import t from"tsignaling-wx";import e from"trtc-wx-sdk";import n from"tim-wx-sdk";function r(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function i(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach((function(e){d(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function a(){a=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r=Object.defineProperty||function(t,e,n){t[e]=n.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function l(t,e,n,i){var a=e&&e.prototype instanceof f?e:f,o=Object.create(a.prototype),s=new b(i||[]);return r(o,"_invoke",{value:_(t,n,s)}),o}function h(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var d={};function f(){}function p(){}function v(){}var g={};u(g,o,(function(){return this}));var y=Object.getPrototypeOf,I=y&&y(y(S([])));I&&I!==e&&n.call(I,o)&&(g=I);var E=v.prototype=f.prototype=Object.create(g);function m(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function i(r,a,o,s){var c=h(t[r],t,a);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==typeof l&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){i("next",t,o,s)}),(function(t){i("throw",t,o,s)})):e.resolve(l).then((function(t){u.value=t,o(u)}),(function(t){return i("throw",t,o,s)}))}s(c.arg)}var a;r(this,"_invoke",{value:function(t,n){function r(){return new e((function(e,r){i(t,n,e,r)}))}return a=a?a.then(r,r):r()}})}function _(t,e,n){var r="suspendedStart";return function(i,a){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw a;return L()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=D(o,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=h(t,e,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===d)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function D(t,e){var n=e.method,r=t.iterator[n];if(void 0===r)return e.delegate=null,"throw"===n&&t.iterator.return&&(e.method="return",e.arg=void 0,D(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=h(r,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,d;var a=i.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,d):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,d)}function C(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function R(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function b(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(C,this),this.reset(!0)}function S(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:L}}function L(){return{value:void 0,done:!0}}return p.prototype=v,r(E,"constructor",{value:v,configurable:!0}),r(v,"constructor",{value:p,configurable:!0}),p.displayName=u(v,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,u(t,c,"GeneratorFunction")),t.prototype=Object.create(E),t},t.awrap=function(t){return{__await:t}},m(T.prototype),u(T.prototype,s,(function(){return this})),t.AsyncIterator=T,t.async=function(e,n,r,i,a){void 0===a&&(a=Promise);var o=new T(l(e,n,r,i),a);return t.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},m(E),u(E,c,"Generator"),u(E,o,(function(){return this})),u(E,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},t.values=S,b.prototype={constructor:b,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(R),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return o.type="throw",o.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(s&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=t,o.arg=e,a?(this.method="next",this.next=a.finallyLoc,d):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),R(n),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;R(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:S(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},t}function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function s(t,e,n,r,i,a,o){try{var s=t[a](o),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,i)}function c(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var a=t.apply(e,n);function o(t){s(a,r,i,o,c,"next",t)}function c(t){s(a,r,i,o,c,"throw",t)}o(void 0)}))}}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,C(r.key),r)}}function h(t,e,n){return e&&l(t.prototype,e),n&&l(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function d(t,e,n){return(e=C(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function f(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&v(t,e)}function p(t){return p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},p(t)}function v(t,e){return v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},v(t,e)}function g(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function y(t,e,n){return y=g()?Reflect.construct.bind():function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&v(i,n.prototype),i},y.apply(null,arguments)}function I(t){var e="function"==typeof Map?new Map:void 0;return I=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return y(t,arguments,p(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),v(r,t)},I(t)}function E(t,e){if(null==t)return{};var n,r,i=function(t,e){if(null==t)return{};var n,r,i={},a=Object.keys(t);for(r=0;r<a.length;r++)n=a[r],e.indexOf(n)>=0||(i[n]=t[n]);return i}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(r=0;r<a.length;r++)n=a[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}function m(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function T(t){var e=g();return function(){var n,r=p(t);if(e){var i=p(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return m(t)}(this,n)}}function _(t){return function(t){if(Array.isArray(t))return D(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return D(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return D(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function C(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}function R(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,S(t,e,"get"))}function b(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,S(t,e,"set"),n),n}function S(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function L(t,e,n){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,n)}var w="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},k=function(t){return t&&t.Math==Math&&t},A=k("object"==typeof globalThis&&globalThis)||k("object"==typeof window&&window)||k("object"==typeof self&&self)||k("object"==typeof w&&w)||function(){return this}()||w||Function("return this")(),O={},x=function(t){try{return!!t()}catch(t){return!0}},N=!x((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),U=!x((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),M=U,P=Function.prototype.call,V=M?P.bind(P):function(){return P.apply(P,arguments)},j={},G={}.propertyIsEnumerable,H=Object.getOwnPropertyDescriptor,B=H&&!G.call({1:2},1);j.f=B?function(t){var e=H(this,t);return!!e&&e.enumerable}:G;var F,K,z=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},J=U,$=Function.prototype,Y=$.call,q=J&&$.bind.bind(Y,Y),W=J?q:function(t){return function(){return Y.apply(t,arguments)}},X=W,Q=X({}.toString),Z=X("".slice),tt=function(t){return Z(Q(t),8,-1)},et=x,nt=tt,rt=Object,it=W("".split),at=et((function(){return!rt("z").propertyIsEnumerable(0)}))?function(t){return"String"==nt(t)?it(t,""):rt(t)}:rt,ot=function(t){return null==t},st=ot,ct=TypeError,ut=function(t){if(st(t))throw ct("Can't call method on "+t);return t},lt=at,ht=ut,dt=function(t){return lt(ht(t))},ft="object"==typeof document&&document.all,pt={all:ft,IS_HTMLDDA:void 0===ft&&void 0!==ft},vt=pt.all,gt=pt.IS_HTMLDDA?function(t){return"function"==typeof t||t===vt}:function(t){return"function"==typeof t},yt=gt,It=pt.all,Et=pt.IS_HTMLDDA?function(t){return"object"==typeof t?null!==t:yt(t)||t===It}:function(t){return"object"==typeof t?null!==t:yt(t)},mt=A,Tt=gt,_t=function(t,e){return arguments.length<2?(n=mt[t],Tt(n)?n:void 0):mt[t]&&mt[t][e];var n},Dt=W({}.isPrototypeOf),Ct="undefined"!=typeof navigator&&String(navigator.userAgent)||"",Rt=A,bt=Ct,St=Rt.process,Lt=Rt.Deno,wt=St&&St.versions||Lt&&Lt.version,kt=wt&&wt.v8;kt&&(K=(F=kt.split("."))[0]>0&&F[0]<4?1:+(F[0]+F[1])),!K&&bt&&(!(F=bt.match(/Edge\/(\d+)/))||F[1]>=74)&&(F=bt.match(/Chrome\/(\d+)/))&&(K=+F[1]);var At=K,Ot=At,xt=x,Nt=A.String,Ut=!!Object.getOwnPropertySymbols&&!xt((function(){var t=Symbol();return!Nt(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&Ot&&Ot<41})),Mt=Ut&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Pt=_t,Vt=gt,jt=Dt,Gt=Object,Ht=Mt?function(t){return"symbol"==typeof t}:function(t){var e=Pt("Symbol");return Vt(e)&&jt(e.prototype,Gt(t))},Bt=String,Ft=function(t){try{return Bt(t)}catch(t){return"Object"}},Kt=gt,zt=Ft,Jt=TypeError,$t=function(t){if(Kt(t))return t;throw Jt(zt(t)+" is not a function")},Yt=$t,qt=ot,Wt=function(t,e){var n=t[e];return qt(n)?void 0:Yt(n)},Xt=V,Qt=gt,Zt=Et,te=TypeError,ee={exports:{}},ne=A,re=Object.defineProperty,ie=function(t,e){try{re(ne,t,{value:e,configurable:!0,writable:!0})}catch(n){ne[t]=e}return e},ae=ie,oe="__core-js_shared__",se=A[oe]||ae(oe,{}),ce=se;(ee.exports=function(t,e){return ce[t]||(ce[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.32.0",mode:"global",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.32.0/LICENSE",source:"https://github.com/zloirock/core-js"});var ue=ut,le=Object,he=function(t){return le(ue(t))},de=he,fe=W({}.hasOwnProperty),pe=Object.hasOwn||function(t,e){return fe(de(t),e)},ve=W,ge=0,ye=Math.random(),Ie=ve(1..toString),Ee=function(t){return"Symbol("+(void 0===t?"":t)+")_"+Ie(++ge+ye,36)},me=A,Te=ee.exports,_e=pe,De=Ee,Ce=Ut,Re=Mt,be=me.Symbol,Se=Te("wks"),Le=Re?be.for||be:be&&be.withoutSetter||De,we=function(t){return _e(Se,t)||(Se[t]=Ce&&_e(be,t)?be[t]:Le("Symbol."+t)),Se[t]},ke=V,Ae=Et,Oe=Ht,xe=Wt,Ne=function(t,e){var n,r;if("string"===e&&Qt(n=t.toString)&&!Zt(r=Xt(n,t)))return r;if(Qt(n=t.valueOf)&&!Zt(r=Xt(n,t)))return r;if("string"!==e&&Qt(n=t.toString)&&!Zt(r=Xt(n,t)))return r;throw te("Can't convert object to primitive value")},Ue=TypeError,Me=we("toPrimitive"),Pe=function(t,e){if(!Ae(t)||Oe(t))return t;var n,r=xe(t,Me);if(r){if(void 0===e&&(e="default"),n=ke(r,t,e),!Ae(n)||Oe(n))return n;throw Ue("Can't convert object to primitive value")}return void 0===e&&(e="number"),Ne(t,e)},Ve=Pe,je=Ht,Ge=function(t){var e=Ve(t,"string");return je(e)?e:e+""},He=Et,Be=A.document,Fe=He(Be)&&He(Be.createElement),Ke=function(t){return Fe?Be.createElement(t):{}},ze=Ke,Je=!N&&!x((function(){return 7!=Object.defineProperty(ze("div"),"a",{get:function(){return 7}}).a})),$e=N,Ye=V,qe=j,We=z,Xe=dt,Qe=Ge,Ze=pe,tn=Je,en=Object.getOwnPropertyDescriptor;O.f=$e?en:function(t,e){if(t=Xe(t),e=Qe(e),tn)try{return en(t,e)}catch(t){}if(Ze(t,e))return We(!Ye(qe.f,t,e),t[e])};var nn={},rn=N&&x((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),an=Et,on=String,sn=TypeError,cn=function(t){if(an(t))return t;throw sn(on(t)+" is not an object")},un=N,ln=Je,hn=rn,dn=cn,fn=Ge,pn=TypeError,vn=Object.defineProperty,gn=Object.getOwnPropertyDescriptor,yn="enumerable",In="configurable",En="writable";nn.f=un?hn?function(t,e,n){if(dn(t),e=fn(e),dn(n),"function"==typeof t&&"prototype"===e&&"value"in n&&En in n&&!n[En]){var r=gn(t,e);r&&r[En]&&(t[e]=n.value,n={configurable:In in n?n[In]:r[In],enumerable:yn in n?n[yn]:r[yn],writable:!1})}return vn(t,e,n)}:vn:function(t,e,n){if(dn(t),e=fn(e),dn(n),ln)try{return vn(t,e,n)}catch(t){}if("get"in n||"set"in n)throw pn("Accessors not supported");return"value"in n&&(t[e]=n.value),t};var mn=nn,Tn=z,_n=N?function(t,e,n){return mn.f(t,e,Tn(1,n))}:function(t,e,n){return t[e]=n,t},Dn={exports:{}},Cn=N,Rn=pe,bn=Function.prototype,Sn=Cn&&Object.getOwnPropertyDescriptor,Ln=Rn(bn,"name"),wn={EXISTS:Ln,PROPER:Ln&&"something"===function(){}.name,CONFIGURABLE:Ln&&(!Cn||Cn&&Sn(bn,"name").configurable)},kn=gt,An=se,On=W(Function.toString);kn(An.inspectSource)||(An.inspectSource=function(t){return On(t)});var xn,Nn,Un,Mn=An.inspectSource,Pn=gt,Vn=A.WeakMap,jn=Pn(Vn)&&/native code/.test(String(Vn)),Gn=ee.exports,Hn=Ee,Bn=Gn("keys"),Fn=function(t){return Bn[t]||(Bn[t]=Hn(t))},Kn={},zn=jn,Jn=A,$n=Et,Yn=_n,qn=pe,Wn=se,Xn=Fn,Qn=Kn,Zn="Object already initialized",tr=Jn.TypeError,er=Jn.WeakMap;if(zn||Wn.state){var nr=Wn.state||(Wn.state=new er);nr.get=nr.get,nr.has=nr.has,nr.set=nr.set,xn=function(t,e){if(nr.has(t))throw tr(Zn);return e.facade=t,nr.set(t,e),e},Nn=function(t){return nr.get(t)||{}},Un=function(t){return nr.has(t)}}else{var rr=Xn("state");Qn[rr]=!0,xn=function(t,e){if(qn(t,rr))throw tr(Zn);return e.facade=t,Yn(t,rr,e),e},Nn=function(t){return qn(t,rr)?t[rr]:{}},Un=function(t){return qn(t,rr)}}var ir={set:xn,get:Nn,has:Un,enforce:function(t){return Un(t)?Nn(t):xn(t,{})},getterFor:function(t){return function(e){var n;if(!$n(e)||(n=Nn(e)).type!==t)throw tr("Incompatible receiver, "+t+" required");return n}}},ar=W,or=x,sr=gt,cr=pe,ur=N,lr=wn.CONFIGURABLE,hr=Mn,dr=ir.enforce,fr=ir.get,pr=String,vr=Object.defineProperty,gr=ar("".slice),yr=ar("".replace),Ir=ar([].join),Er=ur&&!or((function(){return 8!==vr((function(){}),"length",{value:8}).length})),mr=String(String).split("String"),Tr=Dn.exports=function(t,e,n){"Symbol("===gr(pr(e),0,7)&&(e="["+yr(pr(e),/^Symbol\(([^)]*)\)/,"$1")+"]"),n&&n.getter&&(e="get "+e),n&&n.setter&&(e="set "+e),(!cr(t,"name")||lr&&t.name!==e)&&(ur?vr(t,"name",{value:e,configurable:!0}):t.name=e),Er&&n&&cr(n,"arity")&&t.length!==n.arity&&vr(t,"length",{value:n.arity});try{n&&cr(n,"constructor")&&n.constructor?ur&&vr(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var r=dr(t);return cr(r,"source")||(r.source=Ir(mr,"string"==typeof e?e:"")),t};Function.prototype.toString=Tr((function(){return sr(this)&&fr(this).source||hr(this)}),"toString");var _r=gt,Dr=nn,Cr=Dn.exports,Rr=ie,br=function(t,e,n,r){r||(r={});var i=r.enumerable,a=void 0!==r.name?r.name:e;if(_r(n)&&Cr(n,a,r),r.global)i?t[e]=n:Rr(e,n);else{try{r.unsafe?t[e]&&(i=!0):delete t[e]}catch(t){}i?t[e]=n:Dr.f(t,e,{value:n,enumerable:!1,configurable:!r.nonConfigurable,writable:!r.nonWritable})}return t},Sr={},Lr=Math.ceil,wr=Math.floor,kr=Math.trunc||function(t){var e=+t;return(e>0?wr:Lr)(e)},Ar=function(t){var e=+t;return e!=e||0===e?0:kr(e)},Or=Ar,xr=Math.max,Nr=Math.min,Ur=function(t,e){var n=Or(t);return n<0?xr(n+e,0):Nr(n,e)},Mr=Ar,Pr=Math.min,Vr=function(t){return t>0?Pr(Mr(t),9007199254740991):0},jr=Vr,Gr=function(t){return jr(t.length)},Hr=dt,Br=Ur,Fr=Gr,Kr=function(t){return function(e,n,r){var i,a=Hr(e),o=Fr(a),s=Br(r,o);if(t&&n!=n){for(;o>s;)if((i=a[s++])!=i)return!0}else for(;o>s;s++)if((t||s in a)&&a[s]===n)return t||s||0;return!t&&-1}},zr={includes:Kr(!0),indexOf:Kr(!1)},Jr=pe,$r=dt,Yr=zr.indexOf,qr=Kn,Wr=W([].push),Xr=function(t,e){var n,r=$r(t),i=0,a=[];for(n in r)!Jr(qr,n)&&Jr(r,n)&&Wr(a,n);for(;e.length>i;)Jr(r,n=e[i++])&&(~Yr(a,n)||Wr(a,n));return a},Qr=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Zr=Xr,ti=Qr.concat("length","prototype");Sr.f=Object.getOwnPropertyNames||function(t){return Zr(t,ti)};var ei={};ei.f=Object.getOwnPropertySymbols;var ni=_t,ri=Sr,ii=ei,ai=cn,oi=W([].concat),si=ni("Reflect","ownKeys")||function(t){var e=ri.f(ai(t)),n=ii.f;return n?oi(e,n(t)):e},ci=pe,ui=si,li=O,hi=nn,di=x,fi=gt,pi=/#|\.prototype\./,vi=function(t,e){var n=yi[gi(t)];return n==Ei||n!=Ii&&(fi(e)?di(e):!!e)},gi=vi.normalize=function(t){return String(t).replace(pi,".").toLowerCase()},yi=vi.data={},Ii=vi.NATIVE="N",Ei=vi.POLYFILL="P",mi=vi,Ti=A,_i=O.f,Di=_n,Ci=br,Ri=ie,bi=function(t,e,n){for(var r=ui(e),i=hi.f,a=li.f,o=0;o<r.length;o++){var s=r[o];ci(t,s)||n&&ci(n,s)||i(t,s,a(e,s))}},Si=mi,Li=function(t,e){var n,r,i,a,o,s=t.target,c=t.global,u=t.stat;if(n=c?Ti:u?Ti[s]||Ri(s,{}):(Ti[s]||{}).prototype)for(r in e){if(a=e[r],i=t.dontCallGetSet?(o=_i(n,r))&&o.value:n[r],!Si(c?r:s+(u?".":"#")+r,t.forced)&&void 0!==i){if(typeof a==typeof i)continue;bi(a,i)}(t.sham||i&&i.sham)&&Di(a,"sham",!0),Ci(n,r,a,t)}},wi=tt,ki=Array.isArray||function(t){return"Array"==wi(t)},Ai=TypeError,Oi=function(t){if(t>9007199254740991)throw Ai("Maximum allowed index exceeded");return t},xi=Ge,Ni=nn,Ui=z,Mi=function(t,e,n){var r=xi(e);r in t?Ni.f(t,r,Ui(0,n)):t[r]=n},Pi={};Pi[we("toStringTag")]="z";var Vi="[object z]"===String(Pi),ji=Vi,Gi=gt,Hi=tt,Bi=we("toStringTag"),Fi=Object,Ki="Arguments"==Hi(function(){return arguments}()),zi=ji?Hi:function(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Fi(t),Bi))?n:Ki?Hi(e):"Object"==(r=Hi(e))&&Gi(e.callee)?"Arguments":r},Ji=W,$i=x,Yi=gt,qi=zi,Wi=Mn,Xi=function(){},Qi=[],Zi=_t("Reflect","construct"),ta=/^\s*(?:class|function)\b/,ea=Ji(ta.exec),na=!ta.exec(Xi),ra=function(t){if(!Yi(t))return!1;try{return Zi(Xi,Qi,t),!0}catch(t){return!1}},ia=function(t){if(!Yi(t))return!1;switch(qi(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return na||!!ea(ta,Wi(t))}catch(t){return!0}};ia.sham=!0;var aa=!Zi||$i((function(){var t;return ra(ra.call)||!ra(Object)||!ra((function(){t=!0}))||t}))?ia:ra,oa=ki,sa=aa,ca=Et,ua=we("species"),la=Array,ha=function(t){var e;return oa(t)&&(e=t.constructor,(sa(e)&&(e===la||oa(e.prototype))||ca(e)&&null===(e=e[ua]))&&(e=void 0)),void 0===e?la:e},da=function(t,e){return new(ha(t))(0===e?0:e)},fa=x,pa=At,va=we("species"),ga=function(t){return pa>=51||!fa((function(){var e=[];return(e.constructor={})[va]=function(){return{foo:1}},1!==e[t](Boolean).foo}))},ya=Li,Ia=x,Ea=ki,ma=Et,Ta=he,_a=Gr,Da=Oi,Ca=Mi,Ra=da,ba=ga,Sa=At,La=we("isConcatSpreadable"),wa=Sa>=51||!Ia((function(){var t=[];return t[La]=!1,t.concat()[0]!==t})),ka=function(t){if(!ma(t))return!1;var e=t[La];return void 0!==e?!!e:Ea(t)};ya({target:"Array",proto:!0,arity:1,forced:!wa||!ba("concat")},{concat:function(t){var e,n,r,i,a,o=Ta(this),s=Ra(o,0),c=0;for(e=-1,r=arguments.length;e<r;e++)if(ka(a=-1===e?o:arguments[e]))for(i=_a(a),Da(c+i),n=0;n<i;n++,c++)n in a&&Ca(s,c,a[n]);else Da(c+1),Ca(s,c++,a);return s.length=c,s}});var Aa=Xr,Oa=Qr,xa=Object.keys||function(t){return Aa(t,Oa)},Na=he,Ua=xa;Li({target:"Object",stat:!0,forced:x((function(){Ua(1)}))},{keys:function(t){return Ua(Na(t))}});var Ma=tt,Pa=W,Va=function(t){if("Function"===Ma(t))return Pa(t)},ja=x,Ga=function(t,e){var n=[][t];return!!n&&ja((function(){n.call(null,e||function(){return 1},1)}))},Ha=Li,Ba=zr.indexOf,Fa=Ga,Ka=Va([].indexOf),za=!!Ka&&1/Ka([1],1,-0)<0;Ha({target:"Array",proto:!0,forced:za||!Fa("indexOf")},{indexOf:function(t){var e=arguments.length>1?arguments[1]:void 0;return za?Ka(this,t,e)||0:Ba(this,t,e)}});var Ja=$t,$a=U,Ya=Va(Va.bind),qa=function(t,e){return Ja(t),void 0===e?t:$a?Ya(t,e):function(){return t.apply(e,arguments)}},Wa=qa,Xa=at,Qa=he,Za=Gr,to=da,eo=W([].push),no=function(t){var e=1==t,n=2==t,r=3==t,i=4==t,a=6==t,o=7==t,s=5==t||a;return function(c,u,l,h){for(var d,f,p=Qa(c),v=Xa(p),g=Wa(u,l),y=Za(v),I=0,E=h||to,m=e?E(c,y):n||o?E(c,0):void 0;y>I;I++)if((s||I in v)&&(f=g(d=v[I],I,p),t))if(e)m[I]=f;else if(f)switch(t){case 3:return!0;case 5:return d;case 6:return I;case 2:eo(m,d)}else switch(t){case 4:return!1;case 7:eo(m,d)}return a?-1:r||i?i:m}},ro={forEach:no(0),map:no(1),filter:no(2),some:no(3),every:no(4),find:no(5),findIndex:no(6),filterReject:no(7)},io=ro.filter;Li({target:"Array",proto:!0,forced:!ga("filter")},{filter:function(t){return io(this,t,arguments.length>1?arguments[1]:void 0)}});var ao=zi,oo=Vi?{}.toString:function(){return"[object "+ao(this)+"]"};Vi||br(Object.prototype,"toString",oo,{unsafe:!0});var so=W,co=br,uo=Date.prototype,lo="Invalid Date",ho="toString",fo=so(uo[ho]),po=so(uo.getTime);String(new Date(NaN))!=lo&&co(uo,ho,(function(){var t=po(this);return t==t?fo(this):lo}));var vo=ro.map;Li({target:"Array",proto:!0,forced:!ga("map")},{map:function(t){return vo(this,t,arguments.length>1?arguments[1]:void 0)}});var go=Li,yo=Date,Io=W(yo.prototype.getTime);go({target:"Date",stat:!0},{now:function(){return Io(new yo)}});var Eo=N,mo=W,To=V,_o=x,Do=xa,Co=ei,Ro=j,bo=he,So=at,Lo=Object.assign,wo=Object.defineProperty,ko=mo([].concat),Ao=!Lo||_o((function(){if(Eo&&1!==Lo({b:1},Lo(wo({},"a",{enumerable:!0,get:function(){wo(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach((function(t){e[t]=t})),7!=Lo({},t)[n]||Do(Lo({},e)).join("")!=r}))?function(t,e){for(var n=bo(t),r=arguments.length,i=1,a=Co.f,o=Ro.f;r>i;)for(var s,c=So(arguments[i++]),u=a?ko(Do(c),a(c)):Do(c),l=u.length,h=0;l>h;)s=u[h++],Eo&&!To(o,c,s)||(n[s]=c[s]);return n}:Lo,Oo=Ao;Li({target:"Object",stat:!0,arity:2,forced:Object.assign!==Oo},{assign:Oo});var xo,No,Uo,Mo,Po="undefined"!=typeof process&&"process"==tt(process),Vo=W,jo=$t,Go=gt,Ho=String,Bo=TypeError,Fo=function(t,e,n){try{return Vo(jo(Object.getOwnPropertyDescriptor(t,e)[n]))}catch(t){}},Ko=cn,zo=function(t){if("object"==typeof t||Go(t))return t;throw Bo("Can't set "+Ho(t)+" as a prototype")},Jo=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=Fo(Object.prototype,"__proto__","set"))(n,[]),e=n instanceof Array}catch(t){}return function(n,r){return Ko(n),zo(r),e?t(n,r):n.__proto__=r,n}}():void 0),$o=nn.f,Yo=pe,qo=we("toStringTag"),Wo=function(t,e,n){t&&!n&&(t=t.prototype),t&&!Yo(t,qo)&&$o(t,qo,{configurable:!0,value:e})},Xo=Dn.exports,Qo=nn,Zo=function(t,e,n){return n.get&&Xo(n.get,e,{getter:!0}),n.set&&Xo(n.set,e,{setter:!0}),Qo.f(t,e,n)},ts=_t,es=Zo,ns=N,rs=we("species"),is=function(t){var e=ts(t);ns&&e&&!e[rs]&&es(e,rs,{configurable:!0,get:function(){return this}})},as=Dt,os=TypeError,ss=function(t,e){if(as(e,t))return t;throw os("Incorrect invocation")},cs=aa,us=Ft,ls=TypeError,hs=cn,ds=function(t){if(cs(t))return t;throw ls(us(t)+" is not a constructor")},fs=ot,ps=we("species"),vs=U,gs=Function.prototype,ys=gs.apply,Is=gs.call,Es="object"==typeof Reflect&&Reflect.apply||(vs?Is.bind(ys):function(){return Is.apply(ys,arguments)}),ms=_t("document","documentElement"),Ts=W([].slice),_s=TypeError,Ds=function(t,e){if(t<e)throw _s("Not enough arguments");return t},Cs=/(?:ipad|iphone|ipod).*applewebkit/i.test(Ct),Rs=A,bs=Es,Ss=qa,Ls=gt,ws=pe,ks=x,As=ms,Os=Ts,xs=Ke,Ns=Ds,Us=Cs,Ms=Po,Ps=Rs.setImmediate,Vs=Rs.clearImmediate,js=Rs.process,Gs=Rs.Dispatch,Hs=Rs.Function,Bs=Rs.MessageChannel,Fs=Rs.String,Ks=0,zs={},Js="onreadystatechange";ks((function(){xo=Rs.location}));var $s=function(t){if(ws(zs,t)){var e=zs[t];delete zs[t],e()}},Ys=function(t){return function(){$s(t)}},qs=function(t){$s(t.data)},Ws=function(t){Rs.postMessage(Fs(t),xo.protocol+"//"+xo.host)};Ps&&Vs||(Ps=function(t){Ns(arguments.length,1);var e=Ls(t)?t:Hs(t),n=Os(arguments,1);return zs[++Ks]=function(){bs(e,void 0,n)},No(Ks),Ks},Vs=function(t){delete zs[t]},Ms?No=function(t){js.nextTick(Ys(t))}:Gs&&Gs.now?No=function(t){Gs.now(Ys(t))}:Bs&&!Us?(Mo=(Uo=new Bs).port2,Uo.port1.onmessage=qs,No=Ss(Mo.postMessage,Mo)):Rs.addEventListener&&Ls(Rs.postMessage)&&!Rs.importScripts&&xo&&"file:"!==xo.protocol&&!ks(Ws)?(No=Ws,Rs.addEventListener("message",qs,!1)):No=Js in xs("script")?function(t){As.appendChild(xs("script"))[Js]=function(){As.removeChild(this),$s(t)}}:function(t){setTimeout(Ys(t),0)});var Xs={set:Ps,clear:Vs},Qs=function(){this.head=null,this.tail=null};Qs.prototype={add:function(t){var e={item:t,next:null},n=this.tail;n?n.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return null===(this.head=t.next)&&(this.tail=null),t.item}};var Zs,tc,ec,nc,rc,ic=Qs,ac=/ipad|iphone|ipod/i.test(Ct)&&"undefined"!=typeof Pebble,oc=/web0s(?!.*chrome)/i.test(Ct),sc=A,cc=qa,uc=O.f,lc=Xs.set,hc=ic,dc=Cs,fc=ac,pc=oc,vc=Po,gc=sc.MutationObserver||sc.WebKitMutationObserver,yc=sc.document,Ic=sc.process,Ec=sc.Promise,mc=uc(sc,"queueMicrotask"),Tc=mc&&mc.value;if(!Tc){var _c=new hc,Dc=function(){var t,e;for(vc&&(t=Ic.domain)&&t.exit();e=_c.get();)try{e()}catch(t){throw _c.head&&Zs(),t}t&&t.enter()};dc||vc||pc||!gc||!yc?!fc&&Ec&&Ec.resolve?((nc=Ec.resolve(void 0)).constructor=Ec,rc=cc(nc.then,nc),Zs=function(){rc(Dc)}):vc?Zs=function(){Ic.nextTick(Dc)}:(lc=cc(lc,sc),Zs=function(){lc(Dc)}):(tc=!0,ec=yc.createTextNode(""),new gc(Dc).observe(ec,{characterData:!0}),Zs=function(){ec.data=tc=!tc}),Tc=function(t){_c.head||Zs(),_c.add(t)}}var Cc=Tc,Rc=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},bc=A.Promise,Sc="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,Lc=!Sc&&!Po&&"object"==typeof window&&"object"==typeof document,wc=A,kc=bc,Ac=gt,Oc=mi,xc=Mn,Nc=we,Uc=Lc,Mc=Sc,Pc=At;kc&&kc.prototype;var Vc=Nc("species"),jc=!1,Gc=Ac(wc.PromiseRejectionEvent),Hc=Oc("Promise",(function(){var t=xc(kc),e=t!==String(kc);if(!e&&66===Pc)return!0;if(!Pc||Pc<51||!/native code/.test(t)){var n=new kc((function(t){t(1)})),r=function(t){t((function(){}),(function(){}))};if((n.constructor={})[Vc]=r,!(jc=n.then((function(){}))instanceof r))return!0}return!e&&(Uc||Mc)&&!Gc})),Bc={CONSTRUCTOR:Hc,REJECTION_EVENT:Gc,SUBCLASSING:jc},Fc={},Kc=$t,zc=TypeError,Jc=function(t){var e,n;this.promise=new t((function(t,r){if(void 0!==e||void 0!==n)throw zc("Bad Promise constructor");e=t,n=r})),this.resolve=Kc(e),this.reject=Kc(n)};Fc.f=function(t){return new Jc(t)};var $c,Yc,qc,Wc=Li,Xc=Po,Qc=A,Zc=V,tu=br,eu=Jo,nu=Wo,ru=is,iu=$t,au=gt,ou=Et,su=ss,cu=function(t,e){var n,r=hs(t).constructor;return void 0===r||fs(n=hs(r)[ps])?e:ds(n)},uu=Xs.set,lu=Cc,hu=function(t,e){try{1==arguments.length?console.error(t):console.error(t,e)}catch(t){}},du=Rc,fu=ic,pu=ir,vu=bc,gu=Fc,yu="Promise",Iu=Bc.CONSTRUCTOR,Eu=Bc.REJECTION_EVENT,mu=Bc.SUBCLASSING,Tu=pu.getterFor(yu),_u=pu.set,Du=vu&&vu.prototype,Cu=vu,Ru=Du,bu=Qc.TypeError,Su=Qc.document,Lu=Qc.process,wu=gu.f,ku=wu,Au=!!(Su&&Su.createEvent&&Qc.dispatchEvent),Ou="unhandledrejection",xu=function(t){var e;return!(!ou(t)||!au(e=t.then))&&e},Nu=function(t,e){var n,r,i,a=e.value,o=1==e.state,s=o?t.ok:t.fail,c=t.resolve,u=t.reject,l=t.domain;try{s?(o||(2===e.rejection&&ju(e),e.rejection=1),!0===s?n=a:(l&&l.enter(),n=s(a),l&&(l.exit(),i=!0)),n===t.promise?u(bu("Promise-chain cycle")):(r=xu(n))?Zc(r,n,c,u):c(n)):u(a)}catch(t){l&&!i&&l.exit(),u(t)}},Uu=function(t,e){t.notified||(t.notified=!0,lu((function(){for(var n,r=t.reactions;n=r.get();)Nu(n,t);t.notified=!1,e&&!t.rejection&&Pu(t)})))},Mu=function(t,e,n){var r,i;Au?((r=Su.createEvent("Event")).promise=e,r.reason=n,r.initEvent(t,!1,!0),Qc.dispatchEvent(r)):r={promise:e,reason:n},!Eu&&(i=Qc["on"+t])?i(r):t===Ou&&hu("Unhandled promise rejection",n)},Pu=function(t){Zc(uu,Qc,(function(){var e,n=t.facade,r=t.value;if(Vu(t)&&(e=du((function(){Xc?Lu.emit("unhandledRejection",r,n):Mu(Ou,n,r)})),t.rejection=Xc||Vu(t)?2:1,e.error))throw e.value}))},Vu=function(t){return 1!==t.rejection&&!t.parent},ju=function(t){Zc(uu,Qc,(function(){var e=t.facade;Xc?Lu.emit("rejectionHandled",e):Mu("rejectionhandled",e,t.value)}))},Gu=function(t,e,n){return function(r){t(e,r,n)}},Hu=function(t,e,n){t.done||(t.done=!0,n&&(t=n),t.value=e,t.state=2,Uu(t,!0))},Bu=function(t,e,n){if(!t.done){t.done=!0,n&&(t=n);try{if(t.facade===e)throw bu("Promise can't be resolved itself");var r=xu(e);r?lu((function(){var n={done:!1};try{Zc(r,e,Gu(Bu,n,t),Gu(Hu,n,t))}catch(e){Hu(n,e,t)}})):(t.value=e,t.state=1,Uu(t,!1))}catch(e){Hu({done:!1},e,t)}}};if(Iu&&(Ru=(Cu=function(t){su(this,Ru),iu(t),Zc($c,this);var e=Tu(this);try{t(Gu(Bu,e),Gu(Hu,e))}catch(t){Hu(e,t)}}).prototype,($c=function(t){_u(this,{type:yu,done:!1,notified:!1,parent:!1,reactions:new fu,rejection:!1,state:0,value:void 0})}).prototype=tu(Ru,"then",(function(t,e){var n=Tu(this),r=wu(cu(this,Cu));return n.parent=!0,r.ok=!au(t)||t,r.fail=au(e)&&e,r.domain=Xc?Lu.domain:void 0,0==n.state?n.reactions.add(r):lu((function(){Nu(r,n)})),r.promise})),Yc=function(){var t=new $c,e=Tu(t);this.promise=t,this.resolve=Gu(Bu,e),this.reject=Gu(Hu,e)},gu.f=wu=function(t){return t===Cu||undefined===t?new Yc(t):ku(t)},au(vu)&&Du!==Object.prototype)){qc=Du.then,mu||tu(Du,"then",(function(t,e){var n=this;return new Cu((function(t,e){Zc(qc,n,t,e)})).then(t,e)}),{unsafe:!0});try{delete Du.constructor}catch(t){}eu&&eu(Du,Ru)}Wc({global:!0,constructor:!0,wrap:!0,forced:Iu},{Promise:Cu}),nu(Cu,yu,!1),ru(yu);var Fu={},Ku=Fu,zu=we("iterator"),Ju=Array.prototype,$u=function(t){return void 0!==t&&(Ku.Array===t||Ju[zu]===t)},Yu=zi,qu=Wt,Wu=ot,Xu=Fu,Qu=we("iterator"),Zu=function(t){if(!Wu(t))return qu(t,Qu)||qu(t,"@@iterator")||Xu[Yu(t)]},tl=V,el=$t,nl=cn,rl=Ft,il=Zu,al=TypeError,ol=function(t,e){var n=arguments.length<2?il(t):e;if(el(n))return nl(tl(n,t));throw al(rl(t)+" is not iterable")},sl=V,cl=cn,ul=Wt,ll=function(t,e,n){var r,i;cl(t);try{if(!(r=ul(t,"return"))){if("throw"===e)throw n;return n}r=sl(r,t)}catch(t){i=!0,r=t}if("throw"===e)throw n;if(i)throw r;return cl(r),n},hl=qa,dl=V,fl=cn,pl=Ft,vl=$u,gl=Gr,yl=Dt,Il=ol,El=Zu,ml=ll,Tl=TypeError,_l=function(t,e){this.stopped=t,this.result=e},Dl=_l.prototype,Cl=function(t,e,n){var r,i,a,o,s,c,u,l=n&&n.that,h=!(!n||!n.AS_ENTRIES),d=!(!n||!n.IS_RECORD),f=!(!n||!n.IS_ITERATOR),p=!(!n||!n.INTERRUPTED),v=hl(e,l),g=function(t){return r&&ml(r,"normal",t),new _l(!0,t)},y=function(t){return h?(fl(t),p?v(t[0],t[1],g):v(t[0],t[1])):p?v(t,g):v(t)};if(d)r=t.iterator;else if(f)r=t;else{if(!(i=El(t)))throw Tl(pl(t)+" is not iterable");if(vl(i)){for(a=0,o=gl(t);o>a;a++)if((s=y(t[a]))&&yl(Dl,s))return s;return new _l(!1)}r=Il(t,i)}for(c=d?t.next:r.next;!(u=dl(c,r)).done;){try{s=y(u.value)}catch(t){ml(r,"throw",t)}if("object"==typeof s&&s&&yl(Dl,s))return s}return new _l(!1)},Rl=we("iterator"),bl=!1;try{var Sl=0,Ll={next:function(){return{done:!!Sl++}},return:function(){bl=!0}};Ll[Rl]=function(){return this},Array.from(Ll,(function(){throw 2}))}catch(t){}var wl=function(t,e){if(!e&&!bl)return!1;var n=!1;try{var r={};r[Rl]=function(){return{next:function(){return{done:n=!0}}}},t(r)}catch(t){}return n},kl=bc,Al=Bc.CONSTRUCTOR||!wl((function(t){kl.all(t).then(void 0,(function(){}))})),Ol=V,xl=$t,Nl=Fc,Ul=Rc,Ml=Cl;Li({target:"Promise",stat:!0,forced:Al},{all:function(t){var e=this,n=Nl.f(e),r=n.resolve,i=n.reject,a=Ul((function(){var n=xl(e.resolve),a=[],o=0,s=1;Ml(t,(function(t){var c=o++,u=!1;s++,Ol(n,e,t).then((function(t){u||(u=!0,a[c]=t,--s||r(a))}),i)})),--s||r(a)}));return a.error&&i(a.value),n.promise}});var Pl=Li,Vl=Bc.CONSTRUCTOR,jl=bc,Gl=_t,Hl=gt,Bl=br,Fl=jl&&jl.prototype;if(Pl({target:"Promise",proto:!0,forced:Vl,real:!0},{catch:function(t){return this.then(void 0,t)}}),Hl(jl)){var Kl=Gl("Promise").prototype.catch;Fl.catch!==Kl&&Bl(Fl,"catch",Kl,{unsafe:!0})}var zl=V,Jl=$t,$l=Fc,Yl=Rc,ql=Cl;Li({target:"Promise",stat:!0,forced:Al},{race:function(t){var e=this,n=$l.f(e),r=n.reject,i=Yl((function(){var i=Jl(e.resolve);ql(t,(function(t){zl(i,e,t).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}});var Wl=V,Xl=Fc;Li({target:"Promise",stat:!0,forced:Bc.CONSTRUCTOR},{reject:function(t){var e=Xl.f(this);return Wl(e.reject,void 0,t),e.promise}});var Ql=cn,Zl=Et,th=Fc,eh=Li,nh=Bc.CONSTRUCTOR,rh=function(t,e){if(Ql(t),Zl(e)&&e.constructor===t)return e;var n=th.f(t);return(0,n.resolve)(e),n.promise};_t("Promise"),eh({target:"Promise",stat:!0,forced:nh},{resolve:function(t){return rh(this,t)}});var ih="function"==typeof Bun&&Bun&&"string"==typeof Bun.version,ah=A,oh=Es,sh=gt,ch=ih,uh=Ct,lh=Ts,hh=Ds,dh=ah.Function,fh=/MSIE .\./.test(uh)||ch&&function(){var t=ah.Bun.version.split(".");return t.length<3||0==t[0]&&(t[1]<3||3==t[1]&&0==t[2])}(),ph=function(t,e){var n=e?2:1;return fh?function(r,i){var a=hh(arguments.length,1)>n,o=sh(r)?r:dh(r),s=a?lh(arguments,n):[],c=a?function(){oh(o,this,s)}:o;return e?t(c,i):t(c)}:t},vh=Li,gh=A,yh=ph(gh.setInterval,!0);vh({global:!0,bind:!0,forced:gh.setInterval!==yh},{setInterval:yh});var Ih=Li,Eh=A,mh=ph(Eh.setTimeout,!0);Ih({global:!0,bind:!0,forced:Eh.setTimeout!==mh},{setTimeout:mh});var Th=zi,_h=String,Dh=function(t){if("Symbol"===Th(t))throw TypeError("Cannot convert a Symbol value to a string");return _h(t)},Ch=W,Rh=Ar,bh=Dh,Sh=ut,Lh=Ch("".charAt),wh=Ch("".charCodeAt),kh=Ch("".slice),Ah=function(t){return function(e,n){var r,i,a=bh(Sh(e)),o=Rh(n),s=a.length;return o<0||o>=s?t?"":void 0:(r=wh(a,o))<55296||r>56319||o+1===s||(i=wh(a,o+1))<56320||i>57343?t?Lh(a,o):r:t?kh(a,o,o+2):i-56320+(r-55296<<10)+65536}},Oh={codeAt:Ah(!1),charAt:Ah(!0)},xh={},Nh=N,Uh=rn,Mh=nn,Ph=cn,Vh=dt,jh=xa;xh.f=Nh&&!Uh?Object.defineProperties:function(t,e){Ph(t);for(var n,r=Vh(e),i=jh(e),a=i.length,o=0;a>o;)Mh.f(t,n=i[o++],r[n]);return t};var Gh,Hh=cn,Bh=xh,Fh=Qr,Kh=Kn,zh=ms,Jh=Ke,$h="prototype",Yh="script",qh=Fn("IE_PROTO"),Wh=function(){},Xh=function(t){return"<"+Yh+">"+t+"</"+Yh+">"},Qh=function(t){t.write(Xh("")),t.close();var e=t.parentWindow.Object;return t=null,e},Zh=function(){try{Gh=new ActiveXObject("htmlfile")}catch(t){}var t,e,n;Zh="undefined"!=typeof document?document.domain&&Gh?Qh(Gh):(e=Jh("iframe"),n="java"+Yh+":",e.style.display="none",zh.appendChild(e),e.src=String(n),(t=e.contentWindow.document).open(),t.write(Xh("document.F=Object")),t.close(),t.F):Qh(Gh);for(var r=Fh.length;r--;)delete Zh[$h][Fh[r]];return Zh()};Kh[qh]=!0;var td,ed,nd,rd=Object.create||function(t,e){var n;return null!==t?(Wh[$h]=Hh(t),n=new Wh,Wh[$h]=null,n[qh]=t):n=Zh(),void 0===e?n:Bh.f(n,e)},id=!x((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),ad=pe,od=gt,sd=he,cd=id,ud=Fn("IE_PROTO"),ld=Object,hd=ld.prototype,dd=cd?ld.getPrototypeOf:function(t){var e=sd(t);if(ad(e,ud))return e[ud];var n=e.constructor;return od(n)&&e instanceof n?n.prototype:e instanceof ld?hd:null},fd=x,pd=gt,vd=Et,gd=dd,yd=br,Id=we("iterator"),Ed=!1;[].keys&&("next"in(nd=[].keys())?(ed=gd(gd(nd)))!==Object.prototype&&(td=ed):Ed=!0);var md=!vd(td)||fd((function(){var t={};return td[Id].call(t)!==t}));md&&(td={}),pd(td[Id])||yd(td,Id,(function(){return this}));var Td={IteratorPrototype:td,BUGGY_SAFARI_ITERATORS:Ed},_d=Td.IteratorPrototype,Dd=rd,Cd=z,Rd=Wo,bd=Fu,Sd=function(){return this},Ld=Li,wd=V,kd=gt,Ad=function(t,e,n,r){var i=e+" Iterator";return t.prototype=Dd(_d,{next:Cd(+!r,n)}),Rd(t,i,!1),bd[i]=Sd,t},Od=dd,xd=Jo,Nd=Wo,Ud=_n,Md=br,Pd=Fu,Vd=wn.PROPER,jd=wn.CONFIGURABLE,Gd=Td.IteratorPrototype,Hd=Td.BUGGY_SAFARI_ITERATORS,Bd=we("iterator"),Fd="keys",Kd="values",zd="entries",Jd=function(){return this},$d=function(t,e,n,r,i,a,o){Ad(n,e,r);var s,c,u,l=function(t){if(t===i&&v)return v;if(!Hd&&t in f)return f[t];switch(t){case Fd:case Kd:case zd:return function(){return new n(this,t)}}return function(){return new n(this)}},h=e+" Iterator",d=!1,f=t.prototype,p=f[Bd]||f["@@iterator"]||i&&f[i],v=!Hd&&p||l(i),g="Array"==e&&f.entries||p;if(g&&(s=Od(g.call(new t)))!==Object.prototype&&s.next&&(Od(s)!==Gd&&(xd?xd(s,Gd):kd(s[Bd])||Md(s,Bd,Jd)),Nd(s,h,!0)),Vd&&i==Kd&&p&&p.name!==Kd&&(jd?Ud(f,"name",Kd):(d=!0,v=function(){return wd(p,this)})),i)if(c={values:l(Kd),keys:a?v:l(Fd),entries:l(zd)},o)for(u in c)(Hd||d||!(u in f))&&Md(f,u,c[u]);else Ld({target:e,proto:!0,forced:Hd||d},c);return f[Bd]!==v&&Md(f,Bd,v,{name:i}),Pd[e]=v,c},Yd=function(t,e){return{value:t,done:e}},qd=Oh.charAt,Wd=Dh,Xd=ir,Qd=$d,Zd=Yd,tf="String Iterator",ef=Xd.set,nf=Xd.getterFor(tf);Qd(String,"String",(function(t){ef(this,{type:tf,string:Wd(t),index:0})}),(function(){var t,e=nf(this),n=e.string,r=e.index;return r>=n.length?Zd(void 0,!0):(t=qd(n,r),e.index+=t.length,Zd(t,!1))}));var rf=we,af=rd,of=nn.f,sf=rf("unscopables"),cf=Array.prototype;null==cf[sf]&&of(cf,sf,{configurable:!0,value:af(null)});var uf=function(t){cf[sf][t]=!0},lf=dt,hf=uf,df=Fu,ff=ir,pf=nn.f,vf=$d,gf=Yd,yf=N,If="Array Iterator",Ef=ff.set,mf=ff.getterFor(If),Tf=vf(Array,"Array",(function(t,e){Ef(this,{type:If,target:lf(t),index:0,kind:e})}),(function(){var t=mf(this),e=t.target,n=t.kind,r=t.index++;return!e||r>=e.length?(t.target=void 0,gf(void 0,!0)):gf("keys"==n?r:"values"==n?e[r]:[r,e[r]],!1)}),"values"),_f=df.Arguments=df.Array;if(hf("keys"),hf("values"),hf("entries"),yf&&"values"!==_f.name)try{pf(_f,"name",{value:"values"})}catch(t){}var Df={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Cf=Ke("span").classList,Rf=Cf&&Cf.constructor&&Cf.constructor.prototype,bf=Rf===Object.prototype?void 0:Rf,Sf=A,Lf=Df,wf=bf,kf=Tf,Af=_n,Of=we,xf=Of("iterator"),Nf=Of("toStringTag"),Uf=kf.values,Mf=function(t,e){if(t){if(t[xf]!==Uf)try{Af(t,xf,Uf)}catch(e){t[xf]=Uf}if(t[Nf]||Af(t,Nf,e),Lf[e])for(var n in kf)if(t[n]!==kf[n])try{Af(t,n,kf[n])}catch(e){t[n]=kf[n]}}};for(var Pf in Lf)Mf(Sf[Pf]&&Sf[Pf].prototype,Pf);Mf(wf,"DOMTokenList");var Vf=Li,jf=ki,Gf=aa,Hf=Et,Bf=Ur,Ff=Gr,Kf=dt,zf=Mi,Jf=we,$f=Ts,Yf=ga("slice"),qf=Jf("species"),Wf=Array,Xf=Math.max;Vf({target:"Array",proto:!0,forced:!Yf},{slice:function(t,e){var n,r,i,a=Kf(this),o=Ff(a),s=Bf(t,o),c=Bf(void 0===e?o:e,o);if(jf(a)&&(n=a.constructor,(Gf(n)&&(n===Wf||jf(n.prototype))||Hf(n)&&null===(n=n[qf]))&&(n=void 0),n===Wf||void 0===n))return $f(a,s,c);for(r=new(void 0===n?Wf:n)(Xf(c-s,0)),i=0;s<c;s++,i++)s in a&&zf(r,i,a[s]);return r.length=i,r}});var Qf=ro.forEach,Zf=Ga("forEach")?[].forEach:function(t){return Qf(this,t,arguments.length>1?arguments[1]:void 0)};Li({target:"Array",proto:!0,forced:[].forEach!=Zf},{forEach:Zf});var tp=A,ep=Df,np=bf,rp=Zf,ip=_n,ap=function(t){if(t&&t.forEach!==rp)try{ip(t,"forEach",rp)}catch(e){t.forEach=rp}};for(var op in ep)ep[op]&&ap(tp[op]&&tp[op].prototype);ap(np);var sp=cn,cp=ll,up=qa,lp=V,hp=he,dp=function(t,e,n,r){try{return r?e(sp(n)[0],n[1]):e(n)}catch(e){cp(t,"throw",e)}},fp=$u,pp=aa,vp=Gr,gp=Mi,yp=ol,Ip=Zu,Ep=Array,mp=function(t){var e=hp(t),n=pp(this),r=arguments.length,i=r>1?arguments[1]:void 0,a=void 0!==i;a&&(i=up(i,r>2?arguments[2]:void 0));var o,s,c,u,l,h,d=Ip(e),f=0;if(!d||this===Ep&&fp(d))for(o=vp(e),s=n?new this(o):Ep(o);o>f;f++)h=a?i(e[f],f):e[f],gp(s,f,h);else for(l=(u=yp(e,d)).next,s=n?new this:[];!(c=lp(l,u)).done;f++)h=a?dp(u,i,[c.value,f],!0):c.value,gp(s,f,h);return s.length=f,s};Li({target:"Array",stat:!0,forced:!wl((function(t){Array.from(t)}))},{from:mp});var Tp={exports:{}},_p={},Dp=Ur,Cp=Gr,Rp=Mi,bp=Array,Sp=Math.max,Lp=tt,wp=dt,kp=Sr.f,Ap=function(t,e,n){for(var r=Cp(t),i=Dp(e,r),a=Dp(void 0===n?r:n,r),o=bp(Sp(a-i,0)),s=0;i<a;i++,s++)Rp(o,s,t[i]);return o.length=s,o},Op="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];_p.f=function(t){return Op&&"Window"==Lp(t)?function(t){try{return kp(t)}catch(t){return Ap(Op)}}(t):kp(wp(t))};var xp=x((function(){if("function"==typeof ArrayBuffer){var t=new ArrayBuffer(8);Object.isExtensible(t)&&Object.defineProperty(t,"a",{value:8})}})),Np=x,Up=Et,Mp=tt,Pp=xp,Vp=Object.isExtensible,jp=Np((function(){Vp(1)}))||Pp?function(t){return!!Up(t)&&((!Pp||"ArrayBuffer"!=Mp(t))&&(!Vp||Vp(t)))}:Vp,Gp=!x((function(){return Object.isExtensible(Object.preventExtensions({}))})),Hp=Li,Bp=W,Fp=Kn,Kp=Et,zp=pe,Jp=nn.f,$p=Sr,Yp=_p,qp=jp,Wp=Gp,Xp=!1,Qp=Ee("meta"),Zp=0,tv=function(t){Jp(t,Qp,{value:{objectID:"O"+Zp++,weakData:{}}})},ev=Tp.exports={enable:function(){ev.enable=function(){},Xp=!0;var t=$p.f,e=Bp([].splice),n={};n[Qp]=1,t(n).length&&($p.f=function(n){for(var r=t(n),i=0,a=r.length;i<a;i++)if(r[i]===Qp){e(r,i,1);break}return r},Hp({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:Yp.f}))},fastKey:function(t,e){if(!Kp(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!zp(t,Qp)){if(!qp(t))return"F";if(!e)return"E";tv(t)}return t[Qp].objectID},getWeakData:function(t,e){if(!zp(t,Qp)){if(!qp(t))return!0;if(!e)return!1;tv(t)}return t[Qp].weakData},onFreeze:function(t){return Wp&&Xp&&qp(t)&&!zp(t,Qp)&&tv(t),t}};Fp[Qp]=!0;var nv=gt,rv=Et,iv=Jo,av=function(t,e,n){var r,i;return iv&&nv(r=e.constructor)&&r!==n&&rv(i=r.prototype)&&i!==n.prototype&&iv(t,i),t},ov=Li,sv=A,cv=W,uv=mi,lv=br,hv=Tp.exports,dv=Cl,fv=ss,pv=gt,vv=ot,gv=Et,yv=x,Iv=wl,Ev=Wo,mv=av,Tv=function(t,e,n){var r=-1!==t.indexOf("Map"),i=-1!==t.indexOf("Weak"),a=r?"set":"add",o=sv[t],s=o&&o.prototype,c=o,u={},l=function(t){var e=cv(s[t]);lv(s,t,"add"==t?function(t){return e(this,0===t?0:t),this}:"delete"==t?function(t){return!(i&&!gv(t))&&e(this,0===t?0:t)}:"get"==t?function(t){return i&&!gv(t)?void 0:e(this,0===t?0:t)}:"has"==t?function(t){return!(i&&!gv(t))&&e(this,0===t?0:t)}:function(t,n){return e(this,0===t?0:t,n),this})};if(uv(t,!pv(o)||!(i||s.forEach&&!yv((function(){(new o).entries().next()})))))c=n.getConstructor(e,t,r,a),hv.enable();else if(uv(t,!0)){var h=new c,d=h[a](i?{}:-0,1)!=h,f=yv((function(){h.has(1)})),p=Iv((function(t){new o(t)})),v=!i&&yv((function(){for(var t=new o,e=5;e--;)t[a](e,e);return!t.has(-0)}));p||((c=e((function(t,e){fv(t,s);var n=mv(new o,t,c);return vv(e)||dv(e,n[a],{that:n,AS_ENTRIES:r}),n}))).prototype=s,s.constructor=c),(f||v)&&(l("delete"),l("has"),r&&l("get")),(v||d)&&l(a),i&&s.clear&&delete s.clear}return u[t]=c,ov({global:!0,constructor:!0,forced:c!=o},u),Ev(c,t),i||n.setStrong(c,t,r),c},_v=br,Dv=function(t,e,n){for(var r in e)_v(t,r,e[r],n);return t},Cv=rd,Rv=Zo,bv=Dv,Sv=qa,Lv=ss,wv=ot,kv=Cl,Av=$d,Ov=Yd,xv=is,Nv=N,Uv=Tp.exports.fastKey,Mv=ir.set,Pv=ir.getterFor,Vv={getConstructor:function(t,e,n,r){var i=t((function(t,i){Lv(t,a),Mv(t,{type:e,index:Cv(null),first:void 0,last:void 0,size:0}),Nv||(t.size=0),wv(i)||kv(i,t[r],{that:t,AS_ENTRIES:n})})),a=i.prototype,o=Pv(e),s=function(t,e,n){var r,i,a=o(t),s=c(t,e);return s?s.value=n:(a.last=s={index:i=Uv(e,!0),key:e,value:n,previous:r=a.last,next:void 0,removed:!1},a.first||(a.first=s),r&&(r.next=s),Nv?a.size++:t.size++,"F"!==i&&(a.index[i]=s)),t},c=function(t,e){var n,r=o(t),i=Uv(e);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key==e)return n};return bv(a,{clear:function(){for(var t=o(this),e=t.index,n=t.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete e[n.index],n=n.next;t.first=t.last=void 0,Nv?t.size=0:this.size=0},delete:function(t){var e=this,n=o(e),r=c(e,t);if(r){var i=r.next,a=r.previous;delete n.index[r.index],r.removed=!0,a&&(a.next=i),i&&(i.previous=a),n.first==r&&(n.first=i),n.last==r&&(n.last=a),Nv?n.size--:e.size--}return!!r},forEach:function(t){for(var e,n=o(this),r=Sv(t,arguments.length>1?arguments[1]:void 0);e=e?e.next:n.first;)for(r(e.value,e.key,this);e&&e.removed;)e=e.previous},has:function(t){return!!c(this,t)}}),bv(a,n?{get:function(t){var e=c(this,t);return e&&e.value},set:function(t,e){return s(this,0===t?0:t,e)}}:{add:function(t){return s(this,t=0===t?0:t,t)}}),Nv&&Rv(a,"size",{configurable:!0,get:function(){return o(this).size}}),i},setStrong:function(t,e,n){var r=e+" Iterator",i=Pv(e),a=Pv(r);Av(t,e,(function(t,e){Mv(this,{type:r,target:t,state:i(t),kind:e,last:void 0})}),(function(){for(var t=a(this),e=t.kind,n=t.last;n&&n.removed;)n=n.previous;return t.target&&(t.last=n=n?n.next:t.state.first)?Ov("keys"==e?n.key:"values"==e?n.value:[n.key,n.value],!1):(t.target=void 0,Ov(void 0,!0))}),n?"entries":"values",!n,!0),xv(e)}};Tv("Set",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),Vv);var jv=N,Gv=ki,Hv=TypeError,Bv=Object.getOwnPropertyDescriptor,Fv=jv&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}()?function(t,e){if(Gv(t)&&!Bv(t,"length").writable)throw Hv("Cannot set read only .length");return t.length=e}:function(t,e){return t.length=e},Kv=Ft,zv=TypeError,Jv=Li,$v=he,Yv=Ur,qv=Ar,Wv=Gr,Xv=Fv,Qv=Oi,Zv=da,tg=Mi,eg=function(t,e){if(!delete t[e])throw zv("Cannot delete property "+Kv(e)+" of "+Kv(t))},ng=ga("splice"),rg=Math.max,ig=Math.min;Jv({target:"Array",proto:!0,forced:!ng},{splice:function(t,e){var n,r,i,a,o,s,c=$v(this),u=Wv(c),l=Yv(t,u),h=arguments.length;for(0===h?n=r=0:1===h?(n=0,r=u-l):(n=h-2,r=ig(rg(qv(e),0),u-l)),Qv(u+n-r),i=Zv(c,r),a=0;a<r;a++)(o=l+a)in c&&tg(i,a,c[o]);if(i.length=r,n<r){for(a=l;a<u-r;a++)s=a+n,(o=a+r)in c?c[s]=c[o]:eg(c,s);for(a=u;a>u-r+n;a--)eg(c,a-1)}else if(n>r)for(a=u-r;a>l;a--)s=a+n-1,(o=a+r-1)in c?c[s]=c[o]:eg(c,s);for(a=0;a<n;a++)c[a+l]=arguments[a+2];return Xv(c,u-r+n),i}});var ag=function(){function t(){u(this,t)}return h(t,[{key:"on",value:function(t,e,n){"function"==typeof e?(this._stores=this._stores||{},(this._stores[t]=this._stores[t]||[]).push({cb:e,ctx:n})):console.error("listener must be a function")}},{key:"emit",value:function(t){this._stores=this._stores||{};var e,n=this._stores[t];if(n){n=n.slice(0),(e=[].slice.call(arguments,1))[0]={eventCode:t,data:e[0]};for(var r=0,i=n.length;r<i;r++)n[r].cb.apply(n[r].ctx,e)}}},{key:"off",value:function(t,e){if(this._stores=this._stores||{},arguments.length){var n=this._stores[t];if(n)if(1!==arguments.length){for(var r=0,i=n.length;r<i;r++)if(n[r].cb===e){n.splice(r,1);break}}else delete this._stores[t]}else this._stores={}}}]),t}(),og={INVITED:"INVITED",ON_CALL_RECEIVED:"onCallReceived",GROUP_CALL_INVITEE_LIST_UPDATE:"GROUP_CALL_INVITEE_LIST_UPDATE",USER_ENTER:"USER_ENTER",USER_LEAVE:"USER_LEAVE",USER_ACCEPT:"USER_ACCEPT",USER_UPDATE:"USER_UPDATE",REJECT:"REJECT",NO_RESP:"NO_RESP",LINE_BUSY:"LINE_BUSY",CALLING_CANCEL:"CALLING_CANCEL",ON_CALL_CANCELED:"onCallCancelled",CALLING_TIMEOUT:"CALLING_TIMEOUT",ON_CALL_BEGIN:"onCallBegin",CALL_END:"CALL_END",USER_VIDEO_AVAILABLE:"USER_VIDEO_AVAILABLE",USER_AUDIO_AVAILABLE:"USER_AUDIO_AVAILABLE",USER_VOICE_VOLUME:"USER_VOICE_VOLUME",SDK_READY:"SDK_READY",KICKED_OUT:"KICKED_OUT",CALL_MODE:"CALL_MODE",HANG_UP:"HANG_UP",MESSAGE_SENT_BY_ME:"onMessageSentByMe",ERROR:"ERROR"},sg={IDLE:"idle",CALLING:"calling",CONNECTED:"connected"},cg=1,ug=2,lg=3,hg=4,dg=5,fg=1,pg={AUDIO:1,VIDEO:2},vg="",gg="inviter",yg="invitee",Ig=0,Eg=1,mg=2,Tg=["","audioCall","videoCall"],_g="audio",Dg="video",Cg={EAR:"ear",SPEAKER:"speaker"},Rg={BASE:Math.pow(2,16),PRO:Math.pow(2,17),ULTIMATE:Math.pow(2,18)},bg=2147483647,Sg={DEFAULT:"default",VIDEO:"video",AUDIO:"audio",ON_ERROR:"onError",MAIN:"main",RTC:"rtc",LIVE:"live",SMALL:"small",BIG:"big",AUXILIARY:"auxiliary",NUMBER:"number",STRING:"string",INVITER:"inviter",INVITEE:"invitee",VIDEO_INPUT:"videoinput",AUDIO_INPUT:"audioinput",LOCAL:"local",REMOTE:"remote",TRTC:"TRTC",WXMINIPROGRAM:"wxminiprogram",NORMAL:"normal",REJECT:"reject",IGNORE:"ignore",TIMEOUT:"timeout",RIC:"ric",RAF:"raf",INTERVAL:"interval",CANCEL:"cancel",BUSYLINE:"busyline",UNKNOWN:"unknown",SINGLE_CALL:"SingleCall",GROUP_CALL:"groupCall",CALLER:"caller",CALLEE:"callee",DEVTOOLS:"devtools",AV_CALL:"av_call",CALLKIT_RECORDS_SVR:"callkit_records_svr",SINGLE:"single",GROUP:"group",START_CALL:"start_call",RECEIVE_CALL:"receive_call",CALL_ACCEPTED:"call_accepted",ACCEPT_CALL:"accept_call",CALL_MISSED:"call_missed",NOT_ANSWER_CALL:"not_answer_call",CALL_REJECTED:"call_rejected",REJECT_CALL:"reject_call",CALL_BUSY:"call_busy",IGNORE_CALL:"ignore_call",CANCEL_CALL:"cancel_call",CALL_CANCELED:"call_canceled",CALL_FAILED:"call_failed",CALL_END:"call_end",CALL_INTERRUPTED:"call_interrupted",INVITE_USER:"invite_user",JOIN_IN_GROUP_CALL:"join_in_group_call",EVENT_REPORT:"event_report",HEART_BEAT:"heartbeat",CALLING:"calling",MINI_PROGRAM:"miniProgram",BANNED:"banned"},Lg={MIC_TITLE:"麦克风权限授权",MIC_CONTENT:"使用语音通话，需要在设置中对麦克风进行授权允许",CAMERA_TITLE:"麦克风、摄像头权限授权",CAMERA_CONTENT:"使用视频通话，需要在设置中对麦克风、摄像头进行授权允许",CONFIRM_TEXT:"去设置"},wg="微信开发者工具不支持原生推拉流组件(即 <live-pusher> 和 <live-player> 标签)，请使用真机调试或者扫码预览。",kg={RECORD:"scope.record",CAMERA:"scope.camera"},Ag="\t\n\v\f\r                　\u2028\u2029\ufeff",Og=ut,xg=Dh,Ng=Ag,Ug=W("".replace),Mg=RegExp("^["+Ng+"]+"),Pg=RegExp("(^|[^"+Ng+"])["+Ng+"]+$"),Vg=function(t){return function(e){var n=xg(Og(e));return 1&t&&(n=Ug(n,Mg,"")),2&t&&(n=Ug(n,Pg,"$1")),n}},jg={start:Vg(1),end:Vg(2),trim:Vg(3)},Gg=A,Hg=x,Bg=W,Fg=Dh,Kg=jg.trim,zg=Ag,Jg=Gg.parseInt,$g=Gg.Symbol,Yg=$g&&$g.iterator,qg=/^[+-]?0x/i,Wg=Bg(qg.exec),Xg=8!==Jg(zg+"08")||22!==Jg(zg+"0x16")||Yg&&!Hg((function(){Jg(Object(Yg))}))?function(t,e){var n=Kg(Fg(t));return Jg(n,e>>>0||(Wg(qg,n)?16:10))}:Jg;function Qg(t){var e=new Date(t);return"".concat(e.getFullYear(),"-")+"".concat(e.getMonth()+1<10?"0".concat(e.getMonth()+1):e.getMonth()+1,"-")+Zg(e.getDate()," ")+Zg(e.getHours(),":")+Zg(e.getMinutes(),":")+Zg(e.getSeconds(),"")}function Zg(t,e){return"".concat(t<10?"0".concat(t).concat(e):"".concat(t).concat(e))}Li({global:!0,forced:parseInt!=Xg},{parseInt:Xg});var ty=N,ey=wn.EXISTS,ny=W,ry=Zo,iy=Function.prototype,ay=ny(iy.toString),oy=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,sy=ny(oy.exec);ty&&!ey&&ry(iy,"name",{configurable:!0,get:function(){try{return sy(oy,ay(this))[1]}catch(t){return""}}});var cy={UNKNOWN:65535,NO_SDK_APPID:2e3,NO_ACCOUNT_TYPE:2001,NO_IDENTIFIER:2002,NO_USER_SIG:2003,NO_TINY_ID:2022,NO_A2KEY:2023,USER_NOT_LOGGED_IN:2024,NO_NETWORK:2805,FAILURE_SWITCH_TO_AUDIO:60001,FAILURE_SWITCH_TO_VIDEO:60002,NOT_MICROPHONE_LIST:60003,NOT_CAMERA_LIST:60004,NOT_MEDIA_ACCESS:60005,NOT_SUPPORT:60006,ERROR_PACKAGE_NOT_PURCHASED:-1001,ERROR_PACKAGE_NOT_SUPPORTED:-1002,ERROR_TIM_VERSION_OUTDATED:-1003,ERROR_PERMISSION_DENIED:-1101,ERROR_GET_DEVICE_LIST_FAIL:-1102,ERROR_INIT_FAIL:-1201,ERROR_PARAM_INVALID:-1202,ERROR_REQUEST_REFUSED:-1203,ERROR_REQUEST_REPEATED:-1204,ERROR_SCENE_NOT_SUPPORTED:-1205,ERROR_SIGNALING_SEND_FAIL:-1401,ERROR_INVALID_INVITEID:8010,ERROR_INVALID_SEND_FAIL:20003},uy="未连接到网络",ly='The package you purchased does not support this ability. You can refer to "Service Activation" to purchase: https://buy.cloud.tencent.com/avc',hy="TIM SDK version is too old. Please upgrade version",dy="init is not complete, this API needs to be used after init. To solve the problem, please go to: https://cloud.tencent.com/document/product/647/78769#3a61f42b-e06f-49af-88bf-362d40025887",fy="The API is support use in the state of. Please go to: https://cloud.tencent.com/document/product/647/78769#5e65043d-e3dc-4bd3-8220-3ac7694dfa42",py={NO_SDK_APPID:"无 SDKAppID",NO_ACCOUNT_TYPE:"无帐户类型",NO_IDENTIFIER:"无 userID",NO_USER_SIG:"无 userSig",NO_NETWORK:"未连接到网络",FAILURE_SWITCH_TO_AUDIO:"切换语音通话失败",FAILURE_SWITCH_TO_VIDEO:"切换视频通话失败",NOT_MICROPHONE_LIST:"没有麦克风权限",NOT_CAMERA_LIST:"没有摄像头权限",ERROR_NULL:"成功",ERROR_PACKAGE_NOT_PURCHASED:"您目前没有 TUICallKit 包，请在控制台开启免费体验或购买官方包",ERROR_PACKAGE_NOT_SUPPORTED:"您购买的套餐不支持该功能。可参考“服务开通”购买: https://buy.cloud.tencent.com/avc",ERROR_TIM_VERSION_OUTDATED:"TIM SDK 版本太旧，请升级版本",ERROR_PERMISSION_DENIED:"摄像头/麦克风权限被拒绝。解决方案请前往: https://cloud.tencent.com/document/product/647/78770",ERROR_GET_DEVICE_LIST_FAIL:"获取设备列表失败",ERROR_INIT_FAIL:"TUICallEngine init 未完成，需要在 init 完成后使用此 API。解决方案请前往: https://cloud.tencent.com/document/product/647/78769#3a61f42b-e06f-49af-88bf-362d40025887",ERROR_REQUEST_REFUSED:"当前通话状态无法使用该API。解决方案请前往: https://cloud.tencent.com/document/product/647/78769#5e65043d-e3dc-4bd3-8220-3ac7694dfa42",ERROR_REQUEST_REPEATED:"当前方法正在执行中，请勿重复调用",ERROR_REQUEST_REPEATED_SWITCH:"与当前通话类型一致，请勿重复切换",ERROR_SCENE_NOT_SUPPORTED:"当前通话场景不支持该功能",ERROR_SIGNALING_SEND_FAIL:"信令发送失败",ERROR_INVALID_INVITEID:"inviteID 无效或邀请已处理。解决方案请前往: https://cloud.tencent.com/document/product/647/84363#e97ea97b-7812-42ed-89b7-2a3840ac0e3f",ERROR_INVALID_SEND_FAIL:"消息发送方或接收方 UserID 无效或不存在。解决方案请前往: https://cloud.tencent.com/document/product/647/84363#661be1b0-f649-4199-a343-958c3f4f4bbb",ERROR_PARAM_INVALID:"参数错误"},vy=function(t){f(n,I(Error));var e=T(n);function n(t){var r,i=t.message,a=t.code,o=void 0===a?cy.UNKNOWN:a;return u(this,n),r=e.call(this,"".concat(i).concat(function(t){for(var e=0,n=Object.keys(py);e<n.length;e++){var r=n[e];if(cy[r]===t)return py[r]}return"UNKNOWN"}(o))+" <".concat(function(t){for(var e=0,n=Object.keys(cy);e<n.length;e++){var r=n[e];if(cy[r]===t)return r}return"UNKNOWN"}(o),": ").concat(o,">")),r.code=o,r.name="TUICallEngineError",r.message_=i,r}return h(n,[{key:"getCode",value:function(){return this.code}}]),n}(),gy=["inviteID","type"],yy=function(){function t(e){u(this,t),this.TSignaling=e.TSignaling}var e,n,r,o,s,l,d;return h(t,[{key:"handleNewSignaling",value:function(t,e){return i(i({extInfo:(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")||""},t),{},{version:4,businessID:"av_call",platform:"MiniApp",data:i({cmd:Tg[t.call_type],room_id:t.room_id,message:""},e)})}},{key:"extractCallingInfoFromMessage",value:function(t){if(!t||"TIMCustomElem"!==t.type)return"";var e=JSON.parse(t.payload.data);if(e.businessID!==fg)return"";switch(e.actionType){case cg:var n=JSON.parse(e.data);return n.call_end>0&&!e.groupID?n.call_end:0!==n.call_end&&n.room_id?"发起通话":"结束群聊";case ug:return"取消通话";case lg:return"已接听";case hg:return"拒绝通话";case dg:return"无应答";default:return""}}},{key:"handleError",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.code,n=void 0===e?"":e,r=t.message;if(n)throw new vy({message:void 0===r?"":r,code:n})}},{key:"_handleInviteData",value:function(t){var e=t.type,n=t.roomID,r=t.userIDList,i=t.hangup,a=t.switchMode,o=t.userData;if(i)return JSON.stringify(this.handleNewSignaling({version:0,call_type:e,call_end:i.callEnd},{cmd:"hangup"}));if(a){var s={version:0,call_type:e,room_id:n},c={cmd:"switchToVideo"};return a===_g&&(s.switch_to_audio_call="switch_to_audio_call",c.cmd="switchToAudio"),JSON.stringify(this.handleNewSignaling(s,c))}return JSON.stringify(this.handleNewSignaling({version:0,call_type:e,room_id:n},{userIDs:r},o))}},{key:"_handleInviteGroupData",value:function(t){var e=t.type,n=t.roomID,r=t.hangup,i=t.userData;return r?JSON.stringify(this.handleNewSignaling({version:0,call_type:e,call_end:r.call_end},{cmd:"hangup"},i)):JSON.stringify(this.handleNewSignaling({version:0,call_type:e,room_id:n}))}},{key:"invite",value:(d=c(a().mark((function t(e){var n,r,i,o;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.userID,r=e.offlinePushInfo,i=e.hangup,o=e.switchMode,t.prev=1,t.next=4,this.TSignaling.invite({userID:n,data:this._handleInviteData(e),timeout:i?0:30,offlinePushInfo:r});case 4:return t.abrupt("return",t.sent);case 7:if(t.prev=7,t.t0=t.catch(1),!i){t.next=11;break}return t.abrupt("return",this.handleError(t.t0,"hangup C2C"));case 11:if(!o){t.next=13;break}return t.abrupt("return",this.handleError(t.t0,o));case 13:return t.abrupt("return",this.handleError(t.t0,"invite"));case 14:case"end":return t.stop()}}),t,this,[[1,7]])}))),function(t){return d.apply(this,arguments)})},{key:"inviteGroup",value:(l=c(a().mark((function t(e){var n,r,i,o,s,c;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.groupID,r=e.userIDList,i=e.offlinePushInfo,o=e.hangup,s=e.inCallUserIDs,c=void 0===s?[]:s,t.prev=1,t.next=4,this.TSignaling.inviteInGroup({groupID:n,inviteeList:r,timeout:o?0:30,data:this._handleInviteGroupData(e),offlinePushInfo:i,inCallUserIDs:c});case 4:return t.abrupt("return",t.sent);case 7:if(t.prev=7,t.t0=t.catch(1),!o){t.next=11;break}return t.abrupt("return",this.handleError(t.t0,"hangup group"));case 11:return t.abrupt("return",this.handleError(t.t0,"inviteGroup"));case 12:case"end":return t.stop()}}),t,this,[[1,7]])}))),function(t){return l.apply(this,arguments)})},{key:"accept",value:(s=c(a().mark((function t(e,n){var r,o,s;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.inviteID,o=e.type,s=E(e,gy),t.prev=1,t.next=4,this.TSignaling.accept({inviteID:r,data:JSON.stringify(this.handleNewSignaling(i({version:0,call_type:o},s),n))});case 4:return t.abrupt("return",t.sent);case 7:return t.prev=7,t.t0=t.catch(1),t.abrupt("return",this.handleError(t.t0,"accept"));case 10:case"end":return t.stop()}}),t,this,[[1,7]])}))),function(t,e){return s.apply(this,arguments)})},{key:"reject",value:(o=c(a().mark((function t(e){var n,r,i,o,s;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.inviteID,r=e.type,i=e.lineBusy,o={version:0,call_type:r},s=null,i?(o.line_busy=i,s=JSON.stringify(this.handleNewSignaling(o,{message:"lineBusy"}))):s=JSON.stringify(this.handleNewSignaling(o)),t.prev=4,t.next=7,this.TSignaling.reject({inviteID:n,data:s});case 7:return t.abrupt("return",t.sent);case 10:if(t.prev=10,t.t0=t.catch(4),!i){t.next=14;break}return t.abrupt("return",this.handleError(t.t0,"line_busy"));case 14:return t.abrupt("return",this.handleError(t.t0,"reject"));case 15:case"end":return t.stop()}}),t,this,[[4,10]])}))),function(t){return o.apply(this,arguments)})},{key:"cancel",value:(r=c(a().mark((function t(e){var n,r,i;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.inviteID,r=e.callType,t.prev=1,t.next=4,this.TSignaling.cancel({inviteID:n,data:JSON.stringify(this.handleNewSignaling({version:0,call_type:r}))});case 4:return i=t.sent,t.abrupt("return",i);case 8:return t.prev=8,t.t0=t.catch(1),t.abrupt("return",this.handleError(t.t0,"cancel"));case 11:case"end":return t.stop()}}),t,this,[[1,8]])}))),function(t){return r.apply(this,arguments)})},{key:"hangup",value:(n=c(a().mark((function t(e){var n,r,i,o,s,c,u,l,h,d,f;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.userIDList,r=e.callType,i=e.callEnd,o=void 0===i?0:i,s=e.isGroupCall,c=void 0!==s&&s,u=e.groupID,l=void 0===u?"":u,h={version:0,call_type:r,call_end:o},d={cmd:"hangup"},f=JSON.stringify(this.handleNewSignaling(h,d)),!c||!l){t.next=9;break}return t.next=7,this.TSignaling.inviteInGroup({inviteeList:n,groupID:l,data:f,timeout:0});case 7:t.next=11;break;case 9:return t.next=11,this.TSignaling.invite({userID:n[0],data:f,timeout:0});case 11:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"switchCallMode",value:(e=c(a().mark((function t(e){var n,r,i,o;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.userID,r=e.callType,i=e.roomID,o=e.mode,t.abrupt("return",this.invite({userID:n,type:r,roomID:i,switchMode:o}));case 2:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"destroyed",value:function(){this.TSignaling=null}},{key:"setLogLevel",value:function(t){this.TSignaling.setLogLevel(t)}}]),t}(),Iy=function(){function t(e){u(this,t),this._emitter=e.emitter}return h(t,[{key:"onError",value:function(t){this._emitter.emit(og.ERROR,t)}},{key:"onCallBegin",value:function(t){this._emitter.emit(og.ON_CALL_BEGIN,t)}},{key:"onCallEnd",value:function(t){var e=t.userID,n=t.callEnd,r=t.message,i=t.roomID,a=t.callMediaType,o=t.callRole,s=t.totalTime;this._emitter.emit(og.CALL_END,{userID:e,callEnd:n,message:r,roomID:i,callMediaType:a,callRole:o,totalTime:s})}},{key:"onInvited",value:function(t){this._emitter.emit(og.INVITED,t),this._emitter.emit(og.ON_CALL_RECEIVED,t)}},{key:"onLineBusy",value:function(t){var e=t.inviteID,n=t.invitee,r=t.userID;this._emitter.emit(og.LINE_BUSY,{inviteID:e,invitee:n,userID:r,reason:"line busy"})}},{key:"onReject",value:function(t){var e=t.inviteID,n=t.invitee,r=t.userID;this._emitter.emit(og.REJECT,{inviteID:e,invitee:n,userID:r,reason:"reject"})}},{key:"onNoResp",value:function(t){var e=t.groupID,n=void 0===e?"":e,r=t.inviteID,i=t.sponsor,a=t.timeoutUserList,o=t.userIDList;this._emitter.emit(og.NO_RESP,{groupID:n,inviteID:r,sponsor:i,timeoutUserList:a,userIDList:o})}},{key:"onCancel",value:function(t){this._emitter.emit(og.CALLING_CANCEL,t),this._emitter.emit(og.ON_CALL_CANCELED,t)}},{key:"onTimeout",value:function(t){var e=t.inviteID,n=t.groupID,r=t.sponsor,i=t.timeoutUserList;this._emitter.emit(og.CALLING_TIMEOUT,{groupID:n,inviteID:e,sponsor:r,timeoutUserList:i})}},{key:"onUserAccept",value:function(t){var e=t.userID,n=t.userList;this._emitter.emit(og.USER_ACCEPT,{userID:e,userList:n})}},{key:"onUserEnter",value:function(t){var e=t.userID,n=t.playerList;this._emitter.emit(og.USER_ENTER,{userID:e,playerList:n})}},{key:"onUserLeave",value:function(t){var e=t.userID,n=t.playerList;this._emitter.emit(og.USER_LEAVE,{userID:e,playerList:n})}},{key:"onUserUpdate",value:function(t){var e=t.pusher,n=t.playerList;this._emitter.emit(og.USER_UPDATE,{pusher:e,playerList:n})}},{key:"onSdkReady",value:function(t){this._emitter.emit(og.SDK_READY,t)}},{key:"onKickedOut",value:function(t){this._emitter.emit(og.KICKED_OUT,t)}},{key:"onCallMode",value:function(t){this._emitter.emit(og.CALL_MODE,t)}},{key:"onMessageSentByMe",value:function(t){this._emitter.emit(og.MESSAGE_SENT_BY_ME,t)}},{key:"destroyed",value:function(){this._emitter=null}}]),t}(),Ey="1.5.3";Tv("Map",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),Vv);var my=cn,Ty=function(){var t=my(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},_y=V,Dy=pe,Cy=Dt,Ry=Ty,by=RegExp.prototype,Sy=wn.PROPER,Ly=br,wy=cn,ky=Dh,Ay=x,Oy=function(t){var e=t.flags;return void 0!==e||"flags"in by||Dy(t,"flags")||!Cy(by,t)?e:_y(Ry,t)},xy="toString",Ny=RegExp.prototype[xy],Uy=Ay((function(){return"/a/b"!=Ny.call({source:"a",flags:"b"})})),My=Sy&&Ny.name!=xy;(Uy||My)&&Ly(RegExp.prototype,xy,(function(){var t=wy(this);return"/"+ky(t.source)+"/"+ky(Oy(t))}),{unsafe:!0});var Py,Vy,jy=jp;Li({target:"Object",stat:!0,forced:Object.isExtensible!==jy},{isExtensible:jy}),Py="undefined"!=typeof console?console:"undefined"!=typeof global&&global.console?global.console:"undefined"!=typeof window&&window.console?window.console:{};for(var Gy=function(){},Hy=["assert","clear","count","debug","dir","dirxml","error","group","groupCollapsed","groupEnd","info","log","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],By=Hy.length-1;By;)Vy=Hy[By],console[Vy]||(Py[Vy]=Gy),By-=1;Object.isExtensible(Py)&&(Py.methods=Hy);var Fy,Ky,zy=Py,Jy=x,$y=A.RegExp,Yy=Jy((function(){var t=$y("a","y");return t.lastIndex=2,null!=t.exec("abcd")})),qy=Yy||Jy((function(){return!$y("a","y").sticky})),Wy={BROKEN_CARET:Yy||Jy((function(){var t=$y("^r","gy");return t.lastIndex=2,null!=t.exec("str")})),MISSED_STICKY:qy,UNSUPPORTED_Y:Yy},Xy=x,Qy=A.RegExp,Zy=Xy((function(){var t=Qy(".","s");return!(t.dotAll&&t.exec("\n")&&"s"===t.flags)})),tI=x,eI=A.RegExp,nI=tI((function(){var t=eI("(?<a>b)","g");return"b"!==t.exec("b").groups.a||"bc"!=="b".replace(t,"$<a>c")})),rI=V,iI=W,aI=Dh,oI=Ty,sI=Wy,cI=ee.exports,uI=rd,lI=ir.get,hI=Zy,dI=nI,fI=cI("native-string-replace",String.prototype.replace),pI=RegExp.prototype.exec,vI=pI,gI=iI("".charAt),yI=iI("".indexOf),II=iI("".replace),EI=iI("".slice),mI=(Ky=/b*/g,rI(pI,Fy=/a/,"a"),rI(pI,Ky,"a"),0!==Fy.lastIndex||0!==Ky.lastIndex),TI=sI.BROKEN_CARET,_I=void 0!==/()??/.exec("")[1];(mI||_I||TI||hI||dI)&&(vI=function(t){var e,n,r,i,a,o,s,c=this,u=lI(c),l=aI(t),h=u.raw;if(h)return h.lastIndex=c.lastIndex,e=rI(vI,h,l),c.lastIndex=h.lastIndex,e;var d=u.groups,f=TI&&c.sticky,p=rI(oI,c),v=c.source,g=0,y=l;if(f&&(p=II(p,"y",""),-1===yI(p,"g")&&(p+="g"),y=EI(l,c.lastIndex),c.lastIndex>0&&(!c.multiline||c.multiline&&"\n"!==gI(l,c.lastIndex-1))&&(v="(?: "+v+")",y=" "+y,g++),n=new RegExp("^(?:"+v+")",p)),_I&&(n=new RegExp("^"+v+"$(?!\\s)",p)),mI&&(r=c.lastIndex),i=rI(pI,f?n:c,y),f?i?(i.input=EI(i.input,g),i[0]=EI(i[0],g),i.index=c.lastIndex,c.lastIndex+=i[0].length):c.lastIndex=0:mI&&i&&(c.lastIndex=c.global?i.index+i[0].length:r),_I&&i&&i.length>1&&rI(fI,i[0],n,(function(){for(a=1;a<arguments.length-2;a++)void 0===arguments[a]&&(i[a]=void 0)})),i&&d)for(i.groups=o=uI(null),a=0;a<d.length;a++)o[(s=d[a])[0]]=i[s[1]];return i});var DI=vI;Li({target:"RegExp",proto:!0,forced:/./.exec!==DI},{exec:DI});var CI=Va,RI=br,bI=DI,SI=x,LI=we,wI=_n,kI=LI("species"),AI=RegExp.prototype,OI=function(t,e,n,r){var i=LI(t),a=!SI((function(){var e={};return e[i]=function(){return 7},7!=""[t](e)})),o=a&&!SI((function(){var e=!1,n=/a/;return"split"===t&&((n={}).constructor={},n.constructor[kI]=function(){return n},n.flags="",n[i]=/./[i]),n.exec=function(){return e=!0,null},n[i](""),!e}));if(!a||!o||n){var s=CI(/./[i]),c=e(i,""[t],(function(t,e,n,r,i){var o=CI(t),c=e.exec;return c===bI||c===AI.exec?a&&!i?{done:!0,value:s(e,n,r)}:{done:!0,value:o(n,e,r)}:{done:!1}}));RI(String.prototype,t,c[0]),RI(AI,i,c[1])}r&&wI(AI[i],"sham",!0)},xI=Oh.charAt,NI=function(t,e,n){return e+(n?xI(t,e).length:1)},UI=V,MI=cn,PI=gt,VI=tt,jI=DI,GI=TypeError,HI=function(t,e){var n=t.exec;if(PI(n)){var r=UI(n,t,e);return null!==r&&MI(r),r}if("RegExp"===VI(t))return UI(jI,t,e);throw GI("RegExp#exec called on incompatible receiver")},BI=V,FI=cn,KI=ot,zI=Vr,JI=Dh,$I=ut,YI=Wt,qI=NI,WI=HI;OI("match",(function(t,e,n){return[function(e){var n=$I(this),r=KI(e)?void 0:YI(e,t);return r?BI(r,e,n):new RegExp(e)[t](JI(n))},function(t){var r=FI(this),i=JI(t),a=n(e,r,i);if(a.done)return a.value;if(!r.global)return WI(r,i);var o=r.unicode;r.lastIndex=0;for(var s,c=[],u=0;null!==(s=WI(r,i));){var l=JI(s[0]);c[u]=l,""===l&&(r.lastIndex=qI(i,zI(r.lastIndex),o)),u++}return 0===u?null:c}]})),Li({target:"Array",stat:!0},{isArray:ki});var XI=A,QI=W(1..valueOf),ZI=Li,tE=N,eE=A,nE=XI,rE=W,iE=mi,aE=pe,oE=av,sE=Dt,cE=Ht,uE=Pe,lE=x,hE=Sr.f,dE=O.f,fE=nn.f,pE=QI,vE=jg.trim,gE="Number",yE=eE[gE];nE[gE];var IE=yE.prototype,EE=eE.TypeError,mE=rE("".slice),TE=rE("".charCodeAt),_E=function(t){var e,n,r,i,a,o,s,c,u=uE(t,"number");if(cE(u))throw EE("Cannot convert a Symbol value to a number");if("string"==typeof u&&u.length>2)if(u=vE(u),43===(e=TE(u,0))||45===e){if(88===(n=TE(u,2))||120===n)return NaN}else if(48===e){switch(TE(u,1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+u}for(o=(a=mE(u,2)).length,s=0;s<o;s++)if((c=TE(a,s))<48||c>i)return NaN;return parseInt(a,r)}return+u},DE=iE(gE,!yE(" 0o1")||!yE("0b1")||yE("+0x1")),CE=function(t){var e,n=arguments.length<1?0:yE(function(t){var e=uE(t,"number");return"bigint"==typeof e?e:_E(e)}(t));return sE(IE,e=this)&&lE((function(){pE(e)}))?oE(Object(n),this,CE):n};CE.prototype=IE,DE&&(IE.constructor=CE),ZI({global:!0,constructor:!0,wrap:!0,forced:DE},{Number:CE});DE&&function(t,e){for(var n,r=tE?hE(e):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),i=0;r.length>i;i++)aE(e,n=r[i])&&!aE(t,n)&&fE(t,n,dE(e,n))}(nE[gE],yE);var RE=Ar,bE=Dh,SE=ut,LE=RangeError,wE=function(t){var e=bE(SE(this)),n="",r=RE(t);if(r<0||r==1/0)throw LE("Wrong number of repetitions");for(;r>0;(r>>>=1)&&(e+=e))1&r&&(n+=e);return n},kE=W,AE=Vr,OE=Dh,xE=ut,NE=kE(wE),UE=kE("".slice),ME=Math.ceil,PE=function(t){return function(e,n,r){var i,a,o=OE(xE(e)),s=AE(n),c=o.length,u=void 0===r?" ":OE(r);return s<=c||""==u?o:((a=NE(u,ME((i=s-c)/u.length))).length>i&&(a=UE(a,0,i)),t?o+a:a+o)}},VE=W,jE=x,GE={start:PE(!1),end:PE(!0)}.start,HE=RangeError,BE=isFinite,FE=Math.abs,KE=Date.prototype,zE=KE.toISOString,JE=VE(KE.getTime),$E=VE(KE.getUTCDate),YE=VE(KE.getUTCFullYear),qE=VE(KE.getUTCHours),WE=VE(KE.getUTCMilliseconds),XE=VE(KE.getUTCMinutes),QE=VE(KE.getUTCMonth),ZE=VE(KE.getUTCSeconds),tm=jE((function(){return"0385-07-25T07:06:39.999Z"!=zE.call(new Date(-50000000000001))}))||!jE((function(){zE.call(new Date(NaN))}))?function(){if(!BE(JE(this)))throw HE("Invalid time value");var t=this,e=YE(t),n=WE(t),r=e<0?"-":e>9999?"+":"";return r+GE(FE(e),r?6:4,0)+"-"+GE(QE(t)+1,2,0)+"-"+GE($E(t),2,0)+"T"+GE(qE(t),2,0)+":"+GE(XE(t),2,0)+":"+GE(ZE(t),2,0)+"."+GE(n,3,0)+"Z"}:zE;Li({target:"Date",proto:!0,forced:Date.prototype.toISOString!==tm},{toISOString:tm});var em=W,nm=he,rm=Math.floor,im=em("".charAt),am=em("".replace),om=em("".slice),sm=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,cm=/\$([$&'`]|\d{1,2})/g,um=Es,lm=V,hm=W,dm=OI,fm=x,pm=cn,vm=gt,gm=ot,ym=Ar,Im=Vr,Em=Dh,mm=ut,Tm=NI,_m=Wt,Dm=function(t,e,n,r,i,a){var o=n+t.length,s=r.length,c=cm;return void 0!==i&&(i=nm(i),c=sm),am(a,c,(function(a,c){var u;switch(im(c,0)){case"$":return"$";case"&":return t;case"`":return om(e,0,n);case"'":return om(e,o);case"<":u=i[om(c,1,-1)];break;default:var l=+c;if(0===l)return a;if(l>s){var h=rm(l/10);return 0===h?a:h<=s?void 0===r[h-1]?im(c,1):r[h-1]+im(c,1):a}u=r[l-1]}return void 0===u?"":u}))},Cm=HI,Rm=we("replace"),bm=Math.max,Sm=Math.min,Lm=hm([].concat),wm=hm([].push),km=hm("".indexOf),Am=hm("".slice),Om="$0"==="a".replace(/./,"$0"),xm=!!/./[Rm]&&""===/./[Rm]("a","$0");function Nm(t,e){t=t.split("."),e=e.split(".");for(var n=Math.max(t.length,e.length);t.length<n;)t.push("0");for(;e.length<n;)e.push("0");for(var r=0;r<n;r++){var i=parseInt(t[r],10),a=parseInt(e[r],10);if(i>a)return 1;if(i<a)return-1}return 0}dm("replace",(function(t,e,n){var r=xm?"$":"$0";return[function(t,n){var r=mm(this),i=gm(t)?void 0:_m(t,Rm);return i?lm(i,t,r,n):lm(e,Em(r),t,n)},function(t,i){var a=pm(this),o=Em(t);if("string"==typeof i&&-1===km(i,r)&&-1===km(i,"$<")){var s=n(e,a,o,i);if(s.done)return s.value}var c=vm(i);c||(i=Em(i));var u=a.global;if(u){var l=a.unicode;a.lastIndex=0}for(var h=[];;){var d=Cm(a,o);if(null===d)break;if(wm(h,d),!u)break;""===Em(d[0])&&(a.lastIndex=Tm(o,Im(a.lastIndex),l))}for(var f,p="",v=0,g=0;g<h.length;g++){for(var y=Em((d=h[g])[0]),I=bm(Sm(ym(d.index),o.length),0),E=[],m=1;m<d.length;m++)wm(E,void 0===(f=d[m])?f:String(f));var T=d.groups;if(c){var _=Lm([y],E,I,o);void 0!==T&&wm(_,T);var D=Em(um(i,void 0,_))}else D=Dm(y,o,I,E,T,i);I>=v&&(p+=Am(o,v,I)+D,v=I+y.length)}return p+Am(o,v)}]}),!!fm((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")}))||!Om||xm);var Um="TRTC-ROOM",Mm=wx||qq;Mm||console.error(Um,"不支持当前小程序环境");var Pm,Vm=Mm.getSystemInfoSync(),jm=Vm.safeArea;("iOS 13.3"===Vm.system||"iPhoneX"===Vm.model&&"iOS 13.3.1"===Vm.system)&&console.log("use media audio volume type"),console.log(Um,"SystemInfo",Vm),"undefined"!=typeof qq?Pm=!0:"undefined"!=typeof wx&&(Pm=Nm(Vm.version,"7.0.8")>=0||Nm(Vm.version,"2.4.0")>=0&&Nm(Vm.version,"6.0.0")<0&&Nm(Vm.SDKVersion,"2.10.0")>=0);var Gm=Pm,Hm="undefined"!=typeof uni,Bm=/iOS/i.test(Vm.system),Fm=/Android/i.test(Vm.system);/mac/i.test(Vm.system);var Km=Vm.version,zm=Vm.SDKBuild?"".concat(Vm.SDKVersion,"-").concat(Vm.SDKBuild):Vm.SDKVersion;Vm.screenHeight,jm.bottom,console.log(Um,"APP_VERSION:",Km," LIB_VERSION:",zm," is new version:",Gm);var Jm=function(t){return"function"==typeof Array.isArray?Array.isArray(t):"array"===function(t){return Object.prototype.toString.call(t).match(/^\[object (.*)\]$/)[1].toLowerCase()}(t)},$m=function(t){return null!==t&&("number"==typeof t&&!isNaN(t-0)||"object"===o(t)&&t.constructor===Number)},Ym=function(t){return"string"==typeof t},qm=function(t){return null!==t&&"object"===o(t)},Wm=function(t){return void 0===t},Xm=0;Date.now||(Date.now=function(){return(new Date).getTime()});var Qm=function(){0===Xm&&(Xm=Date.now()-1);var t=Date.now()-Xm;return t>4294967295?(Xm+=4294967295,Date.now()-Xm):t},Zm=function(t){return t instanceof Error},tT=function(t){return JSON.stringify(t,["message","code"])};function eT(){var t="unknown";return Bm&&(t="ios"),Fm&&(t="android"),t}function nT(t){return rT.apply(this,arguments)}function rT(){return(rT=c(a().mark((function t(e){var n,r,i,o,s,c,u;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return",!1);case 2:return n=e.microphone,r=void 0!==n&&n,i=e.camera,o=void 0!==i&&i,t.prev=3,t.next=6,wx.getSetting();case 6:if(s=t.sent,c=s.authSetting[kg.RECORD],u=s.authSetting[kg.CAMERA],!r||!o){t.next=11;break}return t.abrupt("return",c&&u);case 11:if(!r){t.next=13;break}return t.abrupt("return",c);case 13:if(!o){t.next=15;break}return t.abrupt("return",u);case 15:return t.abrupt("return",!1);case 18:return t.prev=18,t.t0=t.catch(3),t.abrupt("return",!1);case 21:case"end":return t.stop()}}),t,null,[[3,18]])})))).apply(this,arguments)}function iT(t){return t===Sg.AV_CALL}function aT(){return performance&&performance.now?Math.floor(performance.now()):Date.now()}var oT=0,sT=new Map;function cT(){var t=new Date;return"TUICallEngine ".concat(t.toLocaleTimeString("en-US",{hour12:!1}),".").concat(function(t){var e;switch(t.toString().length){case 1:e="00".concat(t);break;case 2:e="0".concat(t);break;default:e=t}return e}(t.getMilliseconds()),":")}var uT={_data:[],_length:0,_visible:!1,arguments2String:function(t){var e,n;if(1===t.length)e=cT()+t[0];else{e=cT();for(var r=0,i=t.length;r<i;r++)n=t[r],Jm(n)||qm(n)?Zm(t[r])?e+=tT(t[r]):e+=JSON.stringify(t[r]):e+=t[r],e+=" "}return e},debug:function(){if(oT<=-1){var t=this.arguments2String(arguments);uT.record(t,"debug"),zy.debug(t)}},log:function(){if(oT<=0){var t=this.arguments2String(arguments);uT.record(t,"log"),zy.log(t)}},info:function(){if(oT<=1){var t=this.arguments2String(arguments);uT.record(t,"info"),zy.info(t)}},warn:function(){if(oT<=2){var t=this.arguments2String(arguments);uT.record(t,"warn"),zy.warn(t)}},error:function(){if(oT<=3){var t=this.arguments2String(arguments);uT.record(t,"error"),zy.error(t)}},time:function(t){sT.set(t,Qm())},timeEnd:function(t){if(sT.has(t)){var e=Qm()-sT.get(t);return sT.delete(t),e}return zy.warn("未找到对应label: ".concat(t,", 请在调用 logger.timeEnd 前，调用 logger.time")),0},setLevel:function(t){t<4&&zy.log("".concat(cT(),"set level from ").concat(oT," to ").concat(t)),oT=t},getLevel:function(){return oT},record:function(t,e){1100===uT._length&&(uT._data.splice(0,100),uT._length=1e3),uT._length+=1,uT._data.push("".concat(t," [").concat(e,"] \n"))},getLog:function(){return uT._data}},lT=function(){function t(e){u(this,t),this.sdkappid="",this.version="",this.userid="",this.platform="",this.useragent="",this.method=e,this.codeint=1,this.calltype=1,this.talktime=0,this.message="",this.text="",this.startts=Date.now(),this.endts=0,this.timespan=0,this.time="",this.networktype="",this.host=eT()}return h(t,[{key:"setCommonInfo",value:function(t){var e,n,r,i,a=t.SDKAppID,o=t.version,s=t.userID,c=t.platform,u=t.scene;this.sdkappid=a,this.version="".concat(o),this.userid=s,this.platform=c,this.scene=u,this.time=(e=new Date,n=e.toISOString(),r=e.getTimezoneOffset()/60,i="",i=r<0?r>-10?"+0".concat(Math.abs(100*r)):"+".concat(Math.abs(100*r)):r>=10?"-".concat(100*r):"-0".concat(100*r),n.replace("Z",i)),this.startts&&this.endts&&!this.timespan&&(this.timespan=Math.abs(this.endts-this.startts))}},{key:"setEnd",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.endts=Date.now(),e?this._eventStatController.pushIn(this):setTimeout((function(){t._eventStatController.pushIn(t)}),0)}},{key:"setError",value:function(t,e,n){return this.setNetworkType(n),e?(t.code&&this.setCode(t.code),t.message&&this.setMessage(t.message)):(this.setCode(cy.NO_NETWORK),this.setMessage(uy)),this}},{key:"setCode",value:function(t){return"ECONNABORTED"===t&&(this.codeint=103),$m(t)?this.codeint=t:uT.warn("SSOLogData.setCode value not a number, please check!",t,o(t)),this}},{key:"setMessage",value:function(t){return Ym(t)?(this.message=t,this):this}},{key:"setText",value:function(t){return $m(t)?this.text=t.toString():Ym(t)&&(this.text=t),this}},{key:"setTalkTime",value:function(t){return this.talktime=t,this}},{key:"setMessageType",value:function(t){return this.msgType=t,this}},{key:"setCallType",value:function(t){return this.calltype=t,this}},{key:"setNetworkType",value:function(t){return Wm(t)?uT.warn("SSOLogData.setNetworkType value is undefined, please check!"):this.networktype=t,this}}],[{key:"bindController",value:function(e){t.prototype._eventStatController=e}}]),t}(),hT="sdkConstruct",dT="call",fT="quality_report",pT=function(){function t(){u(this,t),this._table="timweb-trtccalling",this._report=[]}return h(t,[{key:"pushIn",value:function(t){uT.debug("SSOLogBody.pushIn",this._report.length,t),this._report.push(t)}},{key:"backfill",value:function(t){var e;Jm(t)&&0!==t.length&&(uT.debug("SSOLogBody.backfill",this._report.length,t.length),(e=this._report).unshift.apply(e,_(t)))}},{key:"getLogsNumInMemory",value:function(){return this._report.length}},{key:"isEmpty",value:function(){return 0===this._report.length}},{key:"_reset",value:function(){this._report.length=0,this._report=[]}},{key:"getTable",value:function(){return this._table}},{key:"getLogsInMemory",value:function(){var t=this._report.slice();return this._reset(),t}}]),t}(),vT={CURRENT:{COMMON:"https://webim.tim.qq.com"},PRODUCTION:{COMMON:"https://webim.tim.qq.com"}},gT={IM_OPEN_STAT:"imopenstat"},yT={TIM_WEB_TRTCCALLING_REPORT:"tweb_trtccalling_report"},IT={imopenstat:"v4"},ET=function(){function t(){u(this,t),this.TAG="trtccalling-ssolog-event",this._reportBody=new pT,this._version=Ey,this.MIN_THRESHOLD=20,this.MAX_THRESHOLD=100,this.WAITING_TIME=6e4,this.INTERVAL=2e4,this._timerID=0,this._resetLastReportTime(),this._startReportTimer(),this._retryCount=0,this.MAX_RETRY_COUNT=3}return h(t,[{key:"reportAtOnce",value:function(){uT.debug("EventStatController.reportAtOnce"),this._report()}},{key:"pushIn",value:function(t){t instanceof lT&&(t.setCommonInfo({SDKAppID:Number(wx.getStorageSync("sdkAppId")),version:this._version,userID:wx.getStorageSync("userId")}),this._reportBody.pushIn(t),this._report())}},{key:"_resetLastReportTime",value:function(){this._lastReportTime=Date.now()}},{key:"_startReportTimer",value:function(){var t=this;this._timerID=setInterval((function(){Date.now()<t._lastReportTime+t.WAITING_TIME||t._reportBody.isEmpty()||t._report()}),this.INTERVAL)}},{key:"_stopReportTimer",value:function(){this._timerID>0&&(clearInterval(this._timerID),this._timerID=0)}},{key:"_report",value:function(){var t=this;if(!this._reportBody.isEmpty()){var e=Math.ceil(+new Date/1e3),n=wx.getStorageSync("sdkAppId"),r=this._reportBody.getLogsInMemory(),i={table:this._reportBody.getTable(),report:r},a=vT.CURRENT.COMMON,o=IT.imopenstat,s=gT.IM_OPEN_STAT,c=yT.TIM_WEB_TRTCCALLING_REPORT,u="".concat(a,"/").concat(o,"/").concat(s,"/").concat(c,"/?sdkappid=").concat(n,"&reqtime=").concat(e);wx.request({url:u,method:"POST",data:JSON.stringify(i),header:{"content-type":"application/json"},success:function(e){t._retryCount>0&&(uT.debug("EventStatController.report retry success"),t._retryCount=0)},fail:function(e){uT.warn("EventStatController.report, error:".concat(tT(e))),t._reportBody.backfill(r),t._reportBody.getLogsNumInMemory()>t.MAX_THRESHOLD||t._retryCount===t.MAX_RETRY_COUNT||0===t._timerID?t._retryCount=0:t._retryCount+=1}})}}},{key:"reset",value:function(){uT.log("EventStatController.reset"),this._stopReportTimer(),this._report()}}]),t}(),mT=zr.includes,TT=uf;Li({target:"Array",proto:!0,forced:x((function(){return!Array(1).includes()}))},{includes:function(t){return mT(this,t,arguments.length>1?arguments[1]:void 0)}}),TT("includes");var _T=Et,DT=tt,CT=we("match"),RT=function(t){var e;return _T(t)&&(void 0!==(e=t[CT])?!!e:"RegExp"==DT(t))},bT=TypeError,ST=we("match"),LT=Li,wT=function(t){if(RT(t))throw bT("The method doesn't accept regular expressions");return t},kT=ut,AT=Dh,OT=function(t){var e=/./;try{"/./"[t](e)}catch(n){try{return e[ST]=!1,"/./"[t](e)}catch(t){}}return!1},xT=W("".indexOf);LT({target:"String",proto:!0,forced:!OT("includes")},{includes:function(t){return!!~xT(AT(kT(this)),AT(wT(t)),arguments.length>1?arguments[1]:void 0)}});var NT=W,UT=Dv,MT=Tp.exports.getWeakData,PT=ss,VT=cn,jT=ot,GT=Et,HT=Cl,BT=pe,FT=ir.set,KT=ir.getterFor,zT=ro.find,JT=ro.findIndex,$T=NT([].splice),YT=0,qT=function(t){return t.frozen||(t.frozen=new WT)},WT=function(){this.entries=[]},XT=function(t,e){return zT(t.entries,(function(t){return t[0]===e}))};WT.prototype={get:function(t){var e=XT(this,t);if(e)return e[1]},has:function(t){return!!XT(this,t)},set:function(t,e){var n=XT(this,t);n?n[1]=e:this.entries.push([t,e])},delete:function(t){var e=JT(this.entries,(function(e){return e[0]===t}));return~e&&$T(this.entries,e,1),!!~e}};var QT,ZT={getConstructor:function(t,e,n,r){var i=t((function(t,i){PT(t,a),FT(t,{type:e,id:YT++,frozen:void 0}),jT(i)||HT(i,t[r],{that:t,AS_ENTRIES:n})})),a=i.prototype,o=KT(e),s=function(t,e,n){var r=o(t),i=MT(VT(e),!0);return!0===i?qT(r).set(e,n):i[r.id]=n,t};return UT(a,{delete:function(t){var e=o(this);if(!GT(t))return!1;var n=MT(t);return!0===n?qT(e).delete(t):n&&BT(n,e.id)&&delete n[e.id]},has:function(t){var e=o(this);if(!GT(t))return!1;var n=MT(t);return!0===n?qT(e).has(t):n&&BT(n,e.id)}}),UT(a,n?{get:function(t){var e=o(this);if(GT(t)){var n=MT(t);return!0===n?qT(e).get(t):n?n[e.id]:void 0}},set:function(t,e){return s(this,t,e)}}:{add:function(t){return s(this,t,!0)}}),i}},t_=Gp,e_=A,n_=W,r_=Dv,i_=Tp.exports,a_=Tv,o_=ZT,s_=Et,c_=ir.enforce,u_=x,l_=jn,h_=Object,d_=Array.isArray,f_=h_.isExtensible,p_=h_.isFrozen,v_=h_.isSealed,g_=h_.freeze,y_=h_.seal,I_={},E_={},m_=!e_.ActiveXObject&&"ActiveXObject"in e_,T_=function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}},__=a_("WeakMap",T_,o_),D_=__.prototype,C_=n_(D_.set);if(l_)if(m_){QT=o_.getConstructor(T_,"WeakMap",!0),i_.enable();var R_=n_(D_.delete),b_=n_(D_.has),S_=n_(D_.get);r_(D_,{delete:function(t){if(s_(t)&&!f_(t)){var e=c_(this);return e.frozen||(e.frozen=new QT),R_(this,t)||e.frozen.delete(t)}return R_(this,t)},has:function(t){if(s_(t)&&!f_(t)){var e=c_(this);return e.frozen||(e.frozen=new QT),b_(this,t)||e.frozen.has(t)}return b_(this,t)},get:function(t){if(s_(t)&&!f_(t)){var e=c_(this);return e.frozen||(e.frozen=new QT),b_(this,t)?S_(this,t):e.frozen.get(t)}return S_(this,t)},set:function(t,e){if(s_(t)&&!f_(t)){var n=c_(this);n.frozen||(n.frozen=new QT),b_(this,t)?C_(this,t,e):n.frozen.set(t,e)}else C_(this,t,e);return this}})}else t_&&u_((function(){var t=g_([]);return C_(new __,t,1),!p_(t)}))&&r_(D_,{set:function(t,e){var n;return d_(t)&&(p_(t)?n=I_:v_(t)&&(n=E_)),C_(this,t,e),n==I_&&g_(t),n==E_&&y_(t),this}});var L_={exports:{}};
/*!
 * validate.js 0.13.1
 *
 * (c) 2013-2019 Nicklas Ansman, 2013 Wrapp
 * Validate.js may be freely distributed under the MIT license.
 * For all details and documentation:
 * http://validatejs.org/
 */(function(t,e,n){var r=function(t,e,n){n=i.extend({},i.options,n);var a=i.runValidations(t,e,n);if(a.some((function(t){return i.isPromise(t.error)})))throw new Error("Use validate.async if you want support for promises");return r.processValidationResults(a,n)},i=r;i.extend=function(t){return[].slice.call(arguments,1).forEach((function(e){for(var n in e)t[n]=e[n]})),t},i.extend(r,{version:{major:0,minor:13,patch:1,metadata:null,toString:function(){var t=i.format("%{major}.%{minor}.%{patch}",i.version);return i.isEmpty(i.version.metadata)||(t+="+"+i.version.metadata),t}},Promise:"undefined"!=typeof Promise?Promise:null,EMPTY_STRING_REGEXP:/^\s*$/,runValidations:function(t,e,n){var r,a,o,s,c,u,l,h=[];for(r in(i.isDomElement(t)||i.isJqueryElement(t))&&(t=i.collectFormValues(t)),e)for(a in o=i.getDeepObjectValue(t,r),s=i.result(e[r],o,t,r,n,e)){if(!(c=i.validators[a]))throw l=i.format("Unknown validator %{name}",{name:a}),new Error(l);u=s[a],(u=i.result(u,o,t,r,n,e))&&h.push({attribute:r,value:o,validator:a,globalOptions:n,attributes:t,options:u,error:c.call(c,o,u,r,t,n)})}return h},processValidationResults:function(t,e){t=i.pruneEmptyErrors(t,e),t=i.expandMultipleErrors(t,e),t=i.convertErrorMessages(t,e);var n=e.format||"grouped";if("function"!=typeof i.formatters[n])throw new Error(i.format("Unknown format %{format}",e));return t=i.formatters[n](t),i.isEmpty(t)?void 0:t},async:function(t,e,n){var r=(n=i.extend({},i.async.options,n)).wrapErrors||function(t){return t};!1!==n.cleanAttributes&&(t=i.cleanAttributes(t,e));var a=i.runValidations(t,e,n);return new i.Promise((function(o,s){i.waitForResults(a).then((function(){var c=i.processValidationResults(a,n);c?s(new r(c,n,t,e)):o(t)}),(function(t){s(t)}))}))},single:function(t,e,n){return n=i.extend({},i.single.options,n,{format:"flat",fullMessages:!1}),i({single:t},{single:e},n)},waitForResults:function(t){return t.reduce((function(t,e){return i.isPromise(e.error)?t.then((function(){return e.error.then((function(t){e.error=t||null}))})):t}),new i.Promise((function(t){t()})))},result:function(t){var e=[].slice.call(arguments,1);return"function"==typeof t&&(t=t.apply(null,e)),t},isNumber:function(t){return"number"==typeof t&&!isNaN(t)},isFunction:function(t){return"function"==typeof t},isInteger:function(t){return i.isNumber(t)&&t%1==0},isBoolean:function(t){return"boolean"==typeof t},isObject:function(t){return t===Object(t)},isDate:function(t){return t instanceof Date},isDefined:function(t){return null!=t},isPromise:function(t){return!!t&&i.isFunction(t.then)},isJqueryElement:function(t){return t&&i.isString(t.jquery)},isDomElement:function(t){return!!t&&!(!t.querySelectorAll||!t.querySelector)&&(!(!i.isObject(document)||t!==document)||("object"==typeof HTMLElement?t instanceof HTMLElement:t&&"object"==typeof t&&null!==t&&1===t.nodeType&&"string"==typeof t.nodeName))},isEmpty:function(t){var e;if(!i.isDefined(t))return!0;if(i.isFunction(t))return!1;if(i.isString(t))return i.EMPTY_STRING_REGEXP.test(t);if(i.isArray(t))return 0===t.length;if(i.isDate(t))return!1;if(i.isObject(t)){for(e in t)return!1;return!0}return!1},format:i.extend((function(t,e){return i.isString(t)?t.replace(i.format.FORMAT_REGEXP,(function(t,n,r){return"%"===n?"%{"+r+"}":String(e[r])})):t}),{FORMAT_REGEXP:/(%?)%\{([^\}]+)\}/g}),prettify:function(t){return i.isNumber(t)?100*t%1==0?""+t:parseFloat(Math.round(100*t)/100).toFixed(2):i.isArray(t)?t.map((function(t){return i.prettify(t)})).join(", "):i.isObject(t)?i.isDefined(t.toString)?t.toString():JSON.stringify(t):(t=""+t).replace(/([^\s])\.([^\s])/g,"$1 $2").replace(/\\+/g,"").replace(/[_-]/g," ").replace(/([a-z])([A-Z])/g,(function(t,e,n){return e+" "+n.toLowerCase()})).toLowerCase()},stringifyValue:function(t,e){return(e&&e.prettify||i.prettify)(t)},isString:function(t){return"string"==typeof t},isArray:function(t){return"[object Array]"==={}.toString.call(t)},isHash:function(t){return i.isObject(t)&&!i.isArray(t)&&!i.isFunction(t)},contains:function(t,e){return!!i.isDefined(t)&&(i.isArray(t)?-1!==t.indexOf(e):e in t)},unique:function(t){return i.isArray(t)?t.filter((function(t,e,n){return n.indexOf(t)==e})):t},forEachKeyInKeypath:function(t,e,n){if(i.isString(e)){var r,a="",o=!1;for(r=0;r<e.length;++r)switch(e[r]){case".":o?(o=!1,a+="."):(t=n(t,a,!1),a="");break;case"\\":o?(o=!1,a+="\\"):o=!0;break;default:o=!1,a+=e[r]}return n(t,a,!0)}},getDeepObjectValue:function(t,e){if(i.isObject(t))return i.forEachKeyInKeypath(t,e,(function(t,e){if(i.isObject(t))return t[e]}))},collectFormValues:function(t,e){var n,r,a,o,s,c,u={};if(i.isJqueryElement(t)&&(t=t[0]),!t)return u;for(e=e||{},o=t.querySelectorAll("input[name], textarea[name]"),n=0;n<o.length;++n)if(a=o.item(n),!i.isDefined(a.getAttribute("data-ignored"))){var l=a.name.replace(/\./g,"\\\\.");c=i.sanitizeFormValue(a.value,e),"number"===a.type?c=c?+c:null:"checkbox"===a.type?a.attributes.value?a.checked||(c=u[l]||null):c=a.checked:"radio"===a.type&&(a.checked||(c=u[l]||null)),u[l]=c}for(o=t.querySelectorAll("select[name]"),n=0;n<o.length;++n)if(a=o.item(n),!i.isDefined(a.getAttribute("data-ignored"))){if(a.multiple)for(r in c=[],a.options)(s=a.options[r])&&s.selected&&c.push(i.sanitizeFormValue(s.value,e));else{var h=void 0!==a.options[a.selectedIndex]?a.options[a.selectedIndex].value:"";c=i.sanitizeFormValue(h,e)}u[a.name]=c}return u},sanitizeFormValue:function(t,e){return e.trim&&i.isString(t)&&(t=t.trim()),!1!==e.nullify&&""===t?null:t},capitalize:function(t){return i.isString(t)?t[0].toUpperCase()+t.slice(1):t},pruneEmptyErrors:function(t){return t.filter((function(t){return!i.isEmpty(t.error)}))},expandMultipleErrors:function(t){var e=[];return t.forEach((function(t){i.isArray(t.error)?t.error.forEach((function(n){e.push(i.extend({},t,{error:n}))})):e.push(t)})),e},convertErrorMessages:function(t,e){var n=[],r=(e=e||{}).prettify||i.prettify;return t.forEach((function(t){var a=i.result(t.error,t.value,t.attribute,t.options,t.attributes,t.globalOptions);i.isString(a)?("^"===a[0]?a=a.slice(1):!1!==e.fullMessages&&(a=i.capitalize(r(t.attribute))+" "+a),a=a.replace(/\\\^/g,"^"),a=i.format(a,{value:i.stringifyValue(t.value,e)}),n.push(i.extend({},t,{error:a}))):n.push(t)})),n},groupErrorsByAttribute:function(t){var e={};return t.forEach((function(t){var n=e[t.attribute];n?n.push(t):e[t.attribute]=[t]})),e},flattenErrorsToArray:function(t){return t.map((function(t){return t.error})).filter((function(t,e,n){return n.indexOf(t)===e}))},cleanAttributes:function(t,e){function n(t,e,n){return i.isObject(t[e])?t[e]:t[e]=!!n||{}}return i.isObject(e)&&i.isObject(t)?function t(e,n){if(!i.isObject(e))return e;var r,a,o=i.extend({},e);for(a in e)r=n[a],i.isObject(r)?o[a]=t(o[a],r):r||delete o[a];return o}(t,e=function(t){var e,r={};for(e in t)t[e]&&i.forEachKeyInKeypath(r,e,n);return r}(e)):{}},exposeModule:function(t,e,n,r,i){n?(r&&r.exports&&(n=r.exports=t),n.validate=t):(e.validate=t,t.isFunction(i)&&i.amd&&i([],(function(){return t})))},warn:function(t){"undefined"!=typeof console&&console.warn&&console.warn("[validate.js] "+t)},error:function(t){"undefined"!=typeof console&&console.error&&console.error("[validate.js] "+t)}}),r.validators={presence:function(t,e){if(!1!==(e=i.extend({},this.options,e)).allowEmpty?!i.isDefined(t):i.isEmpty(t))return e.message||this.message||"can't be blank"},length:function(t,e,n){if(i.isDefined(t)){var r,a=(e=i.extend({},this.options,e)).is,o=e.maximum,s=e.minimum,c=[],u=(t=(e.tokenizer||function(t){return t})(t)).length;return i.isNumber(u)?(i.isNumber(a)&&u!==a&&(r=e.wrongLength||this.wrongLength||"is the wrong length (should be %{count} characters)",c.push(i.format(r,{count:a}))),i.isNumber(s)&&u<s&&(r=e.tooShort||this.tooShort||"is too short (minimum is %{count} characters)",c.push(i.format(r,{count:s}))),i.isNumber(o)&&u>o&&(r=e.tooLong||this.tooLong||"is too long (maximum is %{count} characters)",c.push(i.format(r,{count:o}))),c.length>0?e.message||c:void 0):e.message||this.notValid||"has an incorrect length"}},numericality:function(t,e,n,r,a){if(i.isDefined(t)){var o,s,c=[],u={greaterThan:function(t,e){return t>e},greaterThanOrEqualTo:function(t,e){return t>=e},equalTo:function(t,e){return t===e},lessThan:function(t,e){return t<e},lessThanOrEqualTo:function(t,e){return t<=e},divisibleBy:function(t,e){return t%e==0}},l=(e=i.extend({},this.options,e)).prettify||a&&a.prettify||i.prettify;if(i.isString(t)&&e.strict){var h="^-?(0|[1-9]\\d*)";if(e.onlyInteger||(h+="(\\.\\d+)?"),h+="$",!new RegExp(h).test(t))return e.message||e.notValid||this.notValid||this.message||"must be a valid number"}if(!0!==e.noStrings&&i.isString(t)&&!i.isEmpty(t)&&(t=+t),!i.isNumber(t))return e.message||e.notValid||this.notValid||this.message||"is not a number";if(e.onlyInteger&&!i.isInteger(t))return e.message||e.notInteger||this.notInteger||this.message||"must be an integer";for(o in u)if(s=e[o],i.isNumber(s)&&!u[o](t,s)){var d="not"+i.capitalize(o),f=e[d]||this[d]||this.message||"must be %{type} %{count}";c.push(i.format(f,{count:s,type:l(o)}))}return e.odd&&t%2!=1&&c.push(e.notOdd||this.notOdd||this.message||"must be odd"),e.even&&t%2!=0&&c.push(e.notEven||this.notEven||this.message||"must be even"),c.length?e.message||c:void 0}},datetime:i.extend((function(t,e){if(!i.isFunction(this.parse)||!i.isFunction(this.format))throw new Error("Both the parse and format functions needs to be set to use the datetime/date validator");if(i.isDefined(t)){var n,r=[],a=(e=i.extend({},this.options,e)).earliest?this.parse(e.earliest,e):NaN,o=e.latest?this.parse(e.latest,e):NaN;return t=this.parse(t,e),isNaN(t)||e.dateOnly&&t%864e5!=0?(n=e.notValid||e.message||this.notValid||"must be a valid date",i.format(n,{value:arguments[0]})):(!isNaN(a)&&t<a&&(n=e.tooEarly||e.message||this.tooEarly||"must be no earlier than %{date}",n=i.format(n,{value:this.format(t,e),date:this.format(a,e)}),r.push(n)),!isNaN(o)&&t>o&&(n=e.tooLate||e.message||this.tooLate||"must be no later than %{date}",n=i.format(n,{date:this.format(o,e),value:this.format(t,e)}),r.push(n)),r.length?i.unique(r):void 0)}}),{parse:null,format:null}),date:function(t,e){return e=i.extend({},e,{dateOnly:!0}),i.validators.datetime.call(i.validators.datetime,t,e)},format:function(t,e){(i.isString(e)||e instanceof RegExp)&&(e={pattern:e});var n,r=(e=i.extend({},this.options,e)).message||this.message||"is invalid",a=e.pattern;if(i.isDefined(t))return i.isString(t)?(i.isString(a)&&(a=new RegExp(e.pattern,e.flags)),(n=a.exec(t))&&n[0].length==t.length?void 0:r):r},inclusion:function(t,e){if(i.isDefined(t)&&(i.isArray(e)&&(e={within:e}),e=i.extend({},this.options,e),!i.contains(e.within,t))){var n=e.message||this.message||"^%{value} is not included in the list";return i.format(n,{value:t})}},exclusion:function(t,e){if(i.isDefined(t)&&(i.isArray(e)&&(e={within:e}),e=i.extend({},this.options,e),i.contains(e.within,t))){var n=e.message||this.message||"^%{value} is restricted";return i.isString(e.within[t])&&(t=e.within[t]),i.format(n,{value:t})}},email:i.extend((function(t,e){var n=(e=i.extend({},this.options,e)).message||this.message||"is not a valid email";if(i.isDefined(t))return i.isString(t)&&this.PATTERN.exec(t)?void 0:n}),{PATTERN:/^(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i}),equality:function(t,e,n,r,a){if(i.isDefined(t)){i.isString(e)&&(e={attribute:e});var o=(e=i.extend({},this.options,e)).message||this.message||"is not equal to %{attribute}";if(i.isEmpty(e.attribute)||!i.isString(e.attribute))throw new Error("The attribute must be a non empty string");var s=i.getDeepObjectValue(r,e.attribute),c=e.comparator||function(t,e){return t===e},u=e.prettify||a&&a.prettify||i.prettify;return c(t,s,e,n,r)?void 0:i.format(o,{attribute:u(e.attribute)})}},url:function(t,e){if(i.isDefined(t)){var n=(e=i.extend({},this.options,e)).message||this.message||"is not a valid url",r=e.schemes||this.schemes||["http","https"],a=e.allowLocal||this.allowLocal||!1,o=e.allowDataUrl||this.allowDataUrl||!1;if(!i.isString(t))return n;var s="^(?:(?:"+r.join("|")+")://)(?:\\S+(?::\\S*)?@)?(?:",c="(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))";return a?c+="?":s+="(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})",s+="(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*"+c+")(?::\\d{2,5})?(?:[/?#]\\S*)?$",o&&(s="(?:"+s+")|(?:^data:(?:\\w+\\/[-+.\\w]+(?:;[\\w=]+)*)?(?:;base64)?,[A-Za-z0-9-_.!~\\*'();\\/?:@&=+$,%]*$)"),new RegExp(s,"i").exec(t)?void 0:n}},type:i.extend((function(t,e,n,r,a){if(i.isString(e)&&(e={type:e}),i.isDefined(t)){var o,s=i.extend({},this.options,e),c=s.type;if(!i.isDefined(c))throw new Error("No type was specified");if(o=i.isFunction(c)?c:this.types[c],!i.isFunction(o))throw new Error("validate.validators.type.types."+c+" must be a function.");if(!o(t,s,n,r,a)){var u=e.message||this.messages[c]||this.message||s.message||(i.isFunction(c)?"must be of the correct type":"must be of type %{type}");return i.isFunction(u)&&(u=u(t,e,n,r,a)),i.format(u,{attribute:i.prettify(n),type:c})}}}),{types:{object:function(t){return i.isObject(t)&&!i.isArray(t)},array:i.isArray,integer:i.isInteger,number:i.isNumber,string:i.isString,date:i.isDate,boolean:i.isBoolean},messages:{}})},r.formatters={detailed:function(t){return t},flat:i.flattenErrorsToArray,grouped:function(t){var e;for(e in t=i.groupErrorsByAttribute(t))t[e]=i.flattenErrorsToArray(t[e]);return t},constraint:function(t){var e;for(e in t=i.groupErrorsByAttribute(t))t[e]=t[e].map((function(t){return t.validator})).sort();return t}},r.exposeModule(r,this,t,e,n)}).call(w,L_.exports,L_,null);var w_=L_.exports,k_="number",A_="string",O_="object",x_="function",N_="array",U_={createInstance:{sdkAppID:{presence:!0,type:k_},tim:{type:O_}},destroyInstance:{},init:{userID:{presence:!0,type:A_},userSig:{presence:!0,type:A_}},on:{eventCode:{presence:!0,type:A_},handler:{presence:!0,type:x_},context:{presence:!0,type:O_}},off:{eventCode:{presence:!0,type:A_},handler:{presence:!0,type:x_}},call:{userID:{presence:!0,type:A_},type:{presence:!0,type:k_},roomID:{presence:!1,type:k_,numericality:{onlyInteger:!0,greaterThan:0,lessThanOrEqualTo:bg}}},groupCall:{groupID:{presence:!0,type:A_},type:{presence:!0,type:k_},userIDList:{presence:!0,type:N_},roomID:{presence:!1,type:k_,numericality:{onlyInteger:!0,greaterThan:0,lessThanOrEqualTo:bg}}},joinInGroupCall:{groupID:{presence:!0,type:A_},type:{presence:!0,type:k_},roomID:{presence:!0,type:k_}},inviteUser:{userIDList:{presence:!0,type:N_}},accept:{},reject:{},hangup:{},switchCallMediaType:{type:{presence:!0,type:k_}},openCamera:{},closeCamera:{},switchCamera:{},openMicrophone:{},closeMicrophone:{},selectAudioPlaybackDevice:{type:{presence:!0,type:A_}},setSelfInfo:{nickName:{presence:!0,type:A_},avatar:{presence:!0,type:A_}}},M_={createInstance:"",destroyInstance:"",init:"",on:"",off:"",call:[sg.IDLE],groupCall:[sg.IDLE],accept:[sg.CALLING],reject:[sg.CALLING],hangup:[sg.CALLING,sg.CONNECTED],switchCallMediaType:[sg.CALLING,sg.CONNECTED],joinInGroupCall:[sg.IDLE],inviteUser:[sg.CALLING,sg.CONNECTED],openCamera:[sg.CALLING,sg.CONNECTED],closeCamera:[sg.CALLING,sg.CONNECTED],switchCamera:[sg.CALLING,sg.CONNECTED],openMicrophone:[sg.CALLING,sg.CONNECTED],closeMicrophone:[sg.CALLING,sg.CONNECTED],selectAudioPlaybackDevice:[sg.CALLING,sg.CONNECTED],setSelfInfo:""},P_={createInstance:!1,destroyInstance:!0,init:!1,off:!0,call:!0,groupCall:!0,joinInGroupCall:!0,inviteUser:!0,accept:!0,reject:!0,hangup:!0,switchCallMediaType:!0,openCamera:!0,closeCamera:!0,switchCamera:!0,openMicrophone:!0,closeMicrophone:!0,selectAudioPlaybackDevice:!0,setSelfInfo:!0},V_=function(t){f(n,I(Error));var e=T(n);function n(t,r,i){var a;return u(this,n),d(m(a=e.call(this,r)),"code",void 0),d(m(a),"message",void 0),d(m(a),"data",void 0),a.code=t,a.message=r,a.data=i,a}return h(n,null,[{key:"error",value:function(t,e,r){return r?new n(t,e,r):new n(t,e)}}]),n}();w_.validators.type.types.function=function(t){return t instanceof Function};var j_=function(){function t(){u(this,t),d(this,"paramsMatchedRule",U_),d(this,"statusMatchedRule",M_),d(this,"requireInit",P_)}return h(t,[{key:"getParamsMatchedRule",value:function(t){return this.paramsMatchedRule[t]}},{key:"getStatusMatchedRule",value:function(t){return this.statusMatchedRule[t]}},{key:"getInitReadyRule",value:function(t){return this.requireInit[t]}}]),t}(),G_=function(){function t(){u(this,t)}return h(t,[{key:"notify",value:function(t,e,n,r){throw V_.error(e,"[TUICallEngine:".concat(t.api,",").concat(e,"]").concat(n).concat(r))}}]),t}(),H_=h((function t(e){u(this,t),d(this,"api",""),d(this,"attributes",{}),d(this,"callStatus",""),d(this,"capabilityCode",void 0),d(this,"initReady",void 0),this.api=e.api,this.attributes=e.attributes,this.callStatus=e.callStatus,this.capabilityCode=e.capabilityCode,this.initReady=e.initReady})),B_=new WeakMap,F_=function(){function t(){u(this,t),L(this,B_,{writable:!0,value:void 0}),b(this,B_,[])}var e;return h(t,[{key:"addAlertHandler",value:function(t){R(this,B_).push(t)}},{key:"check",value:(e=c(a().mark((function t(e,n){var r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=0;case 1:if(!(r<R(this,B_).length)){t.next=7;break}return t.next=4,R(this,B_)[r].check(e,n);case 4:r++,t.next=1;break;case 7:case"end":return t.stop()}}),t,this)}))),function(t,n){return e.apply(this,arguments)})},{key:"checkSync",value:function(t,e){for(var n=0;n<R(this,B_).length;n++)R(this,B_)[n].check(t,e)}}]),t}(),K_=function(){function t(e,n){u(this,t),d(this,"rule",void 0),d(this,"notification",void 0),this.rule=e,this.notification=n}var e;return h(t,[{key:"check",value:(e=c(a().mark((function t(e){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return");case 1:case"end":return t.stop()}}),t)}))),function(t){return e.apply(this,arguments)})}]),t}(),z_=function(t){f(n,K_);var e=T(n);function n(t,r){return u(this,n),e.call(this,t,r)}return h(n,[{key:"check",value:function(t){var e=this.rule.getParamsMatchedRule(t.api);if(e&&t.attributes){var n=w_(t.attributes,e);if(void 0!==n)for(var r=0,i=Object.keys(n);r<i.length;r++){var a=i[r];Object.prototype.hasOwnProperty.call(n,a)&&this.notification.notify(t,cy.ERROR_PARAM_INVALID,n[a])}}}}]),n}(),J_=function(t){f(n,K_);var e=T(n);function n(t,r){return u(this,n),e.call(this,t,r)}return h(n,[{key:"check",value:function(t){if(t.callStatus){var e=this.rule.getStatusMatchedRule(t.api);e&&!e.includes(t.callStatus)&&this.notification.notify(t,cy.ERROR_REQUEST_REFUSED,fy,py.ERROR_REQUEST_REFUSED)}}}]),n}(),$_=function(t){f(r,K_);var e,n=T(r);function r(t,e){return u(this,r),n.call(this,t,e)}return h(r,[{key:"check",value:(e=c(a().mark((function t(e){var n,r=arguments;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=r.length>1&&void 0!==r[1]?r[1]:{},!e.capabilityCode){t.next=14;break}return t.prev=2,t.next=5,n.tim.callExperimentalAPI("isCommercialAbilityEnabled",e.capabilityCode);case 5:!1===t.sent.data.enabled&&this.notification.notify(e,cy.ERROR_PACKAGE_NOT_SUPPORTED,ly,py.ERROR_PACKAGE_NOT_SUPPORTED),t.next=14;break;case 9:t.prev=9,t.t0=t.catch(2),wx.$TUICallEngine._callDataReport.setCodeAndMessage(cy.ERROR_PACKAGE_NOT_SUPPORTED,JSON.stringify(t.t0)),wx.$TUICallEngine._callDataReport.uploadToKibana(),2905===t.t0.code?this.notification.notify(e,cy.ERROR_TIM_VERSION_OUTDATED,hy,py.ERROR_TIM_VERSION_OUTDATED):this.notification.notify(e,cy.ERROR_PACKAGE_NOT_SUPPORTED,ly,py.ERROR_PACKAGE_NOT_SUPPORTED);case 14:case"end":return t.stop()}}),t,this,[[2,9]])}))),function(t){return e.apply(this,arguments)})}]),r}(),Y_=function(t){f(n,K_);var e=T(n);function n(t,r){return u(this,n),e.call(this,t,r)}return h(n,[{key:"check",value:function(t,e){void 0!==t.initReady&&this.rule.getInitReadyRule(t.api)!==t.initReady&&this.notification.notify(t,cy.ERROR_INIT_FAIL,dy,py.ERROR_INIT_FAIL)}}]),n}(),q_=function(){function t(){u(this,t),d(this,"alertRule",void 0),d(this,"notification",void 0),d(this,"alert",void 0)}return h(t,[{key:"initializeBeans",value:function(){this.alertRule=new j_,this.notification=new G_,this.alert=new F_,this.alert.addAlertHandler(new z_(this.alertRule,this.notification)),this.alert.addAlertHandler(new Y_(this.alertRule,this.notification)),this.alert.addAlertHandler(new $_(this.alertRule,this.notification)),this.alert.addAlertHandler(new J_(this.alertRule,this.notification))}},{key:"getAlert",value:function(){return this.alert}}],[{key:"getInstance",value:function(){return this.instance||(this.instance=new t,this.instance.initializeBeans()),this.instance}}]),t}();d(q_,"instance",void 0);var W_=W,X_=$t,Q_=Et,Z_=pe,tD=Ts,eD=U,nD=Function,rD=W_([].concat),iD=W_([].join),aD={},oD=eD?nD.bind:function(t){var e=X_(this),n=e.prototype,r=tD(arguments,1),i=function(){var n=rD(r,tD(arguments));return this instanceof i?function(t,e,n){if(!Z_(aD,e)){for(var r=[],i=0;i<e;i++)r[i]="a["+i+"]";aD[e]=nD("C,a","return new C("+iD(r,",")+")")}return aD[e](t,n)}(e,n.length,n):e.apply(t,n)};return Q_(n)&&(i.prototype=n),i};function sD(t){var e=Sg.UNKNOWN;switch(t){case Eg:e=Sg.AUDIO;break;case mg:e=Sg.VIDEO}return e}function cD(t){var e=t;return e===gg?e=Sg.CALLER:e===yg&&(e=Sg.CALLEE),e}Li({target:"Function",proto:!0,forced:Function.bind!==oD},{bind:oD});var uD=function(){function t(e){u(this,t),d(this,"_eventStatController",void 0),d(this,"_callData",void 0),d(this,"_ssoLog",void 0),this._eventStatController=new ET,lT.bindController(this._eventStatController),this.initializeCallData(e),this._ssoLog=new lT(fT)}return h(t,[{key:"setCallData",value:function(t){this._callData=t}},{key:"getCallData",value:function(){return this._callData}},{key:"setInviteID",value:function(t){this._callData.inviteID=t}},{key:"setTotalTime",value:function(t){this._callData.totalTime="".concat(t)}},{key:"setAbilityBit",value:function(t){this._callData.abilityBit=!!t}},{key:"setEnterRoomTime",value:function(t){this._callData.enterRoomTime=Qg(t)}},{key:"setSendSignalingTime",value:function(t){this._callData.sendSignalingTime=Qg(t)}},{key:"setCallAcceptTime",value:function(t){this._callData.callAcceptTime=Qg(t)}},{key:"setExitRoomTime",value:function(t){this._callData.exitRoomTime=Qg(t)}},{key:"setCallEndTime",value:function(t){this._callData.callEndTime=Qg(t)}},{key:"setCodeAndMessage",value:function(t,e){this._callData.code=t||0,this._callData.message=e||""}},{key:"setCallScene",value:function(t){this._callData.callScene=t||""}},{key:"getResult",value:function(){return this._callData.result}},{key:"setResult",value:function(t){this._callData.result=t||""}},{key:"setUserID",value:function(t){this._callData.userID=t||""}},{key:"packageCallDataToKibana",value:function(){var t=sD(this._callData.callType),e=cD(this._callData.callRole);return"".concat("CallData{version='").concat(this._callData.version,", platform=").concat(this._callData.platform,", framework=").concat(this._callData.framework,", sdk_app_id=").concat(this._callData.sdkAppId,", user_id=").concat(this._callData.userID,", room_id=").concat(this._callData.roomID,", invite_id=").concat(this._callData.inviteID,", invitee_list=").concat(this._callData.inviteeList,", media_type=").concat(t,", role=").concat(e,", call_scene=").concat(this._callData.callScene,", result=").concat(this._callData.result,", total_time=").concat(this._callData.totalTime,", total_score=").concat(this._callData.totalScore,", ability_bit=").concat(this._callData.abilityBit,", enter_room=").concat(this._callData.enterRoomTime,", send_signaling=").concat(this._callData.sendSignalingTime,", call_accept=").concat(this._callData.callAcceptTime,", exit_room=").concat(this._callData.exitRoomTime,", call_end=").concat(this._callData.callEndTime,", code=").concat(this._callData.code,", message=").concat(this._callData.message,", network=").concat(this._callData.network,", audio=").concat(this._callData.audio,", video=").concat(this._callData.video,"}")}},{key:"initializeCallData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.version,n=void 0===e?"":e,r=t.sdkAppId,i=void 0===r?0:r,a=t.userID,o=void 0===a?"":a,s=eT(),c=Hm?"uniminiprogram":"wxminiprogram";this._callData={version:n,platform:s,framework:c,sdkAppId:i,userID:o,roomID:0,inviteID:"",callRole:vg,callScene:"",callType:Ig,inviteeList:[],result:Sg.UNKNOWN,totalTime:0,totalScore:0,code:0,message:"",abilityBit:!1,enterRoomTime:"",sendSignalingTime:"",callAcceptTime:"",exitRoomTime:"",callEndTime:"",network:0,audio:0,video:0}}},{key:"reset",value:function(){this.initializeCallData(),this._ssoLog=null}},{key:"clearCallDataAfterUpload",value:function(){var t=this.getCallData(),e=t.version,n=t.sdkAppId,r=t.userID;this.initializeCallData({version:e,sdkAppId:n,userID:r})}},{key:"uploadToKibana",value:function(){try{this._ssoLog.setText(this.packageCallDataToKibana()).setEnd(),this.clearCallDataAfterUpload()}catch(t){}}}]),t}(),lD=function(){function t(e,n){u(this,t),d(this,"_eventEmitter",void 0),d(this,"_callDataReport",void 0),this._eventEmitter=e.emitter,this._callDataReport=n,this.registerListener()}return h(t,[{key:"registerListener",value:function(){this._eventEmitter.on(og.CALL_END,this.onCallEnd.bind(this)),this._eventEmitter.on(og.CALLING_CANCEL,this.onCallingCancel.bind(this)),this._eventEmitter.on(og.NO_RESP,this.onNoResponse.bind(this)),this._eventEmitter.on(og.LINE_BUSY,this.onLineBusy.bind(this)),this._eventEmitter.on(og.REJECT,this.onReject.bind(this))}},{key:"removeLister",value:function(){this._eventEmitter.off(og.CALL_END,this.onCallEnd.bind(this)),this._eventEmitter.off(og.CALLING_CANCEL,this.onCallingCancel.bind(this)),this._eventEmitter.off(og.NO_RESP,this.onNoResponse.bind(this)),this._eventEmitter.off(og.LINE_BUSY,this.onLineBusy.bind(this)),this._eventEmitter.off(og.REJECT,this.onReject.bind(this))}},{key:"onCallEnd",value:function(t){var e=t.data.totalTime,n=void 0===e?0:e;this._callDataReport.setTotalTime(n),this._callDataReport.setCallEndTime((new Date).getTime()),this._callDataReport.setResult(Sg.NORMAL),this._callDataReport.setCodeAndMessage(),this._callDataReport.uploadToKibana()}},{key:"onCallingCancel",value:function(){this._callDataReport.getResult()||this._callDataReport.setResult(Sg.CANCEL),this._callDataReport.setCodeAndMessage(),this._callDataReport.uploadToKibana()}},{key:"onNoResponse",value:function(){this._callDataReport.setResult(Sg.TIMEOUT)}},{key:"onLineBusy",value:function(){this._callDataReport.setResult(Sg.BUSYLINE)}},{key:"onReject",value:function(){this._callDataReport.setResult(Sg.REJECT)}}]),t}();function hD(t){return dD.apply(this,arguments)}function dD(){return dD=c(a().mark((function t(e){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e===pg.AUDIO||e===pg.VIDEO){t.next=2;break}return t.abrupt("return");case 2:return t.abrupt("return",new Promise(function(){var t=c(a().mark((function t(n,r){var i,o,s,c,u,l;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i={microphone:!0,camera:e===pg.VIDEO},t.next=3,nT(i);case 3:if((o=t.sent)||e!==pg.AUDIO){t.next=16;break}return t.prev=5,t.next=8,wx.authorize({scope:kg.RECORD});case 8:t.next=16;break;case 10:t.prev=10,t.t0=t.catch(5),s=Lg.MIC_TITLE,c=Lg.MIC_CONTENT,fD(s,c),r();case 16:if(o||e!==pg.VIDEO){t.next=30;break}return t.prev=17,t.next=20,wx.authorize({scope:kg.RECORD});case 20:return t.next=22,wx.authorize({scope:kg.CAMERA});case 22:t.next=30;break;case 24:t.prev=24,t.t1=t.catch(17),u=Lg.CAMERA_TITLE,l=Lg.CAMERA_CONTENT,fD(u,l),r();case 30:n();case 31:case"end":return t.stop()}}),t,null,[[5,10],[17,24]])})));return function(e,n){return t.apply(this,arguments)}}()));case 3:case"end":return t.stop()}}),t)}))),dD.apply(this,arguments)}function fD(t,e){wx.showModal({title:t,content:e,confirmText:Lg.CONFIRM_TEXT,success:function(t){t.confirm&&wx.openSetting()}})}var pD=Li,vD=W,gD=Ar,yD=QI,ID=wE,ED=x,mD=RangeError,TD=String,_D=Math.floor,DD=vD(ID),CD=vD("".slice),RD=vD(1..toFixed),bD=function(t,e,n){return 0===e?n:e%2==1?bD(t,e-1,n*t):bD(t*t,e/2,n)},SD=function(t,e,n){for(var r=-1,i=n;++r<6;)i+=e*t[r],t[r]=i%1e7,i=_D(i/1e7)},LD=function(t,e){for(var n=6,r=0;--n>=0;)r+=t[n],t[n]=_D(r/e),r=r%e*1e7},wD=function(t){for(var e=6,n="";--e>=0;)if(""!==n||0===e||0!==t[e]){var r=TD(t[e]);n=""===n?r:n+DD("0",7-r.length)+r}return n};pD({target:"Number",proto:!0,forced:ED((function(){return"0.000"!==RD(8e-5,3)||"1"!==RD(.9,0)||"1.25"!==RD(1.255,2)||"1000000000000000128"!==RD(0xde0b6b3a7640080,0)}))||!ED((function(){RD({})}))},{toFixed:function(t){var e,n,r,i,a=yD(this),o=gD(t),s=[0,0,0,0,0,0],c="",u="0";if(o<0||o>20)throw mD("Incorrect fraction digits");if(a!=a)return"NaN";if(a<=-1e21||a>=1e21)return TD(a);if(a<0&&(c="-",a=-a),a>1e-21)if(n=(e=function(t){for(var e=0,n=t;n>=4096;)e+=12,n/=4096;for(;n>=2;)e+=1,n/=2;return e}(a*bD(2,69,1))-69)<0?a*bD(2,-e,1):a/bD(2,e,1),n*=4503599627370496,(e=52-e)>0){for(SD(s,0,n),r=o;r>=7;)SD(s,1e7,0),r-=7;for(SD(s,bD(10,r,1),0),r=e-1;r>=23;)LD(s,1<<23),r-=23;LD(s,1<<r),SD(s,1,1),LD(s,2),u=wD(s)}else SD(s,0,n),SD(s,1<<-e,0),u=wD(s)+DD("0",o);return u=o>0?c+((i=u.length)<=o?"0."+DD("0",o-i)+u:CD(u,0,i-o)+"."+CD(u,i-o)):c+u}});var kD=function(){function t(){u(this,t)}return h(t,null,[{key:"generateTaskID",value:function(){return this.currentTaskID+=1}},{key:"run",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Sg.TIMEOUT,e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;n=i(i({},t===Sg.INTERVAL?{delay:2e3,count:0,backgroundTask:!0}:t===Sg.RAF?{fps:60,delay:16.6,count:0,backgroundTask:!0}:{delay:2e3,count:0,backgroundTask:!0}),n),qm(e)&&(n=i(i({},n),e)),o(t)===Sg.FUNCTION&&(e=t,t=Sg.TIMEOUT);var r=i({taskID:this.generateTaskID(),loopCount:0,intervalID:null,timeoutID:null,rafID:null,taskName:t,callback:e},n);return this.taskMap.set(r.taskID,r),this[t](r),r.taskID}},{key:"interval",value:function(t){var e=this;return t.intervalID=setInterval((function(){t.callback(),t.loopCount+=1,e.isBreakLoop(t)}),t.delay)}},{key:"timeout",value:function(t){var e=this;return t.timeoutID=setTimeout((function n(){if(t.callback(),t.loopCount+=1,!e.isBreakLoop(t))return t.timeoutID=setTimeout(n,t.delay)}),t.delay)}},{key:"raf",value:function(t){var e=this;t.delay=(1e3/t.fps).toFixed(2);var n,r=aT(),i=function i(){if(document.hidden&&t.backgroundTask){if(n=aT()-r,r=aT(),t.callback(),t.loopCount+=1,e.isBreakLoop(t))return;return t.timeoutID=setTimeout(i,t.delay-Math.floor(n%t.delay))}if((n=aT()-r)>=t.delay&&(r=aT()-Math.floor(n%t.delay),t.callback(),t.loopCount+=1),!e.isBreakLoop(t))return t.rafID=requestAnimationFrame(i)};if(t.rafID=requestAnimationFrame(i),t.backgroundTask){var a=function(){if(document.hidden){var e=aT()-r;e>=t.delay?i():t.timeoutID=setTimeout(i,t.delay-e)}};document.addEventListener("visibilitychange",a),t.onVisibilitychange=a,document.hidden&&a()}return t.taskID}},{key:"hasTask",value:function(t){return this.taskMap.has(t)}},{key:"clearTask",value:function(t){if(!this.taskMap.has(t))return!0;var e=this.taskMap.get(t),n=e.intervalID,r=e.timeoutID,i=e.onVisibilitychange;return n&&clearInterval(n),r&&clearTimeout(r),i&&document.removeEventListener("visibilitychange",i),this.taskMap.delete(t),!0}},{key:"isBreakLoop",value:function(t){return!this.taskMap.has(t.taskID)||0!==t.count&&t.loopCount>=t.count&&(this.clearTask(t.taskID),!0)}}]),t}();d(kD,"taskMap",new Map),d(kD,"currentTaskID",1);var AD={serviceCommand:"".concat(Sg.CALLKIT_RECORDS_SVR,".*")},OD="sendTRTCCustomData",xD=function(){function t(e){u(this,t),d(this,"_callRecordData",void 0),d(this,"_tim",void 0),d(this,"_heartbeat",void 0),d(this,"_lastHeartBeatTime",void 0),this._tim=e.tim,this._heartbeat=-1,this._lastHeartBeatTime=-1,this.initializeCallData(e)}var e,n,r,o;return h(t,[{key:"getCallRecordData",value:function(){return this._callRecordData}},{key:"initializeCallData",value:function(t){var e=t||{},n=e.version,r=void 0===n?"":n,i=e.userID,a=void 0===i?"":i,o={name:Vm.platform,version:Vm.version},s={version:1,command:Sg.EVENT_REPORT,sdk_version:r,seq:0,os_name:Sg.MINI_PROGRAM,os_version:o.version||"",device_name:o.name||"",framework:Sg.MINI_PROGRAM,call_type:"",media_type:"",client_ts:0,role:vg,user_id:a,room_id:"",call_id:""};this._callRecordData={head:s,body:{event_type:"",code:0,message:"",invitee_list:[]}}}},{key:"reset",value:function(){this.initializeCallData()}},{key:"_setCallType",value:function(t){t&&(this._callRecordData.head=i(i({},this._callRecordData.head),{},{call_type:t}))}},{key:"_setMediaType",value:function(t){t&&(this._callRecordData.head=i(i({},this._callRecordData.head),{},{media_type:sD(t)}))}},{key:"_setCallRole",value:function(t){t&&(this._callRecordData.head=i(i({},this._callRecordData.head),{},{role:t}))}},{key:"_setUserID",value:function(t){t&&(this._callRecordData.head=i(i({},this._callRecordData.head),{},{user_id:t}))}},{key:"_setRoomID",value:function(t){t&&(this._callRecordData.head=i(i({},this._callRecordData.head),{},{room_id:"".concat(t)}))}},{key:"_setInviteID",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";t&&(this._callRecordData.head=i(i({},this._callRecordData.head),{},{call_id:t}))}},{key:"_setEventType",value:function(t){t&&(this._callRecordData.body=i(i({},this._callRecordData.body),{},{event_type:t}))}},{key:"_setInviteeList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this._callRecordData.body=i(i({},this._callRecordData.body),{},{invitee_list:t})}},{key:"_setSeq",value:function(){var t=this.getCallRecordData().head.seq;this._callRecordData.head=i(i({},this._callRecordData.head),{},{seq:t+1})}},{key:"eventUpload",value:(o=c(a().mark((function t(e){var n,r,o,s,c,u,l,h,d,f,p,v,g,y,I;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.eventType,o=e.callType,s=e.mediaType,c=e.callRole,u=e.userID,l=e.roomID,h=e.inviteID,d=e.inviteeList,f=void 0===d?[]:d,r){t.next=3;break}return t.abrupt("return");case 3:return this._callRecordData.head=i(i({},this._callRecordData.head),{},{command:Sg.EVENT_REPORT,client_ts:Math.floor(Date.now()/1e3)}),this._setCallType(o),this._setMediaType(s),this._setCallRole(c),this._setUserID(u),this._setRoomID(l),this._setInviteID(h),this._setEventType(r),this._setInviteeList(f),this._setSeq(),p=this.getCallRecordData(),v=p.head,g=p.body,y={head:i(i({},v),{},{role:cD(v.role)}),body:g},I=i(i({},AD),{},{data:JSON.stringify(y)}),t.next=18,null==this||null===(n=this._tim)||void 0===n?void 0:n.callExperimentalAPI(OD,I);case 18:case"end":return t.stop()}}),t,this)}))),function(t){return o.apply(this,arguments)})},{key:"eventUploadNotSave",value:(r=c(a().mark((function t(e){var n,r,o,s,c,u,l,h,d,f,p,v;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.eventType,o=e.callType,s=e.mediaType,c=e.callRole,u=e.roomID,l=e.inviteID,this._setSeq(),h=this.getCallRecordData(),d=h.head,f=h.body,p={head:i(i({},d),{},{role:cD(c),call_id:l,call_type:o,media_type:sD(s),room_id:"".concat(u),client_ts:Math.floor(Date.now()/1e3)}),body:i(i({},f),{},{event_type:r})},v=i(i({},AD),{},{data:JSON.stringify(p)}),t.next=7,null==this||null===(n=this._tim)||void 0===n?void 0:n.callExperimentalAPI(OD,v);case 7:case"end":return t.stop()}}),t,this)}))),function(t){return r.apply(this,arguments)})},{key:"heartBeatUpload",value:(n=c(a().mark((function t(){var e,n,r,o;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._setSeq(),n=this._callRecordData.head,r={head:i(i({},n),{},{role:cD(n.role),clientTs:Date.now(),command:Sg.HEART_BEAT}),body:{status:Sg.CALLING}},o=i(i({},AD),{},{data:r}),t.next=6,null==this||null===(e=this._tim)||void 0===e?void 0:e.callExperimentalAPI(OD,o);case 6:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"startHeartbeat",value:function(){-1===this._heartbeat&&(uT.info("start heart beat..."),this._heartbeat=kD.run(Sg.TIMEOUT,this.doHeartbeat.bind(this),{delay:2e3,count:0,backgroundTask:!0}))}},{key:"stopHeartbeat",value:function(){-1!==this._heartbeat&&(uT.info("stop heart beat"),kD.clearTask(this._heartbeat),this._heartbeat=-1,this._lastHeartBeatTime=-1)}},{key:"doHeartbeat",value:(e=c(a().mark((function t(){var e;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.heartBeatUpload(),e=Date.now(),this._lastHeartBeatTime>0&&e-this._lastHeartBeatTime>1e4&&uT.warn("heartbeat took ".concat(e-this._lastHeartBeatTime)),this._lastHeartBeatTime=e;case 4:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})}]),t}(),ND=function(){function t(e,n){u(this,t),d(this,"_eventEmitter",void 0),d(this,"_callRecordDataReport",void 0),d(this,"_isCallAccepted",void 0),this._eventEmitter=e,this._callRecordDataReport=n,this._isCallAccepted=!1,this.registerListener()}return h(t,[{key:"registerListener",value:function(){this._eventEmitter.on(og.USER_ACCEPT,this.onCallAccepted.bind(this)),this._eventEmitter.on(og.CALL_END,this.onCallEnd.bind(this)),this._eventEmitter.on(og.CALLING_CANCEL,this.onCallingCancel.bind(this)),this._eventEmitter.on(og.NO_RESP,this.onNoResponse.bind(this)),this._eventEmitter.on(og.LINE_BUSY,this.onLineBusy.bind(this)),this._eventEmitter.on(og.REJECT,this.onReject.bind(this))}},{key:"removeLister",value:function(){this._eventEmitter.off(og.USER_ACCEPT,this.onCallAccepted),this._eventEmitter.off(og.CALL_END,this.onCallEnd),this._eventEmitter.off(og.CALLING_CANCEL,this.onCallingCancel),this._eventEmitter.off(og.NO_RESP,this.onNoResponse),this._eventEmitter.off(og.LINE_BUSY,this.onLineBusy),this._eventEmitter.off(og.REJECT,this.onReject)}},{key:"onCallAccepted",value:function(){var t=this._callRecordDataReport.getCallRecordData().head;if((null==t?void 0:t.role)===Sg.INVITER){if(this._isCallAccepted&&t.call_type===Sg.GROUP)return;this._isCallAccepted=!0;var e={eventType:Sg.CALL_ACCEPTED};this._callRecordDataReport.eventUpload(e),this._callRecordDataReport.startHeartbeat()}}},{key:"onCallEnd",value:function(){var t={eventType:Sg.CALL_END};this._isCallAccepted=!1,this._callRecordDataReport.eventUpload(t)}},{key:"onCallingCancel",value:function(t){var e=this._callRecordDataReport.getCallRecordData().head,n=e.role===Sg.INVITER?Sg.CANCEL_CALL:Sg.CALL_CANCELED;this._isCallAccepted=!1;var r=(t.data||{}).reason;((void 0===r?"":r)===Sg.NORMAL||e.role===Sg.INVITER&&e.call_type===Sg.GROUP)&&this._callRecordDataReport.eventUpload({eventType:n})}},{key:"onNoResponse",value:function(){this._uploadInC2C(Sg.TIMEOUT)}},{key:"onLineBusy",value:function(){this._uploadInC2C(Sg.BUSYLINE)}},{key:"onReject",value:function(){this._uploadInC2C(Sg.REJECT)}},{key:"_uploadInC2C",value:function(t){var e=this._callRecordDataReport.getCallRecordData().head;if((null==e?void 0:e.call_type)===Sg.SINGLE){var n="";switch(t){case Sg.TIMEOUT:n=e.role===Sg.INVITER?Sg.CALL_MISSED:Sg.NOT_ANSWER_CALL;break;case Sg.REJECT:n=e.role===Sg.INVITER&&Sg.CALL_REJECTED;break;case Sg.BUSYLINE:n=e.role===Sg.INVITER?Sg.CALL_BUSY:Sg.NOT_ANSWER_CALL;break;default:return}this._callRecordDataReport.eventUpload({eventType:n})}}}]),t}(),UD="TUICallEngine",MD=function(){function r(i){u(this,r),d(this,"_initReady",!1),d(this,"_timExternal",!1),d(this,"_initialCallId",""),this.data={config:{sdkAppID:i.sdkAppID,userID:"",userSig:"",type:1}},this.initData(),this.EVENT=og,this.MEDIA_TYPE=pg,this.CALL_TYPE=pg,this._emitter=new ag,this.TRTC=new e(this,{TUIScene:"TUICallKit"});var a="TUICallKit";try{(wx&&wx._isTIMCallKit||wx&&wx.getStorageSync&&wx.getStorageSync("_isTIMCallKit")||getApp&&getApp()&&getApp().globalData&&getApp().globalData._isTIMCallKit)&&(a="TIMCallKit")}catch(t){console.error(t)}wx.TUIScene=a,this._callDataReport=new uD({version:Ey,sdkAppId:i.sdkAppID}),this._dataReportObserver=new lD({emitter:this._emitter},this._callDataReport),i.tim?(this.tim=i.tim,this._timExternal=!0):wx.$TIM?(this.tim=wx.$TIM,this._timExternal=!0):this.tim=n.create({SDKAppID:i.sdkAppID}),this._callRecordReport=new xD({version:Ey,tim:this.tim}),this._recordReportObserver=new ND(this._emitter,this._callRecordReport),wx.$TSignaling||(wx.$TSignaling=new t({SDKAppID:i.sdkAppID,tim:this.tim,isRejectNotifyAll:!0})),wx.getSystemInfoSync().platform===Sg.DEVTOOLS&&uT.warn("".concat(wg)),wx.setStorageSync("sdkAppId",i.sdkAppID),this.TSignalingClient=new yy({TSignaling:wx.$TSignaling}),this.TRTCCallingDelegate=new Iy({emitter:this._emitter}),this._eventStatController=new ET;var o=new lT(hT);lT.bindController(this._eventStatController),o.setText("version=".concat(Ey)).setEnd(),uT.info("".concat(UD," SDK Version:").concat(Ey,", SDKAppID:").concat(i.sdkAppID))}var o,s,l,f,p,v,g,y,I,E,m,T,D,C,R,b,S,L,w,k,A,O,x,N,U,M,P,V,j,G,H,B,F,K,z,J,$;return h(r,[{key:"destroyInstance",value:function(){if(null!==r.instance&&(q_.getInstance().getAlert().checkSync(new H_({api:"destroyInstance",initReady:r.instance._initReady})),null!==r.instance)){this._callDataReport&&this._callDataReport.reset&&this._callDataReport.reset(),this._dataReportObserver&&this._dataReportObserver.reset&&this._dataReportObserver.removeLister(),this._callRecordReport&&this._callRecordReport.reset(),this._recordReportObserver&&this._recordReportObserver.removeLister(),r.instance.destroyed(),r.instance=null;try{wx.removeStorageSync("sdkAppId"),wx.removeStorageSync("userId")}catch(t){console.error(t)}}}},{key:"setLogLevel",value:function(t){"number"!=typeof t||isNaN(t)?uT.error("".concat(UD,",setLogLevel parameter must be a number(0~4)")):(uT.setLevel(t),this.TSignalingClient.setLogLevel(t),this.TRTC.setLogLevel(t))}},{key:"initData",value:function(){var t={callStatus:sg.IDLE,soundMode:this.data.config.type===pg.AUDIO?Cg.EAR:Cg.SPEAKER,active:!1,invitation:{inviteID:"",inviter:"",type:"",roomID:""},startTalkTime:0,localUser:null,remoteUsers:[],remoteID:"",timer:null,chatTimeNum:0,chatTime:"00:00:00",screen:"pusher",pusher:{},playerList:[],isInviter:!0,unHandledInviteeList:[],handledInviteeList:[],_inviterInviteID:{},_audioVideoSwitchIdList:[],_acceptedUserObject:{},isGroupCall:!1,groupID:"",switchCallModeStatus:!0,enterRoomStatus:!1,devicePermission:!1};this.data=i(i({},this.data),t)}},{key:"handleNewInvitationReceived",value:($=c(a().mark((function t(e){var n,r,i,o,s,c,u,l,h,d,f,p,v;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=this.getCallStatus(),uT.log("".concat(UD,".onNewInvitationReceived - params:"),e,"currentCallStatus:".concat(i)),o=e.data,s=o.inviter,c=o.inviteeList,u=o.data,l=o.inviteID,h=o.groupID,iT((d=JSON.parse(u)).businessID)){t.next=6;break}return t.abrupt("return");case 6:if(f=(null==d||null===(n=d.data)||void 0===n?void 0:n.initialCallId)||"",this.getUserID()!==s){t.next=9;break}return t.abrupt("return");case 9:if(v={inviter:s,inviteeList:c,inviteID:l,isGroupCall:p=!!h,inviteData:d,groupID:h,initialCallId:f,currentCallStatus:i,inCallUserIDs:(null==d?void 0:d.inCallUserIDs)||[]},"hangup"!==(null==d||null===(r=d.data)||void 0===r?void 0:r.cmd)){t.next=18;break}if(uT.log("".concat(UD,".hangup - params:"),s,d,this.getHandledInviteeList(),this.getUnHandledInviteeList(),i,p),i!==sg.IDLE){t.next=15;break}return t.abrupt("return");case 15:return t.next=17,this.handleHangupSignal(v);case 17:return t.abrupt("return");case 18:if(p||!this.judgeSwitchCallMode(d)){t.next=24;break}if(i===sg.IDLE||d.room_id!==this.data.invitation.roomID){t.next=23;break}return t.next=22,this.handleSwitchCallModeTSignaling(l,d);case 22:this.addAudioVideoSwitchIdList(l);case 23:return t.abrupt("return");case 24:if(i===sg.IDLE){t.next=29;break}return t.next=27,this.TSignalingClient.reject({inviteID:l,type:u.call_type,lineBusy:"line_busy"});case 27:return this.getCallRecordReport().eventUploadNotSave({inviteID:f||l,callRole:Sg.INVITEE,eventType:Sg.IGNORE_CALL,roomID:d.room_id,mediaType:d.call_type,callType:h?Sg.GROUP:Sg.SINGLE}),t.abrupt("return");case 29:this.handleInvitedSignal(v);case 30:case"end":return t.stop()}}),t,this)}))),function(t){return $.apply(this,arguments)})},{key:"handleHangupSignal",value:(J=c(a().mark((function t(e){var n,r,o,s,c,u,l,h,d,f,p,v,g;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.inviter,r=e.currentCallStatus,o=e.inviteData,s=e.inviteeList,c=this.isGroupCall(),u=this.isInviter(),r!==sg.CALLING){t.next=11;break}if(l=this.getUnHandledInviteeList(),h=this.getHandledInviteeList(),-1!==l.indexOf(n)&&this.deleteUnHandledInviteeList([n]),-1!==h.indexOf(n)){t.next=9;break}return t.abrupt("return");case 9:t.next=15;break;case 11:if(this.deleteHandledInviteeList([n]),!(-1===(d=this.getHandledInviteeList()).indexOf(n)&&d.length>1)){t.next=15;break}return t.abrupt("return");case 15:if(f=this.generateCallEndData({totalTime:o.call_end||0}),c){t.next=22;break}return this.TRTCCallingDelegate.onCallEnd(f),t.next=20,this._resetTUICallEngine();case 20:case 31:t.next=46;break;case 22:if(this.deleteHandledInviteeList([n]),this.data.playerList=this.data.playerList.filter((function(t){return t.userID!==n})),p=this.getHandledInviteeList(),v=this.getUnHandledInviteeList(),!u){t.next=33;break}if(1!==p.length||0!==v.length){t.next=31;break}return this.TRTCCallingDelegate.onCallEnd(f),t.next=31,this._resetTUICallEngine();case 33:if(r!==sg.CALLING){t.next=41;break}if(-1!==s.indexOf(this.getUserID())&&this.TRTCCallingDelegate.onUserLeave({userID:n,playerList:this.data.playerList}),0!==p.length||1!==v.length){t.next=41;break}return g=this.generateEventData(),this.TRTCCallingDelegate.onCancel(i(i({inviteID:this.data.invitation.inviteID,invitee:this.getUserID(),userID:this.getUserID()},g),{},{reason:Sg.NORMAL})),t.next=41,this._resetTUICallEngine();case 41:if(r!==sg.CONNECTED){t.next=46;break}if(1!==p.length||0!==v.length){t.next=46;break}return this.TRTCCallingDelegate.onCallEnd(f),t.next=46,this._resetTUICallEngine();case 46:case"end":return t.stop()}}),t,this)}))),function(t){return J.apply(this,arguments)})},{key:"handleSwitchCallModeTSignaling",value:(z=c(a().mark((function t(e,n){var r,i,o;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r={inviteID:e,type:n.call_type},i={cmd:"switchToVideo"},n.call_type===pg.VIDEO&&(r.switch_to_audio_call="switch_to_audio_call",i.cmd="switchToAudio"),t.next=5,this.TSignalingClient.accept(r,i);case 5:o=t.sent,this.setSwitchCallModeStatus(!1),this.handleCallMode(n.call_type,o);case 8:case"end":return t.stop()}}),t,this)}))),function(t,e){return z.apply(this,arguments)})},{key:"judgeSwitchCallMode",value:function(t){return t.switch_to_audio_call&&"switch_to_audio_call"===t.switch_to_audio_call||t.data&&"switchToAudio"===t.data.cmd||t.data&&"switchToVideo"===t.data.cmd}},{key:"handleCallMode",value:function(t,e){uT.log("".concat(UD,".handleCallMode - type"),t);var n=t!==pg.VIDEO;this.setPusherAttributesHandler({enableCamera:n}),n?(this.data.config.type=pg.VIDEO,this.data.invitation.type=pg.VIDEO):(this.data.config.type=pg.AUDIO,this.data.invitation.type=pg.AUDIO),this.TRTCCallingDelegate.onCallMode({type:this.data.config.type,message:e.data.message}),this.setSwitchCallModeStatus(!0)}},{key:"handleInvitedSignal",value:(K=c(a().mark((function t(e){var n,r,o,s,c,u,l,h,d,f,p,v,g,y,I;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.inviter,r=e.inviteeList,o=e.isGroupCall,s=e.groupID,c=e.inviteID,u=e.inviteData,l=e.inCallUserIDs,h=void 0===l?[]:l,d=e.initialCallId,f=void 0===d?"":d,this.data.remoteID=n,this.data.config.type=u.call_type,this.data.invitation.inviteID=c,this.data.invitation.inviter=n,this.data.invitation.type=u.call_type,this.data.invitation.roomID=u.room_id,this.data.isInviter=!1,this.data.isGroupCall=o,this.data.roomID=u.room_id,this.addHandledInviteeList([n]),this.addUnHandledInviteeList([].concat(_(r),_(h))),this.addAcceptedUserList(c,[n]),this.addInviterInviteId(c,[n].concat(_(r))),this.setInitialCallId(f),p=h.filter((function(t){return-1===r.indexOf(t)})),o&&(this.data.groupID=s),this.changeCallStatus(sg.CALLING),uT.log("".concat(UD," NEW_INVITATION_RECEIVED invitation: "),this.data.callStatus,this.data.invitation),v={sponsor:n,inviteeList:r,userIDList:[].concat(_(r),_(p)),isFromGroup:o,inviteID:c,groupID:s,inviteData:{version:u.version,callType:u.call_type,roomID:u.room_id},userData:u.extInfo,calleeIdList:r,callMediaType:u.call_type},this.setPusherAttributesHandler({enableCamera:this.data.config.type===pg.VIDEO}),g=i(i({},g=this.getCallDataReport().getCallData()),{},{userId:this.getUserID(),roomID:u.room_id,inviteID:c,callRole:yg,callType:u.call_type,inviteeList:r}),y={eventType:Sg.RECEIVE_CALL,callType:s?Sg.GROUP:Sg.SINGLE,mediaType:u.call_type,callRole:Sg.INVITEE,userID:this.getUserID(),roomID:u.room_id,inviteID:f||c},this.getCallRecordReport().eventUpload(y),this.getCallDataReport().setCallData(g),I=this.generateEventData()||{},this.TRTCCallingDelegate.onInvited(i(i({},I),v)),t.next=30,nT({camera:!0});case 30:this.data.devicePermission=t.sent,this.data.devicePermission&&this.data.config.type===pg.VIDEO&&wx.createLivePusherContext().startPreview();case 32:case"end":return t.stop()}}),t,this)}))),function(t){return K.apply(this,arguments)})},{key:"addInviterInviteId",value:function(t,e){0!==e.length&&(0===(this.data._inviterInviteID[t]||[]).length?this.data._inviterInviteID[t]=e:this.data._inviterInviteID[t]=[].concat(_(this.data._inviterInviteID[t]),_(e)))}},{key:"handleInviteeAccepted",value:(F=c(a().mark((function t(e){var n,r,o,s,c,u;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(uT.log("".concat(UD," onInviteeAccepted - params:"),e),iT(null==(n=JSON.parse(e.data.data))?void 0:n.businessID)){t.next=4;break}return t.abrupt("return");case 4:if(r=e.data.invitee,o=e.data.inviteID,-1!==this.getTotalInviterInviteIdList().indexOf(o)){t.next=8;break}return t.abrupt("return");case 8:if(this.data.callStatus!==sg.IDLE){t.next=10;break}return t.abrupt("return");case 10:if(this.isGroupCall()||!this.judgeSwitchCallMode(n)||this.data.switchCallModeStatus){t.next=13;break}return this.handleCallMode(this.data.invitation.type),t.abrupt("return");case 13:if(s=this.getCallStatus(),r!==this.getUserID()||s!==sg.CALLING){t.next=20;break}return c=this.generateEventData(),this.TRTCCallingDelegate.onCancel(i({inviteID:this.data.invitation.inviteID,invitee:r,userID:r},c)),t.next=19,this._resetTUICallEngine();case 19:return t.abrupt("return");case 20:return this.isInviter()&&this.data.callStatus===sg.CALLING&&this.changeCallStatus(sg.CONNECTED),this.getCallDataReport().setCallAcceptTime((new Date).getTime()),this.addHandledInviteeList([r]),this.deleteUnHandledInviteeList([r]),this.addAcceptedUserList(o,[r]),t.next=27,this.getUserProfile(this.data.unHandledInviteeList.map((function(t){return{userID:t}})));case 27:u=t.sent,this.TRTCCallingDelegate.onUserAccept({userID:r,userList:u});case 29:case"end":return t.stop()}}),t,this)}))),function(t){return F.apply(this,arguments)})},{key:"handleInviteeRejected",value:(B=c(a().mark((function t(e){var n,r,o,s,c,u,l,h,d,f,p,v,g,y,I,E;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(uT.log("".concat(UD," onInviteeRejected - params"),e),r=e.data.inviteID,iT(null==(o=JSON.parse(e.data.data))?void 0:o.businessID)){t.next=5;break}return t.abrupt("return");case 5:if(this.isGroupCall()||this.getSwitchCallModeStatus()||-1===this.getAudioVideoSwitchIdList().indexOf(r)){t.next=9;break}return uT.log("".concat(UD,".onInviteeRejected - Audio and video switching is not available")),this.setSwitchCallModeStatus(!0),t.abrupt("return");case 9:if(s=e.data.invitee,c=e.data.inviter,u=this.getUserID(),l=this.getCallStatus(),-1!==this.getInviterInviteIdList().indexOf(r)){t.next=16;break}return this.deleteUnHandledInviteeList([s]),t.abrupt("return");case 16:if(l!==sg.IDLE){t.next=18;break}return t.abrupt("return");case 18:if(h=this.generateEventData(),u!==s||l!==sg.CALLING){t.next=24;break}return this.TRTCCallingDelegate.onCancel(i({inviteID:this.data.invitation.inviteID,invitee:s,userID:s},h)),t.next=23,this._resetTUICallEngine();case 23:return t.abrupt("return");case 24:if(d=this.isGroupCall(),f=this.isInviter(),this.deleteUnHandledInviteeList([s]),p=this.getUnHandledInviteeList(),v=this.getHandledInviteeList(),g=i({inviteID:this.data.invitation.inviteID,invitee:u,userID:u},h),y={inviteID:this.data.invitation.inviteID,invitee:s,userID:s},I=this.data.invitation,l!==sg.CONNECTED){t.next=35;break}if(-1===v.indexOf(s)){t.next=35;break}return t.abrupt("return");case 35:if(!("line_busy"===o.line_busy||""===o.line_busy||null!=o&&null!==(n=o.data)&&void 0!==n&&n.message&&"lineBusy"===o.data.message)){t.next=49;break}if(c===I.inviter&&this.TRTCCallingDelegate.onLineBusy({inviteID:this.data.invitation.inviteID,invitee:s,userID:s}),d){t.next=43;break}return this.TRTCCallingDelegate.onCancel(i(i({},g),{},{reason:Sg.BUSYLINE})),t.next=41,this._resetTUICallEngine();case 41:t.next=47;break;case 43:if(0!==p.length||1!==v.length){t.next=47;break}return this.TRTCCallingDelegate.onCancel(i(i({},g),{},{reason:Sg.BUSYLINE})),t.next=47,this._resetTUICallEngine();case 47:case 54:t.next=75;break;case 49:if(d){t.next=56;break}return this.TRTCCallingDelegate.onReject(y),this.TRTCCallingDelegate.onCancel(i(i({},g),{},{reason:Sg.REJECT})),t.next=54,this._resetTUICallEngine();case 56:if(this.TRTCCallingDelegate.onReject(y),l!==sg.CALLING){t.next=69;break}if(!f){t.next=65;break}if(0!==p.length||1!==v.length){t.next=63;break}return this.TRTCCallingDelegate.onCancel(i(i({},g),{},{reason:Sg.REJECT})),t.next=63,this._resetTUICallEngine();case 63:t.next=69;break;case 65:if(1!==p.length||0!==v.length){t.next=69;break}return this.TRTCCallingDelegate.onCancel(i(i({},g),{},{reason:Sg.REJECT})),t.next=69,this._resetTUICallEngine();case 69:if(l!==sg.CONNECTED){t.next=75;break}if(0!==p.length||1!==v.length){t.next=75;break}return E=this.generateCallEndData(),this.TRTCCallingDelegate.onCallEnd(E),t.next=75,this._resetTUICallEngine();case 75:case"end":return t.stop()}}),t,this)}))),function(t){return B.apply(this,arguments)})},{key:"handleInvitationCancelled",value:(H=c(a().mark((function t(e){var n,r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.data.invitation.inviteID===e.data.inviteID){t.next=2;break}return t.abrupt("return");case 2:if(iT(null==(n=JSON.parse(e.data.data))?void 0:n.businessID)){t.next=5;break}return t.abrupt("return");case 5:if(this.data.callStatus!==sg.IDLE){t.next=7;break}return t.abrupt("return");case 7:if(-1!==this.getInviterInviteIdList().indexOf(e.data.inviteID)){t.next=9;break}return t.abrupt("return");case 9:return uT.log(UD,"onInvitationCancelled","inviteID:".concat(e.data.inviteID," inviter:").concat(e.data.inviter," data:").concat(e.data.data)),r=this.generateEventData(),this.TRTCCallingDelegate.onCancel(i(i({inviteID:this.data.invitation.inviteID,invitee:e.data.inviter,userID:e.data.inviter},r),{},{reason:Sg.NORMAL})),t.next=14,this._resetTUICallEngine();case 14:case"end":return t.stop()}}),t,this)}))),function(t){return H.apply(this,arguments)})},{key:"handleInvitationTimeout",value:(G=c(a().mark((function t(e){var n,r,o,s,c,u,l,h,d,f,p,v,g,y,I,E,m,T;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.data,o=r.inviter,s=r.inviteeList,c=void 0===s?[]:s,u=r.inviteID,l=this.getUserID(),h=this.isGroupCall(),d=this.isInviter(),f=this.getCallStatus(),this.deleteUnHandledInviteeList(c),uT.warn("".concat(UD,".onInvitationTimeout - params:"),e,"currentUserID:".concat(l," isInviter:").concat(d," isGroupCall:").concat(h," \n      currentCallStatus:").concat(f," inviteID:").concat(null==this||null===(n=this._newInvitationData)||void 0===n?void 0:n.inviteID)),-1!==this.getInviterInviteIdList().indexOf(u)){t.next=9;break}return t.abrupt("return");case 9:if(f!==sg.IDLE){t.next=11;break}return t.abrupt("return");case 11:if(p=this.getHandledInviteeList(),v=this.getUnHandledInviteeList(),g={groupID:this.data.groupID,inviteID:this.data.invitation.inviteID,sponsor:o,timeoutUserList:c,userIDList:c},y=this.generateEventData(),I=i(i({inviteID:this.data.invitation.inviteID,invitee:l,userID:l},y),{},{reason:Sg.TIMEOUT}),h){t.next=22;break}return d?(this.TRTCCallingDelegate.onNoResp(g),this.TRTCCallingDelegate.onCancel(I)):(this.TRTCCallingDelegate.onCancel(I),E=this.getCallRecordReport().getCallRecordData().head,this.getCallRecordReport().eventUpload(i(i({},E),{},{eventType:Sg.NOT_ANSWER_CALL,inviteID:this.getInitialCallId()}))),t.next=20,this._resetTUICallEngine();case 20:t.next=47;break;case 22:if(f!==sg.CALLING){t.next=40;break}if(!d){t.next=31;break}if(this.TRTCCallingDelegate.onNoResp(g),0!==v.length){t.next=29;break}return this.TRTCCallingDelegate.onCancel(I),t.next=29,this._resetTUICallEngine();case 29:t.next=40;break;case 31:if(-1!==c.indexOf(l)){t.next=35;break}this.TRTCCallingDelegate.onNoResp(g),t.next=38;break;case 35:return this.TRTCCallingDelegate.onCancel(I),t.next=38,this._resetTUICallEngine();case 38:m=this.getCallRecordReport().getCallRecordData().head,this.getCallRecordReport().eventUpload(i(i({},m),{},{eventType:Sg.NOT_ANSWER_CALL,inviteID:this.getInitialCallId()}));case 40:if(f!==sg.CONNECTED){t.next=47;break}if(this.TRTCCallingDelegate.onNoResp(g),1!==p.length||0!==v.length){t.next=47;break}return T=this.generateCallEndData(),this.TRTCCallingDelegate.onCallEnd(T),t.next=47,this._resetTUICallEngine();case 47:case"end":return t.stop()}}),t,this)}))),function(t){return G.apply(this,arguments)})},{key:"handleSDKReady",value:function(){var t=this;uT.log(UD,"TSignaling SDK ready"),this.TSignalingResolve(),this.TRTCCallingDelegate.onSdkReady({message:"SDK ready"}),this.tim.getMyProfile().then((function(e){t.data.localUser=e.data})).catch((function(t){uT.warn("getMyProfile error:",t)}))}},{key:"handleKickedOut",value:(j=c(a().mark((function t(){var e,n,r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.getCallStatus()!==sg.CONNECTED){t.next=5;break}return e=this.generateCallEndData(),this.TRTCCallingDelegate.onCallEnd(e),t.next=5,this._resetTUICallEngine();case 5:if(this.getCallStatus()!==sg.CALLING){t.next=13;break}return n=this.getUserID(),r=this.generateEventData(),this.TRTCCallingDelegate.onCancel(i(i({inviteID:this.data.invitation.inviteID,invitee:n,userID:n},r),{},{reason:Sg.BANNED})),t.next=11,this.cancel();case 11:return t.next=13,this._resetTUICallEngine();case 13:this._initReady=!1,this.TRTCCallingDelegate.onKickedOut({message:"kicked out"});case 15:case"end":return t.stop()}}),t,this)}))),function(){return j.apply(this,arguments)})},{key:"_addTSignalingEvent",value:function(){wx.$TSignaling.on(t.EVENT.NEW_INVITATION_RECEIVED,this.handleNewInvitationReceived,this),wx.$TSignaling.on(t.EVENT.INVITEE_ACCEPTED,this.handleInviteeAccepted,this),wx.$TSignaling.on(t.EVENT.INVITEE_REJECTED,this.handleInviteeRejected,this),wx.$TSignaling.on(t.EVENT.INVITATION_CANCELLED,this.handleInvitationCancelled,this),wx.$TSignaling.on(t.EVENT.INVITATION_TIMEOUT,this.handleInvitationTimeout,this),wx.$TSignaling.on(t.EVENT.SDK_READY,this.handleSDKReady,this),wx.$TSignaling.on(t.EVENT.KICKED_OUT,this.handleKickedOut,this),t.EVENT.MESSAGE_SENT_BY_ME&&wx.$TSignaling.on(t.EVENT.MESSAGE_SENT_BY_ME,this.onMessageSentByMe,this)}},{key:"_removeTSignalingEvent",value:function(){wx.$TSignaling.off(t.EVENT.NEW_INVITATION_RECEIVED,this.handleNewInvitationReceived),wx.$TSignaling.off(t.EVENT.INVITEE_ACCEPTED,this.handleInviteeAccepted),wx.$TSignaling.off(t.EVENT.INVITEE_REJECTED,this.handleInviteeRejected),wx.$TSignaling.off(t.EVENT.INVITATION_CANCELLED,this.handleInvitationCancelled),wx.$TSignaling.off(t.EVENT.INVITATION_TIMEOUT,this.handleInvitationTimeout),wx.$TSignaling.off(t.EVENT.SDK_READY,this.handleSDKReady),wx.$TSignaling.off(t.EVENT.KICKED_OUT,this.handleKickedOut),t.EVENT.MESSAGE_SENT_BY_ME&&wx.$TSignaling.off(t.EVENT.MESSAGE_SENT_BY_ME,this.onMessageSentByMe,this)}},{key:"onLocalJoin",value:function(){var t=this.generateEventData();this.TRTCCallingDelegate.onCallBegin(t)}},{key:"onRemoteUserJoin",value:(V=c(a().mark((function t(e){var n,r,i,o;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.data,r=n.userID,i=n.userList,o=n.playerList,uT.log(UD,"REMOTE_USER_JOIN",e,r),this.addHandledInviteeList([r]),this.deleteUnHandledInviteeList([r]),this.changeCallStatus(sg.CONNECTED),!(o.length>0)){t.next=11;break}return t.next=8,this.getUserProfile(o);case 8:t.t0=t.sent,t.next=12;break;case 11:t.t0=this.data.playerList;case 12:this.data.playerList=t.t0,this.data.startTalkTime||(this.data.startTalkTime=Date.now()),this.TRTCCallingDelegate.onUserEnter({userID:e.data.userID,playerList:this.data.playerList}),uT.log(UD,"REMOTE_USER_JOIN","playerList:",this.data.playerList,"userList:",i);case 16:case"end":return t.stop()}}),t,this)}))),function(t){return V.apply(this,arguments)})},{key:"onRemoteUserLeave",value:(P=c(a().mark((function t(e){var n,r,i,o,s,c;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.getCallStatus()!==sg.IDLE){t.next=2;break}return t.abrupt("return");case 2:if(n=e.data.userID,uT.log(UD,"REMOTE_USER_LEAVE",e,e.data.userID),this.deleteHandledInviteeList([n]),this.data.playerList=this.data.playerList.filter((function(t){return t.userID!==n})),this.TRTCCallingDelegate.onUserLeave({userID:n,playerList:this.data.playerList}),this.getCallDataReport().setExitRoomTime((new Date).getTime()),this.data.isGroupCall){t.next=17;break}return t.next=11,this.TSignalingClient.hangup({userIDList:[n],callType:this.data.config.type,callEnd:Math.round((Date.now()-this.data.startTalkTime)/1e3)});case 11:return r=this.generateCallEndData(),this.TRTCCallingDelegate.onCallEnd(r),uT.log(UD,"REMOTE_USER_LEAVE","playerList:"),t.next=16,this._resetTUICallEngine();case 16:return t.abrupt("return");case 17:if(i=this.getHandledInviteeList(),o=this.getUnHandledInviteeList(),s=this.getUserID(),1!==i.length||i[0]!==s||0!==o.length){t.next=25;break}return c=this.generateCallEndData(),this.TRTCCallingDelegate.onCallEnd(c),t.next=25,this._resetTUICallEngine();case 25:case"end":return t.stop()}}),t,this)}))),function(t){return P.apply(this,arguments)})},{key:"onLocalNetStateUpdate",value:function(t){var e=t.data.pusher.netStatus;uT.log(UD,"onLocalNetStateUpdate",e),this.data.pusher=t.data.pusher,this.TRTCCallingDelegate.onUserUpdate({pusher:this.data.pusher,playerList:this.data.playerList})}},{key:"onRemoteNetStateUpdate",value:(M=c(a().mark((function t(e){var n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.data.playerList,uT.log(UD,"onRemoteNetStateUpdate",n),this.data.playerList=this._updateUserProfile(this.data.playerList,n),this.TRTCCallingDelegate.onUserUpdate({pusher:this.data.pusher,playerList:this.data.playerList});case 4:case"end":return t.stop()}}),t,this)}))),function(t){return M.apply(this,arguments)})},{key:"onError",value:function(t){uT.warn(UD,"onError",t),this.TRTCCallingDelegate.onError(t)}},{key:"onRemoteVideoAdd",value:function(t){uT.log("* room REMOTE_VIDEO_ADD",t);var e=t.data.player;this.setPlayerAttributesHandler(e,{muteVideo:!1})}},{key:"onRemoteVideoRemove",value:function(t){uT.log("* room REMOTE_VIDEO_REMOVE",t);var e=t.data.player;this.setPlayerAttributesHandler(e,{muteVideo:!0})}},{key:"onRemoteAudioAdd",value:(U=c(a().mark((function t(e){var n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return uT.log("* room REMOTE_AUDIO_ADD",e),t.next=3,this.getUserProfile([e.data.player]);case 3:n=t.sent,this.setPlayerAttributesHandler(n[0],{muteAudio:!1});case 5:case"end":return t.stop()}}),t,this)}))),function(t){return U.apply(this,arguments)})},{key:"onRemoteAudioRemove",value:function(t){uT.log("* room REMOTE_AUDIO_REMOVE",t);var e=t.data.player;this.setPlayerAttributesHandler(e,{muteAudio:!0})}},{key:"onRemoteAudioVolumeUpdate",value:(N=c(a().mark((function t(e){var n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:uT.log("* room REMOTE_AUDIO_VOLUME_UPDATE",e),n=e.data.playerList,this.data.playerList=this._updateUserProfile(this.data.playerList,n),this.TRTCCallingDelegate.onUserUpdate({pusher:this.data.pusher,playerList:this.data.playerList});case 4:case"end":return t.stop()}}),t,this)}))),function(t){return N.apply(this,arguments)})},{key:"onLocalAudioVolumeUpdate",value:function(t){var e=t.data.pusher;this.data.pusher=e,this.TRTCCallingDelegate.onUserUpdate({pusher:this.data.pusher,playerList:this.data.playerList})}},{key:"onMessageSentByMe",value:function(t){this.TRTCCallingDelegate.onMessageSentByMe(t)}},{key:"_addTRTCEvent",value:function(){this.TRTC.on(this.TRTC.EVENT.LOCAL_JOIN,this.onLocalJoin,this),this.TRTC.on(this.TRTC.EVENT.REMOTE_USER_JOIN,this.onRemoteUserJoin,this),this.TRTC.on(this.TRTC.EVENT.REMOTE_USER_LEAVE,this.onRemoteUserLeave,this),this.TRTC.on(this.TRTC.EVENT.LOCAL_NET_STATE_UPDATE,this.onLocalNetStateUpdate,this),this.TRTC.on(this.TRTC.EVENT.REMOTE_NET_STATE_UPDATE,this.onRemoteNetStateUpdate,this),this.TRTC.on(this.TRTC.EVENT.ERROR,this.onError,this),this.TRTC.on(this.TRTC.EVENT.REMOTE_VIDEO_ADD,this.onRemoteVideoAdd,this),this.TRTC.on(this.TRTC.EVENT.REMOTE_VIDEO_REMOVE,this.onRemoteVideoRemove,this),this.TRTC.on(this.TRTC.EVENT.REMOTE_AUDIO_ADD,this.onRemoteAudioAdd,this),this.TRTC.on(this.TRTC.EVENT.REMOTE_AUDIO_REMOVE,this.onRemoteAudioRemove,this),this.TRTC.on(this.TRTC.EVENT.REMOTE_AUDIO_VOLUME_UPDATE,this.onRemoteAudioVolumeUpdate,this),this.TRTC.on(this.TRTC.EVENT.LOCAL_AUDIO_VOLUME_UPDATE,this.onLocalAudioVolumeUpdate,this)}},{key:"_removeTRTCEvent",value:function(){this.TRTC.off(this.TRTC.EVENT.LOCAL_JOIN,this.onLocalJoin),this.TRTC.off(this.TRTC.EVENT.REMOTE_USER_JOIN,this.onRemoteUserJoin),this.TRTC.off(this.TRTC.EVENT.REMOTE_USER_LEAVE,this.onRemoteUserLeave),this.TRTC.off(this.TRTC.EVENT.LOCAL_NET_STATE_UPDATE,this.onLocalNetStateUpdate),this.TRTC.off(this.TRTC.EVENT.REMOTE_NET_STATE_UPDATE,this.onRemoteNetStateUpdate),this.TRTC.off(this.TRTC.EVENT.ERROR,this.onError),this.TRTC.off(this.TRTC.EVENT.REMOTE_VIDEO_ADD,this.onRemoteVideoAdd),this.TRTC.off(this.TRTC.EVENT.REMOTE_VIDEO_REMOVE,this.onRemoteVideoRemove),this.TRTC.off(this.TRTC.EVENT.REMOTE_AUDIO_ADD,this.onRemoteAudioAdd),this.TRTC.off(this.TRTC.EVENT.REMOTE_AUDIO_REMOVE,this.onRemoteAudioRemove),this.TRTC.off(this.TRTC.EVENT.REMOTE_AUDIO_VOLUME_UPDATE,this.onRemoteAudioVolumeUpdate),this.TRTC.off(this.TRTC.EVENT.LOCAL_AUDIO_VOLUME_UPDATE,this.onLocalAudioVolumeUpdate)}},{key:"initTRTC",value:function(){var t=this.TRTC.createPusher({beautyLevel:5});this.data.pusher=t.pusherAttributes}},{key:"enterRoom",value:function(t){this._addTRTCEvent();var e=t.roomID,n=Object.assign(this.data.config,{roomID:e,enableMic:!0,autopush:!0,enableAgc:!0,enableAns:!0,enableCamera:t.callType===pg.VIDEO});this.data.enterRoomStatus=!0,this.data.pusher=this.TRTC.enterRoom(n),wx.createLivePusherContext().startPreview(),this.getCurrentPusherInstance().start()}},{key:"exitRoom",value:(x=c(a().mark((function t(){var e;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getCurrentPusherInstance().stop();case 2:return t.next=4,this.TRTC.exitRoom();case 4:e=t.sent,this.data.pusher=e.pusher,this.data.playerList=e.playerList,this.data.unHandledInviteeList=[],this.data.enterRoomStatus=!1,this.initTRTC(),this._removeTRTCEvent();case 11:case"end":return t.stop()}}),t,this)}))),function(){return x.apply(this,arguments)})},{key:"setPusherAttributesHandler",value:function(t){this.data.pusher=this.TRTC.setPusherAttributes(t),this.TRTCCallingDelegate.onUserUpdate({pusher:this.data.pusher,playerList:this.data.playerList})}},{key:"setPlayerAttributesHandler",value:(O=c(a().mark((function t(e,n){var r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=this.TRTC.setPlayerAttributes(e.streamID,n),uT.warn("setPlayerAttributesHandler",r),this.data.playerList=r.length>0?this._updateUserProfile(this.data.playerList,r):this.data.playerList,this.data.playerList.length>0&&0===r.length&&(this.data.playerList[0].hasAudio=!1,this.data.playerList[0].hasVideo=!1),this.TRTCCallingDelegate.onUserUpdate({pusher:this.data.pusher,playerList:this.data.playerList});case 5:case"end":return t.stop()}}),t,this)}))),function(t,e){return O.apply(this,arguments)})},{key:"_mutePlayerAudio",value:function(t){var e=t.currentTarget.dataset.value;e.hasAudio&&e.muteAudio?this.setPlayerAttributesHandler(e,{muteAudio:!1}):!e.hasAudio||e.muteAudio||this.setPlayerAttributesHandler(e,{muteAudio:!0})}},{key:"_mutePlayerVideo",value:function(t){var e=t.currentTarget.dataset.value;e.hasVideo&&e.muteVideo?this.setPlayerAttributesHandler(e,{muteVideo:!1}):!e.hasVideo||e.muteVideo||this.setPlayerAttributesHandler(e,{muteVideo:!0})}},{key:"_pusherAudioHandler",value:function(){this.data.pusher.enableMic?(this.setPusherAttributesHandler({enableMic:!1}),this.getCurrentPusherInstance().setMICVolume({volume:0})):(this.setPusherAttributesHandler({enableMic:!0}),this.getCurrentPusherInstance().setMICVolume({volume:100}))}},{key:"_pusherVideoHandler",value:function(){this.data.pusher.enableCamera?this.setPusherAttributesHandler({enableCamera:!1}):this.setPusherAttributesHandler({enableCamera:!0})}},{key:"init",value:(A=c(a().mark((function t(e){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return q_.getInstance().getAlert().checkSync(new H_({api:"init",attributes:e})),t.next=3,this.login(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)}))),function(t){return A.apply(this,arguments)})},{key:"login",value:(k=c(a().mark((function t(e){var n=this;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.data.config.userID=e.userID,this.data.config.userSig=e.userSig,t.abrupt("return",new Promise((function(t,r){wx.$TSignaling.login({userID:e.userID,userSig:e.userSig}).then((function(r){return uT.log(UD,"login","IM login success",r),wx.setStorageSync("userId","".concat(e.userID)),n._callDataReport.setUserID(e.userID),n._initReady=!0,n._resetTUICallEngine(),n._addTSignalingEvent(),n.initTRTC(),n.TSignalingResolve=t,r.data.repeatLogin&&t(null),null})).catch((function(t){uT.error("".concat(UD," init failed', error: ").concat(t)),r(t)}))})));case 3:case"end":return t.stop()}}),t,this)}))),function(t){return k.apply(this,arguments)})},{key:"logout",value:(w=c(a().mark((function t(){var e,n,r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.data.config,n=e.userID,r=e.userSig,t.prev=1,t.next=4,wx.$TSignaling.logout({userID:n,userSig:r});case 4:uT.log(UD,"logout","IM logout success"),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(1),uT.error(UD,"logout","IM logout failure");case 10:case"end":return t.stop()}}),t,this,[[1,7]])}))),function(){return w.apply(this,arguments)})},{key:"on",value:function(t,e,n){q_.getInstance().getAlert().checkSync(new H_({api:"on",attributes:{eventCode:t,handler:e,context:n}})),this._emitter.on(t,e,n)}},{key:"off",value:function(t,e){q_.getInstance().getAlert().checkSync(new H_({api:"off",attributes:{eventCode:t,handler:e}})),this._emitter.off(t,e)}},{key:"call",value:(L=c(a().mark((function t(e){var n,r,o,s,c,u,l;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.userID,r=e.type,t.next=3,q_.getInstance().getAlert().check(new H_({api:"call",attributes:e,initReady:this._initReady,callStatus:this.data.callStatus,capabilityCode:Rg.BASE}),{tim:this.tim});case 3:return t.prev=3,t.next=6,hD(r);case 6:t.next=11;break;case 8:return t.prev=8,t.t0=t.catch(3),t.abrupt("return");case 11:if(this.getUserID()!==n){t.next=14;break}throw uT.log("".concat(UD,".call failed. Called id can't be yourself. userId:").concat(this.getUserID(),", inviteeId:").concat(n)),new Error("".concat(UD,".call failed. Called id can't be yourself. userId:").concat(this.getUserID(),", inviteeId:").concat(n));case 14:return this._callDataReport.setAbilityBit(!0),this._callDataReport.setCallScene(Sg.SINGLE_CALL),o={callType:Sg.SINGLE,mediaType:r,inviteeList:[n]},t.prev=17,s=e.roomID||Math.floor(2147483646*Math.random()+1),this.data.roomID=s,this.data.config.type=r,this.data.invitation.inviter=this.data.config.userID,this.data.invitation.type=r,this.data.invitation.roomID=s,this.data.isInviter=!0,this.data.remoteID=n,t.next=28,this.TSignalingClient.invite(i(i({},e),{},{roomID:s}));case 28:if(c=t.sent,this.enterRoom({roomID:s,callType:r}),this._callDataReport.setEnterRoomTime((new Date).getTime()),u=i(i({},u=this._callDataReport.getCallData()),{},{userId:n,roomID:s,callRole:gg,callType:r,inviteeList:[n]}),this._callDataReport.setCallData(u),this._callDataReport.setSendSignalingTime((new Date).getTime()),uT.log("".concat(UD," call(userID: ").concat(n,", type: ").concat(r,") success, ").concat(c)),l="callType: ".concat(r+1,",\n      conversationType: ").concat(c.data.message.conversationType,",\n      userId:{ ").concat(c.data.message.from," } invite userId:{ ").concat(c.data.message.to," }"),0!==c.code){t.next=44;break}this._callDataReport.setInviteID(c.inviteID),this.setInitialCallId(c.inviteID),this._callRecordUpload(i({eventType:Sg.START_CALL},o)),this._setInterfaceUpLoad(dT).setCallType(r+1).setText("".concat(l," succeeded")).setEnd(),t.next=50;break;case 44:return this._callDataReport.setCodeAndMessage(c.code,c.message),this._callDataReport.uploadToKibana(),this._callRecordUpload(i({eventType:Sg.CALL_FAILED},o)),this._setInterfaceUpLoad(dT).setCallType(r+1).setText("".concat(l," failed")).setEnd(),t.next=50,this._resetTUICallEngine();case 50:return this.data.invitation.inviteID=c.inviteID,this.changeCallStatus(sg.CALLING),this.addInviterInviteId(c.inviteID,[this.data.config.userID,n]),this.addUnHandledInviteeList([n]),this.addHandledInviteeList([this.getUserID()]),t.abrupt("return",{data:c.data,pusher:this.data.pusher});case 58:return t.prev=58,t.t1=t.catch(17),this._callDataReport.setCodeAndMessage(cy.NOT_MEDIA_ACCESS,JSON.stringify(t.t1)),this._callDataReport.uploadToKibana(),this._callRecordUpload(i({eventType:Sg.CALL_FAILED},o)),uT.error("".concat(UD," call(userID:").concat(n,",type:").concat(r,") failed', error: ").concat(t.t1)),t.next=66,this._resetTUICallEngine();case 66:throw new Error(t.t1);case 67:case"end":return t.stop()}}),t,this,[[3,8],[17,58]])}))),function(t){return L.apply(this,arguments)})},{key:"groupCall",value:(S=c(a().mark((function t(e){var n,r,o,s,c;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.type,r=e.userIDList,t.next=3,q_.getInstance().getAlert().check(new H_({api:"groupCall",attributes:e,initReady:this._initReady,callStatus:this.data.callStatus,capabilityCode:Rg.PRO}),{tim:this.tim});case 3:return t.prev=3,t.next=6,hD(n);case 6:t.next=11;break;case 8:return t.prev=8,t.t0=t.catch(3),t.abrupt("return");case 11:if(-1===r.indexOf(this.getUserID())){t.next=13;break}throw new Error("".concat(UD,".groupCall failed. Called list can't contain yourself. userID:").concat(this.getUserID(),", inviteeIDList:").concat(r));case 13:return this._callDataReport.setCallScene(Sg.GROUP_CALL),o=e.roomID||Math.floor(2147483646*Math.random()+1),this.enterRoom({roomID:o,callType:n}),s={callType:Sg.GROUP,mediaType:n,inviteeList:e.userIDList},this.data.config.type=e.type,this.data.invitation.inviter=this.data.config.userID,this.data.invitation.type=n,this.data.invitation.roomID=o,this.data.isInviter=!0,this.data.isGroupCall=!0,this.data.groupID=e.groupID,t.prev=24,t.next=27,this.TSignalingClient.inviteGroup(i(i({},e),{},{roomID:o}));case 27:return c=t.sent,this.data.config.type=e.type,this.data.invitation.inviteID=c.inviteID,this.data.invitation.inviter=this.data.config.userID,this.data.invitation.type=n,this.data.invitation.roomID=o,this.data.isInviter=!0,this.data.isGroupCall=!0,this.data.groupID=e.groupID,this.data.roomID=o,this.addUnHandledInviteeList(e.userIDList),this.addHandledInviteeList([this.getUserID()]),this.changeCallStatus(sg.CALLING),this.addInviterInviteId(c.inviteID,[this.data.config.userID].concat(_(e.userIDList))),this.setInitialCallId(c.inviteID),this._callRecordUpload(i({eventType:Sg.START_CALL},s)),uT.log(UD,"groupCall OK",c),t.abrupt("return",{data:c.data,pusher:this.data.pusher});case 47:return t.prev=47,t.t1=t.catch(24),uT.error(UD,"groupCall failed",t.t1),this._callRecordUpload(i({eventType:Sg.CALL_FAILED},s)),t.next=53,this._resetTUICallEngine();case 53:throw new Error(t.t1);case 54:case"end":return t.stop()}}),t,this,[[3,8],[24,47]])}))),function(t){return S.apply(this,arguments)})},{key:"joinInGroupCall",value:(b=c(a().mark((function t(e){var n,r,i,o;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.roomID,r=e.type,i=e.groupID,t.next=3,q_.getInstance().getAlert().check(new H_({api:"joinInGroupCall",attributes:e,initReady:this._initReady,capabilityCode:Rg.PRO}),{tim:this.tim});case 3:return t.prev=3,t.next=6,hD(r);case 6:t.next=11;break;case 8:return t.prev=8,t.t0=t.catch(3),t.abrupt("return");case 11:return t.prev=11,this.data.config.type=r,this.data.invitation.type=r,uT.log("".concat(UD,".joinInGroupCall  roomID:").concat(n,",type:").concat(r,",userID:").concat(this.getUserID())),this.changeCallStatus(sg.CALLING),this.addHandledInviteeList([this.getUserID()]),this.data.groupID=i,this.data.roomID=n,this.data.isGroupCall=!0,this.data.isInviter=!1,this.enterRoom({roomID:n,callType:r}),this.changeCallStatus(sg.CONNECTED),o={eventType:Sg.JOIN_IN_GROUP_CALL,callType:Sg.GROUP,mediaType:this._callType},this._callRecordUpload(o),this._callRecordReport.startHeartbeat(),t.abrupt("return",this.data.pusher);case 29:return t.prev=29,t.t1=t.catch(11),t.next=33,this._resetTUICallEngine();case 33:throw new Error("".concat(UD,".joinInGroupCall failed error: ").concat(t.t1));case 34:case"end":return t.stop()}}),t,this,[[3,8],[11,29]])}))),function(t){return b.apply(this,arguments)})},{key:"inviteUser",value:(R=c(a().mark((function t(e){var n,r,i,o,s,c,u,l,h,d=this;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,q_.getInstance().getAlert().check(new H_({api:"inviteUser",attributes:e,initReady:this._initReady,capabilityCode:Rg.PRO}),{tim:this.tim});case 2:if(n=e.userIDList,r=void 0===n?[]:n,this.isGroupCall()){t.next=6;break}throw uT.error("".concat(UD,".inviteUser - groupID:").concat(this.data.groupID,", roomID:").concat(this.data.roomID,", type:").concat(this.data.callType)),new Error("".concat(UD,".inviteUser - groupID:").concat(this.data.groupID,", roomID:").concat(this.data.roomID,", type:").concat(this.data.callType));case 6:if(this.isInviter()||this.data.callStatus===sg.CONNECTED){t.next=9;break}throw uT.error("".concat(UD,".inviteUser - current status:").concat(this.data.callStatus," not support")),new Error("".concat(UD,".inviteUser - current status:").concat(this.data.callStatus," not support"));case 9:if(0!==r.length){t.next=12;break}throw uT.error("".concat(UD,".inviteUser - userIDList is empty")),new Error("".concat(UD,".inviteUser - userIDList is empty"));case 12:if(i=this.getHandledInviteeList(),o=this.getUnHandledInviteeList(),s=[].concat(_(i),_(o)),0!==(c=r.filter((function(t){return-1===s.indexOf(t)}))).length){t.next=19;break}return uT.error("".concat(UD,".inviteUser failed - userIDList in call list. userIDList:").concat(JSON.stringify(r))),t.abrupt("return",Promise.reject("".concat(UD,".inviteUser failed - userIDList in call list. userIDList:").concat(JSON.stringify(r))));case 19:return r=c,t.prev=20,u=this.data.handledInviteeList.filter((function(t){return t!==d.getUserID()})),t.next=24,this.TSignalingClient.inviteGroup({groupID:this.data.groupID,userIDList:r,type:this.data.invitation.type,roomID:this.data.roomID,timeout:this.data.callTimeout,inCallUserIDs:[].concat(_(this.data.unHandledInviteeList),_(u)),initialCallId:this.getInitialCallId()});case 24:if(l=t.sent,uT.log("inviteUser res",l),0!==l.code){t.next=32;break}return this.addUnHandledInviteeList(r),this.addInviterInviteId(l.inviteID,[this.data.config.userID].concat(_(r))),h={eventType:Sg.INVITE_USER,callType:Sg.GROUP,mediaType:this._callType,inviteeList:r},this._callRecordUpload(h),t.abrupt("return",l);case 32:t.next=37;break;case 34:throw t.prev=34,t.t0=t.catch(20),new Error("".concat(UD,".inviteUser failed, userId:").concat(this.getUserID(),", inviteeIdList:").concat(r,", error: ").concat(t.t0));case 37:case"end":return t.stop()}}),t,this,[[20,34]])}))),function(t){return R.apply(this,arguments)})},{key:"accept",value:(C=c(a().mark((function t(){var e=this;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,q_.getInstance().getAlert().check(new H_({api:"accept",initReady:this._initReady,callStatus:this.data.callStatus}));case 2:return t.prev=2,t.next=5,hD(this.data.config.type);case 5:t.next=10;break;case 7:return t.prev=7,t.t0=t.catch(2),t.abrupt("return");case 10:return t.abrupt("return",new Promise((function(t,n){if(uT.log(UD,"accept() inviteID: ",e.data.invitation.inviteID),e.data.config.type!==pg.VIDEO||e.data.isGroupCall)e.handleAccept(t,n);else if(e.data.devicePermission){wx.createLivePusherContext().stopPreview();var r=setTimeout(c(a().mark((function i(){return a().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:clearTimeout(r),e.handleAccept(t,n);case 2:case"end":return i.stop()}}),i)}))),0)}else e.handleAccept(t,n)})));case 11:case"end":return t.stop()}}),t,this,[[2,7]])}))),function(){return C.apply(this,arguments)})},{key:"handleAccept",value:(D=c(a().mark((function t(e,n){var r,i;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._callDataReport.setEnterRoomTime((new Date).getTime()),this.enterRoom({roomID:this.data.invitation.roomID,callType:this.data.config.type}),r=this.data.invitation.inviteID,t.next=5,this.TSignalingClient.accept({inviteID:r,type:this.data.config.type});case 5:0===(i=t.sent).code?(uT.log(UD,"accept OK"),this.addHandledInviteeList([this.getUserID()]),this.deleteUnHandledInviteeList([this.getUserID()]),this.addAcceptedUserList(r,[this.getUserID()]),this._callRecordUpload({eventType:Sg.ACCEPT_CALL}),this._callRecordReport.startHeartbeat(),e({message:i.data.message,pusher:this.data.pusher}),this.changeCallStatus(sg.CONNECTED)):(this.isGroupCall()&&(this._callDataReport.setCodeAndMessage(cy.NOT_MEDIA_ACCESS,JSON.stringify(i.data.message)),this._callDataReport.uploadToKibana()),uT.error(UD,"accept failed",i),n(i),this._resetTUICallEngine());case 7:case"end":return t.stop()}}),t,this)}))),function(t,e){return D.apply(this,arguments)})},{key:"reject",value:(T=c(a().mark((function t(){var e,n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,q_.getInstance().getAlert().checkSync(new H_({api:"reject",callStatus:this.data.callStatus,initReady:this._initReady}));case 2:if(!this.data.invitation.inviteID){t.next=13;break}return t.next=5,this.TSignalingClient.reject({inviteID:this.data.invitation.inviteID,type:this.data.config.type});case 5:return e=t.sent,uT.log(UD,"reject OK",e),n=this.generateEventData(),this.TRTCCallingDelegate.onCancel(i(i({inviteID:this.data.invitation.inviteID,invitee:this.getUserID(),userID:this.getUserID()},n),{},{reason:Sg.REJECT})),this._callRecordUpload({eventType:Sg.REJECT_CALL}),t.next=12,this._resetTUICallEngine();case 12:return t.abrupt("return",e);case 13:return uT.warn("".concat(UD," 未收到邀请，无法拒绝")),t.abrupt("return","未收到邀请，无法拒绝");case 15:case"end":return t.stop()}}),t,this)}))),function(){return T.apply(this,arguments)})},{key:"hangup",value:(m=c(a().mark((function t(){var e,n,r,o,s,c,u,l,h,d,f,p,v,g,y,I,E,m,T=this;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,q_.getInstance().getAlert().checkSync(new H_({api:"hangup",callStatus:this.data.callStatus,initReady:this._initReady}));case 2:if(uT.warn("".concat(UD,". - callStatus:").concat(this.data.callStatus," _inviterInviteID:").concat(JSON.stringify(this.data.invitation))),this.data.callStatus!==sg.IDLE){t.next=5;break}throw new Error("".concat(UD,".hangup failed. current status:").concat(this.data.callStatus));case 5:if(this.data.callStatus!==sg.CALLING||0!==this.getInviterInviteIdList().length){t.next=7;break}throw new Error("".concat(UD,".call/groupCall incomplete。please wait cancel"));case 7:if(e=this.isGroupCall(),n=this.isInviter(),r=this.getUserID(),o=Math.round((Date.now()-this.data.startTalkTime)/1e3),s=this.getCallType(),u=this.getInviterInviteIdList(),this.data.callStatus!==sg.CONNECTED){t.next=27;break}if(t.prev=14,0!==u.length){t.next=20;break}return l=this.generateCallEndData({callMediaType:s,totalTime:o}),this.TRTCCallingDelegate.onCallEnd(l),t.next=20,this._resetTUICallEngine();case 20:t.next=27;break;case 22:return t.prev=22,t.t0=t.catch(14),t.next=26,this._resetTUICallEngine();case 26:throw new Error(t.t0);case 27:if(h=this.getHandledInviteeList(),d=this.getUnHandledInviteeList(),f=this.generateEventData(),t.prev=30,e){t.next=49;break}if(p=this.generateCallEndData(),!n){t.next=44;break}if(1!==d.length){t.next=41;break}return t.next=37,this.cancel();case 37:c=t.sent,this.TRTCCallingDelegate.onCancel(i(i({inviteID:this.data.invitation.inviteID,invitee:r,userID:r},f),{},{reason:Sg.NORMAL})),t.next=42;break;case 41:this.TRTCCallingDelegate.onCallEnd(p);case 42:t.next=45;break;case 44:this.TRTCCallingDelegate.onCallEnd(p);case 45:return t.next=47,this._resetTUICallEngine();case 47:t.next=78;break;case 49:if(v=this.getCallStatus(),g={callType:this.getCallType(),isGroupCall:this.isGroupCall(),groupID:this.data.groupID,userIDList:[].concat(_(h.filter((function(t){return t!==r}))),_(d)),callEnd:Math.round((Date.now()-this.data.startTalkTime)/1e3)},!n){t.next=69;break}if(v!==sg.CALLING){t.next=59;break}return t.next=55,this.cancel(this.getInviterInviteIdList());case 55:return c=t.sent,this.TRTCCallingDelegate.onCancel(i(i({inviteID:this.data.invitation.inviteID,invitee:r,userID:r},f),{},{reason:Sg.NORMAL})),t.next=59,this._resetTUICallEngine();case 59:if(v!==sg.CONNECTED){t.next=67;break}y=a().mark((function t(){var e,n,i,o,s,l,f;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=u[I],n=T.getInviterInviteIdUserList(e),!((i=T.getAcceptedUserList(e)).length>0)){t.next=14;break}return o=i.filter((function(t){return-1!==h.indexOf(t)})),s=n.filter((function(t){return-1!==d.indexOf(t)})),g.userIDList=[].concat(_(o),_(s)).filter((function(t){return t!==r})),uT.warn("inviter emit hangup signal, notify userIDList:".concat(JSON.stringify(g.userIDList))),t.next=9,T.TSignalingClient.hangup(g);case 9:c=t.sent,l=T.generateCallEndData(),T.TRTCCallingDelegate.onCallEnd(l),t.next=21;break;case 14:if(f=T.getUnHandledInviteeList(),!(n.filter((function(t){return-1!==f.indexOf(t)})).length>0)){t.next=21;break}return uT.warn("inviter emit cancel signal, userIdList:".concat(n)),t.next=20,T.cancel([e]);case 20:c=t.sent;case 21:case"end":return t.stop()}}),t)})),I=0;case 62:if(!(I<u.length)){t.next=67;break}return t.delegateYield(y(),"t1",64);case 64:I++,t.next=62;break;case 67:t.next=76;break;case 69:E=a().mark((function t(){var e,n,i,o,s,l,f;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=u[m],n=T.getInviterInviteIdUserList(e),!((i=T.getAcceptedUserList(e)).length>0)){t.next=14;break}return o=i.filter((function(t){return-1!==h.indexOf(t)})),s=n.filter((function(t){return-1!==d.indexOf(t)})),g.userIDList=[].concat(_(o),_(s)).filter((function(t){return t!==r})),uT.warn("invitee emit hangup signal, notify userIDList:".concat(JSON.stringify(g.userIDList))),t.next=9,T.TSignalingClient.hangup(g);case 9:c=t.sent,l=T.generateCallEndData(),T.TRTCCallingDelegate.onCallEnd(l),t.next=21;break;case 14:if(f=T.getUnHandledInviteeList(),!(n.filter((function(t){return-1!==f.indexOf(t)})).length>0)){t.next=21;break}return uT.warn("invitee emit cancel signal, inviteID:".concat(e)),t.next=20,T.cancel([e]);case 20:c=t.sent;case 21:case"end":return t.stop()}}),t)})),m=0;case 71:if(!(m<u.length)){t.next=76;break}return t.delegateYield(E(),"t2",73);case 73:m++,t.next=71;break;case 76:return t.next=78,this._resetTUICallEngine();case 78:return t.abrupt("return",c);case 81:throw t.prev=81,t.t3=t.catch(30),uT.warn("".concat(UD,".hangup failed, error: ").concat(t.t3)),new Error("".concat(UD,".hangup failed, error: ").concat(t.t3));case 85:case"end":return t.stop()}}),t,this,[[14,22],[30,81]])}))),function(){return m.apply(this,arguments)})},{key:"cancel",value:(E=c(a().mark((function t(e){var n,r,i,o,s;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:uT.log("_cancel _inviterInviteID",this.data_inviterInviteID),n=[],t.prev=2,0===(e||[]).length&&(e=this.getInviterInviteIdList().slice(0,1)),r=0;case 5:if(!(r<e.length)){t.next=14;break}return i=e[r],t.next=9,this.TSignalingClient.cancel({inviteID:i,callType:this.data.invitation.type});case 9:o=t.sent,n.push(o);case 11:r++,t.next=5;break;case 14:t.next=19;break;case 16:throw t.prev=16,t.t0=t.catch(2),new Error("".concat(UD,"._cancel failed, error: ").concat(t.t0));case 19:return s="cancel ".concat(JSON.stringify(n)," succeeded"),uT.log("".concat(UD,"._cancel ").concat(s)),t.abrupt("return",n);case 22:case"end":return t.stop()}}),t,this,[[2,16]])}))),function(t){return E.apply(this,arguments)})},{key:"getRoomID",value:function(){return this.data.invitation.roomID}},{key:"getCallType",value:function(){return this.data.invitation.type}},{key:"isGroupCall",value:function(){return this.data.isGroupCall}},{key:"getUserID",value:function(){return this.data.config.userID}},{key:"isInviter",value:function(){return this.data.isInviter}},{key:"getHandledInviteeList",value:function(){return this.data.handledInviteeList||[]}},{key:"getCallDataReport",value:function(){return this._callDataReport}},{key:"getCallRecordReport",value:function(){return this._callRecordReport}},{key:"getUnHandledInviteeList",value:function(){return this.data.unHandledInviteeList||[]}},{key:"getCallStatus",value:function(){return this.data.callStatus}},{key:"getInviterInviteID",value:function(t){return this.data._inviterInviteID[t]||[]}},{key:"addAcceptedUserList",value:function(t,e){var n=this;if(0!==e.length)if(t)0===(this.data._acceptedUserObject[t]||[]).length?this.data._acceptedUserObject[t]=e:e.forEach((function(e){-1===n.data._acceptedUserObject[t].indexOf(e)&&n.data._acceptedUserObject[t].push(e)}));else for(var r=this.getInviterInviteIdList(),i=function(){var t=r[a],i=n.getInviterInviteIdUserList(t),o=e.filter((function(t){return-1!==i.indexOf(t)}));0===(n._acceptedUserObject[t]||[]).length?n.data._acceptedUserObject[t]=o:o.forEach((function(e){-1===n.data._acceptedUserObject[t].indexOf(e)&&n.data._acceptedUserObject[t].push(e)}))},a=0;a<r.length;a++)i()}},{key:"getAcceptedUserList",value:function(t){return this.data._acceptedUserObject[t]||[]}},{key:"getInviterInviteIdList",value:function(){return Object.keys(this.data._inviterInviteID||{})}},{key:"getTotalInviterInviteIdList",value:function(){var t=this.getInviterInviteIdList();return[].concat(_(this.data._audioVideoSwitchIdList),_(t))}},{key:"getInviterInviteIdUserList",value:function(t){return this.data._inviterInviteID[t]||[]}},{key:"addAudioVideoSwitchIdList",value:function(t){t&&this.data._audioVideoSwitchIdList.push(t)}},{key:"getAudioVideoSwitchIdList",value:function(){return this.data._audioVideoSwitchIdList||[]}},{key:"addUnHandledInviteeList",value:function(t){var e=this;0!==t.length&&(t.forEach((function(t){-1===e.data.unHandledInviteeList.indexOf(t)&&e.data.unHandledInviteeList.push(t)})),this.data.unHandledInviteeList=Array.from(new Set(this.data.unHandledInviteeList)))}},{key:"deleteUnHandledInviteeList",value:function(t){var e=this;0!==t.length&&t.forEach((function(t){e.data.unHandledInviteeList=e.data.unHandledInviteeList.filter((function(e){return e!==t}))}))}},{key:"addHandledInviteeList",value:function(t){var e=this;0!==t.length&&(t.forEach((function(t){-1===e.data.handledInviteeList.indexOf(t)&&e.data.handledInviteeList.push(t)})),this.data.handledInviteeList=Array.from(new Set(this.data.handledInviteeList)))}},{key:"deleteHandledInviteeList",value:function(t){var e=this;0!==t.length&&t.forEach((function(t){e.data.handledInviteeList=e.data.handledInviteeList.filter((function(e){return e!==t}))}))}},{key:"getSwitchCallModeStatus",value:function(){return this.data.switchCallModeStatus}},{key:"changeCallStatus",value:function(t){var e=this;switch(uT.log("进入callStatus",t),this.data.callStatus=t,t){case sg.CONNECTED:if(this.data.timer)return;this.data.timer=setInterval((function(){var t,n,r,i,a,o;e.data.chatTime=(t=e.data.chatTimeNum,(o=t)>=3600?(r=parseInt(o/3600)<10?"0".concat(parseInt(o/3600)):parseInt(o/3600),i=parseInt(o%60/60)<10?"0".concat(parseInt(o%60/60)):parseInt(o%60/60),(a=o%3600<10?"0".concat(o%3600):o%3600)>60&&(i=parseInt(a/60)<10?"0".concat(parseInt(a/60)):parseInt(a/60),a=a%60<10?"0".concat(a%60):a%60),n="".concat(r,":").concat(i,":").concat(a)):o>=60&&o<3600?(i=parseInt(o/60)<10?"0".concat(parseInt(o/60)):parseInt(o/60),a=o%60<10?"0".concat(o%60):o%60,n="00:".concat(i,":").concat(a)):o<60&&(a=o<10?"0".concat(o):o,n="00:00:".concat(a)),n),e.data.chatTimeNum+=1,e.data.pusher.chatTime=e.data.chatTime,e.data.pusher.chatTimeNum=e.data.chatTimeNum,e.TRTCCallingDelegate.onUserUpdate({pusher:e.data.pusher,playerList:e.data.playerList})}),1e3);break;case sg.IDLE:clearInterval(this.data.timer),this.data.timer=null,this.data.chatTime="00:00:00",this.data.chatTimeNum=0}}},{key:"_resetTUICallEngine",value:(I=c(a().mark((function t(e,n){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.changeCallStatus(sg.IDLE),uT.log(UD," _resetTUICallEngine()",this.data.enterRoomStatus),!this.data.enterRoomStatus){t.next=5;break}return t.next=5,this.exitRoom(e,n);case 5:this.data.config.type=pg.AUDIO,this._callRecordReport.stopHeartbeat(),this._initialCallId="",this.initData();case 9:case"end":return t.stop()}}),t,this)}))),function(t,e){return I.apply(this,arguments)})},{key:"startRemoteView",value:(y=c(a().mark((function t(e){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.data.playerList.forEach((function(t){if(t.userID===e)return t.muteVideo=!1,void uT.log("".concat(UD,", startRemoteView(").concat(e,")"))}));case 1:case"end":return t.stop()}}),t,this)}))),function(t){return y.apply(this,arguments)})},{key:"stopRemoteView",value:function(t){this.data.playerList.forEach((function(e){if(e.userID===t)return e.muteVideo=!0,void uT.log("".concat(UD,", stopRemoteView(").concat(t,")"))}))}},{key:"openCamera",value:function(){q_.getInstance().getAlert().checkSync(new H_({api:"openCamera",callStatus:this.data.callStatus,initReady:this._initReady})),this.data.pusher.enableCamera||this._pusherVideoHandler(),uT.log("".concat(UD,", openCamera() pusher: ").concat(this.data.pusher))}},{key:"closeCamera",value:function(){q_.getInstance().getAlert().checkSync(new H_({api:"closeCamera",callStatus:this.data.callStatus,initReady:this._initReady})),this.data.pusher.enableCamera&&this._pusherVideoHandler(),uT.log("".concat(UD,", closeCamera() pusher: ").concat(this.data.pusher))}},{key:"switchCamera",value:function(){q_.getInstance().getAlert().checkSync(new H_({api:"switchCamera",callStatus:this.data.callStatus,initReady:this._initReady})),this.getCurrentPusherInstance().switchCamera(),uT.log("".concat(UD,", switchCamera(), frontCamera").concat(this.data.pusher.frontCamera))}},{key:"openMicrophone",value:function(){q_.getInstance().getAlert().checkSync(new H_({api:"openMicrophone",callStatus:this.data.callStatus,initReady:this._initReady})),this.data.pusher.enableMic||this._pusherAudioHandler(),uT.log("".concat(UD,", openMicrophone() pusher: ").concat(this.data.pusher))}},{key:"closeMicrophone",value:function(){q_.getInstance().getAlert().checkSync(new H_({api:"closeMicrophone",callStatus:this.data.callStatus,initReady:this._initReady})),this.data.pusher.enableMic&&this._pusherAudioHandler(),uT.log("".concat(UD,", closeMicrophone() pusher: ").concat(this.data.pusher))}},{key:"selectAudioPlaybackDevice",value:function(t){q_.getInstance().getAlert().checkSync(new H_({api:"selectAudioPlaybackDevice",callStatus:this.data.callStatus,attributes:{type:t},initReady:this._initReady}));var e=!1;switch(t){case"speaker":e=!0;break;case"ear":e=!1}return this.setHandsFree(e)}},{key:"setHandsFree",value:function(t){return this.data.soundMode=t?"speaker":"ear",uT.log("".concat(UD,", setHandsFree() result: ").concat(this.data.soundMode)),this.data.soundMode}},{key:"switchAudioCall",value:(g=c(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isGroupCall()){t.next=3;break}return uT.warn("".concat(UD,".switchToAudioCall is not applicable to groupCall.")),t.abrupt("return");case 3:if(this.data.invitation.type!==pg.AUDIO){t.next=6;break}return uT.warn("".concat(UD," Now the call mode is audio call.")),t.abrupt("return");case 6:if(this.data.switchCallModeStatus){t.next=9;break}return uT.warn("".concat(UD," audio and video call switching.")),t.abrupt("return");case 9:return this.setSwitchCallModeStatus(!1),this.setPusherAttributesHandler({enableCamera:!1}),t.abrupt("return",this.TSignalingClient.switchCallMode({userID:this.data.unHandledInviteeList[0]||this.data.playerList[0].userID,callType:this.data.invitation.type,roomID:this.data.invitation.roomID,mode:_g}));case 12:case"end":return t.stop()}}),t,this)}))),function(){return g.apply(this,arguments)})},{key:"switchCallMediaType",value:(v=c(a().mark((function t(e){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,q_.getInstance().getAlert().check(new H_({api:"switchCallMediaType",attributes:{type:e},callStatus:this.data.callStatus,initReady:this._initReady}));case 2:if(!this.isGroupCall()){t.next=5;break}return uT.warn("".concat(UD,".switchToAudioCall is not applicable to groupCall.")),t.abrupt("return");case 5:if(this.data.switchCallModeStatus){t.next=8;break}return uT.warn("".concat(UD," audio and video call switching.")),t.abrupt("return");case 8:t.t0=e,t.next=t.t0===pg.AUDIO?11:t.t0===pg.VIDEO?14:16;break;case 11:return this.setSwitchCallModeStatus(!1),this.setPusherAttributesHandler({enableCamera:!1}),t.abrupt("return",this.TSignalingClient.switchCallMode({userID:this.data.unHandledInviteeList[0]||this.data.playerList[0].userID,callType:this.data.invitation.type,roomID:this.data.invitation.roomID,mode:_g}));case 14:throw uT.warn("".concat(UD," Audio switching Video is not supported yet")),new Error("".concat(UD," Audio switching Video is not supported yet"));case 16:case"end":return t.stop()}}),t,this)}))),function(t){return v.apply(this,arguments)})},{key:"setSwitchCallModeStatus",value:function(t){this.data.switchCallModeStatus=t}},{key:"switchVideoCall",value:(p=c(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isGroupCall()){t.next=3;break}return uT.warn("".concat(UD,".switchToVideoCall is not applicable to groupCall.")),t.abrupt("return");case 3:if(this.data.invitation.type!==pg.VIDEO){t.next=6;break}return uT.warn("".concat(UD," Now the call mode is video call.")),t.abrupt("return");case 6:if(this.data.switchCallModeStatus){t.next=9;break}return uT.warn("".concat(UD," audio and video call switching.")),t.abrupt("return");case 9:return this.setSwitchCallModeStatus(!1),this.setPusherAttributesHandler({enableCamera:!0}),t.abrupt("return",this.TSignalingClient.switchCallMode({userID:this.data.playerList[0].userID,callType:this.data.invitation.type,roomID:this.data.invitation.roomID,mode:Dg}));case 12:case"end":return t.stop()}}),t,this)}))),function(){return p.apply(this,arguments)})},{key:"setSoundMode",value:function(t){var e=!1,n=!1;switch(t||(n=!0,t=this.data.soundMode),t){case"speaker":e=!0;break;case"ear":e=!1}return this.setHandsFree(n?!e:e)}},{key:"_hangUp",value:function(){this.hangup()}},{key:"getCurrentPusherInstance",value:function(){return this.TRTC.getPusherInstance().context=wx.createLivePusherContext(),this.TRTC.getPusherInstance()}},{key:"_pusherStateChangeHandler",value:function(t){this.TRTC.pusherEventHandler(t)}},{key:"_playerStateChange",value:function(t){this._emitter.emit(og.REMOTE_STATE_UPDATE,t)}},{key:"_playerAudioVolumeNotify",value:function(t){this.data.playerList.length>0&&this.TRTC.playerAudioVolumeNotify(t)}},{key:"_pusherAudioVolumeNotify",value:function(t){this.TRTC.pusherAudioVolumeNotify(t)}},{key:"_updateUserProfile",value:function(t,e){return 0===e.length||0===t.length?e:e.map((function(e){var n=e,r=t.filter((function(t){return t.userID===e.userID}));return n.avatar=r[0]&&r[0].avatar?r[0].avatar:"",n.nick=r[0]&&r[0].nick?r[0].nick:"",n}))}},{key:"_getUserProfile",value:function(t){var e=this;this.tim.getUserProfile({userIDList:t}).then((function(t){uT.log("getUserProfile success",t),uT.log(t.data),e.data.remoteUsers=t.data})).catch((function(t){uT.warn("getUserProfile error:",t)}))}},{key:"getUserProfile",value:(f=c(a().mark((function t(e){var n,r,i,o,s=arguments;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=s.length>1&&void 0!==s[1]?s[1]:"array",0!==e.length){t.next=3;break}return t.abrupt("return",[]);case 3:return r=e.map((function(t){return t.userID})),t.next=6,this.tim.getUserProfile({userIDList:r});case 6:i=t.sent,o=null,t.t0=n,t.next="array"===t.t0?11:"map"===t.t0?13:16;break;case 11:return o=e.map((function(t,e){return t.avatar=i.data[e].avatar,t.nick=i.data[e].nick,t})),t.abrupt("break",16);case 13:return o={},e.forEach((function(t,e){t.avatar=i.data[e].avatar,t.nick=i.data[e].nick,o[t.userID]=t})),t.abrupt("break",16);case 16:return t.abrupt("return",o);case 17:case"end":return t.stop()}}),t,this)}))),function(t){return f.apply(this,arguments)})},{key:"setSelfInfo",value:function(t,e){return q_.getInstance().getAlert().checkSync(new H_({api:"setSelfInfo",attributes:{nickName:t,avatar:e},initReady:this._initReady})),this.tim.updateMyProfile({nick:t,avatar:e})}},{key:"deviceCheck",value:(l=c(a().mark((function t(e){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",nT(e));case 1:case"end":return t.stop()}}),t)}))),function(t){return l.apply(this,arguments)})},{key:"_pusherNetStatus",value:function(t){this.TRTC.pusherNetStatusHandler(t)}},{key:"_playNetStatus",value:function(t){this.TRTC.playerNetStatus(t)}},{key:"_toggleViewSize",value:function(t){var e=t.currentTarget.dataset.screen;return uT.log("get screen",e,t),1===this.data.playerList.length&&e!==this.data.screen&&this.data.invitation.type===pg.VIDEO&&(this.data.screen=e),this.data.screen}},{key:"getTim",value:function(){return this.tim}},{key:"_setInterfaceUpLoad",value:function(t){return uT.time(t),new lT(t)}},{key:"destroyed",value:(s=c(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.getCallStatus()===sg.IDLE){t.next=3;break}return t.next=3,this.handleExceptionExit();case 3:if(this._resetTUICallEngine(),this._removeTSignalingEvent(),this._removeTRTCEvent(),this._timExternal){t.next=9;break}return t.next=9,this.logout();case 9:this._initReady=!1;case 10:case"end":return t.stop()}}),t,this)}))),function(){return s.apply(this,arguments)})},{key:"handleExceptionExit",value:(o=c(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.getCallStatus()!==sg.CALLING){t.next=8;break}if(!this.isInviter()){t.next=6;break}return t.next=4,this.hangup();case 4:t.next=8;break;case 6:return t.next=8,this.reject();case 8:if(this.getCallStatus()!==sg.CONNECTED){t.next=11;break}return t.next=11,this.hangup();case 11:case"end":return t.stop()}}),t,this)}))),function(){return o.apply(this,arguments)})},{key:"_callRecordUpload",value:function(t){var e=i(i({},t),{},{callRole:this.isInviter()?Sg.INVITER:Sg.INVITEE,userID:this.getUserID(),roomID:this.getRoomID(),inviteID:this.getInitialCallId()});this._callRecordReport.eventUpload(e)}},{key:"generateCallEndData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.roomId,n=t.callMediaType,r=t.callRole,i=t.totalTime,a=t.userId;return e=e||this.getRoomID(),n=n||this.getCallType(),r||(r=this.isInviter()?gg:yg),{roomID:e,callMediaType:n,callRole:r,totalTime:i=Wm(i)?Math.round((Date.now()-this.data.startTalkTime)/1e3):i,userID:a=a||this.getUserID(),callEnd:i,message:t.message||""}}},{key:"generateEventData",value:function(){return{callID:this.getInviterInviteIdList()[0],roomID:this.getRoomID(),callRole:this.isInviter()?Sg.INVITER:Sg.INVITEE,callMediaType:this.getCallType()}}},{key:"setInitialCallId",value:function(t){this._initialCallId=t}},{key:"getInitialCallId",value:function(){return this._initialCallId}}],[{key:"createInstance",value:function(t){return q_.getInstance().getAlert().checkSync(new H_({api:"createInstance",attributes:t})),r.instance||(r.instance=new r(t)),r.instance.initData(),r.instance}}]),r}();d(MD,"instance",null),d(MD,"AUDIO_PLAYBACK_DEVICE",Cg),d(MD,"MEDIA_TYPE",pg),d(MD,"EVENT",og),d(MD,"STATUS",sg);export{Cg as AUDIO_PLAYBACK_DEVICE,og as EVENT,pg as MEDIA_TYPE,sg as STATUS,MD as TUICallEngine,MD as default};
