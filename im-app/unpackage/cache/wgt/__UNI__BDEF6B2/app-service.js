if("undefined"==typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(e){const t=this.constructor;return this.then((n=>t.resolve(e()).then((()=>n))),(n=>t.resolve(e()).then((()=>{throw n}))))}),"undefined"!=typeof uni&&uni&&uni.requireGlobal){const e=uni.requireGlobal();ArrayBuffer=e.ArrayBuffer,Int8Array=e.Int8Array,Uint8Array=e.Uint8Array,Uint8ClampedArray=e.Uint8ClampedArray,Int16Array=e.Int16Array,Uint16Array=e.Uint16Array,Int32Array=e.Int32Array,Uint32Array=e.Uint32Array,Float32Array=e.Float32Array,Float64Array=e.Float64Array,BigInt64Array=e.BigInt64Array,BigUint64Array=e.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(Vue,weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),function(e){"use strict";function t(e,t,...n){uni.__log__?uni.__log__(e,t,...n):console[e].apply(console,[...n,t])}const n=t=>(n,o=e.getCurrentInstance())=>{!e.isInSSRComponentSetup&&e.injectHook(t,n,o)},o=n("onShow"),r=n("onLoad"),i=n("onReady"),s=n("onUnload"),a=n("onBackPress"),c=n("onNavigationBarButtonTap");function u(e){const t=6e4,n=36e5,o=24*n,r=(new Date).getTime()-e;let i="";if(r<0)return;const s=r/t,a=r/n,c=r/o,u=r/6048e5;if(u>=1&&u<=4)i=` ${parseInt(`${u}`,10)}周前`;else if(c>=1&&c<=6)i=` ${parseInt(`${c}`,10)}天前`;else if(a>=1&&a<=23)i=` ${parseInt(`${a}`,10)}小时前`;else if(s>=1&&s<=59)i=` ${parseInt(`${s}`,10)}分钟前`;else if(r>=0&&r<=t)i="刚刚";else{const t=new Date;t.setTime(e);i=`${t.getFullYear()}-${t.getMonth()+1<10?`0${t.getMonth()+1}`:t.getMonth()+1}-${t.getDate()<10?`0${t.getDate()}`:t.getDate()}`}return i}const l=e.defineComponent({props:{conversationList:{type:Array,default:()=>[]},currentID:{type:String,default:()=>""}},setup(n,o){const r=e.reactive({conversationList:[],currentID:"",isOpened:"none",currentConversation:{},dialogID:""});e.watchEffect((()=>{r.conversationList=n.conversationList,r.currentID=n.currentID}));return{...e.toRefs(r),handleGotoItem:e=>{o.emit("handleGotoItem",e)},handleItemAvator:e=>{var t,n,o;let r="";switch(e.type){case uni.$TIM.TYPES.CONV_C2C:r=(null==(t=null==e?void 0:e.userProfile)?void 0:t.avatar)||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png";break;case uni.$TIM.TYPES.CONV_GROUP:r=(null==(n=null==e?void 0:e.groupProfile)?void 0:n.avatar)||"https://web.sdk.qcloud.com/component/TUIKit/assets/group_avatar.png";break;case uni.$TIM.TYPES.CONV_SYSTEM:r=(null==(o=null==e?void 0:e.groupProfile)?void 0:o.avatar)||"https://web.sdk.qcloud.com/component/TUIKit/assets/group_avatar.png"}return r},handleItemTime:e=>e>0?u(1e3*e):"",handleItemMessage:e=>e.type===uni.$TIM.TYPES.MSG_TEXT?e.payload.text:e.messageForShow,handleItemName:e=>{var t,n;let o="";switch(e.type){case uni.$TIM.TYPES.CONV_C2C:o=(null==e?void 0:e.userProfile.nick)||(null==(t=null==e?void 0:e.userProfile)?void 0:t.userID)||"";break;case uni.$TIM.TYPES.CONV_GROUP:o=e.groupProfile.name||(null==(n=null==e?void 0:e.groupProfile)?void 0:n.groupID)||"";break;case uni.$TIM.TYPES.CONV_SYSTEM:o="系统通知"}return o},handleItemLongpress:e=>{r.currentConversation=e,r.dialogID=e.conversationID,"C2C"===e.type?r.currentuserID=e.userProfile.userID:"GROUP"===e.type&&(r.currentuserID=e.groupProfile.groupID),r.conversationType=e.type},handleConversation:e=>{switch(e){case"delete":uni.$TUIKit.TUIConversationServer.deleteConversation(r.dialogID).then((e=>{e.data})),r.dialogID="";break;case"ispinned":if("ispinned"===e){const e={conversationID:r.dialogID,isPinned:!0};uni.$TUIKit.TUIConversationServer.pinConversation(e).then((e=>{t("log","at pages/TUIKit/TUIPages/TUIConversation/conversation-list.vue:234",e)}))}r.dialogID="";break;case"dispinned":if("dispinned"===e){const e={conversationID:r.dialogID,isPinned:!1};uni.$TUIKit.TUIConversationServer.pinConversation(e).then((e=>{}))}r.dialogID="";break;case"mute":if("mute"===e&&"C2C"===r.conversationType){const e={userIDList:[r.currentuserID],messageRemindType:uni.$TIM.TYPES.MSG_REMIND_ACPT_NOT_NOTE};uni.$TUIKit.TUIConversationServer.muteConversation(e).then((e=>{t("log","at pages/TUIKit/TUIPages/TUIConversation/conversation-list.vue:260",e)}))}else if("mute"===e&&"GROUP"===r.conversationType){const e={groupID:r.currentuserID,messageRemindType:uni.$TIM.TYPES.MSG_REMIND_ACPT_NOT_NOTE};uni.$TUIKit.TUIConversationServer.muteConversation(e).then((e=>{t("log","at pages/TUIKit/TUIPages/TUIConversation/conversation-list.vue:270",e)}))}r.dialogID="";break;case"notMute":if("notMute"===e&&"C2C"===r.conversationType){const e={userIDList:[r.currentuserID],messageRemindType:uni.$TIM.TYPES.MSG_REMIND_ACPT_AND_NOTE};uni.$TUIKit.TUIConversationServer.muteConversation(e).then((e=>{t("log","at pages/TUIKit/TUIPages/TUIConversation/conversation-list.vue:284",e)}))}else if("notMute"===e&&"GROUP"===r.conversationType){const e={groupID:r.currentuserID,messageRemindType:uni.$TIM.TYPES.MSG_REMIND_ACPT_AND_NOTE};uni.$TUIKit.TUIConversationServer.muteConversation(e).then((e=>{t("log","at pages/TUIKit/TUIPages/TUIConversation/conversation-list.vue:294",e)}))}r.dialogID=""}},handlerIsOpened:e=>e.conversationID===r.doalogID?"right":"none"}}}),d=(e,t)=>{const n=e.__vccOpts||e;for(const[o,r]of t)n[o]=r;return n};const p=d(l,[["render",function(t,n,o,r,i,s){return e.openBlock(),e.createElementBlock("view",{class:"TUI-conversation-list",onClick:n[5]||(n[5]=e=>t.dialogID="")},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.conversationList,((o,r)=>(e.openBlock(),e.createElementBlock("view",{key:r},[e.createElementVNode("view",{class:e.normalizeClass(["TUI-conversation-item",[t.dialogID===o.conversationID&&"selected",o.isPinned&&"pinned"]]),onClick:e=>t.handleGotoItem(o),onLongpress:e=>t.handleItemLongpress(o)},[e.createElementVNode("aside",{class:"left"},[e.createElementVNode("img",{class:"avatar",src:t.handleItemAvator(o)},null,8,["src"]),o.unreadCount>0&&"AcceptNotNotify"!==o.messageRemindType?(e.openBlock(),e.createElementBlock("span",{key:0,class:"num"},e.toDisplayString(o.unreadCount>99?"99+":o.unreadCount),1)):e.createCommentVNode("",!0),o.unreadCount>0&&"AcceptNotNotify"===o.messageRemindType?(e.openBlock(),e.createElementBlock("span",{key:1,class:"num-notNotify"})):e.createCommentVNode("",!0)]),e.createElementVNode("main",{class:"content"},[e.createElementVNode("header",{class:"content-header"},[e.createElementVNode("label",null,[e.createElementVNode("p",{class:"name"},e.toDisplayString(t.handleItemName(o)),1)])]),e.createElementVNode("footer",{class:"content-footer"},[o.unreadCount>0&&"AcceptNotNotify"===o.messageRemindType?(e.openBlock(),e.createElementBlock("span",{key:0,class:"content-footer-unread"},"["+e.toDisplayString(o.unreadCount>99?"99+":o.unreadCount)+"条]",1)):e.createCommentVNode("",!0),e.createElementVNode("span",{class:"message-text"},e.toDisplayString(t.handleItemMessage(o.lastMessage)),1),e.createElementVNode("view",{class:"conversation-line"})]),e.createElementVNode("view",{class:"item-footer"},[e.createElementVNode("span",{class:"time"},e.toDisplayString(t.handleItemTime(o.lastMessage.lastTime)),1),"AcceptNotNotify"===o.messageRemindType?(e.openBlock(),e.createElementBlock("image",{key:0,class:"mute-icon",src:"/assets/mute.7e6900f5.svg"})):e.createCommentVNode("",!0)])]),o.conversationID===t.dialogID?(e.openBlock(),e.createElementBlock("view",{key:0,class:"dialog-box dialog-item"},[e.createElementVNode("view",{class:"conversation-options",onClick:n[0]||(n[0]=e.withModifiers((e=>t.handleConversation("delete",t.dialogID)),["stop"]))},"删除会话"),o.isPinned?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:0,class:"conversation-options",onClick:n[1]||(n[1]=e.withModifiers((e=>t.handleConversation("ispinned",t.dialogID)),["stop"]))},"置顶会话")),o.isPinned?(e.openBlock(),e.createElementBlock("view",{key:1,class:"conversation-options",onClick:n[2]||(n[2]=e.withModifiers((e=>t.handleConversation("dispinned",t.dialogID)),["stop"]))},"取消置顶")):e.createCommentVNode("",!0),""===o.messageRemindType||"AcceptAndNotify"===o.messageRemindType?(e.openBlock(),e.createElementBlock("view",{key:2,class:"conversation-options",onClick:n[3]||(n[3]=e.withModifiers((e=>t.handleConversation("mute",t.dialogID)),["stop"]))},"消息免打扰")):e.createCommentVNode("",!0),"AcceptNotNotify"===o.messageRemindType?(e.openBlock(),e.createElementBlock("view",{key:3,class:"conversation-options",onClick:n[4]||(n[4]=e.withModifiers((e=>t.handleConversation("notMute",t.dialogID)),["stop"]))},"取消免打扰")):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0)],42,["onClick","onLongpress"])])))),128))])}],["__scopeId","data-v-68e4333b"]]);const h=d(e.defineComponent({name:"dialog",props:{visible:{type:Boolean,default:()=>!1},styleConfig:{type:Object,default:()=>({width:"240px",padding:"16px",top:"10px",right:"10px"})},handleClose:{type:Function,default:()=>{}}},setup(e,t){}}),[["render",function(t,n,o,r,i,s){return t.visible?(e.openBlock(),e.createElementBlock("view",{key:0,class:"dialog",onClick:n[0]||(n[0]=(...e)=>t.handleClose&&t.handleClose(...e))},[e.createElementVNode("view",{class:"dialog-container",style:e.normalizeStyle(t.styleConfig)},[e.renderSlot(t.$slots,"default",{},void 0,!0)],4)])):e.createCommentVNode("",!0)}],["__scopeId","data-v-3fe5b611"]]);function g(){return"undefined"!=typeof navigator&&"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}}const f="function"==typeof Proxy;class _{constructor(e,t){this.target=null,this.targetQueue=[],this.onQueue=[],this.plugin=e,this.hook=t;const n={};if(e.settings)for(const i in e.settings){const t=e.settings[i];n[i]=t.defaultValue}const o=`__vue-devtools-plugin-settings__${e.id}`;let r={...n};try{const e=localStorage.getItem(o),t=JSON.parse(e);Object.assign(r,t)}catch(Io){}this.fallbacks={getSettings:()=>r,setSettings(e){try{localStorage.setItem(o,JSON.stringify(e))}catch(Io){}r=e}},t.on("plugin:settings:set",((e,t)=>{e===this.plugin.id&&this.fallbacks.setSettings(t)})),this.proxiedOn=new Proxy({},{get:(e,t)=>this.target?this.target.on[t]:(...e)=>{this.onQueue.push({method:t,args:e})}}),this.proxiedTarget=new Proxy({},{get:(e,t)=>this.target?this.target[t]:"on"===t?this.proxiedOn:Object.keys(this.fallbacks).includes(t)?(...e)=>(this.targetQueue.push({method:t,args:e,resolve:()=>{}}),this.fallbacks[t](...e)):(...e)=>new Promise((n=>{this.targetQueue.push({method:t,args:e,resolve:n})}))})}async setRealTarget(e){this.target=e;for(const t of this.onQueue)this.target.on[t.method](...t.args);for(const t of this.targetQueue)t.resolve(await this.target[t.method](...t.args))}}function m(e,t){const n=g(),o=g().__VUE_DEVTOOLS_GLOBAL_HOOK__,r=f&&e.enableEarlyProxy;if(!o||!n.__VUE_DEVTOOLS_PLUGIN_API_AVAILABLE__&&r){const i=r?new _(e,o):null;(n.__VUE_DEVTOOLS_PLUGINS__=n.__VUE_DEVTOOLS_PLUGINS__||[]).push({pluginDescriptor:e,setupFn:t,proxy:i}),i&&t(i.proxiedTarget)}else o.emit("devtools-plugin:setup",e,t)}
/*!
   * vuex v4.1.0
   * (c) 2022 Evan You
   * @license MIT
   */var v="store";function y(e,t){if(void 0===t&&(t=[]),null===e||"object"!=typeof e)return e;var n,o=(n=function(t){return t.original===e},t.filter(n)[0]);if(o)return o.copy;var r=Array.isArray(e)?[]:{};return t.push({original:e,copy:r}),Object.keys(e).forEach((function(n){r[n]=y(e[n],t)})),r}function M(e,t){Object.keys(e).forEach((function(n){return t(e[n],n)}))}function I(e){return null!==e&&"object"==typeof e}function C(e,t,n){return t.indexOf(e)<0&&(n&&n.prepend?t.unshift(e):t.push(e)),function(){var n=t.indexOf(e);n>-1&&t.splice(n,1)}}function T(e,t){e._actions=Object.create(null),e._mutations=Object.create(null),e._wrappedGetters=Object.create(null),e._modulesNamespaceMap=Object.create(null);var n=e.state;k(e,n,[],e._modules.root,!0),E(e,n,t)}function E(t,n,o){var r=t._state,i=t._scope;t.getters={},t._makeLocalGettersCache=Object.create(null);var s=t._wrappedGetters,a={},c={},u=e.effectScope(!0);u.run((function(){M(s,(function(n,o){a[o]=function(e,t){return function(){return e(t)}}(n,t),c[o]=e.computed((function(){return a[o]()})),Object.defineProperty(t.getters,o,{get:function(){return c[o].value},enumerable:!0})}))})),t._state=e.reactive({data:n}),t._scope=u,t.strict&&function(t){e.watch((function(){return t._state.data}),(function(){}),{deep:!0,flush:"sync"})}(t),r&&o&&t._withCommit((function(){r.data=null})),i&&i.stop()}function k(e,t,n,o,r){var i=!n.length,s=e._modules.getNamespace(n);if(o.namespaced&&(e._modulesNamespaceMap[s],e._modulesNamespaceMap[s]=o),!i&&!r){var a=S(t,n.slice(0,-1)),c=n[n.length-1];e._withCommit((function(){a[c]=o.state}))}var u=o.context=function(e,t,n){var o=""===t,r={dispatch:o?e.dispatch:function(n,o,r){var i=L(n,o,r),s=i.payload,a=i.options,c=i.type;return a&&a.root||(c=t+c),e.dispatch(c,s)},commit:o?e.commit:function(n,o,r){var i=L(n,o,r),s=i.payload,a=i.options,c=i.type;a&&a.root||(c=t+c),e.commit(c,s,a)}};return Object.defineProperties(r,{getters:{get:o?function(){return e.getters}:function(){return D(e,t)}},state:{get:function(){return S(e.state,n)}}}),r}(e,s,n);o.forEachMutation((function(t,n){!function(e,t,n,o){(e._mutations[t]||(e._mutations[t]=[])).push((function(t){n.call(e,o.state,t)}))}(e,s+n,t,u)})),o.forEachAction((function(t,n){var o=t.root?n:s+n,r=t.handler||t;!function(e,t,n,o){(e._actions[t]||(e._actions[t]=[])).push((function(t){var r,i=n.call(e,{dispatch:o.dispatch,commit:o.commit,getters:o.getters,state:o.state,rootGetters:e.getters,rootState:e.state},t);return(r=i)&&"function"==typeof r.then||(i=Promise.resolve(i)),e._devtoolHook?i.catch((function(t){throw e._devtoolHook.emit("vuex:error",t),t})):i}))}(e,o,r,u)})),o.forEachGetter((function(t,n){!function(e,t,n,o){if(e._wrappedGetters[t])return;e._wrappedGetters[t]=function(e){return n(o.state,o.getters,e.state,e.getters)}}(e,s+n,t,u)})),o.forEachChild((function(o,i){k(e,t,n.concat(i),o,r)}))}function D(e,t){if(!e._makeLocalGettersCache[t]){var n={},o=t.length;Object.keys(e.getters).forEach((function(r){if(r.slice(0,o)===t){var i=r.slice(o);Object.defineProperty(n,i,{get:function(){return e.getters[r]},enumerable:!0})}})),e._makeLocalGettersCache[t]=n}return e._makeLocalGettersCache[t]}function S(e,t){return t.reduce((function(e,t){return e[t]}),e)}function L(e,t,n){return I(e)&&e.type&&(n=t,t=e,e=e.type),{type:e,payload:t,options:n}}var A="vuex:mutations",R="vuex:actions",O="vuex",N=0;function w(e,t){m({id:"org.vuejs.vuex",app:e,label:"Vuex",homepage:"https://next.vuex.vuejs.org/",logo:"https://vuejs.org/images/icons/favicon-96x96.png",packageName:"vuex",componentStateTypes:["vuex bindings"]},(function(n){n.addTimelineLayer({id:A,label:"Vuex Mutations",color:b}),n.addTimelineLayer({id:R,label:"Vuex Actions",color:b}),n.addInspector({id:O,label:"Vuex",icon:"storage",treeFilterPlaceholder:"Filter stores..."}),n.on.getInspectorTree((function(n){if(n.app===e&&n.inspectorId===O)if(n.filter){var o=[];x(o,t._modules.root,n.filter,""),n.rootNodes=o}else n.rootNodes=[G(t._modules.root,"")]})),n.on.getInspectorState((function(n){if(n.app===e&&n.inspectorId===O){var o=n.nodeId;D(t,o),n.state=function(e,t,n){t="root"===n?t:t[n];var o=Object.keys(t),r={state:Object.keys(e.state).map((function(t){return{key:t,editable:!0,value:e.state[t]}}))};if(o.length){var i=function(e){var t={};return Object.keys(e).forEach((function(n){var o=n.split("/");if(o.length>1){var r=t,i=o.pop();o.forEach((function(e){r[e]||(r[e]={_custom:{value:{},display:e,tooltip:"Module",abstract:!0}}),r=r[e]._custom.value})),r[i]=F((function(){return e[n]}))}else t[n]=F((function(){return e[n]}))})),t}(t);r.getters=Object.keys(i).map((function(e){return{key:e.endsWith("/")?P(e):e,editable:!1,value:F((function(){return i[e]}))}}))}return r}((r=t._modules,(s=(i=o).split("/").filter((function(e){return e}))).reduce((function(e,t,n){var o=e[t];if(!o)throw new Error('Missing module "'+t+'" for path "'+i+'".');return n===s.length-1?o:o._children}),"root"===i?r:r.root._children)),"root"===o?t.getters:t._makeLocalGettersCache,o)}var r,i,s})),n.on.editInspectorState((function(n){if(n.app===e&&n.inspectorId===O){var o=n.nodeId,r=n.path;"root"!==o&&(r=o.split("/").filter(Boolean).concat(r)),t._withCommit((function(){n.set(t._state.data,r,n.state.value)}))}})),t.subscribe((function(e,t){var o={};e.payload&&(o.payload=e.payload),o.state=t,n.notifyComponentUpdate(),n.sendInspectorTree(O),n.sendInspectorState(O),n.addTimelineEvent({layerId:A,event:{time:Date.now(),title:e.type,data:o}})})),t.subscribeAction({before:function(e,t){var o={};e.payload&&(o.payload=e.payload),e._id=N++,e._time=Date.now(),o.state=t,n.addTimelineEvent({layerId:R,event:{time:e._time,title:e.type,groupId:e._id,subtitle:"start",data:o}})},after:function(e,t){var o={},r=Date.now()-e._time;o.duration={_custom:{type:"duration",display:r+"ms",tooltip:"Action duration",value:r}},e.payload&&(o.payload=e.payload),o.state=t,n.addTimelineEvent({layerId:R,event:{time:Date.now(),title:e.type,groupId:e._id,subtitle:"end",data:o}})}})}))}var b=8702998,U={label:"namespaced",textColor:16777215,backgroundColor:6710886};function P(e){return e&&"root"!==e?e.split("/").slice(-2,-1)[0]:"Root"}function G(e,t){return{id:t||"root",label:P(t),tags:e.namespaced?[U]:[],children:Object.keys(e._children).map((function(n){return G(e._children[n],t+n+"/")}))}}function x(e,t,n,o){o.includes(n)&&e.push({id:o||"root",label:o.endsWith("/")?o.slice(0,o.length-1):o||"Root",tags:t.namespaced?[U]:[]}),Object.keys(t._children).forEach((function(r){x(e,t._children[r],n,o+r+"/")}))}function F(e){try{return e()}catch(Io){return Io}}var q=function(e,t){this.runtime=t,this._children=Object.create(null),this._rawModule=e;var n=e.state;this.state=("function"==typeof n?n():n)||{}},B={namespaced:{configurable:!0}};B.namespaced.get=function(){return!!this._rawModule.namespaced},q.prototype.addChild=function(e,t){this._children[e]=t},q.prototype.removeChild=function(e){delete this._children[e]},q.prototype.getChild=function(e){return this._children[e]},q.prototype.hasChild=function(e){return e in this._children},q.prototype.update=function(e){this._rawModule.namespaced=e.namespaced,e.actions&&(this._rawModule.actions=e.actions),e.mutations&&(this._rawModule.mutations=e.mutations),e.getters&&(this._rawModule.getters=e.getters)},q.prototype.forEachChild=function(e){M(this._children,e)},q.prototype.forEachGetter=function(e){this._rawModule.getters&&M(this._rawModule.getters,e)},q.prototype.forEachAction=function(e){this._rawModule.actions&&M(this._rawModule.actions,e)},q.prototype.forEachMutation=function(e){this._rawModule.mutations&&M(this._rawModule.mutations,e)},Object.defineProperties(q.prototype,B);var V=function(e){this.register([],e,!1)};function K(e,t,n){if(t.update(n),n.modules)for(var o in n.modules){if(!t.getChild(o))return;K(e.concat(o),t.getChild(o),n.modules[o])}}function H(e){return new j(e)}V.prototype.get=function(e){return e.reduce((function(e,t){return e.getChild(t)}),this.root)},V.prototype.getNamespace=function(e){var t=this.root;return e.reduce((function(e,n){return e+((t=t.getChild(n)).namespaced?n+"/":"")}),"")},V.prototype.update=function(e){K([],this.root,e)},V.prototype.register=function(e,t,n){var o=this;void 0===n&&(n=!0);var r=new q(t,n);0===e.length?this.root=r:this.get(e.slice(0,-1)).addChild(e[e.length-1],r);t.modules&&M(t.modules,(function(t,r){o.register(e.concat(r),t,n)}))},V.prototype.unregister=function(e){var t=this.get(e.slice(0,-1)),n=e[e.length-1],o=t.getChild(n);o&&o.runtime&&t.removeChild(n)},V.prototype.isRegistered=function(e){var t=this.get(e.slice(0,-1)),n=e[e.length-1];return!!t&&t.hasChild(n)};var j=function(e){var t=this;void 0===e&&(e={});var n=e.plugins;void 0===n&&(n=[]);var o=e.strict;void 0===o&&(o=!1);var r=e.devtools;this._committing=!1,this._actions=Object.create(null),this._actionSubscribers=[],this._mutations=Object.create(null),this._wrappedGetters=Object.create(null),this._modules=new V(e),this._modulesNamespaceMap=Object.create(null),this._subscribers=[],this._makeLocalGettersCache=Object.create(null),this._scope=null,this._devtools=r;var i=this,s=this.dispatch,a=this.commit;this.dispatch=function(e,t){return s.call(i,e,t)},this.commit=function(e,t,n){return a.call(i,e,t,n)},this.strict=o;var c=this._modules.root.state;k(this,c,[],this._modules.root),E(this,c),n.forEach((function(e){return e(t)}))},z={state:{configurable:!0}};j.prototype.install=function(e,t){e.provide(t||v,this),e.config.globalProperties.$store=this,void 0!==this._devtools&&this._devtools&&w(e,this)},z.state.get=function(){return this._state.data},z.state.set=function(e){},j.prototype.commit=function(e,t,n){var o=this,r=L(e,t,n),i=r.type,s=r.payload,a={type:i,payload:s},c=this._mutations[i];c&&(this._withCommit((function(){c.forEach((function(e){e(s)}))})),this._subscribers.slice().forEach((function(e){return e(a,o.state)})))},j.prototype.dispatch=function(e,t){var n=this,o=L(e,t),r=o.type,i=o.payload,s={type:r,payload:i},a=this._actions[r];if(a){try{this._actionSubscribers.slice().filter((function(e){return e.before})).forEach((function(e){return e.before(s,n.state)}))}catch(Io){}var c=a.length>1?Promise.all(a.map((function(e){return e(i)}))):a[0](i);return new Promise((function(e,t){c.then((function(t){try{n._actionSubscribers.filter((function(e){return e.after})).forEach((function(e){return e.after(s,n.state)}))}catch(Io){}e(t)}),(function(e){try{n._actionSubscribers.filter((function(e){return e.error})).forEach((function(t){return t.error(s,n.state,e)}))}catch(Io){}t(e)}))}))}},j.prototype.subscribe=function(e,t){return C(e,this._subscribers,t)},j.prototype.subscribeAction=function(e,t){return C("function"==typeof e?{before:e}:e,this._actionSubscribers,t)},j.prototype.watch=function(t,n,o){var r=this;return e.watch((function(){return t(r.state,r.getters)}),n,Object.assign({},o))},j.prototype.replaceState=function(e){var t=this;this._withCommit((function(){t._state.data=e}))},j.prototype.registerModule=function(e,t,n){void 0===n&&(n={}),"string"==typeof e&&(e=[e]),this._modules.register(e,t),k(this,this.state,e,this._modules.get(e),n.preserveState),E(this,this.state)},j.prototype.unregisterModule=function(e){var t=this;"string"==typeof e&&(e=[e]),this._modules.unregister(e),this._withCommit((function(){delete S(t.state,e.slice(0,-1))[e[e.length-1]]})),T(this)},j.prototype.hasModule=function(e){return"string"==typeof e&&(e=[e]),this._modules.isRegistered(e)},j.prototype.hotUpdate=function(e){this._modules.update(e),T(this,!0)},j.prototype._withCommit=function(e){var t=this._committing;this._committing=!0,e(),this._committing=t},Object.defineProperties(j.prototype,z);var W=Z((function(e,t){var n={};return X(t).forEach((function(t){var o=t.key,r=t.val;n[o]=function(){var t=this.$store.state,n=this.$store.getters;if(e){var o=Q(this.$store,"mapState",e);if(!o)return;t=o.context.state,n=o.context.getters}return"function"==typeof r?r.call(this,t,n):t[r]},n[o].vuex=!0})),n})),Y=Z((function(e,t){var n={};return X(t).forEach((function(t){var o=t.key,r=t.val;n[o]=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var o=this.$store.commit;if(e){var i=Q(this.$store,"mapMutations",e);if(!i)return;o=i.context.commit}return"function"==typeof r?r.apply(this,[o].concat(t)):o.apply(this.$store,[r].concat(t))}})),n})),$=Z((function(e,t){var n={};return X(t).forEach((function(t){var o=t.key,r=t.val;r=e+r,n[o]=function(){if(!e||Q(this.$store,"mapGetters",e))return this.$store.getters[r]},n[o].vuex=!0})),n})),J=Z((function(e,t){var n={};return X(t).forEach((function(t){var o=t.key,r=t.val;n[o]=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var o=this.$store.dispatch;if(e){var i=Q(this.$store,"mapActions",e);if(!i)return;o=i.context.dispatch}return"function"==typeof r?r.apply(this,[o].concat(t)):o.apply(this.$store,[r].concat(t))}})),n}));function X(e){return function(e){return Array.isArray(e)||I(e)}(e)?Array.isArray(e)?e.map((function(e){return{key:e,val:e}})):Object.keys(e).map((function(t){return{key:t,val:e[t]}})):[]}function Z(e){return function(t,n){return"string"!=typeof t?(n=t,t=""):"/"!==t.charAt(t.length-1)&&(t+="/"),e(t,n)}}function Q(e,t,n){return e._modulesNamespaceMap[n]}function ee(e,t,n){var o=n?e.groupCollapsed:e.group;try{o.call(e,t)}catch(Io){e.log(t)}}function te(e){try{e.groupEnd()}catch(Io){e.log("—— log end ——")}}function ne(){var e=new Date;return" @ "+oe(e.getHours(),2)+":"+oe(e.getMinutes(),2)+":"+oe(e.getSeconds(),2)+"."+oe(e.getMilliseconds(),3)}function oe(e,t){return n="0",o=t-e.toString().length,new Array(o+1).join(n)+e;var n,o}var re={version:"4.1.0",Store:j,storeKey:v,createStore:H,useStore:function(t){return void 0===t&&(t=null),e.inject(null!==t?t:v)},mapState:W,mapMutations:Y,mapGetters:$,mapActions:J,createNamespacedHelpers:function(e){return{mapState:W.bind(null,e),mapGetters:$.bind(null,e),mapMutations:Y.bind(null,e),mapActions:J.bind(null,e)}},createLogger:function(e){void 0===e&&(e={});var t=e.collapsed;void 0===t&&(t=!0);var n=e.filter;void 0===n&&(n=function(e,t,n){return!0});var o=e.transformer;void 0===o&&(o=function(e){return e});var r=e.mutationTransformer;void 0===r&&(r=function(e){return e});var i=e.actionFilter;void 0===i&&(i=function(e,t){return!0});var s=e.actionTransformer;void 0===s&&(s=function(e){return e});var a=e.logMutations;void 0===a&&(a=!0);var c=e.logActions;void 0===c&&(c=!0);var u=e.logger;return void 0===u&&(u=console),function(e){var l=y(e.state);void 0!==u&&(a&&e.subscribe((function(e,i){var s=y(i);if(n(e,l,s)){var a=ne(),c=r(e),d="mutation "+e.type+a;ee(u,d,t),u.log("%c prev state","color: #9E9E9E; font-weight: bold",o(l)),u.log("%c mutation","color: #03A9F4; font-weight: bold",c),u.log("%c next state","color: #4CAF50; font-weight: bold",o(s)),te(u)}l=s})),c&&e.subscribeAction((function(e,n){if(i(e,n)){var o=ne(),r=s(e),a="action "+e.type+o;ee(u,a,t),u.log("%c action","color: #03A9F4; font-weight: bold",r),te(u)}})))}}};const ie=H({modules:{timStore:{namespaced:!0,state:{isLogin:!1,conversationList:[],messageList:[],conversation:{},conversationID:"",scrollTop:0},getters:{userInfo:e=>e.userInfo},mutations:{setscrollTop(e,t){e.scrollTop=t},setConversationList(e,t){e.conversationList=t},setConversation(e,t){e.conversation=t},setConversationID(e,t){e.conversationID=t},resetConversationID(e){e.conversationID=""},setMessageList(e,t){e.messageList=t},resetChat(e){e.messageList=[]}},actions:{}}}});class se{destroyed(){}updateStore(e,t){}}class ae extends se{constructor(e){super(),this.store=ie.state.timStore,this.TUICore=uni.$TUIKit,uni.setStorageSync(`TIM_${uni.$chat_SDKAppID}_isTUIKit`,!0),uni.$aegis&&uni.$aegis.reportEvent({name:"platform",ext1:"platform-APP-npm",ext2:"uniTuikitExternalVue3",ext3:`${uni.$chat_SDKAppID}`}),uni.showLoading({title:"加载中"}),this.bindTIMEvent(),uni.$chat_isSDKReady&&this.getConversationList()}bindTIMEvent(){this.TUICore.on(uni.$TIM.EVENT.CONVERSATION_LIST_UPDATED,this.handleConversationListUpdate,this)}unbindTIMEvent(){this.TUICore.off(uni.$TIM.EVENT.CONVERSATION_LIST_UPDATED,this.handleConversationListUpdate)}handleConversationListUpdate(e){uni.hideLoading(),0===e.data.length&&uni.showToast({title:"暂无回话哦～"}),ie.commit("timStore/setConversationList",e.data)}destroyed(){this.unbindTIMEvent()}async getConversationList(){return new Promise((async(e,t)=>{try{const t=await uni.$TUIKit.getConversationList();ie.commit("timStore/setConversationList",t.data.conversationList),uni.hideLoading(),e(t)}catch(n){t(n)}}))}async getConversationProfile(e){return new Promise((async(t,n)=>{try{t(await this.TUICore.getConversationProfile(e))}catch(o){n(o)}}))}async deleteConversation(e){return new Promise((async(t,n)=>{try{t(await this.TUICore.deleteConversation(e))}catch(o){n(o)}}))}async pinConversation(e){return new Promise((async(t,n)=>{try{t(await this.TUICore.pinConversation(e))}catch(o){n(o)}}))}async muteConversation(e){return new Promise((async(t,n)=>{try{t(await this.TUICore.setMessageRemindType(e))}catch(o){n(o)}}))}async setMessageRead(e){return new Promise((async(t,n)=>{try{t(await this.TUICore.setMessageRead({conversationID:e}))}catch(o){n(o)}}))}}class ce extends se{constructor(e){super(),this.currentStore={},this.store=ie.state.timStore,this.TUICore=uni.$TUIKit,this.bindTIMEvent(),this.updateStore()}destroyed(){this.unbindTIMEvent()}updateStore(){this.getMessageList({conversationID:this.store.conversationID,count:15}),ie.commit("timStore/resetChat")}bindTIMEvent(){this.TUICore.on(uni.$TIM.EVENT.MESSAGE_RECEIVED,this.handleMessageReceived,this),this.TUICore.on(uni.$TIM.EVENT.MESSAGE_MODIFIED,this.handleMessageModified,this),this.TUICore.on(uni.$TIM.EVENT.MESSAGE_REVOKED,this.handleMessageRevoked,this),this.TUICore.on(uni.$TIM.EVENT.MESSAGE_READ_BY_PEER,this.handleMessageReadByPeer,this),this.TUICore.on(uni.$TIM.EVENT.GROUP_LIST_UPDATED,this.handleGroupListUpdated,this)}unbindTIMEvent(){this.TUICore.off(uni.$TIM.EVENT.MESSAGE_RECEIVED,this.handleMessageReceived),this.TUICore.off(uni.$TIM.EVENT.MESSAGE_MODIFIED,this.handleMessageModified),this.TUICore.off(uni.$TIM.EVENT.MESSAGE_REVOKED,this.handleMessageRevoked),this.TUICore.off(uni.$TIM.EVENT.MESSAGE_READ_BY_PEER,this.handleMessageReadByPeer),this.TUICore.off(uni.$TIM.EVENT.GROUP_LIST_UPDATED,this.handleGroupListUpdated,this)}handleMessageReceived(e){e.data.forEach((e=>{if(e.conversationID===this.store.conversationID){uni.$TUIKit.TUIConversationServer.setMessageRead(e.conversationID);const t=[...this.store.messageList,e];ie.commit("timStore/setMessageList",t)}}))}handleMessageModified(e){const t=this.store.messageList;this.store.messageList=[],this.store.messageList=t}handleMessageRevoked(e){}async handleMessageReadByPeer(e){const t=this.store.messageList;await ie.commit("timStore/resetChat"),await ie.commit("timStore/setMessageList",t)}handleGroupListUpdated(e){null==e||e.data.map((e=>{var t,n,o;if((null==e?void 0:e.groupID)===(null==(o=null==(n=null==(t=null==this?void 0:this.store)?void 0:t.conversation)?void 0:n.groupProfile)?void 0:o.groupID)){this.store.conversation.groupProfile=e;const t=this.store.conversation;this.store.conversation={},this.store.conversation=t}return e}))}handleMessageOptions(e,t,n,o){var r,i,s,a,c,u;const l={to:"",conversationType:(null==o?void 0:o.type)||this.store.conversation.type,payload:e,needReadReceipt:!0};switch("file"===t&&n&&(l.onProgress=n),l.conversationType){case uni.$TIM.TYPES.CONV_C2C:l.to=(null==(r=null==o?void 0:o.userProfile)?void 0:r.userID)||(null==(s=null==(i=this.store.conversation)?void 0:i.userProfile)?void 0:s.userID)||"";break;case uni.$TIM.TYPES.CONV_GROUP:l.to=(null==(a=null==o?void 0:o.groupProfile)?void 0:a.groupID)||(null==(u=null==(c=this.store.conversation)?void 0:c.groupProfile)?void 0:u.groupID)||""}return l}handlePromiseCallback(e){return new Promise(((e,t)=>{}))}handleUploadProgress(e,t){this.store.messageList.map((n=>(n.ID===t.ID&&(n.progress=e),n)))}sendTextMessage(e){return new Promise((async(t,n)=>{try{const n=this.handleMessageOptions({text:e},"text"),o=this.TUICore.createTextMessage(n),r=[...this.store.messageList,o];ie.commit("timStore/setMessageList",r);const i=await this.TUICore.sendMessage(o);this.store.messageList=this.store.messageList.map((e=>e.ID===i.data.message.ID?i.data.message:e)),t(i)}catch(o){n(o);const e=this.store.messageList;ie.commit("timStore/resetChat"),ie.commit("timStore/setMessageList",e)}}))}sendFaceMessage(e){return new Promise((async(t,n)=>{try{const n=this.handleMessageOptions(e,"face"),o=this.TUICore.createFaceMessage(n),r=[...this.store.messageList,o];ie.commit("timStore/setMessageList",r);const i=await this.TUICore.sendMessage(o);this.store.messageList=this.store.messageList.map((e=>e.ID===i.data.message.ID?i.data.message:e)),t(i)}catch(o){n(o)}}))}sendImageMessage(e,t){return new Promise((async(n,o)=>{try{const o=this.handleMessageOptions({file:e},"file"),r=this.TUICore.createImageMessage(o);r.payload.imageInfoArray[1].height=t.height,r.payload.imageInfoArray[1].width=t.width;const i=[...this.store.messageList,r];ie.commit("timStore/setMessageList",i);const s=await this.TUICore.sendMessage(r);this.store.messageList=this.store.messageList.map((e=>e.ID===s.data.message.ID?s.data.message:e)),n(s)}catch(r){o(r)}}))}sendVideoMessage(e,t){return new Promise((async(t,n)=>{try{const n=this.handleMessageOptions({file:e},"file"),o=this.TUICore.createVideoMessage(n),r=[...this.store.messageList,o];ie.commit("timStore/setMessageList",r);const i=await this.TUICore.sendMessage(o);this.store.messageList=this.store.messageList.map((e=>e.ID===i.data.message.ID?i.data.message:e)),t(i)}catch(o){n(o)}}))}sendAudioMessage(e){return new Promise((async(n,o)=>{try{const o=this.handleMessageOptions({file:e},"file",(e=>{this.handleUploadProgress(e,r)})),r=this.TUICore.createAudioMessage(o),i=[...this.store.messageList,r];ie.commit("timStore/setMessageList",i);const s=await this.TUICore.sendMessage(r);t("log","at pages/TUIKit/TUICore/server/chat/index.ts:384","发送音频消息完成",s),this.store.messageList=this.store.messageList.map((e=>e.ID===s.data.message.ID?s.data.message:e)),n(s)}catch(r){o(r)}}))}sendFileMessage(e){return this.handlePromiseCallback((async(n,o)=>{try{const o=this.handleMessageOptions({file:e},"file",(e=>{this.handleUploadProgress(e,r)})),r=this.TUICore.createFileMessage(o);this.currentStore.messageList.push(r);const i=await this.TUICore.sendMessage(r);t("log","at pages/TUIKit/TUICore/server/chat/index.ts:417","发送文件消息完成",i),this.store.messageList=this.store.messageList.map((e=>e.ID===i.data.message.ID?i.data.message:e)),n(i)}catch(r){o(r)}}))}sendCustomMessage(e){return this.handlePromiseCallback((async(n,o)=>{try{const o=this.handleMessageOptions(e,"custom"),r=this.TUICore.createCustomMessage(o);this.currentStore.messageList.push(r);const i=await this.TUICore.sendMessage(r);t("log","at pages/TUIKit/TUICore/server/chat/index.ts:447","发送自定义消息完成",i),this.store.messageList=this.store.messageList.map((e=>e.ID===i.data.message.ID?i.data.message:e)),n(i)}catch(r){o(r)}}))}sendLocationMessage(e){return this.handlePromiseCallback((async(n,o)=>{try{const o=this.handleMessageOptions(e,"location"),r=this.TUICore.createLocationMessage(o);this.store.messageList.push(r);const i=await this.TUICore.sendMessage(r);t("log","at pages/TUIKit/TUICore/server/chat/index.ts:477","发送地理位置消息完成",i),n(i)}catch(r){o(r)}}))}forwardMessage(e,n){return this.handlePromiseCallback((async(o,r)=>{try{const r=this.handleMessageOptions(e,"forward",{},n),i=this.TUICore.createForwardMessage(r),s=await this.TUICore.sendMessage(i);this.store.conversation.conversationID===s.data.message.conversationID&&this.store.messageList.push(s.data.message),t("log","at pages/TUIKit/TUICore/server/chat/index.ts:504","消息转发完成",s),o(s)}catch(i){r(i)}}))}sendTextAtMessage(e){return new Promise((async(t,n)=>{try{const n=this.handleMessageOptions(e,"text"),o=this.TUICore.createTextAtMessage(n);this.currentStore.messageList.push(o);const r=await this.TUICore.sendMessage(o);this.currentStore.messageList=this.currentStore.messageList.map((e=>e.ID===r.data.message.ID?r.data.message:e)),t(r)}catch(o){n(o)}}))}sendMergerMessage(e){return this.handlePromiseCallback((async(n,o)=>{try{const o=this.handleMessageOptions(e,"merger"),r=this.TUICore.createMergerMessage(o);this.currentStore.messageList.push(r);const i=await this.TUICore.sendMessage(r);t("log","at pages/TUIKit/TUICore/server/chat/index.ts:561","发送合并消息完成",i),this.currentStore.messageList=this.currentStore.messageList.map((e=>e.ID===i.data.message.ID?i.data.message:e)),n(i)}catch(r){o(r)}}))}async getMessageList(e,t){return new Promise((async(n,o)=>{try{const o=await this.TUICore.getMessageList(e);let r;r=t?[...o.data.messageList,...this.store.messageList]:o.data.messageList,this.currentStore.nextReqMessageID=o.data.nextReqMessageID,this.currentStore.isCompleted=o.data.isCompleted,ie.commit("timStore/setMessageList",r),n(o.data)}catch(r){o(r)}}))}async getHistoryMessageList(){return new Promise((async(e,t)=>{try{const t={conversationID:this.store.conversation.conversationID,nextReqMessageID:this.currentStore.nextReqMessageID,count:15};let n=[];this.currentStore.isCompleted||(n=await this.getMessageList(t,!0)),e(n)}catch(n){t(n)}}))}revokeMessage(e){return new Promise((async(t,n)=>{try{t(await this.TUICore.revokeMessage(e))}catch(o){n(o)}}))}resendMessage(e){return new Promise((async(n,o)=>{try{const o=await this.TUICore.resendMessage(e);t("log","at pages/TUIKit/TUICore/server/chat/index.ts:658","消息重发完成",o);let r=[];r=this.store.messageList.filter((t=>t.ID!==e.ID)),ie.commit("timStore/setMessageList",r),n(o)}catch(r){o(r)}}))}deleteMessage(e){return new Promise((async(t,n)=>{try{const n=await this.TUICore.deleteMessage(e);let o=[];o=this.store.messageList.filter((t=>t.ID!==e.ID)),ie.commit("timStore/setMessageList",o),t(n)}catch(o){n(o)}}))}}class ue extends se{constructor(e){super(),this.store=ie.state.timStore,this.currentStore={},this.TUICore=uni.$TUIKit,this.bindTIMEvent()}destroyed(){this.unbindTIMEvent()}updateStore(e,t){this.currentStore.groupList=e.groupList,this.currentStore.searchGroup=e.searchGroup}bindTIMEvent(){this.TUICore.on(uni.$TIM.EVENT.GROUP_LIST_UPDATED,this.handleGroupListUpdated,this),this.TUICore.on(uni.$TIM.EVENT.GROUP_ATTRIBUTES_UPDATED,this.handleGroupAttributesUpdated,this)}unbindTIMEvent(){this.TUICore.off(uni.$TIM.EVENT.GROUP_LIST_UPDATED,this.handleGroupListUpdated),this.TUICore.off(uni.$TIM.EVENT.GROUP_ATTRIBUTES_UPDATED,this.handleGroupAttributesUpdated)}handleGroupListUpdated(e){}handleGroupAttributesUpdated(e){const{groupID:n,groupAttributes:o}=e.data;t("log","at pages/TUIKit/TUICore/server/group/index.ts:76",n,o)}}class le extends se{constructor(e){super(),this.store=ie.state.timStore,this.currentStore={},this.TUICore=uni.$TUIKit,this.bindTIMEvent()}destroyed(){this.unbindTIMEvent()}bindTIMEvent(){this.TUICore.on(uni.$TIM.EVENT.PROFILE_UPDATED,this.handleProfileUpdated,this)}unbindTIMEvent(){this.TUICore.off(uni.$TIM.EVENT.PROFILE_UPDATED,this.handleProfileUpdated)}handleProfileUpdated(e){}}const de=e.defineComponent({name:"TUIConversation",components:{TUIConversationList:p,Dialog:h},setup(t){const n=ie.state.timStore;uni.$TUIKit.TUIConversationServer=new ae,uni.$TUIKit.TUIProfileServer=new le;const r=e.reactive({conversationList:e.computed((()=>n.conversationList)),currrentConversationID:"",open:!1,searchUserID:"",selectedList:[],searchUserList:[],step:1,showDialog:!1,item:{flow:"out",status:"success"},styleConfig:{width:"150px",padding:"16px 16px 0px",top:"8px",right:"8px"},chatList:[{imgType:"SINGLE",type:uni.$TIM.TYPES.CONV_C2C,id:1,content:"发起会话"},{imgType:"GROUP",type:uni.$TIM.TYPES.GRP_WORK,id:1,content:"工作群"},{imgType:"GROUP",type:uni.$TIM.TYPES.GRP_PUBLIC,id:2,content:"社交群"},{imgType:"GROUP",type:uni.$TIM.TYPES.GRP_MEETING,id:3,content:"会议群"}]});s((()=>{uni.$TUIKit.TUIConversationServer.destroyed()})),c((()=>{r.showDialog=!r.showDialog})),o((()=>{ie.commit("timStore/setConversationID","")}));const i=e=>{var t,n;let o="";switch(e.type){case uni.$TIM.TYPES.CONV_C2C:o=(null==e?void 0:e.userProfile.nick)||(null==(t=null==e?void 0:e.userProfile)?void 0:t.userID)||"";break;case uni.$TIM.TYPES.CONV_GROUP:o=e.groupProfile.name||(null==(n=null==e?void 0:e.groupProfile)?void 0:n.groupID)||"";break;case uni.$TIM.TYPES.CONV_SYSTEM:o="系统通知"}return o};return{...e.toRefs(r),handleCurrrentConversation:e=>{r.currrentConversationID=e.conversationID,ie.commit("timStore/setConversationID",e.conversationID),uni.navigateTo({url:`../TUIChat/index?conversationName=${i(e)}`}),uni.$TUIKit.TUIConversationServer.setMessageRead(e.conversationID);const t=r.conversationList.filter((t=>t.conversationID===e.conversationID));ie.commit("timStore/setConversation",t),uni.$TUIKit.TUIConversationServer.getConversationProfile(e.conversationID).then((e=>{ie.commit("timStore/setConversation",e.data.conversation)}))},handleContentClick:e=>{r.showDialog=!1,uni.navigateTo({url:`../TUIConversation/create?title=${e.content}&type=${e.type}`})},handleItemName:i,handleClose:()=>{r.showDialog=!1},handleShow:()=>{r.showDialog=!0}}}});const pe=d(de,[["render",function(t,n,o,r,i,s){const a=e.resolveComponent("Dialog"),c=e.resolveComponent("TUIConversationList");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(a,{visible:t.showDialog,styleConfig:t.styleConfig,handleClose:t.handleClose},{default:e.withCtx((()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.chatList,((n,o)=>(e.openBlock(),e.createElementBlock("view",{key:o,class:"chat-container",onClick:e.withModifiers((e=>t.handleContentClick(n)),["stop"])},["SINGLE"===n.imgType?(e.openBlock(),e.createElementBlock("image",{key:0,class:"item-icon",src:"/assets/singlePerson.59f1319b.svg"})):(e.openBlock(),e.createElementBlock("image",{key:1,class:"item-icon",src:"/assets/multiPerson.63026248.svg"})),e.createElementVNode("view",null,e.toDisplayString(n.content),1)],8,["onClick"])))),128))])),_:1},8,["visible","styleConfig","handleClose"]),e.createElementVNode("view",{class:"TUI-conversation"},[e.createElementVNode("view",{class:"create-group",onClick:n[0]||(n[0]=(...e)=>t.handleShow&&t.handleShow(...e))}," + 发起聊天"),e.createVNode(c,{currentID:t.currrentConversationID,conversationList:t.conversationList,onHandleGotoItem:t.handleCurrrentConversation},null,8,["currentID","conversationList","onHandleGotoItem"])])],64)}],["__scopeId","data-v-fe199ba6"]]),he="/assets/selected.2c312a9c.svg",ge=e.defineComponent({name:"Create",props:{},setup(n,o){const i=uni.$TUIKit.TUIConversationServer,{userInfo:s}=ie.state.timStore,a=e.reactive({userID:(null==s?void 0:s.userID)||"",inputUserID:"",chooseUserList:[],title:"发起会话",myProfile:{},type:uni.$TIM.TYPES.CONV_C2C});r((e=>{a.title=e&&e.title||"发起会话",a.type=e&&e.type||uni.$TIM.TYPES.CONV_C2C}));const c=e=>{ie.commit("timStore/setConversationID",e),i.setMessageRead(e),i.getConversationProfile(e).then((n=>{var o;const{conversation:r}=n.data;t("log","at pages/TUIKit/TUIPages/TUIConversation/create.vue:220","create conversation response = ",n),ie.commit("timStore/setConversation",r);let i="../TUIChat/index";if("GROUP"===e.slice(0,5)){const{name:e}=r.groupProfile;i=`${i}?conversationName=${e}`}else"C2C"===e.slice(0,3)&&(r.userProfile,i=`${i}?conversationName=${(null==(o=r.userProfile.nick)?void 0:o.nick)||r.userProfile.userID}`);uni.redirectTo({url:i})})).catch((e=>{t("warn","at pages/TUIKit/TUIPages/TUIConversation/create.vue:236","获取 group profile 异常 = ",e)}))};return{...e.toRefs(a),handleUserIdInput:e=>{a.inputUserID=e.detail.value,uni.$TUIKit.getMyProfile().then((e=>{a.myProfile=e.data})).catch((e=>{t("warn","at pages/TUIKit/TUIPages/TUIConversation/create.vue:90","getMyProfile error:",e)}))},handleGetUserProfileInfo:()=>{if(!a.inputUserID)return;const e=[a.inputUserID];uni.showLoading({title:"加载中"}),uni.$TUIKit.getUserProfile({userIDList:e}).then((e=>{if(uni.hideLoading(),e.data.length>0){const t={...e.data[0],isChoose:!1};0===a.chooseUserList.filter((e=>t.userID===e.userID)).length&&a.chooseUserList.push(t)}else uni.showToast({title:"搜索用户不存在",icon:"error"}),a.inputUserID=""})).catch((e=>{uni.hideLoading()}))},handleChoose:e=>{const t=a.chooseUserList.map((t=>e.userID==t.userID?{...t,isChoose:!t.isChoose}:t));a.chooseUserList=t},handleCreateGroup:()=>{var e,t;const n=a.chooseUserList.filter((e=>e.isChoose));if(n.length>0)switch(a.type){case uni.$TIM.TYPES.CONV_C2C:if(n.length>1)return void uni.showToast({title:"“发起会话”仅能选择一个用户",icon:"none"});{const e=`C2C${n[0].userID}`;c(e)}break;case uni.$TIM.TYPES.GRP_WORK:case uni.$TIM.TYPES.GRP_PUBLIC:case uni.$TIM.TYPES.GRP_MEETING:{let o="";o=n.length>2?n.slice(0,3).map((e=>e.nick||e.userID)).join(",")||"":n.map((e=>e.nick||e.userID)).join(",")+"、"+((null==(e=a.myProfile)?void 0:e.nick)||(null==(t=a.myProfile)?void 0:t.userID));const r={avatar:"https://web.sdk.qcloud.com/component/TUIKit/assets/group_avatar.png",type:a.type,name:o,memberList:n.map((e=>({userID:e.userID,role:e.role,memberCustomField:e.memberCustomField})))};uni.showLoading({title:"群组创建中…"}),uni.$TUIKit.createGroup(r).then((e=>{uni.hideLoading();const{groupID:t}=e.data&&e.data.group;if(t){c(`GROUP${t}`)}})).catch((e=>{uni.showToast({title:"群组创建失败！"}),uni.hideLoading()}));break}}else uni.showToast({title:"请选择相关用户",icon:"none"})}}}});const fe=d(ge,[["render",function(t,n,o,r,i,s){return e.openBlock(),e.createElementBlock("view",{class:"TUI-Create-conversation-container"},[e.createElementVNode("view",{class:"tui-search-area"},[e.createElementVNode("view",{class:"tui-search-bar"},[e.createElementVNode("input",{class:"tui-search-bar-input",value:t.inputUserID,placeholder:"请输入用户ID",onInput:n[0]||(n[0]=(...e)=>t.handleUserIdInput&&t.handleUserIdInput(...e)),onConfirm:n[1]||(n[1]=(...e)=>t.handleGetUserProfileInfo&&t.handleGetUserProfileInfo(...e)),onBlur:n[2]||(n[2]=(...e)=>t.handleGetUserProfileInfo&&t.handleGetUserProfileInfo(...e))},null,40,["value"])]),e.createElementVNode("view",{class:"tui-showID"})]),e.createElementVNode("view",{class:"tui-person-list-container"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.chooseUserList,((n,o)=>(e.openBlock(),e.createElementBlock("view",{class:"tui-person-to-invite",key:o,onClick:e=>t.handleChoose(n)},[e.createElementVNode("view",{class:"tui-person-choose-container"},[n.isChoose?(e.openBlock(),e.createElementBlock("image",{key:0,class:"tui-normal-choose",src:he})):(e.openBlock(),e.createElementBlock("view",{key:1,class:"tui-normal-unchoose"}))]),e.createElementVNode("view",{class:"tui-person-profile"},[e.createElementVNode("image",{class:"tui-person-profile-avatar",src:n.avatar||"https://sdk-web-1252463788.cos.ap-hongkong.myqcloud.com/component/TUIKit/assets/avatar_21.png"},null,8,["src"]),e.createElementVNode("view",null,[e.createElementVNode("view",{class:"tui-person-profile-nick"},e.toDisplayString(n.nick),1),e.createElementVNode("view",{class:"tui-person-profile-userID"},"用户ID："+e.toDisplayString(n.userID),1)])])],8,["onClick"])))),128))]),e.createElementVNode("view",{class:"tui-confirm-btn-container"},[e.createElementVNode("view",{class:"tui-confirm-btn",onClick:n[3]||(n[3]=(...e)=>t.handleCreateGroup&&t.handleCreateGroup(...e))},"确认创建")])])}],["__scopeId","data-v-d2091ab8"]]);const _e=d(e.defineComponent({props:{data:{type:Object,default:()=>({})}},setup(t,n){const o=e.reactive({message:{},show:!1});e.watchEffect((()=>{o.message=t.data}));return{...e.toRefs(o),toggleDialog:()=>{o.show=!o.show}}}}),[["render",function(t,n,o,r,i,s){var a;return e.openBlock(),e.createElementBlock("view",{class:e.normalizeClass(["message-bubble",["in"===t.message.flow?"":"reverse"]])},[e.createElementVNode("image",{class:"avatar",src:(null==(a=t.message)?void 0:a.avatar)||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png",alt:""},null,8,["src"]),e.createElementVNode("view",{class:"message-area"},["in"===t.message.flow?(e.openBlock(),e.createElementBlock("label",{key:0,class:"name"},e.toDisplayString(t.message.nick),1)):e.createCommentVNode("",!0),e.createElementVNode("div",{class:e.normalizeClass(["content content-"+t.message.flow])},[e.renderSlot(t.$slots,"default",{},void 0,!0)],2)]),"fail"===t.message.status?(e.openBlock(),e.createElementBlock("view",{key:0,class:"message-label fail"},"!")):e.createCommentVNode("",!0),"C2C"===t.message.conversationType&&"out"==t.message.flow&&"fail"!==t.message.status?(e.openBlock(),e.createElementBlock("view",{key:1,class:e.normalizeClass(["message-label",[!t.message.isPeerRead&&"unRead"]])},[t.message.isPeerRead?(e.openBlock(),e.createElementBlock("span",{key:1},"已读")):(e.openBlock(),e.createElementBlock("span",{key:0},"未读"))],2)):e.createCommentVNode("",!0)],2)}],["__scopeId","data-v-cb51a64a"]]);const me=d(e.defineComponent({props:{data:{type:Object,default:()=>({})},messageData:{type:Object,default:()=>({})}},setup(t,n){const o=e.reactive({data:{},message:{}});return e.watchEffect((()=>{o.data=t.data,o.message=t.messageData})),{...e.toRefs(o)}}}),[["render",function(t,n,o,r,i,s){return e.openBlock(),e.createElementBlock("view",{class:e.normalizeClass(["content content-"+t.message.flow])},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.data.text,((t,n)=>(e.openBlock(),e.createElementBlock("view",{key:n},["text"===t.name?(e.openBlock(),e.createElementBlock("view",{key:0},e.toDisplayString(t.text),1)):"img"===t.name?(e.openBlock(),e.createElementBlock("img",{key:1,class:"text-img",src:t.src},null,8,["src"])):e.createCommentVNode("",!0)])))),128))],2)}],["__scopeId","data-v-059b5776"]]);const ve=d(e.defineComponent({props:{data:{type:Array,default:()=>[]},messageData:{type:Object,default:()=>({})}},setup(n,o){const r=e.reactive({imageInfo:[],imageHeight:0,imageWidth:0,message:{}});e.watchEffect((()=>{const e=155;let t=0,o=0;r.message=n.messageData,r.imageInfo=n.data.info[1],r.imageInfo.width>=r.imageInfo.height?(t=e,o=e*r.imageInfo.height/r.imageInfo.width):(t=e*r.imageInfo.width/r.imageInfo.height,o=e),r.imageWidth=t+"px",r.imageHeight=o+"px"}));return{...e.toRefs(r),handlePreviewImage:()=>{t("error","at pages/TUIKit/TUIPages/TUIChat/components/message-elements/message-image.vue:59",n.data.info[0].url,"----linda"),uni.previewImage({current:n.data.info[0].url,urls:[n.data.info[0].url]})}}}}),[["render",function(t,n,o,r,i,s){return e.openBlock(),e.createElementBlock("view",{class:"message-image",onClick:n[0]||(n[0]=(...e)=>t.handlePreviewImage&&t.handlePreviewImage(...e))},[e.createElementVNode("image",{src:t.data.info[1].url,style:e.normalizeStyle({height:t.imageHeight,width:t.imageWidth}),class:e.normalizeClass(["content-"+t.message.flow])},null,14,["src"])])}],["__scopeId","data-v-377b4a0a"]]),ye=e.defineComponent({props:{data:{type:Object,default:()=>({})}},setup(t,n){const o=uni.$TUIKit.TUIChatServer,r=e.reactive({message:{}});e.watchEffect((()=>{r.message=t.data}));return{...e.toRefs(r),handleMseeage:async e=>{switch(e){case"revoke":await o.revokeMessage(r.message).catch((e=>{(e.code=20016)&&uni.showToast({title:"消息超过了 2 分钟",icon:"error"})})),r.dialogID="";break;case"delete":await o.deleteMessage([r.message]),r.dialogID="";break;case"resend":await o.resendMessage(r.message),r.dialogID=""}}}}});const Me=d(ye,[["render",function(t,n,o,r,i,s){return e.openBlock(),e.createElementBlock("view",{class:"dialog-container"},["out"===t.message.flow&&"success"===t.message.status?(e.openBlock(),e.createElementBlock("view",{key:0,class:"item-box",onClick:n[0]||(n[0]=e=>t.handleMseeage("revoke"))},[e.createElementVNode("image",{class:"item-icon",src:"/assets/revoked.7c9df1a1.svg"}),e.createElementVNode("view",null,"撤回")])):e.createCommentVNode("",!0),"success"===t.message.status?(e.openBlock(),e.createElementBlock("view",{key:1,class:"item-box",onClick:n[1]||(n[1]=e=>t.handleMseeage("delete"))},[e.createElementVNode("image",{class:"item-icon",src:"/assets/delete.f7e3358f.svg"}),e.createElementVNode("view",null,"删除")])):e.createCommentVNode("",!0),"out"===t.message.flow&&"fail"===t.message.status?(e.openBlock(),e.createElementBlock("view",{key:2,class:"item-box",onClick:n[2]||(n[2]=e=>t.handleMseeage("resend"))},[e.createElementVNode("image",{class:"item-icon",src:"/assets/forword.ae89e5df.svg"}),e.createElementVNode("view",null,"重发")])):e.createCommentVNode("",!0)])}],["__scopeId","data-v-0097d3c0"]]),Ie=e.defineComponent({props:{data:{type:Object,default:()=>({})},messageData:{type:Object,default:()=>({})}},setup(t,n){const o=e.reactive({video:{},message:{},show:!1,videoContext:null});e.watchEffect((()=>{o.video=t.data,o.message=t.messageData}));return{...e.toRefs(o),toggleShow:()=>{uni.navigateTo({url:`./components/message-elements/video-play?videoMessage=${o.video.url}`})}}}});const Ce=d(Ie,[["render",function(t,n,o,r,i,s){return e.openBlock(),e.createElementBlock("div",{class:"message-video"},[e.createElementVNode("div",{class:e.normalizeClass(["message-video-box",[!t.video.progress&&"message-video-cover"]]),onClick:n[0]||(n[0]=(...e)=>t.toggleShow&&t.toggleShow(...e))},[e.createElementVNode("image",{src:t.video.snapshotUrl,class:e.normalizeClass(["message-video-box",["content-"+t.message.flow]])},null,10,["src"]),e.createElementVNode("image",{src:"/assets/play_normal@2x.58b451c9.png",class:"video-play"})],2)])}],["__scopeId","data-v-933956f0"]]),Te=uni.createInnerAudioContext(),Ee=e.defineComponent({props:{data:{type:Object,default:()=>({})},messageData:{type:Object,default:()=>({})}},setup(n,o){const r=e.reactive({data:{},message:{},isPlay:!1});e.watchEffect((()=>{r.data=n.data,r.message=n.messageData})),e.onMounted((()=>{Te.onPlay((()=>{t("log","at pages/TUIKit/TUIPages/TUIChat/components/message-elements/message-audio.vue:43","开始播放")})),Te.onEnded((()=>{t("log","at pages/TUIKit/TUIPages/TUIChat/components/message-elements/message-audio.vue:46","停止播放")})),Te.onError((e=>{t("error","at pages/TUIKit/TUIPages/TUIChat/components/message-elements/message-audio.vue:49",e,"onError"),uni.showToast({icon:"none",title:"该音频暂不支持播放"})}))}));return{...e.toRefs(r),audio:Te,handlePlay:()=>{r.data.url&&(Te.src=r.data.url,Te.play()),r.isPlay=!0}}}}),ke="/assets/audio-play.949caa88.svg";const De=d(Ee,[["render",function(t,n,o,r,i,s){return e.openBlock(),e.createElementBlock("view",{class:e.normalizeClass(["message-audio",["content content-"+t.message.flow]]),onClick:n[0]||(n[0]=(...e)=>t.handlePlay&&t.handlePlay(...e))},["in"===t.message.flow?(e.openBlock(),e.createElementBlock("image",{key:0,class:"audio-icon audio-icon-in",src:ke})):e.createCommentVNode("",!0),e.createElementVNode("view",null,e.toDisplayString(t.data.second)+"s",1),"out"===t.message.flow?(e.openBlock(),e.createElementBlock("image",{key:1,class:"audio-icon",src:ke})):e.createCommentVNode("",!0)],2)}],["__scopeId","data-v-2c34ed7c"]]);const Se=d(e.defineComponent({props:{data:{type:Object,default:()=>({})}},setup(t,n){const o=e.reactive({data:{}});return e.watchEffect((()=>{o.data=t.data})),{...e.toRefs(o)}}}),[["render",function(t,n,o,r,i,s){return e.openBlock(),e.createElementBlock("image",{class:"message-image",src:t.data.url},null,8,["src"])}],["__scopeId","data-v-42fc419d"]]);const Le=d(e.defineComponent({props:{data:{type:Object,default:()=>({})},messageData:{type:Object,default:()=>({})}},setup(t,n){const o=e.reactive({data:{},extension:{},isCustom:"",payload:{},message:{}});return e.watchEffect((()=>{o.data=t.data,o.message=t.messageData,o.isCustom=t.data.message.payload.data,o.payload=t.data.message.payload,"consultion"===t.data.message.payload.data&&(o.extension=JSON.parse(t.data.message.payload.extension))})),{...e.toRefs(o)}}}),[["render",function(t,n,o,r,i,s){return e.openBlock(),e.createElementBlock("view",{class:"custom"},["consultion"===t.isCustom?(e.openBlock(),e.createElementBlock("div",{key:0},[e.createElementVNode("h1",null,e.toDisplayString(t.extension.title),1),e.createElementVNode("ul",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.extension.item,((t,n)=>(e.openBlock(),e.createElementBlock("li",{key:n},[e.createElementVNode("a",{href:t.value},e.toDisplayString(t.key),9,["href"])])))),128))]),e.createElementVNode("article",null,e.toDisplayString(t.extension.description),1)])):"evaluate"===t.isCustom?(e.openBlock(),e.createElementBlock("div",{key:1,class:"evaluate"},[e.createElementVNode("h1",null,"对本次服务评价"),e.createElementVNode("ul",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(~~t.payload.description,((t,n)=>(e.openBlock(),e.createElementBlock("li",{class:"evaluate-list-item",key:n},[e.createElementVNode("i",{class:"icon icon-star-light"})])))),128))]),e.createElementVNode("article",null,e.toDisplayString(t.data.custom),1)])):(e.openBlock(),e.createElementBlock("span",{key:2,class:e.normalizeClass(["content content-"+t.message.flow])},e.toDisplayString(t.data.custom),3))])}],["__scopeId","data-v-ecfd9e3d"]]);const Ae=d(e.defineComponent({props:{data:{type:Object,default:()=>({})}},setup(t,n){const o=e.reactive({message:{}});return e.watchEffect((()=>{o.message=t.data})),{...e.toRefs(o)}}}),[["render",function(t,n,o,r,i,s){return e.openBlock(),e.createElementBlock("div",{class:"message-tip"},e.toDisplayString(t.message.text),1)}],["__scopeId","data-v-a7f70a4d"]]);const Re=d(e.defineComponent({props:{data:{type:Object,default:()=>({})}},setup(t,n){const o=e.reactive({message:{}});e.watchEffect((()=>{o.message=t.data}));return{...e.toRefs(o),edit:()=>{n.emit("edit",o.message)}}}}),[["render",function(t,n,o,r,i,s){return e.openBlock(),e.createElementBlock("div",{class:"revoke"},["in"===t.message.flow?(e.openBlock(),e.createElementBlock("label",{key:0},e.toDisplayString(t.message.nick||t.message.from),1)):(e.openBlock(),e.createElementBlock("label",{key:1},"你")),e.createElementVNode("span",null,"撤回了一条消息"),"out"===t.message.flow?(e.openBlock(),e.createElementBlock("span",{key:2,class:"edit",onClick:n[0]||(n[0]=(...e)=>t.edit&&t.edit(...e))},"重新编辑")):e.createCommentVNode("",!0)])}],["__scopeId","data-v-712c9a8f"]]),Oe="https://web.sdk.qcloud.com/im/assets/emoji/",Ne={"[NO]":"emoji_0@2x.png","[OK]":"emoji_1@2x.png","[下雨]":"emoji_2@2x.png","[么么哒]":"emoji_3@2x.png","[乒乓]":"emoji_4@2x.png","[便便]":"emoji_5@2x.png","[信封]":"emoji_6@2x.png","[偷笑]":"emoji_7@2x.png","[傲慢]":"emoji_8@2x.png","[再见]":"emoji_9@2x.png","[冷汗]":"emoji_10@2x.png","[凋谢]":"emoji_11@2x.png","[刀]":"emoji_12@2x.png","[删除]":"emoji_13@2x.png","[勾引]":"emoji_14@2x.png","[发呆]":"emoji_15@2x.png","[发抖]":"emoji_16@2x.png","[可怜]":"emoji_17@2x.png","[可爱]":"emoji_18@2x.png","[右哼哼]":"emoji_19@2x.png","[右太极]":"emoji_20@2x.png","[右车头]":"emoji_21@2x.png","[吐]":"emoji_22@2x.png","[吓]":"emoji_23@2x.png","[咒骂]":"emoji_24@2x.png","[咖啡]":"emoji_25@2x.png","[啤酒]":"emoji_26@2x.png","[嘘]":"emoji_27@2x.png","[回头]":"emoji_28@2x.png","[困]":"emoji_29@2x.png","[坏笑]":"emoji_30@2x.png","[多云]":"emoji_31@2x.png","[大兵]":"emoji_32@2x.png","[大哭]":"emoji_33@2x.png","[太阳]":"emoji_34@2x.png","[奋斗]":"emoji_35@2x.png","[奶瓶]":"emoji_36@2x.png","[委屈]":"emoji_37@2x.png","[害羞]":"emoji_38@2x.png","[尴尬]":"emoji_39@2x.png","[左哼哼]":"emoji_40@2x.png","[左太极]":"emoji_41@2x.png","[左车头]":"emoji_42@2x.png","[差劲]":"emoji_43@2x.png","[弱]":"emoji_44@2x.png","[强]":"emoji_45@2x.png","[彩带]":"emoji_46@2x.png","[彩球]":"emoji_47@2x.png","[得意]":"emoji_48@2x.png","[微笑]":"emoji_49@2x.png","[心碎了]":"emoji_50@2x.png","[快哭了]":"emoji_51@2x.png","[怄火]":"emoji_52@2x.png","[怒]":"emoji_53@2x.png","[惊恐]":"emoji_54@2x.png","[惊讶]":"emoji_55@2x.png","[憨笑]":"emoji_56@2x.png","[手枪]":"emoji_57@2x.png","[打哈欠]":"emoji_58@2x.png","[抓狂]":"emoji_59@2x.png","[折磨]":"emoji_60@2x.png","[抠鼻]":"emoji_61@2x.png","[抱抱]":"emoji_62@2x.png","[抱拳]":"emoji_63@2x.png","[拳头]":"emoji_64@2x.png","[挥手]":"emoji_65@2x.png","[握手]":"emoji_66@2x.png","[撇嘴]":"emoji_67@2x.png","[擦汗]":"emoji_68@2x.png","[敲打]":"emoji_69@2x.png","[晕]":"emoji_70@2x.png","[月亮]":"emoji_71@2x.png","[棒棒糖]":"emoji_72@2x.png","[汽车]":"emoji_73@2x.png","[沙发]":"emoji_74@2x.png","[流汗]":"emoji_75@2x.png","[流泪]":"emoji_76@2x.png","[激动]":"emoji_77@2x.png","[灯泡]":"emoji_78@2x.png","[炸弹]":"emoji_79@2x.png","[熊猫]":"emoji_80@2x.png","[爆筋]":"emoji_81@2x.png","[爱你]":"emoji_82@2x.png","[爱心]":"emoji_83@2x.png","[爱情]":"emoji_84@2x.png","[猪头]":"emoji_85@2x.png","[猫咪]":"emoji_86@2x.png","[献吻]":"emoji_87@2x.png","[玫瑰]":"emoji_88@2x.png","[瓢虫]":"emoji_89@2x.png","[疑问]":"emoji_90@2x.png","[白眼]":"emoji_91@2x.png","[皮球]":"emoji_92@2x.png","[睡觉]":"emoji_93@2x.png","[磕头]":"emoji_94@2x.png","[示爱]":"emoji_95@2x.png","[礼品袋]":"emoji_96@2x.png","[礼物]":"emoji_97@2x.png","[篮球]":"emoji_98@2x.png","[米饭]":"emoji_99@2x.png","[糗大了]":"emoji_100@2x.png","[红双喜]":"emoji_101@2x.png","[红灯笼]":"emoji_102@2x.png","[纸巾]":"emoji_103@2x.png","[胜利]":"emoji_104@2x.png","[色]":"emoji_105@2x.png","[药]":"emoji_106@2x.png","[菜刀]":"emoji_107@2x.png","[蛋糕]":"emoji_108@2x.png","[蜡烛]":"emoji_109@2x.png","[街舞]":"emoji_110@2x.png","[衰]":"emoji_111@2x.png","[西瓜]":"emoji_112@2x.png","[调皮]":"emoji_113@2x.png","[象棋]":"emoji_114@2x.png","[跳绳]":"emoji_115@2x.png","[跳跳]":"emoji_116@2x.png","[车厢]":"emoji_117@2x.png","[转圈]":"emoji_118@2x.png","[鄙视]":"emoji_119@2x.png","[酷]":"emoji_120@2x.png","[钞票]":"emoji_121@2x.png","[钻戒]":"emoji_122@2x.png","[闪电]":"emoji_123@2x.png","[闭嘴]":"emoji_124@2x.png","[闹钟]":"emoji_125@2x.png","[阴险]":"emoji_126@2x.png","[难过]":"emoji_127@2x.png","[雨伞]":"emoji_128@2x.png","[青蛙]":"emoji_129@2x.png","[面条]":"emoji_130@2x.png","[鞭炮]":"emoji_131@2x.png","[风车]":"emoji_132@2x.png","[飞吻]":"emoji_133@2x.png","[飞机]":"emoji_134@2x.png","[饥饿]":"emoji_135@2x.png","[香蕉]":"emoji_136@2x.png","[骷髅]":"emoji_137@2x.png","[麦克风]":"emoji_138@2x.png","[麻将]":"emoji_139@2x.png","[鼓掌]":"emoji_140@2x.png","[龇牙]":"emoji_141@2x.png"},we=["[龇牙]","[调皮]","[流汗]","[偷笑]","[再见]","[敲打]","[擦汗]","[猪头]","[玫瑰]","[流泪]","[大哭]","[嘘]","[酷]","[抓狂]","[委屈]","[便便]","[炸弹]","[菜刀]","[可爱]","[色]","[害羞]","[得意]","[吐]","[微笑]","[怒]","[尴尬]","[惊恐]","[冷汗]","[爱心]","[示爱]","[白眼]","[傲慢]","[难过]","[惊讶]","[疑问]","[困]","[么么哒]","[憨笑]","[爱情]","[衰]","[撇嘴]","[阴险]","[奋斗]","[发呆]","[右哼哼]","[抱抱]","[坏笑]","[飞吻]","[鄙视]","[晕]","[大兵]","[可怜]","[强]","[弱]","[握手]","[胜利]","[抱拳]","[凋谢]","[米饭]","[蛋糕]","[西瓜]","[啤酒]","[瓢虫]","[勾引]","[OK]","[爱你]","[咖啡]","[月亮]","[刀]","[发抖]","[差劲]","[拳头]","[心碎了]","[太阳]","[礼物]","[皮球]","[骷髅]","[挥手]","[闪电]","[饥饿]","[咒骂]","[折磨]","[抠鼻]","[鼓掌]","[糗大了]","[左哼哼]","[打哈欠]","[快哭了]","[吓]","[篮球]","[乒乓]","[NO]","[跳跳]","[怄火]","[转圈]","[磕头]","[回头]","[跳绳]","[激动]","[街舞]","[献吻]","[左太极]","[右太极]","[闭嘴]","[猫咪]","[红双喜]","[鞭炮]","[红灯笼]","[麻将]","[麦克风]","[礼品袋]","[信封]","[象棋]","[彩带]","[蜡烛]","[爆筋]","[棒棒糖]","[奶瓶]","[面条]","[香蕉]","[飞机]","[左车头]","[车厢]","[右车头]","[多云]","[下雨]","[钞票]","[熊猫]","[灯泡]","[风车]","[闹钟]","[雨伞]","[彩球]","[钻戒]","[沙发]","[纸巾]","[手枪]","[青蛙]"],be=[{icon:"yz00",list:["yz00","yz01","yz02","yz03","yz04","yz05","yz06","yz07","yz08","yz09","yz10","yz11","yz12","yz13","yz14","yz15","yz16","yz17"]},{icon:"ys00",list:["ys00","ys01","ys02","ys03","ys04","ys05","ys06","ys07","ys08","ys09","ys10","ys11","ys12","ys13","ys14","ys15"]},{icon:"gcs00",list:["gcs00","gcs01","gcs02","gcs03","gcs04","gcs05","gcs06","gcs07","gcs08","gcs09","gcs10","gcs11","gcs12","gcs13","gcs14","gcs15","gcs16"]}];function Ue(e){const t=[];let n=e.text,o=-1,r=-1;for(;""!==n;)switch(o=n.indexOf("["),r=n.indexOf("]"),o){case 0:if(-1===r)t.push({name:"text",text:n}),n="";else{const e=n.slice(0,r+1);Ne[e]?(t.push({name:"img",src:Oe+Ne[e]}),n=n.substring(r+1)):(t.push({name:"text",text:"["}),n=n.slice(1))}break;case-1:t.push({name:"text",text:n}),n="";break;default:t.push({name:"text",text:n.slice(0,o)}),n=n.substring(o)}return t}function Pe(e){const t={message:e,text:""},n=e.nick||e.payload.userIDList.join(",");switch(e.payload.operationType){case uni.$TIM.TYPES.GRP_TIP_MBR_JOIN:t.text=`群成员：${n} 加入群组`;break;case uni.$TIM.TYPES.GRP_TIP_MBR_QUIT:t.text=`群成员：${n} 退出群组`;break;case uni.$TIM.TYPES.GRP_TIP_MBR_KICKED_OUT:t.text=`群成员：${n} 被 ${e.payload.operatorID} 踢出群组`;break;case uni.$TIM.TYPES.GRP_TIP_MBR_SET_ADMIN:t.text=`群成员：${n} 成为管理员`;break;case uni.$TIM.TYPES.GRP_TIP_MBR_CANCELED_ADMIN:t.text=`群成员：${n} 被撤销管理员`;break;case uni.$TIM.TYPES.GRP_TIP_GRP_PROFILE_UPDATED:t.text=function(e){const{payload:t}=e,{newGroupProfile:n}=t,{operatorID:o}=t;let r="";const i=Object.keys(n)[0];switch(i){case"ownerID":r=`${n[i]} 成为新的群主`;break;case"groupName":r=`${o} 修改群名为 ${n[i]}`;break;case"notification":r=`${o} 发布新公告`}return r}(e);break;case uni.$TIM.TYPES.GRP_TIP_MBR_PROFILE_UPDATED:for(const n of e.payload.memberList)n.muteTime>0?t.text=`群成员：${n.userID} 被禁言`:t.text=`群成员：${n.userID} 被取消禁言`;break;default:t.text="[群提示消息]"}return t}function Ge(e){return{text:Ue(e.payload)}}function xe(e){const t={message:e,name:"",url:""},n=be.filter((t=>t.icon===e.payload.data));return n.length>0&&(t.name=n[0].list[e.payload.index]),e.payload.data.indexOf("@2x")>0?t.name=e.payload.data:t.name=`${e.payload.data}@2x`,t.url=`https://web.sdk.qcloud.com/im/assets/face-elem/${t.name}.png`,t}function Fe(e){const t={lon:"",lat:"",href:"",url:"",description:"",message:e};return t.lon=e.payload.longitude.toFixed(6),t.lat=e.payload.latitude.toFixed(6),t.href=`https://map.qq.com/?type=marker&isopeninfowin=1&markertype=1&pointx=${t.lon}&pointy=${t.lat}&name=${e.payload.description}`,t.url=`https://apis.map.qq.com/ws/staticmap/v2/?center=${t.lat},${t.lon}&zoom=10&size=300*150&maptype=roadmap&markers=size:large|color:0xFFCCFF|label:k|${t.lat},${t.lon}&key=UBNBZ-PTP3P-TE7DB-LHRTI-Y4YLE-VWBBD`,t.description=e.payload.description,t}function qe(e){return{progress:"unSend"===(null==e?void 0:e.status)&&e.progress,info:e.payload.imageInfoArray,message:e}}function Be(e){var t,n;return{progress:"unSend"===(null==e?void 0:e.status)&&(null==e?void 0:e.progress),url:null==(t=null==e?void 0:e.payload)?void 0:t.videoUrl,snapshotUrl:null==(n=null==e?void 0:e.payload)?void 0:n.snapshotUrl,message:e}}function Ve(e){return{progress:"unSend"===(null==e?void 0:e.status)&&e.progress,url:e.payload.url,message:e,second:e.payload.second}}function Ke(e){let t="";return t=e.payload.fileSize>=1048576?`${(e.payload.fileSize/1048576).toFixed(2)} Mb`:e.payload.fileSize>=1024?`${(e.payload.fileSize/1024).toFixed(2)} Kb`:`${e.payload.fileSize.toFixed(2)}B`,{progress:"unSend"===(null==e?void 0:e.status)&&e.progress,url:e.payload.fileUrl,message:e,name:e.payload.fileName,size:t}}function He(e){return{message:e,...e.payload}}function je(e){let t={},n={};try{t=JSON.parse(e.payload.data)}catch(o){t={}}if(1!==t.businessID)return"";try{n=JSON.parse(t.data)}catch(o){n={}}switch(t.actionType){case 1:return n.call_end>=0&&!t.groupID?`通话时长 ：${function(e){const t=e;let n,o,r,i;return t>=3600?(o=parseInt(""+t/3600,10)<10?`0${parseInt(""+t/3600,10)}`:parseInt(""+t/3600,10),r=parseInt(""+t%60/60,10)<10?`0${parseInt(""+t%60/60,10)}`:parseInt(""+t%60/60,10),i=t%3600<10?"0"+t%3600:t%3600,i>60&&(r=parseInt(""+i/60,10)<10?`0${parseInt(""+i/60,10)}`:parseInt(""+i/60,10),i=i%60<10?"0"+i%60:i%60),n=`${o}:${r}:${i}`):t>=60&&t<3600?(r=parseInt(""+t/60,10)<10?`0${parseInt(""+t/60,10)}`:parseInt(""+t/60,10),i=t%60<10?"0"+t%60:t%60,n=`00:${r}:${i}`):t<60&&(i=t<10?`0${t}`:t,n=`00:00:${i}`),n}(n.call_end)}`:t.groupID?"结束群聊":n.data&&"switchToAudio"===n.data.cmd?"切换语音通话":n.data&&"switchToVideo"===n.data.cmd?"切换视频通话":"发起通话";case 2:return"取消通话";case 3:return n.data&&"switchToAudio"===n.data.cmd?"切换语音通话":n.data&&"switchToVideo"===n.data.cmd?"切换视频通话":"已接听";case 4:return"拒绝通话";case 5:return n.data&&"switchToAudio"===n.data.cmd?"切换语音通话":n.data&&"switchToVideo"===n.data.cmd?"切换视频通话":"无应答";default:return""}}function ze(e){var t;return{message:e,custom:je(e)||(null==(t=null==e?void 0:e.payload)?void 0:t.extension)||"[自定义消息]"}}function We(e){var t,n;const o=(null==(t=e.payload.groupProfile)?void 0:t.name)||(null==(n=e.payload.groupProfile)?void 0:n.groupID);switch(e.payload.operationType){case 1:return`${e.payload.operatorID} 申请加入群组：${o}`;case 2:return`成功加入群组：${o}`;case 3:return`申请加入群组：${o} 被拒绝`;case 4:return`你被管理员 ${e.payload.operatorID} 踢出群组：${o}`;case 5:return`群：${o} 被 ${e.payload.operatorID} 解散`;case 6:return`${e.payload.operatorID} 创建群：${o}`;case 7:case 12:return`${e.payload.operatorID} 邀请你加群：${o}`;case 8:return`你退出群组：${o}`;case 9:return`你被${e.payload.operatorID} 设置为群：${o} 的管理员`;case 10:return`你被 ${e.payload.operatorID} 撤销群：${o} 的管理员身份`;case 13:return`${e.payload.operatorID} 同意加群 ：${o}`;case 14:return`${e.payload.operatorID} 拒接加群 ：${o}`;case 255:return`自定义群系统通知: ${e.payload.userDefinedField}`}}const Ye=d(e.defineComponent({props:{data:{type:Array,default:()=>[]},types:{type:Object,default:()=>({})}},setup(t,n){const o=e.reactive({messageList:[],types:{}});e.watchEffect((()=>{o.messageList=t.data,o.types=t.types}));return{...e.toRefs(o),translateGroupSystemNotice:We,handleApplication:()=>{uni.showActionSheet({itemList:["同意","拒绝"],success:e=>{const t={handleAction:"Agree",handleMessage:"欢迎进群",message:this.message};1===e.tapIndex&&(t.handleAction="Reject",t.handleMessage="拒绝申请"),uni.$TUIKit.handleGroupApplication(t).then((()=>{uni.showToast({title:"Agree"===t.handleAction?"已同意申请":"已拒绝申请"})})).catch((e=>{uni.showToast({title:e.message||"处理失败",icon:"none"})}))}})},caculateTimeago:u}}}),[["render",function(t,n,o,r,i,s){return e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.messageList,((o,r)=>(e.openBlock(),e.createElementBlock("view",{key:r},[1===o.payload.operationType?(e.openBlock(),e.createElementBlock("view",{key:0,class:"card handle"},[e.createElementVNode("view",null,[e.createElementVNode("view",{class:"time"},e.toDisplayString(t.caculateTimeago(1e3*o.time)),1),e.createTextVNode(" "+e.toDisplayString(t.translateGroupSystemNotice(o)),1)]),e.createElementVNode("view",{class:"choose"},[e.createElementVNode("view",{class:"button",onClick:n[0]||(n[0]=(...e)=>t.handleClick&&t.handleClick(...e))},"处理")])])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"card"},[e.createElementVNode("view",{class:"time"},e.toDisplayString(t.caculateTimeago(1e3*o.time)),1),e.createTextVNode(" "+e.toDisplayString(t.translateGroupSystemNotice(o)),1)]))])))),128)}],["__scopeId","data-v-3bf5bdf6"]]);const $e=d(e.defineComponent({props:{show:{type:Boolean,default:()=>!1},isMute:{type:Boolean,default:()=>!1}},setup(t,n){const o=e.reactive({emojiUrl:Oe,emojiMap:Ne,emojiName:we,faceUrl:"https://web.sdk.qcloud.com/im/assets/face-elem/",bigEmojiList:be,show:!1,currentIndex:0,isMute:!1}),r=e.ref();e.watchEffect((()=>{o.show=t.show,o.isMute=t.isMute}));const i=e.computed((()=>{const e=[o.emojiName];for(let t=0;t<o.bigEmojiList.length;t++)e.push(o.bigEmojiList[t].list);return e})),s=e=>{o.currentIndex=e};return{...e.toRefs(o),toggleShow:()=>{o.isMute||(o.show=!o.show),o.show||s(0)},select:async(e,t)=>{const r={name:e};if(0===o.currentIndex)return r.type="emo",r.url=Oe+Ne[e],r.template=`<image src="${Oe+Ne[e]}"></image>`,n.emit("send",r);try{await uni.$TUIKit.TUIChatServer.sendFaceMessage({index:t,data:e})}catch(i){}},selectFace:s,list:i,dialog:r,handleSendEmoji:()=>n.emit("handleSendEmoji")}}}),[["render",function(t,n,o,r,i,s){return e.openBlock(),e.createElementBlock("view",{class:"face"},[e.createElementVNode("view",{class:"icon icon-face",onClick:n[0]||(n[0]=(...e)=>t.toggleShow&&t.toggleShow(...e))}),e.withDirectives(e.createElementVNode("view",{class:"face-main",ref:"dialog"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.list,((n,o)=>(e.openBlock(),e.createElementBlock("view",{class:"face-main-box",key:o},[t.currentIndex===o?(e.openBlock(),e.createElementBlock("view",{key:0,class:"face-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n,((n,r)=>(e.openBlock(),e.createElementBlock("view",{class:"face-list-item",key:r,onClick:e=>t.select(n,r)},[0===o?(e.openBlock(),e.createElementBlock("image",{key:0,class:"emo-image",src:t.emojiUrl+t.emojiMap[n]},null,8,["src"])):(e.openBlock(),e.createElementBlock("image",{key:1,class:"face-img",src:t.faceUrl+n+"@2x.png"},null,8,["src"]))],8,["onClick"])))),128))])):e.createCommentVNode("",!0)])))),128)),e.createElementVNode("view",{class:"face-tab"},[e.createElementVNode("view",{class:"face-tab-item",onClick:n[1]||(n[1]=e=>t.selectFace(0))},[e.createElementVNode("view",{class:"icon icon-face"})]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.bigEmojiList,((n,o)=>(e.openBlock(),e.createElementBlock("view",{class:"face-tab-item",key:o,onClick:e=>t.selectFace(o+1)},[e.createElementVNode("image",{class:"face-icon",src:t.faceUrl+n.icon+"@2x.png"},null,8,["src"])],8,["onClick"])))),128)),e.createElementVNode("view",{class:"send-btn",onClick:n[2]||(n[2]=(...e)=>t.handleSendEmoji&&t.handleSendEmoji(...e))},"发送")])],512),[[e.vShow,t.show]])])}],["__scopeId","data-v-997a660b"]]),Je=uni.getRecorderManager(),Xe=e.defineComponent({props:{show:{type:Boolean,default:()=>!1}},setup(t,n){const o=e.reactive({popupToggle:!1,isRecording:!1,canSend:!0,text:"按住说话",recorderManager:null,title:" ",recordTime:0,recordTimer:null});e.onMounted((()=>{Je.onStop((e=>{clearInterval(o.recordTimer);let t={duration:e.duration?e.duration:1e3*o.recordTime,tempFilePath:e.tempFilePath,fileSize:e.fileSize?e.fileSize:48*o.recordTime/8*1024};uni.hideLoading(),o.canSend&&(t.duration<1e3?uni.showToast({title:"录音时间太短",icon:"none"}):uni.$TUIKit.TUIChatServer.sendAudioMessage(t)),o.popupToggle=!1,o.isRecording=!1,o.canSend=!0,o.title=" ",o.text="按住说话"}))}));return{...e.toRefs(o),sendUploadMessage:e=>{Video.TUIServer.sendVideoMessage(e.target)},handleLongPress:e=>{o.popupToggle=!0,Je.start({duration:6e4,sampleRate:44100,numberOfChannels:1,encodeBitRate:192e3,format:"aac"}),o.startPoint=e.target,o.title="正在录音",o.isRecording=!0,o.recordTime=0,o.recordTimer=setInterval((()=>{o.recordTime++}),1e3)},handleTouchEnd:()=>{o.isRecording=!1,o.popupToggle=!1,o.text="按住说话",uni.hideLoading(),Je.stop()},handleTouchMove:e=>{o.isRecording&&(e.currentTarget.offsetTop-e.changedTouches[e.changedTouches.length-1].clientY>100?(o.text="抬起停止",o.title="松开手指，取消发送",o.canSend=!1):e.currentTarget.offsetTop-e.changedTouches[e.changedTouches.length-1].clientY>20?(o.text="抬起停止",o.title="上划可取消",o.canSend=!0):(o.text="抬起停止",o.title="正在录音",o.canSend=!0))}}}});const Ze=d(Xe,[["render",function(t,n,o,r,i,s){return e.openBlock(),e.createElementBlock("view",{class:"TUI-message-input-main",onLongpress:n[3]||(n[3]=(...e)=>t.handleLongPress&&t.handleLongPress(...e)),onTouchmove:n[4]||(n[4]=(...e)=>t.handleTouchMove&&t.handleTouchMove(...e)),onTouchend:n[5]||(n[5]=(...e)=>t.handleTouchEnd&&t.handleTouchEnd(...e))},[e.createElementVNode("text",null,e.toDisplayString(t.text),1),t.popupToggle?(e.openBlock(),e.createElementBlock("view",{key:0,class:"record-modal",onLongpress:n[0]||(n[0]=(...e)=>t.handleLongPress&&t.handleLongPress(...e)),onTouchmove:n[1]||(n[1]=(...e)=>t.handleTouchMove&&t.handleTouchMove(...e)),onTouchend:n[2]||(n[2]=(...e)=>t.handleTouchEnd&&t.handleTouchEnd(...e))},[e.createElementVNode("view",{class:"wrapper"},[e.createElementVNode("view",{class:"modal-loading"})]),e.createElementVNode("view",{class:"modal-title"},e.toDisplayString(t.title),1)],32)):e.createCommentVNode("",!0)],32)}],["__scopeId","data-v-45791345"]]),Qe=e.defineComponent({components:{Face:$e,AudioMessage:Ze},props:{text:{type:String,default:()=>""},conversationData:{type:Object,default:()=>""}},setup(n){const o=uni.$TUIKit.TUIChatServer,r=e.reactive({firstSendMessage:!0,inputText:"",extensionArea:!1,sendMessageBtn:!1,displayFlag:"",isAudio:!1,displayServiceEvaluation:!1,displayCommonWords:!1,displayOrderList:!1,conversation:e.computed((()=>ie.state.timStore.conversation))});e.watchEffect((()=>{r.inputText=n.text}));return{...e.toRefs(r),handleExtensions:e=>{r.displayFlag="extension"===r.displayFlag?"":"extension"},handleSendImageMessage:e=>{uni.chooseImage({sourceType:[e],count:1,success:e=>{uni.getImageInfo({src:e.tempFilePaths[0],success(n){t("error","at pages/TUIKit/TUIPages/TUIChat/components/message-input/index.vue:195",n),o.sendImageMessage(e,n)}})}})},handleSendTextMessage:e=>{r.inputText.trimEnd()&&uni.$TUIKit.TUIChatServer.sendTextMessage(JSON.parse(JSON.stringify(r.inputText))),r.inputText=" "},handleSendVideoMessage:e=>{uni.chooseVideo({sourceType:[e],maxDuration:60,camera:"back",success:e=>{e&&o.sendVideoMessage(e)}})},handleEmoji:()=>{r.displayFlag="emoji"===r.displayFlag?"":"emoji"},handleSend:e=>{r.inputText+=e.name},handleSwitchAudio:()=>{r.isAudio=!r.isAudio},handleCalling:e=>{if("GROUP"===r.conversation.type)return void uni.showToast({title:"群聊暂不支持",icon:"none"});const{userID:n}=r.conversation.userProfile;void 0===uni.$TUICallKit?(t("error","at pages/TUIKit/TUIPages/TUIChat/components/message-input/index.vue:232","请集成 TUICallKit 插件，使用真机运行并且自定义基座调试，请参考官网文档：https://cloud.tencent.com/document/product/269/83857"),uni.showToast({title:"请集成 TUICallKit 插件哦 ～ ",icon:"none",duration:3e3})):uni.$TUICallKit.call({userID:n,callMediaType:e},(e=>{t("log","at pages/TUIKit/TUIPages/TUIChat/components/message-input/index.vue:247",JSON.stringify(e))}))}}}}),et="/assets/take-photo.bbcbfd9a.svg",nt="/assets/take-video.3b38acb8.svg";const ot=d(Qe,[["render",function(t,n,o,r,i,s){const a=e.resolveComponent("AudioMessage"),c=e.resolveComponent("Face");return e.openBlock(),e.createElementBlock("view",{class:"TUI-message-input-container"},[e.createElementVNode("view",{class:"TUI-message-input"},[e.createElementVNode("image",{class:"TUI-icon",onClick:n[0]||(n[0]=(...e)=>t.handleSwitchAudio&&t.handleSwitchAudio(...e)),src:"/assets/audio.3e97d529.svg"}),t.isAudio?(e.openBlock(),e.createElementBlock("view",{key:1,class:"TUI-message-input-main"},[e.createVNode(a)])):(e.openBlock(),e.createElementBlock("view",{key:0,class:"TUI-message-input-main"},[e.withDirectives(e.createElementVNode("input",{class:"TUI-message-input-area","adjust-position":!0,"cursor-spacing":"20","onUpdate:modelValue":n[1]||(n[1]=e=>t.inputText=e),"confirm-type":"send","confirm-hold":"true",onConfirm:n[2]||(n[2]=(...e)=>t.handleSendTextMessage&&t.handleSendTextMessage(...e)),maxlength:"140",type:"text","placeholder-class":"input-placeholder",placeholder:"说点什么呢~"},null,544),[[e.vModelText,t.inputText]])])),e.createElementVNode("view",{class:"TUI-message-input-functions","hover-class":"none"},[e.createElementVNode("image",{class:"TUI-icon",onClick:n[3]||(n[3]=(...e)=>t.handleEmoji&&t.handleEmoji(...e)),src:"/assets/emoji.ccca7654.svg"}),e.createElementVNode("view",{onClick:n[4]||(n[4]=(...e)=>t.handleExtensions&&t.handleExtensions(...e))},[e.createElementVNode("image",{class:"TUI-icon",src:"/assets/more.abda2f36.svg"})])])]),"emoji"===t.displayFlag?(e.openBlock(),e.createElementBlock("view",{key:0,class:"TUI-Emoji-area"},[e.createVNode(c,{show:"emoji"===t.displayFlag,onSend:t.handleSend,onHandleSendEmoji:t.handleSendTextMessage},null,8,["show","onSend","onHandleSendEmoji"])])):e.createCommentVNode("",!0),"extension"===t.displayFlag?(e.openBlock(),e.createElementBlock("view",{key:1,class:"TUI-Extensions"},[e.createElementVNode("view",{class:"TUI-Extension-slot",onClick:n[5]||(n[5]=e=>t.handleSendImageMessage("camera"))},[e.createElementVNode("image",{class:"TUI-Extension-icon",src:et}),e.createElementVNode("view",{class:"TUI-Extension-slot-name"},"拍照")]),e.createElementVNode("view",{class:"TUI-Extension-slot",onClick:n[6]||(n[6]=e=>t.handleSendImageMessage("album"))},[e.createElementVNode("image",{class:"TUI-Extension-icon",src:"/assets/send-img.7ec35072.svg"}),e.createElementVNode("view",{class:"TUI-Extension-slot-name"},"图片")]),e.createElementVNode("view",{class:"TUI-Extension-slot",onClick:n[7]||(n[7]=e=>t.handleSendVideoMessage("album"))},[e.createElementVNode("image",{class:"TUI-Extension-icon",src:nt}),e.createElementVNode("view",{class:"TUI-Extension-slot-name"},"视频")]),e.createElementVNode("view",{class:"TUI-Extension-slot",onClick:n[8]||(n[8]=e=>t.handleSendVideoMessage("camera"))},[e.createElementVNode("image",{class:"TUI-Extension-icon",src:et}),e.createElementVNode("view",{class:"TUI-Extension-slot-name"},"录像")]),e.createElementVNode("view",{class:"TUI-Extension-slot",onClick:n[9]||(n[9]=e=>t.handleCalling(1))},[e.createElementVNode("image",{class:"TUI-Extension-icon",src:"/assets/audio-calling.ce9b3c0a.svg"}),e.createElementVNode("view",{class:"TUI-Extension-slot-name"},"语音通话")]),e.createElementVNode("view",{class:"TUI-Extension-slot",onClick:n[10]||(n[10]=e=>t.handleCalling(2))},[e.createElementVNode("image",{class:"TUI-Extension-icon",src:nt}),e.createElementVNode("view",{class:"TUI-Extension-slot-name"},"视频通话")])])):e.createCommentVNode("",!0)])}],["__scopeId","data-v-86c190c1"]]);const rt=d(e.defineComponent({name:"TUIChat",components:{MessageText:me,MessageImage:ve,MessageVideo:Ce,MessageAudio:De,MessageFace:Se,MessageCustom:Le,MessageBubble:_e,MessageTip:Ae,MessageRevoked:Re,MessageSystem:Ye,TUIChatInput:ot,MessageOperate:Me},setup(t){const n=ie.state.timStore;uni.$TUIKit.TUIChatServer=new ce;const o=e.shallowRef(null),a=uni.$TUIKit.TUIChatServer,l={top:-70,left:0,right:0},d=e.reactive({messageList:e.computed((()=>n.messageList)),conversation:e.computed((()=>n.conversation)),triggered:!1,scrollTop:999,text:"",types:uni.$TIM.TYPES,currentMessage:{},dialogID:"",forwardStatus:!1,imageFlag:!1,isCompleted:!1,oldMessageTime:0,dialogPosition:l}),p=e.computed((()=>{const e=d.conversation;return(null==e?void 0:e.conversationID)?(null==e?void 0:e.type)===uni.$TIM.TYPES.CONV_SYSTEM?"system":"chat":""})),h=e.computed((()=>{if(d.messageList.length>0)return d.oldMessageTime=d.messageList[0].time,d.messageList.filter((e=>!e.isDeleted))}));r((e=>{uni.setNavigationBarTitle({title:e&&e.conversationName})})),s((()=>{a.destroyed()})),e.watch(h,((t,n)=>{e.nextTick((()=>{const e=t[t.length-1],o=n?n[n.length-1]:{};d.oldMessageTime=h.value[0].time,g(),n&&(e.ID,o.ID)}))})),i((()=>{const t={sdkAppID:uni.$chat_SDKAppID,userID:uni.$chat_userID,userSig:uni.$chat_userSig,tim:uni.$TUIKit};uni.$TUICallKit=o,e.nextTick((()=>{null!==uni.$TUICallKit.value&&uni.$TUICallKit.value.init(t)})),setTimeout((()=>{d.scrollTop=998}),500)})),e.onMounted((()=>{g(),uni.addInterceptor("navigateBack",{success(){uni.$TUIKit.TUIConversationServer.setMessageRead(d.conversation.conversationID)}})})),c((()=>{var e;(null==(e=d.conversation)?void 0:e.type)===uni.$TIM.TYPES.CONV_GROUP?uni.navigateTo({url:"../TUIGroup/index"}):uni.showToast({title:"暂无信息"})}));const g=()=>{h.value&&Array.from(h.value).forEach((e=>{e.time-d.oldMessageTime>300?(d.oldMessageTime=e.time,e.showTime=!0):e.showTime=!1}))};return{...e.toRefs(d),TUICallKit:o,conversationType:p,messages:h,handleShowTime:g,handleTouchStart:()=>{uni.hideKeyboard()},handleRefresher:()=>{d.triggered=!0,d.isCompleted||a.getHistoryMessageList().then((e=>{d.triggered=!1,d.isCompleted=e.isCompleted})),setTimeout((()=>{d.triggered=!1}),500)},handleScroll:e=>{d.triggered="restore"},handleScrollBottom:()=>{uni.createSelectorQuery().select(".TUI-message-list").boundingClientRect((e=>{var t;const n=null==(t=e.height)?void 0:t.height;d.scrollTop=n})).exec()},handleSendTextMessage:e=>{d.text.trimEnd()&&a.sendTextMessage(JSON.parse(JSON.stringify(d.text))),d.text=" "},handleItem:(e,t)=>{const{flow:n}=t;try{uni.createSelectorQuery().select("#"+(t.flow+"-"+t.ID)).boundingClientRect((e=>{var t;const{top:o}=e;o<80?(d.dialogPosition={...d.dialogPosition,top:(null==(t=e.height)?void 0:t.res)+10},d.dialogPosition={...d.dialogPosition,right:"out"===n?0:null,left:"in"===n?0:null}):d.dialogPosition={...l,right:"out"===n?0:null,left:"in"===n?0:null}})).exec((e=>{d.currentMessage=t,d.dialogID=t.ID}))}catch(o){d.currentMessage=t,d.dialogID=t.ID}},handleEdit:e=>{d.text=e.payload.text},handleTextMessageShowContext:Ge,handleImageMessageShowContext:qe,handleVideoMessageShowContext:Be,handleAudioMessageShowContext:Ve,handleFileMessageShowContext:Ke,handleFaceMessageShowContext:xe,handleLocationMessageShowContext:Fe,handleMergerMessageShowContext:He,handleTipMessageShowContext:Pe,handleCustomMessageShowContext:ze,handleSend:e=>{d.text+=e.name},caculateTimeago:u,handleGetProfile:()=>{uni.navigateTo({url:"../TUIGroup/index"})}}}}),[["render",function(t,n,o,r,i,s){var a;const c=e.resolveComponent("MessageTip"),u=e.resolveComponent("Message-Operate"),l=e.resolveComponent("MessageText"),d=e.resolveComponent("MessageImage"),p=e.resolveComponent("MessageVideo"),h=e.resolveComponent("MessageAudio"),g=e.resolveComponent("MessageFace"),f=e.resolveComponent("MessageCustom"),_=e.resolveComponent("MessageBubble"),m=e.resolveComponent("MessageRevoked"),v=e.resolveComponent("TUIChatInput"),y=e.resolveComponent("MessageSystem");return e.openBlock(),e.createElementBlock(e.Fragment,null,["chat"===t.conversationType?(e.openBlock(),e.createElementBlock("view",{key:0,class:"TUIChat"},["GROUP"===(null==(a=t.conversation)?void 0:a.type)?(e.openBlock(),e.createElementBlock("view",{key:0,class:"more-btn",onClick:n[0]||(n[0]=(...e)=>t.handleGetProfile&&t.handleGetProfile(...e))}," 更多")):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"TUIChat-container"},[e.createElementVNode("scroll-view",{class:"TUIChat-main","scroll-y":"true","scroll-with-animation":!0,"refresher-triggered":t.triggered,"refresher-enabled":!0,onRefresherrefresh:n[3]||(n[3]=(...e)=>t.handleRefresher&&t.handleRefresher(...e)),"scroll-top":t.scrollTop},[e.createElementVNode("view",{class:"TUI-message-list",onTouchstart:n[1]||(n[1]=(...e)=>t.handleTouchStart&&t.handleTouchStart(...e)),onClick:n[2]||(n[2]=e=>t.dialogID="")},[t.isCompleted?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading-text"},"没有更多")):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.messages,((n,o)=>(e.openBlock(),e.createElementBlock("view",{key:n.ID,id:"view"+n.ID},[n.showTime?(e.openBlock(),e.createElementBlock("view",{key:0,class:"time-container"},e.toDisplayString(t.caculateTimeago(1e3*n.time)),1)):e.createCommentVNode("",!0),n.isRevoked||n.type!==t.types.MSG_GRP_TIP?e.createCommentVNode("",!0):(e.openBlock(),e.createBlock(c,{key:1,data:t.handleTipMessageShowContext(n)},null,8,["data"])),n.isRevoked||n.type===t.types.MSG_GRP_TIP?e.createCommentVNode("",!0):(e.openBlock(),e.createBlock(_,{key:2,data:n},{default:e.withCtx((()=>[t.dialogID===n.ID?(e.openBlock(),e.createBlock(u,{key:0,data:n,class:"dialog dialog-item",style:e.normalizeStyle({top:t.dialogPosition.top+"px",right:t.dialogPosition.right+"px",left:t.dialogPosition.left+"px"})},null,8,["data","style"])):e.createCommentVNode("",!0),n.type===t.types.MSG_TEXT?(e.openBlock(),e.createBlock(l,{key:1,id:n.flow+"-"+n.ID,data:t.handleTextMessageShowContext(n),messageData:n,onLongpress:e=>t.handleItem(e,n)},null,8,["id","data","messageData","onLongpress"])):e.createCommentVNode("",!0),n.type===t.types.MSG_IMAGE?(e.openBlock(),e.createBlock(d,{key:2,id:n.flow+"-"+n.ID,data:t.handleImageMessageShowContext(n),messageData:n,onLongpress:e=>t.handleItem(e,n)},null,8,["id","data","messageData","onLongpress"])):e.createCommentVNode("",!0),n.type===t.types.MSG_VIDEO?(e.openBlock(),e.createBlock(p,{key:3,id:n.flow+"-"+n.ID,data:t.handleVideoMessageShowContext(n),messageData:n,onLongpress:e=>t.handleItem(e,n)},null,8,["id","data","messageData","onLongpress"])):e.createCommentVNode("",!0),n.type===t.types.MSG_AUDIO?(e.openBlock(),e.createBlock(h,{key:4,id:n.flow+"-"+n.ID,data:t.handleAudioMessageShowContext(n),messageData:n,onLongpress:e=>t.handleItem(e,n)},null,8,["id","data","messageData","onLongpress"])):e.createCommentVNode("",!0),n.type===t.types.MSG_FACE?(e.openBlock(),e.createBlock(g,{key:5,id:n.flow+"-"+n.ID,data:t.handleFaceMessageShowContext(n),messageData:n,onLongpress:e=>t.handleItem(e,n)},null,8,["id","data","messageData","onLongpress"])):e.createCommentVNode("",!0),n.type===t.types.MSG_CUSTOM?(e.openBlock(),e.createBlock(f,{key:6,id:n.flow+"-"+n.ID,data:t.handleCustomMessageShowContext(n),messageData:n,onLongpress:e=>t.handleItem(e,n)},null,8,["id","data","messageData","onLongpress"])):e.createCommentVNode("",!0)])),_:2},1032,["data"])),n.isRevoked?(e.openBlock(),e.createBlock(m,{key:3,data:n,onEdit:e=>t.handleEdit(n)},null,8,["data","onEdit"])):e.createCommentVNode("",!0)],8,["id"])))),128))],32)],40,["refresher-triggered","scroll-top"])]),e.createVNode(v,{text:t.text,conversationData:t.conversation},null,8,["text","conversationData"])])):e.createCommentVNode("",!0),"system"===t.conversationType?(e.openBlock(),e.createElementBlock("view",{key:1,class:"TUIChat"},[e.createVNode(y,{data:t.messages,types:t.types},null,8,["data","types"])])):e.createCommentVNode("",!0)],64)}],["__scopeId","data-v-909819ad"]]);const it=d(e.defineComponent({name:"videoPlay",setup(t){const n=e.reactive({videoData:"",show:!1,videoContext:null,direction:0});r((e=>{n.videoData=e&&e.videoMessage,n.show=!0})),i((()=>{n.videoContext=uni.createVideoContext("videoEle")}));return{...e.toRefs(n),toggleClose:()=>{n.show=!1,uni.navigateBack({delta:1})}}}}),[["render",function(t,n,o,r,i,s){return e.openBlock(),e.createElementBlock("view",{class:"dialog-video"},[t.show?(e.openBlock(),e.createElementBlock("video",{key:0,class:"video-box",src:t.videoData,id:"videoEle",controls:"",autoplay:""},null,8,["src"])):e.createCommentVNode("",!0)])}],["__scopeId","data-v-a5f47555"]]),st=e.defineComponent({props:{data:{type:Object,default:()=>({})},isAuth:{type:Boolean,default:!1}},setup(t,n){uni.$TUIKit.TUIGroupServer;const o=e.reactive({groupProfile:{},input:"",isEdit:!1});e.watchEffect((()=>{o.groupProfile=t.data,o.input=o.groupProfile.name}));return{...e.toRefs(o),updateProfile:async()=>{if(o.input&&o.input!==o.groupProfile.name){const e={groupID:o.groupProfile.groupID,name:o.input};uni.$TUIKit.updateGroupProfile(e).then((e=>{})).catch((e=>{})),o.groupProfile.name=o.input,o.input=""}o.isEdit=!o.isEdit}}}});const at=d(st,[["render",function(t,n,o,r,i,s){return e.openBlock(),e.createElementBlock("view",{class:"name"},[e.createElementVNode("label",null,"群名称"),t.isEdit?e.withDirectives((e.openBlock(),e.createElementBlock("input",{key:0,class:"input","onUpdate:modelValue":n[0]||(n[0]=e=>t.input=e),type:"text",onBlur:n[1]||(n[1]=(...e)=>t.updateProfile&&t.updateProfile(...e))},null,544)),[[e.vModelText,t.input]]):(e.openBlock(),e.createElementBlock("view",{key:1,class:"name-container"},[e.createElementVNode("span",null,e.toDisplayString(t.groupProfile.name),1),e.createElementVNode("image",{src:"/assets/edit.a181c718.svg",mode:"scaleToFill",onClick:n[2]||(n[2]=e=>t.isEdit=!t.isEdit),class:"edit-image"})]))])}],["__scopeId","data-v-75b63cc2"]]);const ct=d(e.defineComponent({props:{data:{type:Object,default:()=>({})},isAuth:{type:Boolean,default:!1}},setup(t,n){const o=e.reactive({groupProfile:{},input:"",isEdit:!1});e.watchEffect((()=>{o.groupProfile=t.data,o.input=o.groupProfile.notification}));return{...e.toRefs(o),updateProfile:async()=>{o.input&&o.input!==o.groupProfile.notification&&(n.emit("update",{key:"notification",value:o.input}),o.groupProfile.notification=o.input,o.input=""),o.isEdit=!o.isEdit}}}}),[["render",function(t,n,o,r,i,s){return e.openBlock(),e.createElementBlock("main",{class:"notification"},[t.isEdit?e.withDirectives((e.openBlock(),e.createElementBlock("textarea",{key:0,"onUpdate:modelValue":n[0]||(n[0]=e=>t.input=e),onKeyup:n[1]||(n[1]=e.withKeys(((...e)=>t.updateProfile&&t.updateProfile(...e)),["enter"]))},null,544)),[[e.vModelText,t.input]]):(e.openBlock(),e.createElementBlock("section",{key:1},[t.groupProfile.notification?(e.openBlock(),e.createElementBlock("article",{key:1},e.toDisplayString(t.groupProfile.notification),1)):(e.openBlock(),e.createElementBlock("p",{key:0},"暂无公告"))])),t.isAuth?(e.openBlock(),e.createElementBlock("footer",{key:2},[t.isEdit?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn",onClick:n[2]||(n[2]=(...e)=>t.updateProfile&&t.updateProfile(...e))},"发布")):(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn",onClick:n[3]||(n[3]=e=>t.isEdit=!t.isEdit)},"编辑"))])):e.createCommentVNode("",!0)])}],["__scopeId","data-v-c16cb6ec"]]);const ut=d(e.defineComponent({components:{},props:{list:{type:Array,default:()=>[]},total:{type:Number,default:()=>0},isShowDel:{type:Boolean,default:()=>!1},self:{type:Object,default:()=>({})}},setup(t,n){const o=uni.$TIM.TYPES,r=e.reactive({total:0,list:[],isShowDel:!1,self:{}});e.watchEffect((()=>{r.total=t.total,r.isShowDel=t.isShowDel,r.list=t.list,r.self=t.self}));return{...e.toRefs(r),getMore:()=>{n.emit("more")},submit:e=>{n.emit("del",[e])},handleRoleName:e=>{let t="";switch(null==e?void 0:e.role){case o.GRP_MBR_ROLE_ADMIN:t="管理员";break;case o.GRP_MBR_ROLE_OWNER:t="群主"}return e.userID===r.self.userID&&(t+="我"),t}}}}),[["render",function(t,n,o,r,i,s){return e.openBlock(),e.createElementBlock("main",{class:"member"},[e.createElementVNode("ul",{class:"list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.list,((n,o)=>(e.openBlock(),e.createElementBlock("li",{class:"list-item",key:o},[e.createElementVNode("aside",null,[e.createElementVNode("img",{class:"avatar",src:(null==n?void 0:n.avatar)||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png",onerror:"this.src='https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png'"},null,8,["src"]),e.createElementVNode("span",{class:"name"},e.toDisplayString((null==n?void 0:n.nick)||(null==n?void 0:n.userID)),1),e.createElementVNode("span",null,e.toDisplayString(t.handleRoleName(n)),1)]),"Owner"!==n.role&&t.isShowDel?(e.openBlock(),e.createElementBlock("i",{key:0,class:"icon icon-del",onClick:e=>t.submit(n)},null,8,["onClick"])):e.createCommentVNode("",!0)])))),128)),t.list.length<t.total?(e.openBlock(),e.createElementBlock("li",{key:0,class:"list-item",onClick:n[0]||(n[0]=(...e)=>t.getMore&&t.getMore(...e))}," 查看更多 ")):e.createCommentVNode("",!0)])])}],["__scopeId","data-v-66f0721e"]]),lt=e.defineComponent({components:{ManageName:at,ManageNotification:ct,ManageMember:ut},props:{userInfo:{type:Object,default:()=>({isGroup:!1,list:[]})},conversation:{type:Object,default:()=>({})}},setup(t,n){const o=uni.$TIM.TYPES,r=uni.$TUIKit.TUIGroupServer,i=e.reactive({conversation:{},userInfo:{isGroup:!1,list:[]},isShowMuteTimeInput:!1,editLableName:"",currentTab:"",transferType:"",isSearch:!0,isRadio:!1,transferList:[],selectedList:[],isMuteTime:!1,show:!1,typeName:{[o.GRP_WORK]:"好友工作群",[o.GRP_PUBLIC]:"陌生人社交群",[o.GRP_MEETING]:"临时会议群",[o.GRP_AVCHATROOM]:"直播群",[o.JOIN_OPTIONS_FREE_ACCESS]:"自由加入",[o.JOIN_OPTIONS_NEED_PERMISSION]:"需要验证",[o.JOIN_OPTIONS_DISABLE_APPLY]:"禁止加群"},delDialogShow:!1,userList:[],transferTitle:"",member:{admin:[],member:[],muteMember:[]}}),s=e.ref();e.watchEffect((()=>{i.conversation=t.conversation,i.userInfo=t.userInfo})),re.useStore();const c=e.computed((()=>{let e="";switch(i.currentTab){case"notification":e="群公告";break;case"member":e="群成员";break;default:e="群管理"}return e}));e.watch((()=>i.userInfo.list),((e,t)=>{i.member={admin:[],member:[],muteMember:[]},e.map((e=>{switch(null==e?void 0:e.role){case o.GRP_MBR_ROLE_ADMIN:i.member.admin.push(e);break;case o.GRP_MBR_ROLE_MEMBER:i.member.member.push(e)}return e}));const n=(new Date).getTime();i.member.muteMember=e.filter((e=>1e3*(null==e?void 0:e.muteUntil)-n>0))}),{deep:!0});const u=e.computed((()=>{var e,t;const{conversation:n}=i,r=null==(e=null==n?void 0:n.groupProfile)?void 0:e.selfInfo.role,s=null==(t=null==n?void 0:n.groupProfile)?void 0:t.type,a=r===o.GRP_MBR_ROLE_OWNER,c=s===o.GRP_WORK;return a&&!c})),l=e.computed((()=>{var e;const{conversation:t}=i;return!((null==(e=null==t?void 0:t.groupProfile)?void 0:e.type)!==o.GRP_WORK)})),d=e.computed((()=>{let e=3;return l.value||(e+=1),"Owner"!==i.conversation.groupProfile.selfInfo.role&&(e+=1),e})),p=e.computed((()=>{var e;const{conversation:t}=i,n=null==(e=null==t?void 0:t.groupProfile)?void 0:e.selfInfo.role,r=n===o.GRP_MBR_ROLE_OWNER,s=n===o.GRP_MBR_ROLE_ADMIN;return r||s})),h=e.computed((()=>{var e,t;const{conversation:n}=i,r=null==(e=null==n?void 0:n.groupProfile)?void 0:e.type,s=(null==(t=null==n?void 0:n.groupProfile)?void 0:t.selfInfo.role)===o.GRP_MBR_ROLE_OWNER,a=r===o.GRP_WORK,c=r===o.GRP_AVCHATROOM;return!(a||c||!s)})),g=e=>{var t;const{conversation:n}=i,o={groupID:null==(t=null==n?void 0:n.groupProfile)?void 0:t.groupID,count:100,offset:e&&"more"===e?i.userInfo.list.length:0};uni.$TUIKit.getGroupMemberList(o).then((t=>{i.userInfo.list=e&&"more"===e?[...i.userInfo.list,...t.data.memberList]:t.data.memberList}))},f=e=>{i.currentTab=e,i.editLableName="","member"===i.currentTab&&(i.transferType="remove"),i.currentTab||(i.transferType="")},_=(e,t)=>{const n=[];e.map((e=>(n.push(e.userID),e)))};g(),a((e=>!("backbutton"!==e.from||!i.currentTab)&&(f(""),!0)));return{...e.toRefs(i),isDismissGroupAuth:u,isShowAddMember:l,isAdmin:h,isAuth:p,quit:async e=>{await uni.$TUIKit.quitGroup(e.groupID),uni.navigateTo({url:"../../TUIPages/TUIConversation/index"})},dismiss:async e=>{await uni.$TUIKit.dismissGroup(e.groupID),r.store.conversation={},uni.navigateTo({url:"../../TUIPages/TUIConversation/index"})},edit:e=>{i.editLableName=e},updateProfile:async e=>{const{key:t,value:n}=e,o={groupID:i.conversation.groupProfile.groupID,[t]:n},s=await uni.$TUIKit.updateGroupProfile(o),{conversation:a}=r.store;a.groupProfile=s.data.group,r.store.conversation={},r.store.conversation=a,i.editLableName=""},setTab:f,TabName:c,getMember:g,submit:e=>{"remove"===i.transferType?(i.userList=e,i.delDialogShow=!i.delDialogShow):_(e,i.transferType)},handleManage:_,showUserNum:d,dialog:s,handleOperateMember:e=>{e&&uni.navigateTo({url:`../TUIGroup/memberOperate?type=${e}&groupID=${i.conversation.groupProfile.groupID}`})}}}}),dt="/assets/right-arrow.f71e2fd5.svg";const pt=d(lt,[["render",function(t,n,o,r,i,s){var a,c,u,l,d,p,h,g;const f=e.resolveComponent("ManageName"),_=e.resolveComponent("ManageMember"),m=e.resolveComponent("ManageNotification");return e.openBlock(),e.createElementBlock("view",{class:"manage",ref:"dialog"},[e.createElementVNode("view",{class:"manage-header"},[e.createElementVNode("view",{class:"manage-header-left"},[e.createElementVNode("view",null,[e.createElementVNode("h1",null,e.toDisplayString(t.TabName),1)])])]),t.currentTab?"member"===t.currentTab?(e.openBlock(),e.createBlock(_,{key:1,self:t.conversation.groupProfile.selfInfo,list:t.userInfo.list,total:null==(g=t.conversation.groupProfile.memberCount)?void 0:g.memberCount,isShowDel:"Owner"===t.conversation.groupProfile.selfInfo.role,onMore:n[7]||(n[7]=e=>t.getMember("more")),onDel:t.submit},null,8,["self","list","total","isShowDel","onDel"])):"notification"===t.currentTab?(e.openBlock(),e.createBlock(m,{key:2,isAuth:t.isAuth,data:t.conversation.groupProfile,onUpdate:t.updateProfile},null,8,["isAuth","data","onUpdate"])):"admin"===t.currentTab?(e.openBlock(),e.createElementBlock("main",{key:3,class:"admin"},[t.isAdmin?(e.openBlock(),e.createElementBlock("view",{key:0,class:"admin-list"},[e.createElementVNode("label",null,"群管理员"),e.createElementVNode("view",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.member.admin,((t,n)=>(e.openBlock(),e.createElementBlock("view",{key:n},[e.createElementVNode("view",null,[e.createElementVNode("img",{class:"avatar",src:(null==t?void 0:t.avatar)||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png",onerror:"this.src='https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png'"},null,8,["src"])]),e.createElementVNode("view",null,e.toDisplayString((null==t?void 0:t.nick)||(null==t?void 0:t.userID)),1)])))),128))])])):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:0,class:"main"},[e.createVNode(f,{class:"space-top",isAuth:t.isAuth,data:t.conversation.groupProfile,onUpdate:t.updateProfile},null,8,["isAuth","data","onUpdate"]),e.createElementVNode("view",{class:"userInfo space-top"},[e.createElementVNode("view",{class:"userInfo-header",onClick:n[0]||(n[0]=e=>t.setTab("member"))},[e.createElementVNode("view",null,e.toDisplayString(t.群成员),1),e.createElementVNode("view",{style:{display:"flex"}},[e.createElementVNode("view",null,e.toDisplayString(null==(c=null==(a=t.conversation.groupProfile)?void 0:a.memberCount)?void 0:c.memberCount)+"人",1),e.createElementVNode("image",{class:"image-right",src:dt})])]),e.createElementVNode("view",{style:{display:"flex"}},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(null==(l=null==(u=t.userInfo)?void 0:u.list)?void 0:l.slice(0,t.showUserNum),((t,n)=>(e.openBlock(),e.createElementBlock("view",{key:n},[e.createElementVNode("view",{style:{padding:"10px"}},[e.createElementVNode("image",{class:"avatar",src:(null==t?void 0:t.avatar)||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png",onerror:"this.src='https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png'"},null,8,["src"])]),e.createElementVNode("view",{class:"text-ellipsis"},e.toDisplayString((null==t?void 0:t.nick)||(null==t?void 0:t.userID)),1)])))),128)),t.isShowAddMember?(e.openBlock(),e.createElementBlock("view",{key:0,style:{padding:"10px"}},[e.createElementVNode("view",{class:"avatar",onClick:n[1]||(n[1]=e=>t.handleOperateMember("add"))},"+")])):e.createCommentVNode("",!0),"Owner"===t.conversation.groupProfile.selfInfo.role?(e.openBlock(),e.createElementBlock("view",{key:1,style:{padding:"10px"}},[e.createElementVNode("view",{class:"avatar",onClick:n[2]||(n[2]=e=>t.handleOperateMember("remove"))},"-")])):e.createCommentVNode("",!0)])]),e.createElementVNode("view",{class:"content space-top",onClick:n[4]||(n[4]=e=>t.editLableName="")},[t.isAdmin?(e.openBlock(),e.createElementBlock("view",{key:0,class:"item-li",onClick:n[3]||(n[3]=e.withModifiers((e=>t.setTab("admin")),["stop"]))},[e.createElementVNode("view",null,"群管理"),e.createElementVNode("image",{class:"image-right",src:dt})])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"item-li"},[e.createElementVNode("view",null,"群ID"),e.createElementVNode("view",null,e.toDisplayString(t.conversation.groupProfile.groupID),1)]),e.createElementVNode("view",{class:"item-li"},[e.createElementVNode("view",null,"群头像"),e.createElementVNode("image",{class:"avatar",src:(null==(p=null==(d=t.conversation)?void 0:d.groupProfile)?void 0:p.avatar)||"https://sdk-web-1252463788.cos.ap-hongkong.myqcloud.com/im/demo/TUIkit/web/img/constomer.svg",onerror:"this.src='https://sdk-web-1252463788.cos.ap-hongkong.myqcloud.com/im/demo/TUIkit/web/img/constomer.svg'"},null,8,["src"])]),e.createElementVNode("view",{class:"item-li"},[e.createElementVNode("view",null,"群类型"),e.createElementVNode("view",null,e.toDisplayString(t.typeName[t.conversation.groupProfile.type]),1)]),e.createElementVNode("view",{class:"item-li"},[e.createElementVNode("view",null,"加群方式"),e.createElementVNode("view",null,e.toDisplayString(t.typeName[t.conversation.groupProfile.joinOption]),1)])]),e.createElementVNode("view",{class:"footer space-top"},["Owner"===t.conversation.groupProfile.selfInfo.role&&(null==(h=t.userInfo)?void 0:h.list.length)>1?(e.openBlock(),e.createElementBlock("view",{key:0,class:"group-btn"}," 转让群组 ")):e.createCommentVNode("",!0),t.isDismissGroupAuth?(e.openBlock(),e.createElementBlock("view",{key:1,class:"group-btn",onClick:n[5]||(n[5]=e.withModifiers((e=>t.dismiss(t.conversation.groupProfile)),["stop"]))}," 解散群聊 ")):(e.openBlock(),e.createElementBlock("view",{key:2,class:"group-btn",onClick:n[6]||(n[6]=e.withModifiers((e=>t.quit(t.conversation.groupProfile)),["stop"]))}," 退出群组 "))])]))],512)}],["__scopeId","data-v-8cbb4a5a"]]);const ht=d(e.defineComponent({name:"TUIConversation",components:{TUIGroupManage:pt},setup(t){const n=ie.state.timStore;uni.$TUIKit.TUIGroupServer=new ue;const o=e.reactive({conversation:e.computed((()=>n.conversation)),userInfo:{isGroup:!1,list:[]}});return s((()=>{uni.$TUIKit.TUIGroupServer.destroyed()})),{...e.toRefs(o)}}}),[["render",function(t,n,o,r,i,s){const a=e.resolveComponent("TUIGroupManage");return e.openBlock(),e.createBlock(a,{class:"setting",conversation:t.conversation,userInfo:t.userInfo},null,8,["conversation","userInfo"])}],["__scopeId","data-v-1fe2d995"]]),gt=e.defineComponent({name:"Create",props:{},setup(t,n){uni.$TUIKit.TUIGroupServer;const{userInfo:o}=ie.state.timStore,i=e.reactive({userID:(null==o?void 0:o.userID)||"",inputUserID:"",chooseUserList:[],title:"发起会话",type:"",groupID:""});r((e=>{i.title=(null==e?void 0:e.title)||"发起会话",i.type=(null==e?void 0:e.type)||"",i.groupID=(null==e?void 0:e.groupID)||"",uni.setNavigationBarTitle({title:"add"===(null==e?void 0:e.type)?"添加成员":"删除成员"});const t={groupID:i.groupID,count:100,offset:0};uni.$TUIKit.getGroupMemberList(t).then((e=>{0===e.code&&(i.chooseUserList=(e.data.memberList||[]).map((e=>({...e,isShow:!0,isExist:!0}))))}))}));return{...e.toRefs(i),handleUserIdInput:e=>{i.inputUserID=e.detail.value},handleGetUserProfileInfo:()=>{if(!i.inputUserID)return;const e=[i.inputUserID];uni.showLoading({title:"加载中"}),uni.$TUIKit.getUserProfile({userIDList:e}).then((e=>{if(uni.hideLoading(),e.data.length>0){const t={...e.data[0],isChoose:!1,isShow:!0};0===i.chooseUserList.filter((e=>t.userID===e.userID)).length?i.chooseUserList.push(t):i.chooseUserList=i.chooseUserList.map((e=>e.userID===t.userID?{...e,isShow:!0}:e))}else uni.showToast({title:"搜索用户不存在",icon:"error"}),i.inputUserID=""})).catch((e=>{uni.hideLoading()}))},handleChoose:e=>{if(e.isExist&&"add"===i.type)return;const t=i.chooseUserList.map((t=>e.userID==t.userID?{...t,isChoose:!t.isChoose}:t));i.chooseUserList=t},handleConfirmOperate:async()=>{const{type:e,groupID:t}=i;if("add"===e){const e=i.chooseUserList.filter((e=>e.isChoose&&!e.isExist)).map((e=>e.userID));await uni.$TUIKit.addGroupMember({groupID:t,userIDList:e}),uni.navigateBack()}if("remove"===e){const e=i.chooseUserList.filter((e=>e.isChoose)).map((e=>e.userID));uni.$TUIKit.deleteGroupMember({groupID:t,userIDList:e}).catch((e=>{10004==e.code&&uni.showToast({title:"不能删除自己",icon:"error"})})),uni.navigateBack()}}}}});const ft=d(gt,[["render",function(t,n,o,r,i,s){return e.openBlock(),e.createElementBlock("view",{class:"TUI-Create-conversation-container"},[e.createElementVNode("view",{class:"tui-search-area"},["add"===t.type?(e.openBlock(),e.createElementBlock("view",{key:0,class:"tui-search-bar"},[e.createElementVNode("input",{class:"tui-search-bar-input",value:t.inputUserID,placeholder:"请输入用户ID",onInput:n[0]||(n[0]=(...e)=>t.handleUserIdInput&&t.handleUserIdInput(...e)),onConfirm:n[1]||(n[1]=(...e)=>t.handleGetUserProfileInfo&&t.handleGetUserProfileInfo(...e)),onBlur:n[2]||(n[2]=(...e)=>t.handleGetUserProfileInfo&&t.handleGetUserProfileInfo(...e))},null,40,["value"])])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"tui-showID"},"我的 ID："+e.toDisplayString(t.userID),1)]),t.chooseUserList.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:e.normalizeClass(["tui-person-list-container",{delete:"remove"===t.type}])},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.chooseUserList,((n,o)=>(e.openBlock(),e.createElementBlock("view",{class:e.normalizeClass(["tui-person-to-invite",{isExist:n.isExist}]),key:o,onClick:e=>t.handleChoose(n)},[e.createElementVNode("view",{class:"tui-person-choose-container"},[n.isChoose?(e.openBlock(),e.createElementBlock("image",{key:0,class:"tui-normal-choose",src:he})):(e.openBlock(),e.createElementBlock("view",{key:1,class:e.normalizeClass(["tui-normal-unchoose",{isExist:n.isExist&&"add"===t.type}])},null,2))]),e.createElementVNode("view",{class:"tui-person-profile"},[e.createElementVNode("image",{class:"tui-person-profile-avatar",src:n.avatar||"https://sdk-web-1252463788.cos.ap-hongkong.myqcloud.com/component/TUIKit/assets/avatar_21.png"},null,8,["src"]),e.createElementVNode("view",null,[e.createElementVNode("view",{class:"tui-person-profile-nick"},e.toDisplayString(n.nick),1),e.createElementVNode("view",{class:"tui-person-profile-userID"},"用户ID："+e.toDisplayString(n.userID),1)])]),n.isExist&&"add"===t.type?(e.openBlock(),e.createElementBlock("view",{key:0,class:"exist-tips"},"(已在群聊中)")):e.createCommentVNode("",!0)],10,["onClick"])))),128))],2)):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"tui-confirm-btn-container"},[e.createElementVNode("view",{class:"tui-confirm-btn",onClick:n[3]||(n[3]=(...e)=>t.handleConfirmOperate&&t.handleConfirmOperate(...e))},"确认")])])}],["__scopeId","data-v-473fb7d7"]]);__definePage("pages/TUIKit/TUIPages/TUIConversation/index",pe),__definePage("pages/TUIKit/TUIPages/TUIConversation/create",fe),__definePage("pages/TUIKit/TUIPages/TUIChat/index",rt),__definePage("pages/TUIKit/TUIPages/TUIChat/components/message-elements/video-play",it),__definePage("pages/TUIKit/TUIPages/TUIGroup/index",ht),__definePage("pages/TUIKit/TUIPages/TUIGroup/memberOperate",ft);var _t="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},mt=[],vt=[],yt="undefined"!=typeof Uint8Array?Uint8Array:Array,Mt=!1;function It(){Mt=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0,n=e.length;t<n;++t)mt[t]=e[t],vt[e.charCodeAt(t)]=t;vt["-".charCodeAt(0)]=62,vt["_".charCodeAt(0)]=63}function Ct(e,t,n){for(var o,r,i=[],s=t;s<n;s+=3)o=(e[s]<<16)+(e[s+1]<<8)+e[s+2],i.push(mt[(r=o)>>18&63]+mt[r>>12&63]+mt[r>>6&63]+mt[63&r]);return i.join("")}function Tt(e){var t;Mt||It();for(var n=e.length,o=n%3,r="",i=[],s=0,a=n-o;s<a;s+=16383)i.push(Ct(e,s,s+16383>a?a:s+16383));return 1===o?(t=e[n-1],r+=mt[t>>2],r+=mt[t<<4&63],r+="=="):2===o&&(t=(e[n-2]<<8)+e[n-1],r+=mt[t>>10],r+=mt[t>>4&63],r+=mt[t<<2&63],r+="="),i.push(r),i.join("")}function Et(e,t,n,o,r){var i,s,a=8*r-o-1,c=(1<<a)-1,u=c>>1,l=-7,d=n?r-1:0,p=n?-1:1,h=e[t+d];for(d+=p,i=h&(1<<-l)-1,h>>=-l,l+=a;l>0;i=256*i+e[t+d],d+=p,l-=8);for(s=i&(1<<-l)-1,i>>=-l,l+=o;l>0;s=256*s+e[t+d],d+=p,l-=8);if(0===i)i=1-u;else{if(i===c)return s?NaN:1/0*(h?-1:1);s+=Math.pow(2,o),i-=u}return(h?-1:1)*s*Math.pow(2,i-o)}function kt(e,t,n,o,r,i){var s,a,c,u=8*i-r-1,l=(1<<u)-1,d=l>>1,p=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,h=o?0:i-1,g=o?1:-1,f=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=l):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+d>=1?p/c:p*Math.pow(2,1-d))*c>=2&&(s++,c/=2),s+d>=l?(a=0,s=l):s+d>=1?(a=(t*c-1)*Math.pow(2,r),s+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,r),s=0));r>=8;e[n+h]=255&a,h+=g,a/=256,r-=8);for(s=s<<r|a,u+=r;u>0;e[n+h]=255&s,h+=g,s/=256,u-=8);e[n+h-g]|=128*f}var Dt={}.toString,St=Array.isArray||function(e){return"[object Array]"==Dt.call(e)};function Lt(){return Rt.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function At(e,t){if(Lt()<t)throw new RangeError("Invalid typed array length");return Rt.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=Rt.prototype:(null===e&&(e=new Rt(t)),e.length=t),e}function Rt(e,t,n){if(!(Rt.TYPED_ARRAY_SUPPORT||this instanceof Rt))return new Rt(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return wt(this,e)}return Ot(this,e,t,n)}function Ot(e,t,n,o){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,o){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(o||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===o?new Uint8Array(t):void 0===o?new Uint8Array(t,n):new Uint8Array(t,n,o),Rt.TYPED_ARRAY_SUPPORT?(e=t).__proto__=Rt.prototype:e=bt(e,t),e}(e,t,n,o):"string"==typeof t?function(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!Rt.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var o=0|Gt(t,n),r=(e=At(e,o)).write(t,n);return r!==o&&(e=e.slice(0,r)),e}(e,t,n):function(e,t){if(Pt(t)){var n=0|Ut(t.length);return 0===(e=At(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(o=t.length)!=o?At(e,0):bt(e,t);if("Buffer"===t.type&&St(t.data))return bt(e,t.data)}var o;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function Nt(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function wt(e,t){if(Nt(t),e=At(e,t<0?0:0|Ut(t)),!Rt.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function bt(e,t){var n=t.length<0?0:0|Ut(t.length);e=At(e,n);for(var o=0;o<n;o+=1)e[o]=255&t[o];return e}function Ut(e){if(e>=Lt())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+Lt().toString(16)+" bytes");return 0|e}function Pt(e){return!(null==e||!e._isBuffer)}function Gt(e,t){if(Pt(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var o=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return dn(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return pn(e).length;default:if(o)return dn(e).length;t=(""+t).toLowerCase(),o=!0}}function xt(e,t,n){var o=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return Qt(this,t,n);case"utf8":case"utf-8":return $t(this,t,n);case"ascii":return Xt(this,t,n);case"latin1":case"binary":return Zt(this,t,n);case"base64":return Yt(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return en(this,t,n);default:if(o)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}function Ft(e,t,n){var o=e[t];e[t]=e[n],e[n]=o}function qt(e,t,n,o,r){if(0===e.length)return-1;if("string"==typeof n?(o=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(r)return-1;n=e.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof t&&(t=Rt.from(t,o)),Pt(t))return 0===t.length?-1:Bt(e,t,n,o,r);if("number"==typeof t)return t&=255,Rt.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):Bt(e,[t],n,o,r);throw new TypeError("val must be string, number or Buffer")}function Bt(e,t,n,o,r){var i,s=1,a=e.length,c=t.length;if(void 0!==o&&("ucs2"===(o=String(o).toLowerCase())||"ucs-2"===o||"utf16le"===o||"utf-16le"===o)){if(e.length<2||t.length<2)return-1;s=2,a/=2,c/=2,n/=2}function u(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(r){var l=-1;for(i=n;i<a;i++)if(u(e,i)===u(t,-1===l?0:i-l)){if(-1===l&&(l=i),i-l+1===c)return l*s}else-1!==l&&(i-=i-l),l=-1}else for(n+c>a&&(n=a-c),i=n;i>=0;i--){for(var d=!0,p=0;p<c;p++)if(u(e,i+p)!==u(t,p)){d=!1;break}if(d)return i}return-1}function Vt(e,t,n,o){n=Number(n)||0;var r=e.length-n;o?(o=Number(o))>r&&(o=r):o=r;var i=t.length;if(i%2!=0)throw new TypeError("Invalid hex string");o>i/2&&(o=i/2);for(var s=0;s<o;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[n+s]=a}return s}function Kt(e,t,n,o){return hn(dn(t,e.length-n),e,n,o)}function Ht(e,t,n,o){return hn(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,o)}function jt(e,t,n,o){return Ht(e,t,n,o)}function zt(e,t,n,o){return hn(pn(t),e,n,o)}function Wt(e,t,n,o){return hn(function(e,t){for(var n,o,r,i=[],s=0;s<e.length&&!((t-=2)<0);++s)o=(n=e.charCodeAt(s))>>8,r=n%256,i.push(r),i.push(o);return i}(t,e.length-n),e,n,o)}function Yt(e,t,n){return 0===t&&n===e.length?Tt(e):Tt(e.slice(t,n))}function $t(e,t,n){n=Math.min(e.length,n);for(var o=[],r=t;r<n;){var i,s,a,c,u=e[r],l=null,d=u>239?4:u>223?3:u>191?2:1;if(r+d<=n)switch(d){case 1:u<128&&(l=u);break;case 2:128==(192&(i=e[r+1]))&&(c=(31&u)<<6|63&i)>127&&(l=c);break;case 3:i=e[r+1],s=e[r+2],128==(192&i)&&128==(192&s)&&(c=(15&u)<<12|(63&i)<<6|63&s)>2047&&(c<55296||c>57343)&&(l=c);break;case 4:i=e[r+1],s=e[r+2],a=e[r+3],128==(192&i)&&128==(192&s)&&128==(192&a)&&(c=(15&u)<<18|(63&i)<<12|(63&s)<<6|63&a)>65535&&c<1114112&&(l=c)}null===l?(l=65533,d=1):l>65535&&(l-=65536,o.push(l>>>10&1023|55296),l=56320|1023&l),o.push(l),r+=d}return function(e){var t=e.length;if(t<=Jt)return String.fromCharCode.apply(String,e);for(var n="",o=0;o<t;)n+=String.fromCharCode.apply(String,e.slice(o,o+=Jt));return n}(o)}Rt.TYPED_ARRAY_SUPPORT=void 0===_t.TYPED_ARRAY_SUPPORT||_t.TYPED_ARRAY_SUPPORT,Rt.poolSize=8192,Rt._augment=function(e){return e.__proto__=Rt.prototype,e},Rt.from=function(e,t,n){return Ot(null,e,t,n)},Rt.TYPED_ARRAY_SUPPORT&&(Rt.prototype.__proto__=Uint8Array.prototype,Rt.__proto__=Uint8Array),Rt.alloc=function(e,t,n){return o=null,i=t,s=n,Nt(r=e),r<=0?At(o,r):void 0!==i?"string"==typeof s?At(o,r).fill(i,s):At(o,r).fill(i):At(o,r);var o,r,i,s},Rt.allocUnsafe=function(e){return wt(null,e)},Rt.allocUnsafeSlow=function(e){return wt(null,e)},Rt.isBuffer=gn,Rt.compare=function(e,t){if(!Pt(e)||!Pt(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,o=t.length,r=0,i=Math.min(n,o);r<i;++r)if(e[r]!==t[r]){n=e[r],o=t[r];break}return n<o?-1:o<n?1:0},Rt.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Rt.concat=function(e,t){if(!St(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return Rt.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var o=Rt.allocUnsafe(t),r=0;for(n=0;n<e.length;++n){var i=e[n];if(!Pt(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(o,r),r+=i.length}return o},Rt.byteLength=Gt,Rt.prototype._isBuffer=!0,Rt.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)Ft(this,t,t+1);return this},Rt.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)Ft(this,t,t+3),Ft(this,t+1,t+2);return this},Rt.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)Ft(this,t,t+7),Ft(this,t+1,t+6),Ft(this,t+2,t+5),Ft(this,t+3,t+4);return this},Rt.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?$t(this,0,e):xt.apply(this,arguments)},Rt.prototype.equals=function(e){if(!Pt(e))throw new TypeError("Argument must be a Buffer");return this===e||0===Rt.compare(this,e)},Rt.prototype.inspect=function(){var e="";return this.length>0&&(e=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(e+=" ... ")),"<Buffer "+e+">"},Rt.prototype.compare=function(e,t,n,o,r){if(!Pt(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===o&&(o=0),void 0===r&&(r=this.length),t<0||n>e.length||o<0||r>this.length)throw new RangeError("out of range index");if(o>=r&&t>=n)return 0;if(o>=r)return-1;if(t>=n)return 1;if(this===e)return 0;for(var i=(r>>>=0)-(o>>>=0),s=(n>>>=0)-(t>>>=0),a=Math.min(i,s),c=this.slice(o,r),u=e.slice(t,n),l=0;l<a;++l)if(c[l]!==u[l]){i=c[l],s=u[l];break}return i<s?-1:s<i?1:0},Rt.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},Rt.prototype.indexOf=function(e,t,n){return qt(this,e,t,n,!0)},Rt.prototype.lastIndexOf=function(e,t,n){return qt(this,e,t,n,!1)},Rt.prototype.write=function(e,t,n,o){if(void 0===t)o="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)o=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===o&&(o="utf8")):(o=n,n=void 0)}var r=this.length-t;if((void 0===n||n>r)&&(n=r),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");o||(o="utf8");for(var i=!1;;)switch(o){case"hex":return Vt(this,e,t,n);case"utf8":case"utf-8":return Kt(this,e,t,n);case"ascii":return Ht(this,e,t,n);case"latin1":case"binary":return jt(this,e,t,n);case"base64":return zt(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Wt(this,e,t,n);default:if(i)throw new TypeError("Unknown encoding: "+o);o=(""+o).toLowerCase(),i=!0}},Rt.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Jt=4096;function Xt(e,t,n){var o="";n=Math.min(e.length,n);for(var r=t;r<n;++r)o+=String.fromCharCode(127&e[r]);return o}function Zt(e,t,n){var o="";n=Math.min(e.length,n);for(var r=t;r<n;++r)o+=String.fromCharCode(e[r]);return o}function Qt(e,t,n){var o=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>o)&&(n=o);for(var r="",i=t;i<n;++i)r+=ln(e[i]);return r}function en(e,t,n){for(var o=e.slice(t,n),r="",i=0;i<o.length;i+=2)r+=String.fromCharCode(o[i]+256*o[i+1]);return r}function tn(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function nn(e,t,n,o,r,i){if(!Pt(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<i)throw new RangeError('"value" argument is out of bounds');if(n+o>e.length)throw new RangeError("Index out of range")}function on(e,t,n,o){t<0&&(t=65535+t+1);for(var r=0,i=Math.min(e.length-n,2);r<i;++r)e[n+r]=(t&255<<8*(o?r:1-r))>>>8*(o?r:1-r)}function rn(e,t,n,o){t<0&&(t=4294967295+t+1);for(var r=0,i=Math.min(e.length-n,4);r<i;++r)e[n+r]=t>>>8*(o?r:3-r)&255}function sn(e,t,n,o,r,i){if(n+o>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function an(e,t,n,o,r){return r||sn(e,0,n,4),kt(e,t,n,o,23,4),n+4}function cn(e,t,n,o,r){return r||sn(e,0,n,8),kt(e,t,n,o,52,8),n+8}Rt.prototype.slice=function(e,t){var n,o=this.length;if((e=~~e)<0?(e+=o)<0&&(e=0):e>o&&(e=o),(t=void 0===t?o:~~t)<0?(t+=o)<0&&(t=0):t>o&&(t=o),t<e&&(t=e),Rt.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=Rt.prototype;else{var r=t-e;n=new Rt(r,void 0);for(var i=0;i<r;++i)n[i]=this[i+e]}return n},Rt.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||tn(e,t,this.length);for(var o=this[e],r=1,i=0;++i<t&&(r*=256);)o+=this[e+i]*r;return o},Rt.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||tn(e,t,this.length);for(var o=this[e+--t],r=1;t>0&&(r*=256);)o+=this[e+--t]*r;return o},Rt.prototype.readUInt8=function(e,t){return t||tn(e,1,this.length),this[e]},Rt.prototype.readUInt16LE=function(e,t){return t||tn(e,2,this.length),this[e]|this[e+1]<<8},Rt.prototype.readUInt16BE=function(e,t){return t||tn(e,2,this.length),this[e]<<8|this[e+1]},Rt.prototype.readUInt32LE=function(e,t){return t||tn(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},Rt.prototype.readUInt32BE=function(e,t){return t||tn(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},Rt.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||tn(e,t,this.length);for(var o=this[e],r=1,i=0;++i<t&&(r*=256);)o+=this[e+i]*r;return o>=(r*=128)&&(o-=Math.pow(2,8*t)),o},Rt.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||tn(e,t,this.length);for(var o=t,r=1,i=this[e+--o];o>0&&(r*=256);)i+=this[e+--o]*r;return i>=(r*=128)&&(i-=Math.pow(2,8*t)),i},Rt.prototype.readInt8=function(e,t){return t||tn(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},Rt.prototype.readInt16LE=function(e,t){t||tn(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},Rt.prototype.readInt16BE=function(e,t){t||tn(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},Rt.prototype.readInt32LE=function(e,t){return t||tn(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},Rt.prototype.readInt32BE=function(e,t){return t||tn(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},Rt.prototype.readFloatLE=function(e,t){return t||tn(e,4,this.length),Et(this,e,!0,23,4)},Rt.prototype.readFloatBE=function(e,t){return t||tn(e,4,this.length),Et(this,e,!1,23,4)},Rt.prototype.readDoubleLE=function(e,t){return t||tn(e,8,this.length),Et(this,e,!0,52,8)},Rt.prototype.readDoubleBE=function(e,t){return t||tn(e,8,this.length),Et(this,e,!1,52,8)},Rt.prototype.writeUIntLE=function(e,t,n,o){e=+e,t|=0,n|=0,o||nn(this,e,t,n,Math.pow(2,8*n)-1,0);var r=1,i=0;for(this[t]=255&e;++i<n&&(r*=256);)this[t+i]=e/r&255;return t+n},Rt.prototype.writeUIntBE=function(e,t,n,o){e=+e,t|=0,n|=0,o||nn(this,e,t,n,Math.pow(2,8*n)-1,0);var r=n-1,i=1;for(this[t+r]=255&e;--r>=0&&(i*=256);)this[t+r]=e/i&255;return t+n},Rt.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||nn(this,e,t,1,255,0),Rt.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},Rt.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||nn(this,e,t,2,65535,0),Rt.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):on(this,e,t,!0),t+2},Rt.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||nn(this,e,t,2,65535,0),Rt.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):on(this,e,t,!1),t+2},Rt.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||nn(this,e,t,4,4294967295,0),Rt.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):rn(this,e,t,!0),t+4},Rt.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||nn(this,e,t,4,4294967295,0),Rt.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):rn(this,e,t,!1),t+4},Rt.prototype.writeIntLE=function(e,t,n,o){if(e=+e,t|=0,!o){var r=Math.pow(2,8*n-1);nn(this,e,t,n,r-1,-r)}var i=0,s=1,a=0;for(this[t]=255&e;++i<n&&(s*=256);)e<0&&0===a&&0!==this[t+i-1]&&(a=1),this[t+i]=(e/s>>0)-a&255;return t+n},Rt.prototype.writeIntBE=function(e,t,n,o){if(e=+e,t|=0,!o){var r=Math.pow(2,8*n-1);nn(this,e,t,n,r-1,-r)}var i=n-1,s=1,a=0;for(this[t+i]=255&e;--i>=0&&(s*=256);)e<0&&0===a&&0!==this[t+i+1]&&(a=1),this[t+i]=(e/s>>0)-a&255;return t+n},Rt.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||nn(this,e,t,1,127,-128),Rt.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},Rt.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||nn(this,e,t,2,32767,-32768),Rt.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):on(this,e,t,!0),t+2},Rt.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||nn(this,e,t,2,32767,-32768),Rt.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):on(this,e,t,!1),t+2},Rt.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||nn(this,e,t,4,2147483647,-2147483648),Rt.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):rn(this,e,t,!0),t+4},Rt.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||nn(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),Rt.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):rn(this,e,t,!1),t+4},Rt.prototype.writeFloatLE=function(e,t,n){return an(this,e,t,!0,n)},Rt.prototype.writeFloatBE=function(e,t,n){return an(this,e,t,!1,n)},Rt.prototype.writeDoubleLE=function(e,t,n){return cn(this,e,t,!0,n)},Rt.prototype.writeDoubleBE=function(e,t,n){return cn(this,e,t,!1,n)},Rt.prototype.copy=function(e,t,n,o){if(n||(n=0),o||0===o||(o=this.length),t>=e.length&&(t=e.length),t||(t=0),o>0&&o<n&&(o=n),o===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(o<0)throw new RangeError("sourceEnd out of bounds");o>this.length&&(o=this.length),e.length-t<o-n&&(o=e.length-t+n);var r,i=o-n;if(this===e&&n<t&&t<o)for(r=i-1;r>=0;--r)e[r+t]=this[r+n];else if(i<1e3||!Rt.TYPED_ARRAY_SUPPORT)for(r=0;r<i;++r)e[r+t]=this[r+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+i),t);return i},Rt.prototype.fill=function(e,t,n,o){if("string"==typeof e){if("string"==typeof t?(o=t,t=0,n=this.length):"string"==typeof n&&(o=n,n=this.length),1===e.length){var r=e.charCodeAt(0);r<256&&(e=r)}if(void 0!==o&&"string"!=typeof o)throw new TypeError("encoding must be a string");if("string"==typeof o&&!Rt.isEncoding(o))throw new TypeError("Unknown encoding: "+o)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var i;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{var s=Pt(e)?e:dn(new Rt(e,o).toString()),a=s.length;for(i=0;i<n-t;++i)this[i+t]=s[i%a]}return this};var un=/[^+\/0-9A-Za-z-_]/g;function ln(e){return e<16?"0"+e.toString(16):e.toString(16)}function dn(e,t){var n;t=t||1/0;for(var o=e.length,r=null,i=[],s=0;s<o;++s){if((n=e.charCodeAt(s))>55295&&n<57344){if(!r){if(n>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(s+1===o){(t-=3)>-1&&i.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&i.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&(t-=3)>-1&&i.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;i.push(n)}else if(n<2048){if((t-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function pn(e){return function(e){var t,n,o,r,i,s;Mt||It();var a=e.length;if(a%4>0)throw new Error("Invalid string. Length must be a multiple of 4");i="="===e[a-2]?2:"="===e[a-1]?1:0,s=new yt(3*a/4-i),o=i>0?a-4:a;var c=0;for(t=0,n=0;t<o;t+=4,n+=3)r=vt[e.charCodeAt(t)]<<18|vt[e.charCodeAt(t+1)]<<12|vt[e.charCodeAt(t+2)]<<6|vt[e.charCodeAt(t+3)],s[c++]=r>>16&255,s[c++]=r>>8&255,s[c++]=255&r;return 2===i?(r=vt[e.charCodeAt(t)]<<2|vt[e.charCodeAt(t+1)]>>4,s[c++]=255&r):1===i&&(r=vt[e.charCodeAt(t)]<<10|vt[e.charCodeAt(t+1)]<<4|vt[e.charCodeAt(t+2)]>>2,s[c++]=r>>8&255,s[c++]=255&r),s}(function(e){if((e=(t=e,t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")).replace(un,"")).length<2)return"";for(var t;e.length%4!=0;)e+="=";return e}(e))}function hn(e,t,n,o){for(var r=0;r<o&&!(r+n>=t.length||r>=e.length);++r)t[r+n]=e[r];return r}function gn(e){return null!=e&&(!!e._isBuffer||fn(e)||"function"==typeof(t=e).readFloatLE&&"function"==typeof t.slice&&fn(t.slice(0,0)));var t}function fn(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function _n(e,t){return e(t={exports:{}},t.exports),t.exports}var mn=_n((function(e,t){var n,o,r,i,s,a,c,u,l,d,p,h,g;e.exports=(n=n||(o=Math,r=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),s=(i={}).lib={},a=s.Base={extend:function(e){var t=r(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=s.WordArray=a.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,n=e.words,o=this.sigBytes,r=e.sigBytes;if(this.clamp(),o%4)for(var i=0;i<r;i++){var s=n[i>>>2]>>>24-i%4*8&255;t[o+i>>>2]|=s<<24-(o+i)%4*8}else for(i=0;i<r;i+=4)t[o+i>>>2]=n[i>>>2];return this.sigBytes+=r,this},clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=o.ceil(t/4)},clone:function(){var e=a.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t,n=[],r=function(e){var t=987654321,n=4294967295;return function(){var r=((t=36969*(65535&t)+(t>>16)&n)<<16)+(e=18e3*(65535&e)+(e>>16)&n)&n;return r/=4294967296,(r+=.5)*(o.random()>.5?1:-1)}},i=0;i<e;i+=4){var s=r(4294967296*(t||o.random()));t=987654071*s(),n.push(4294967296*s()|0)}return new c.init(n,e)}}),u=i.enc={},l=u.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,o=[],r=0;r<n;r++){var i=t[r>>>2]>>>24-r%4*8&255;o.push((i>>>4).toString(16)),o.push((15&i).toString(16))}return o.join("")},parse:function(e){for(var t=e.length,n=[],o=0;o<t;o+=2)n[o>>>3]|=parseInt(e.substr(o,2),16)<<24-o%8*4;return new c.init(n,t/2)}},d=u.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,o=[],r=0;r<n;r++){var i=t[r>>>2]>>>24-r%4*8&255;o.push(String.fromCharCode(i))}return o.join("")},parse:function(e){for(var t=e.length,n=[],o=0;o<t;o++)n[o>>>2]|=(255&e.charCodeAt(o))<<24-o%4*8;return new c.init(n,t)}},p=u.Utf8={stringify:function(e){try{return decodeURIComponent(escape(d.stringify(e)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(e){return d.parse(unescape(encodeURIComponent(e)))}},h=s.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=p.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t=this._data,n=t.words,r=t.sigBytes,i=this.blockSize,s=r/(4*i),a=(s=e?o.ceil(s):o.max((0|s)-this._minBufferSize,0))*i,u=o.min(4*a,r);if(a){for(var l=0;l<a;l+=i)this._doProcessBlock(n,l);var d=n.splice(0,a);t.sigBytes-=u}return new c.init(d,u)},clone:function(){var e=a.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),s.Hasher=h.extend({cfg:a.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new g.HMAC.init(e,n).finalize(t)}}}),g=i.algo={},i),n)})),vn=(_n((function(e,t){var n,o,r,i,s,a;e.exports=(r=(o=n=mn).lib,i=r.Base,s=r.WordArray,(a=o.x64={}).Word=i.extend({init:function(e,t){this.high=e,this.low=t}}),a.WordArray=i.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:8*e.length},toX32:function(){for(var e=this.words,t=e.length,n=[],o=0;o<t;o++){var r=e[o];n.push(r.high),n.push(r.low)}return s.create(n,this.sigBytes)},clone:function(){for(var e=i.clone.call(this),t=e.words=this.words.slice(0),n=t.length,o=0;o<n;o++)t[o]=t[o].clone();return e}}),n)})),_n((function(e,t){var n;e.exports=(n=mn,function(){if("function"==typeof ArrayBuffer){var e=n.lib.WordArray,t=e.init;(e.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var n=e.byteLength,o=[],r=0;r<n;r++)o[r>>>2]|=e[r]<<24-r%4*8;t.call(this,o,n)}else t.apply(this,arguments)}).prototype=e}}(),n.lib.WordArray)})),_n((function(e,t){var n;e.exports=(n=mn,function(){var e=n,t=e.lib.WordArray,o=e.enc;function r(e){return e<<8&4278255360|e>>>8&16711935}o.Utf16=o.Utf16BE={stringify:function(e){for(var t=e.words,n=e.sigBytes,o=[],r=0;r<n;r+=2){var i=t[r>>>2]>>>16-r%4*8&65535;o.push(String.fromCharCode(i))}return o.join("")},parse:function(e){for(var n=e.length,o=[],r=0;r<n;r++)o[r>>>1]|=e.charCodeAt(r)<<16-r%2*16;return t.create(o,2*n)}},o.Utf16LE={stringify:function(e){for(var t=e.words,n=e.sigBytes,o=[],i=0;i<n;i+=2){var s=r(t[i>>>2]>>>16-i%4*8&65535);o.push(String.fromCharCode(s))}return o.join("")},parse:function(e){for(var n=e.length,o=[],i=0;i<n;i++)o[i>>>1]|=r(e.charCodeAt(i)<<16-i%2*16);return t.create(o,2*n)}}}(),n.enc.Utf16)})),_n((function(e,t){var n,o,r;e.exports=(r=(o=n=mn).lib.WordArray,o.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,o=this._map;e.clamp();for(var r=[],i=0;i<n;i+=3)for(var s=(t[i>>>2]>>>24-i%4*8&255)<<16|(t[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|t[i+2>>>2]>>>24-(i+2)%4*8&255,a=0;a<4&&i+.75*a<n;a++)r.push(o.charAt(s>>>6*(3-a)&63));var c=o.charAt(64);if(c)for(;r.length%4;)r.push(c);return r.join("")},parse:function(e){var t=e.length,n=this._map,o=this._reverseMap;if(!o){o=this._reverseMap=[];for(var i=0;i<n.length;i++)o[n.charCodeAt(i)]=i}var s=n.charAt(64);if(s){var a=e.indexOf(s);-1!==a&&(t=a)}return function(e,t,n){for(var o=[],i=0,s=0;s<t;s++)if(s%4){var a=n[e.charCodeAt(s-1)]<<s%4*2,c=n[e.charCodeAt(s)]>>>6-s%4*2;o[i>>>2]|=(a|c)<<24-i%4*8,i++}return r.create(o,i)}(e,t,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},n.enc.Base64)})),_n((function(e,t){var n;e.exports=(n=mn,function(e){var t=n,o=t.lib,r=o.WordArray,i=o.Hasher,s=t.algo,a=[];!function(){for(var t=0;t<64;t++)a[t]=4294967296*e.abs(e.sin(t+1))|0}();var c=s.MD5=i.extend({_doReset:function(){this._hash=new r.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var o=t+n,r=e[o];e[o]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8)}var i=this._hash.words,s=e[t+0],c=e[t+1],h=e[t+2],g=e[t+3],f=e[t+4],_=e[t+5],m=e[t+6],v=e[t+7],y=e[t+8],M=e[t+9],I=e[t+10],C=e[t+11],T=e[t+12],E=e[t+13],k=e[t+14],D=e[t+15],S=i[0],L=i[1],A=i[2],R=i[3];S=u(S,L,A,R,s,7,a[0]),R=u(R,S,L,A,c,12,a[1]),A=u(A,R,S,L,h,17,a[2]),L=u(L,A,R,S,g,22,a[3]),S=u(S,L,A,R,f,7,a[4]),R=u(R,S,L,A,_,12,a[5]),A=u(A,R,S,L,m,17,a[6]),L=u(L,A,R,S,v,22,a[7]),S=u(S,L,A,R,y,7,a[8]),R=u(R,S,L,A,M,12,a[9]),A=u(A,R,S,L,I,17,a[10]),L=u(L,A,R,S,C,22,a[11]),S=u(S,L,A,R,T,7,a[12]),R=u(R,S,L,A,E,12,a[13]),A=u(A,R,S,L,k,17,a[14]),S=l(S,L=u(L,A,R,S,D,22,a[15]),A,R,c,5,a[16]),R=l(R,S,L,A,m,9,a[17]),A=l(A,R,S,L,C,14,a[18]),L=l(L,A,R,S,s,20,a[19]),S=l(S,L,A,R,_,5,a[20]),R=l(R,S,L,A,I,9,a[21]),A=l(A,R,S,L,D,14,a[22]),L=l(L,A,R,S,f,20,a[23]),S=l(S,L,A,R,M,5,a[24]),R=l(R,S,L,A,k,9,a[25]),A=l(A,R,S,L,g,14,a[26]),L=l(L,A,R,S,y,20,a[27]),S=l(S,L,A,R,E,5,a[28]),R=l(R,S,L,A,h,9,a[29]),A=l(A,R,S,L,v,14,a[30]),S=d(S,L=l(L,A,R,S,T,20,a[31]),A,R,_,4,a[32]),R=d(R,S,L,A,y,11,a[33]),A=d(A,R,S,L,C,16,a[34]),L=d(L,A,R,S,k,23,a[35]),S=d(S,L,A,R,c,4,a[36]),R=d(R,S,L,A,f,11,a[37]),A=d(A,R,S,L,v,16,a[38]),L=d(L,A,R,S,I,23,a[39]),S=d(S,L,A,R,E,4,a[40]),R=d(R,S,L,A,s,11,a[41]),A=d(A,R,S,L,g,16,a[42]),L=d(L,A,R,S,m,23,a[43]),S=d(S,L,A,R,M,4,a[44]),R=d(R,S,L,A,T,11,a[45]),A=d(A,R,S,L,D,16,a[46]),S=p(S,L=d(L,A,R,S,h,23,a[47]),A,R,s,6,a[48]),R=p(R,S,L,A,v,10,a[49]),A=p(A,R,S,L,k,15,a[50]),L=p(L,A,R,S,_,21,a[51]),S=p(S,L,A,R,T,6,a[52]),R=p(R,S,L,A,g,10,a[53]),A=p(A,R,S,L,I,15,a[54]),L=p(L,A,R,S,c,21,a[55]),S=p(S,L,A,R,y,6,a[56]),R=p(R,S,L,A,D,10,a[57]),A=p(A,R,S,L,m,15,a[58]),L=p(L,A,R,S,E,21,a[59]),S=p(S,L,A,R,f,6,a[60]),R=p(R,S,L,A,C,10,a[61]),A=p(A,R,S,L,h,15,a[62]),L=p(L,A,R,S,M,21,a[63]),i[0]=i[0]+S|0,i[1]=i[1]+L|0,i[2]=i[2]+A|0,i[3]=i[3]+R|0},_doFinalize:function(){var t=this._data,n=t.words,o=8*this._nDataBytes,r=8*t.sigBytes;n[r>>>5]|=128<<24-r%32;var i=e.floor(o/4294967296),s=o;n[15+(r+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),n[14+(r+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),t.sigBytes=4*(n.length+1),this._process();for(var a=this._hash,c=a.words,u=0;u<4;u++){var l=c[u];c[u]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}return a},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});function u(e,t,n,o,r,i,s){var a=e+(t&n|~t&o)+r+s;return(a<<i|a>>>32-i)+t}function l(e,t,n,o,r,i,s){var a=e+(t&o|n&~o)+r+s;return(a<<i|a>>>32-i)+t}function d(e,t,n,o,r,i,s){var a=e+(t^n^o)+r+s;return(a<<i|a>>>32-i)+t}function p(e,t,n,o,r,i,s){var a=e+(n^(t|~o))+r+s;return(a<<i|a>>>32-i)+t}t.MD5=i._createHelper(c),t.HmacMD5=i._createHmacHelper(c)}(Math),n.MD5)})),_n((function(e,t){var n,o,r,i,s,a,c,u;e.exports=(r=(o=n=mn).lib,i=r.WordArray,s=r.Hasher,a=o.algo,c=[],u=a.SHA1=s.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,o=n[0],r=n[1],i=n[2],s=n[3],a=n[4],u=0;u<80;u++){if(u<16)c[u]=0|e[t+u];else{var l=c[u-3]^c[u-8]^c[u-14]^c[u-16];c[u]=l<<1|l>>>31}var d=(o<<5|o>>>27)+a+c[u];d+=u<20?1518500249+(r&i|~r&s):u<40?1859775393+(r^i^s):u<60?(r&i|r&s|i&s)-1894007588:(r^i^s)-899497514,a=s,s=i,i=r<<30|r>>>2,r=o,o=d}n[0]=n[0]+o|0,n[1]=n[1]+r|0,n[2]=n[2]+i|0,n[3]=n[3]+s|0,n[4]=n[4]+a|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,o=8*e.sigBytes;return t[o>>>5]|=128<<24-o%32,t[14+(o+64>>>9<<4)]=Math.floor(n/4294967296),t[15+(o+64>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}}),o.SHA1=s._createHelper(u),o.HmacSHA1=s._createHmacHelper(u),n.SHA1)})),_n((function(e,t){var n;e.exports=(n=mn,function(e){var t=n,o=t.lib,r=o.WordArray,i=o.Hasher,s=t.algo,a=[],c=[];!function(){function t(t){for(var n=e.sqrt(t),o=2;o<=n;o++)if(!(t%o))return!1;return!0}function n(e){return 4294967296*(e-(0|e))|0}for(var o=2,r=0;r<64;)t(o)&&(r<8&&(a[r]=n(e.pow(o,.5))),c[r]=n(e.pow(o,1/3)),r++),o++}();var u=[],l=s.SHA256=i.extend({_doReset:function(){this._hash=new r.init(a.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,o=n[0],r=n[1],i=n[2],s=n[3],a=n[4],l=n[5],d=n[6],p=n[7],h=0;h<64;h++){if(h<16)u[h]=0|e[t+h];else{var g=u[h-15],f=(g<<25|g>>>7)^(g<<14|g>>>18)^g>>>3,_=u[h-2],m=(_<<15|_>>>17)^(_<<13|_>>>19)^_>>>10;u[h]=f+u[h-7]+m+u[h-16]}var v=o&r^o&i^r&i,y=(o<<30|o>>>2)^(o<<19|o>>>13)^(o<<10|o>>>22),M=p+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&l^~a&d)+c[h]+u[h];p=d,d=l,l=a,a=s+M|0,s=i,i=r,r=o,o=M+(y+v)|0}n[0]=n[0]+o|0,n[1]=n[1]+r|0,n[2]=n[2]+i|0,n[3]=n[3]+s|0,n[4]=n[4]+a|0,n[5]=n[5]+l|0,n[6]=n[6]+d|0,n[7]=n[7]+p|0},_doFinalize:function(){var t=this._data,n=t.words,o=8*this._nDataBytes,r=8*t.sigBytes;return n[r>>>5]|=128<<24-r%32,n[14+(r+64>>>9<<4)]=e.floor(o/4294967296),n[15+(r+64>>>9<<4)]=o,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=i._createHelper(l),t.HmacSHA256=i._createHmacHelper(l)}(Math),n.SHA256)})),_n((function(e,t){var n,o,r,i,s,a;e.exports=(r=(o=n=mn).lib.WordArray,i=o.algo,s=i.SHA256,a=i.SHA224=s.extend({_doReset:function(){this._hash=new r.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var e=s._doFinalize.call(this);return e.sigBytes-=4,e}}),o.SHA224=s._createHelper(a),o.HmacSHA224=s._createHmacHelper(a),n.SHA224)})),_n((function(e,t){var n;e.exports=(n=mn,function(){var e=n,t=e.lib.Hasher,o=e.x64,r=o.Word,i=o.WordArray,s=e.algo;function a(){return r.create.apply(r,arguments)}var c=[a(1116352408,3609767458),a(1899447441,602891725),a(3049323471,3964484399),a(3921009573,2173295548),a(961987163,4081628472),a(1508970993,3053834265),a(2453635748,2937671579),a(2870763221,3664609560),a(3624381080,2734883394),a(310598401,1164996542),a(607225278,1323610764),a(1426881987,3590304994),a(1925078388,4068182383),a(2162078206,991336113),a(2614888103,633803317),a(3248222580,3479774868),a(3835390401,2666613458),a(4022224774,944711139),a(264347078,2341262773),a(604807628,2007800933),a(770255983,1495990901),a(1249150122,1856431235),a(1555081692,3175218132),a(1996064986,2198950837),a(2554220882,3999719339),a(2821834349,766784016),a(2952996808,2566594879),a(3210313671,3203337956),a(3336571891,1034457026),a(3584528711,2466948901),a(113926993,3758326383),a(338241895,168717936),a(666307205,1188179964),a(773529912,1546045734),a(1294757372,1522805485),a(1396182291,2643833823),a(1695183700,2343527390),a(1986661051,1014477480),a(2177026350,1206759142),a(2456956037,344077627),a(2730485921,1290863460),a(2820302411,3158454273),a(3259730800,3505952657),a(3345764771,106217008),a(3516065817,3606008344),a(3600352804,1432725776),a(4094571909,1467031594),a(275423344,851169720),a(430227734,3100823752),a(506948616,1363258195),a(659060556,3750685593),a(883997877,3785050280),a(958139571,3318307427),a(1322822218,3812723403),a(1537002063,2003034995),a(1747873779,3602036899),a(1955562222,1575990012),a(2024104815,1125592928),a(2227730452,2716904306),a(2361852424,442776044),a(2428436474,593698344),a(2756734187,3733110249),a(3204031479,2999351573),a(3329325298,3815920427),a(3391569614,3928383900),a(3515267271,566280711),a(3940187606,3454069534),a(4118630271,4000239992),a(116418474,1914138554),a(174292421,2731055270),a(289380356,3203993006),a(460393269,320620315),a(685471733,587496836),a(852142971,1086792851),a(1017036298,365543100),a(1126000580,2618297676),a(1288033470,3409855158),a(1501505948,4234509866),a(1607167915,987167468),a(1816402316,1246189591)],u=[];!function(){for(var e=0;e<80;e++)u[e]=a()}();var l=s.SHA512=t.extend({_doReset:function(){this._hash=new i.init([new r.init(1779033703,4089235720),new r.init(3144134277,2227873595),new r.init(1013904242,4271175723),new r.init(2773480762,1595750129),new r.init(1359893119,2917565137),new r.init(2600822924,725511199),new r.init(528734635,4215389547),new r.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var n=this._hash.words,o=n[0],r=n[1],i=n[2],s=n[3],a=n[4],l=n[5],d=n[6],p=n[7],h=o.high,g=o.low,f=r.high,_=r.low,m=i.high,v=i.low,y=s.high,M=s.low,I=a.high,C=a.low,T=l.high,E=l.low,k=d.high,D=d.low,S=p.high,L=p.low,A=h,R=g,O=f,N=_,w=m,b=v,U=y,P=M,G=I,x=C,F=T,q=E,B=k,V=D,K=S,H=L,j=0;j<80;j++){var z=u[j];if(j<16)var W=z.high=0|e[t+2*j],Y=z.low=0|e[t+2*j+1];else{var $=u[j-15],J=$.high,X=$.low,Z=(J>>>1|X<<31)^(J>>>8|X<<24)^J>>>7,Q=(X>>>1|J<<31)^(X>>>8|J<<24)^(X>>>7|J<<25),ee=u[j-2],te=ee.high,ne=ee.low,oe=(te>>>19|ne<<13)^(te<<3|ne>>>29)^te>>>6,re=(ne>>>19|te<<13)^(ne<<3|te>>>29)^(ne>>>6|te<<26),ie=u[j-7],se=ie.high,ae=ie.low,ce=u[j-16],ue=ce.high,le=ce.low;W=(W=(W=Z+se+((Y=Q+ae)>>>0<Q>>>0?1:0))+oe+((Y+=re)>>>0<re>>>0?1:0))+ue+((Y+=le)>>>0<le>>>0?1:0),z.high=W,z.low=Y}var de,pe=G&F^~G&B,he=x&q^~x&V,ge=A&O^A&w^O&w,fe=R&N^R&b^N&b,_e=(A>>>28|R<<4)^(A<<30|R>>>2)^(A<<25|R>>>7),me=(R>>>28|A<<4)^(R<<30|A>>>2)^(R<<25|A>>>7),ve=(G>>>14|x<<18)^(G>>>18|x<<14)^(G<<23|x>>>9),ye=(x>>>14|G<<18)^(x>>>18|G<<14)^(x<<23|G>>>9),Me=c[j],Ie=Me.high,Ce=Me.low,Te=K+ve+((de=H+ye)>>>0<H>>>0?1:0),Ee=me+fe;K=B,H=V,B=F,V=q,F=G,q=x,G=U+(Te=(Te=(Te=Te+pe+((de+=he)>>>0<he>>>0?1:0))+Ie+((de+=Ce)>>>0<Ce>>>0?1:0))+W+((de+=Y)>>>0<Y>>>0?1:0))+((x=P+de|0)>>>0<P>>>0?1:0)|0,U=w,P=b,w=O,b=N,O=A,N=R,A=Te+(_e+ge+(Ee>>>0<me>>>0?1:0))+((R=de+Ee|0)>>>0<de>>>0?1:0)|0}g=o.low=g+R,o.high=h+A+(g>>>0<R>>>0?1:0),_=r.low=_+N,r.high=f+O+(_>>>0<N>>>0?1:0),v=i.low=v+b,i.high=m+w+(v>>>0<b>>>0?1:0),M=s.low=M+P,s.high=y+U+(M>>>0<P>>>0?1:0),C=a.low=C+x,a.high=I+G+(C>>>0<x>>>0?1:0),E=l.low=E+q,l.high=T+F+(E>>>0<q>>>0?1:0),D=d.low=D+V,d.high=k+B+(D>>>0<V>>>0?1:0),L=p.low=L+H,p.high=S+K+(L>>>0<H>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,o=8*e.sigBytes;return t[o>>>5]|=128<<24-o%32,t[30+(o+128>>>10<<5)]=Math.floor(n/4294967296),t[31+(o+128>>>10<<5)]=n,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=t.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});e.SHA512=t._createHelper(l),e.HmacSHA512=t._createHmacHelper(l)}(),n.SHA512)})),_n((function(e,t){var n,o,r,i,s,a,c,u;e.exports=(r=(o=n=mn).x64,i=r.Word,s=r.WordArray,a=o.algo,c=a.SHA512,u=a.SHA384=c.extend({_doReset:function(){this._hash=new s.init([new i.init(3418070365,3238371032),new i.init(1654270250,914150663),new i.init(2438529370,812702999),new i.init(355462360,4144912697),new i.init(1731405415,4290775857),new i.init(2394180231,1750603025),new i.init(3675008525,1694076839),new i.init(1203062813,3204075428)])},_doFinalize:function(){var e=c._doFinalize.call(this);return e.sigBytes-=16,e}}),o.SHA384=c._createHelper(u),o.HmacSHA384=c._createHmacHelper(u),n.SHA384)})),_n((function(e,t){var n;e.exports=(n=mn,function(e){var t=n,o=t.lib,r=o.WordArray,i=o.Hasher,s=t.x64.Word,a=t.algo,c=[],u=[],l=[];!function(){for(var e=1,t=0,n=0;n<24;n++){c[e+5*t]=(n+1)*(n+2)/2%64;var o=(2*e+3*t)%5;e=t%5,t=o}for(e=0;e<5;e++)for(t=0;t<5;t++)u[e+5*t]=t+(2*e+3*t)%5*5;for(var r=1,i=0;i<24;i++){for(var a=0,d=0,p=0;p<7;p++){if(1&r){var h=(1<<p)-1;h<32?d^=1<<h:a^=1<<h-32}128&r?r=r<<1^113:r<<=1}l[i]=s.create(a,d)}}();var d=[];!function(){for(var e=0;e<25;e++)d[e]=s.create()}();var p=a.SHA3=i.extend({cfg:i.cfg.extend({outputLength:512}),_doReset:function(){for(var e=this._state=[],t=0;t<25;t++)e[t]=new s.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(e,t){for(var n=this._state,o=this.blockSize/2,r=0;r<o;r++){var i=e[t+2*r],s=e[t+2*r+1];i=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),s=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),(L=n[r]).high^=s,L.low^=i}for(var a=0;a<24;a++){for(var p=0;p<5;p++){for(var h=0,g=0,f=0;f<5;f++)h^=(L=n[p+5*f]).high,g^=L.low;var _=d[p];_.high=h,_.low=g}for(p=0;p<5;p++){var m=d[(p+4)%5],v=d[(p+1)%5],y=v.high,M=v.low;for(h=m.high^(y<<1|M>>>31),g=m.low^(M<<1|y>>>31),f=0;f<5;f++)(L=n[p+5*f]).high^=h,L.low^=g}for(var I=1;I<25;I++){var C=(L=n[I]).high,T=L.low,E=c[I];E<32?(h=C<<E|T>>>32-E,g=T<<E|C>>>32-E):(h=T<<E-32|C>>>64-E,g=C<<E-32|T>>>64-E);var k=d[u[I]];k.high=h,k.low=g}var D=d[0],S=n[0];for(D.high=S.high,D.low=S.low,p=0;p<5;p++)for(f=0;f<5;f++){var L=n[I=p+5*f],A=d[I],R=d[(p+1)%5+5*f],O=d[(p+2)%5+5*f];L.high=A.high^~R.high&O.high,L.low=A.low^~R.low&O.low}L=n[0];var N=l[a];L.high^=N.high,L.low^=N.low}},_doFinalize:function(){var t=this._data,n=t.words,o=(this._nDataBytes,8*t.sigBytes),i=32*this.blockSize;n[o>>>5]|=1<<24-o%32,n[(e.ceil((o+1)/i)*i>>>5)-1]|=128,t.sigBytes=4*n.length,this._process();for(var s=this._state,a=this.cfg.outputLength/8,c=a/8,u=[],l=0;l<c;l++){var d=s[l],p=d.high,h=d.low;p=16711935&(p<<8|p>>>24)|4278255360&(p<<24|p>>>8),h=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8),u.push(h),u.push(p)}return new r.init(u,a)},clone:function(){for(var e=i.clone.call(this),t=e._state=this._state.slice(0),n=0;n<25;n++)t[n]=t[n].clone();return e}});t.SHA3=i._createHelper(p),t.HmacSHA3=i._createHmacHelper(p)}(Math),n.SHA3)})),_n((function(e,t){var n;e.exports=(n=mn,function(e){var t=n,o=t.lib,r=o.WordArray,i=o.Hasher,s=t.algo,a=r.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),c=r.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),u=r.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),l=r.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),d=r.create([0,1518500249,1859775393,2400959708,2840853838]),p=r.create([1352829926,1548603684,1836072691,2053994217,0]),h=s.RIPEMD160=i.extend({_doReset:function(){this._hash=r.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var o=t+n,r=e[o];e[o]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8)}var i,s,h,M,I,C,T,E,k,D,S,L=this._hash.words,A=d.words,R=p.words,O=a.words,N=c.words,w=u.words,b=l.words;for(C=i=L[0],T=s=L[1],E=h=L[2],k=M=L[3],D=I=L[4],n=0;n<80;n+=1)S=i+e[t+O[n]]|0,S+=n<16?g(s,h,M)+A[0]:n<32?f(s,h,M)+A[1]:n<48?_(s,h,M)+A[2]:n<64?m(s,h,M)+A[3]:v(s,h,M)+A[4],S=(S=y(S|=0,w[n]))+I|0,i=I,I=M,M=y(h,10),h=s,s=S,S=C+e[t+N[n]]|0,S+=n<16?v(T,E,k)+R[0]:n<32?m(T,E,k)+R[1]:n<48?_(T,E,k)+R[2]:n<64?f(T,E,k)+R[3]:g(T,E,k)+R[4],S=(S=y(S|=0,b[n]))+D|0,C=D,D=k,k=y(E,10),E=T,T=S;S=L[1]+h+k|0,L[1]=L[2]+M+D|0,L[2]=L[3]+I+C|0,L[3]=L[4]+i+T|0,L[4]=L[0]+s+E|0,L[0]=S},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,o=8*e.sigBytes;t[o>>>5]|=128<<24-o%32,t[14+(o+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),e.sigBytes=4*(t.length+1),this._process();for(var r=this._hash,i=r.words,s=0;s<5;s++){var a=i[s];i[s]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}return r},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});function g(e,t,n){return e^t^n}function f(e,t,n){return e&t|~e&n}function _(e,t,n){return(e|~t)^n}function m(e,t,n){return e&n|t&~n}function v(e,t,n){return e^(t|~n)}function y(e,t){return e<<t|e>>>32-t}t.RIPEMD160=i._createHelper(h),t.HmacRIPEMD160=i._createHmacHelper(h)}(),n.RIPEMD160)})),_n((function(e,t){var n,o,r,i;e.exports=(o=(n=mn).lib.Base,r=n.enc,i=r.Utf8,void(n.algo.HMAC=o.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=i.parse(t));var n=e.blockSize,o=4*n;t.sigBytes>o&&(t=e.finalize(t)),t.clamp();for(var r=this._oKey=t.clone(),s=this._iKey=t.clone(),a=r.words,c=s.words,u=0;u<n;u++)a[u]^=1549556828,c[u]^=909522486;r.sigBytes=s.sigBytes=o,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,n=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(n))}})))})),_n((function(e,t){var n,o,r,i,s,a,c,u,l;e.exports=(i=(r=(o=n=mn).lib).Base,s=r.WordArray,c=(a=o.algo).SHA1,u=a.HMAC,l=a.PBKDF2=i.extend({cfg:i.extend({keySize:4,hasher:c,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=this.cfg,o=u.create(n.hasher,e),r=s.create(),i=s.create([1]),a=r.words,c=i.words,l=n.keySize,d=n.iterations;a.length<l;){var p=o.update(t).finalize(i);o.reset();for(var h=p.words,g=h.length,f=p,_=1;_<d;_++){f=o.finalize(f),o.reset();for(var m=f.words,v=0;v<g;v++)h[v]^=m[v]}r.concat(p),c[0]++}return r.sigBytes=4*l,r}}),o.PBKDF2=function(e,t,n){return l.create(n).compute(e,t)},n.PBKDF2)})),_n((function(e,t){var n,o,r,i,s,a,c,u;e.exports=(i=(r=(o=n=mn).lib).Base,s=r.WordArray,c=(a=o.algo).MD5,u=a.EvpKDF=i.extend({cfg:i.extend({keySize:4,hasher:c,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=this.cfg,o=n.hasher.create(),r=s.create(),i=r.words,a=n.keySize,c=n.iterations;i.length<a;){u&&o.update(u);var u=o.update(e).finalize(t);o.reset();for(var l=1;l<c;l++)u=o.finalize(u),o.reset();r.concat(u)}return r.sigBytes=4*a,r}}),o.EvpKDF=function(e,t,n){return u.create(n).compute(e,t)},n.EvpKDF)})),_n((function(e,t){var n,o,r,i,s,a,c,u,l,d,p,h,g,f,_,m,v,y,M,I,C,T,E;e.exports=void((n=mn).lib.Cipher||(o=n,r=o.lib,i=r.Base,s=r.WordArray,a=r.BufferedBlockAlgorithm,c=o.enc,c.Utf8,u=c.Base64,l=o.algo,d=l.EvpKDF,p=r.Cipher=a.extend({cfg:i.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){a.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?E:I}return function(t){return{encrypt:function(n,o,r){return e(o).encrypt(t,n,o,r)},decrypt:function(n,o,r){return e(o).decrypt(t,n,o,r)}}}}()}),r.StreamCipher=p.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),h=o.mode={},g=r.BlockCipherMode=i.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),f=h.CBC=function(){var e=g.extend();function t(e,t,n){var o=this._iv;if(o){var r=o;this._iv=undefined}else r=this._prevBlock;for(var i=0;i<n;i++)e[t+i]^=r[i]}return e.Encryptor=e.extend({processBlock:function(e,n){var o=this._cipher,r=o.blockSize;t.call(this,e,n,r),o.encryptBlock(e,n),this._prevBlock=e.slice(n,n+r)}}),e.Decryptor=e.extend({processBlock:function(e,n){var o=this._cipher,r=o.blockSize,i=e.slice(n,n+r);o.decryptBlock(e,n),t.call(this,e,n,r),this._prevBlock=i}}),e}(),_=o.pad={},m=_.Pkcs7={pad:function(e,t){for(var n=4*t,o=n-e.sigBytes%n,r=o<<24|o<<16|o<<8|o,i=[],a=0;a<o;a+=4)i.push(r);var c=s.create(i,o);e.concat(c)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},r.BlockCipher=p.extend({cfg:p.cfg.extend({mode:f,padding:m}),reset:function(){p.reset.call(this);var e=this.cfg,t=e.iv,n=e.mode;if(this._xformMode==this._ENC_XFORM_MODE)var o=n.createEncryptor;else{o=n.createDecryptor;this._minBufferSize=1}this._mode&&this._mode.__creator==o?this._mode.init(this,t&&t.words):(this._mode=o.call(n,this,t&&t.words),this._mode.__creator=o)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else{t=this._process(!0);e.unpad(t)}return t},blockSize:4}),v=r.CipherParams=i.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),y=o.format={},M=y.OpenSSL={stringify:function(e){var t=e.ciphertext,n=e.salt;if(n)var o=s.create([1398893684,1701076831]).concat(n).concat(t);else o=t;return o.toString(u)},parse:function(e){var t=u.parse(e),n=t.words;if(1398893684==n[0]&&1701076831==n[1]){var o=s.create(n.slice(2,4));n.splice(0,4),t.sigBytes-=16}return v.create({ciphertext:t,salt:o})}},I=r.SerializableCipher=i.extend({cfg:i.extend({format:M}),encrypt:function(e,t,n,o){o=this.cfg.extend(o);var r=e.createEncryptor(n,o),i=r.finalize(t),s=r.cfg;return v.create({ciphertext:i,key:n,iv:s.iv,algorithm:e,mode:s.mode,padding:s.padding,blockSize:e.blockSize,formatter:o.format})},decrypt:function(e,t,n,o){return o=this.cfg.extend(o),t=this._parse(t,o.format),e.createDecryptor(n,o).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),C=o.kdf={},T=C.OpenSSL={execute:function(e,t,n,o){o||(o=s.random(8));var r=d.create({keySize:t+n}).compute(e,o),i=s.create(r.words.slice(t),4*n);return r.sigBytes=4*t,v.create({key:r,iv:i,salt:o})}},E=r.PasswordBasedCipher=I.extend({cfg:I.cfg.extend({kdf:T}),encrypt:function(e,t,n,o){var r=(o=this.cfg.extend(o)).kdf.execute(n,e.keySize,e.ivSize);o.iv=r.iv;var i=I.encrypt.call(this,e,t,r.key,o);return i.mixIn(r),i},decrypt:function(e,t,n,o){o=this.cfg.extend(o),t=this._parse(t,o.format);var r=o.kdf.execute(n,e.keySize,e.ivSize,t.salt);return o.iv=r.iv,I.decrypt.call(this,e,t,r.key,o)}})))})),_n((function(e,t){var n;e.exports=((n=mn).mode.CFB=function(){var e=n.lib.BlockCipherMode.extend();function t(e,t,n,o){var r=this._iv;if(r){var i=r.slice(0);this._iv=void 0}else i=this._prevBlock;o.encryptBlock(i,0);for(var s=0;s<n;s++)e[t+s]^=i[s]}return e.Encryptor=e.extend({processBlock:function(e,n){var o=this._cipher,r=o.blockSize;t.call(this,e,n,r,o),this._prevBlock=e.slice(n,n+r)}}),e.Decryptor=e.extend({processBlock:function(e,n){var o=this._cipher,r=o.blockSize,i=e.slice(n,n+r);t.call(this,e,n,r,o),this._prevBlock=i}}),e}(),n.mode.CFB)})),_n((function(e,t){var n,o,r;e.exports=((n=mn).mode.CTR=(r=(o=n.lib.BlockCipherMode.extend()).Encryptor=o.extend({processBlock:function(e,t){var n=this._cipher,o=n.blockSize,r=this._iv,i=this._counter;r&&(i=this._counter=r.slice(0),this._iv=void 0);var s=i.slice(0);n.encryptBlock(s,0),i[o-1]=i[o-1]+1|0;for(var a=0;a<o;a++)e[t+a]^=s[a]}}),o.Decryptor=r,o),n.mode.CTR)})),_n((function(e,t){var n;e.exports=((n=mn).mode.CTRGladman=function(){var e=n.lib.BlockCipherMode.extend();function t(e){if(255==(e>>24&255)){var t=e>>16&255,n=e>>8&255,o=255&e;255===t?(t=0,255===n?(n=0,255===o?o=0:++o):++n):++t,e=0,e+=t<<16,e+=n<<8,e+=o}else e+=1<<24;return e}var o=e.Encryptor=e.extend({processBlock:function(e,n){var o,r=this._cipher,i=r.blockSize,s=this._iv,a=this._counter;s&&(a=this._counter=s.slice(0),this._iv=void 0),0===((o=a)[0]=t(o[0]))&&(o[1]=t(o[1]));var c=a.slice(0);r.encryptBlock(c,0);for(var u=0;u<i;u++)e[n+u]^=c[u]}});return e.Decryptor=o,e}(),n.mode.CTRGladman)})),_n((function(e,t){var n,o,r;e.exports=((n=mn).mode.OFB=(r=(o=n.lib.BlockCipherMode.extend()).Encryptor=o.extend({processBlock:function(e,t){var n=this._cipher,o=n.blockSize,r=this._iv,i=this._keystream;r&&(i=this._keystream=r.slice(0),this._iv=void 0),n.encryptBlock(i,0);for(var s=0;s<o;s++)e[t+s]^=i[s]}}),o.Decryptor=r,o),n.mode.OFB)})),_n((function(e,t){var n,o;e.exports=((n=mn).mode.ECB=((o=n.lib.BlockCipherMode.extend()).Encryptor=o.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),o.Decryptor=o.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),o),n.mode.ECB)})),_n((function(e,t){var n;e.exports=((n=mn).pad.AnsiX923={pad:function(e,t){var n=e.sigBytes,o=4*t,r=o-n%o,i=n+r-1;e.clamp(),e.words[i>>>2]|=r<<24-i%4*8,e.sigBytes+=r},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},n.pad.Ansix923)})),_n((function(e,t){var n;e.exports=((n=mn).pad.Iso10126={pad:function(e,t){var o=4*t,r=o-e.sigBytes%o;e.concat(n.lib.WordArray.random(r-1)).concat(n.lib.WordArray.create([r<<24],1))},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},n.pad.Iso10126)})),_n((function(e,t){var n;e.exports=((n=mn).pad.Iso97971={pad:function(e,t){e.concat(n.lib.WordArray.create([2147483648],1)),n.pad.ZeroPadding.pad(e,t)},unpad:function(e){n.pad.ZeroPadding.unpad(e),e.sigBytes--}},n.pad.Iso97971)})),_n((function(e,t){var n;e.exports=((n=mn).pad.ZeroPadding={pad:function(e,t){var n=4*t;e.clamp(),e.sigBytes+=n-(e.sigBytes%n||n)},unpad:function(e){for(var t=e.words,n=e.sigBytes-1;!(t[n>>>2]>>>24-n%4*8&255);)n--;e.sigBytes=n+1}},n.pad.ZeroPadding)})),_n((function(e,t){var n;e.exports=((n=mn).pad.NoPadding={pad:function(){},unpad:function(){}},n.pad.NoPadding)})),_n((function(e,t){var n,o,r,i;e.exports=(r=(o=n=mn).lib.CipherParams,i=o.enc.Hex,o.format.Hex={stringify:function(e){return e.ciphertext.toString(i)},parse:function(e){var t=i.parse(e);return r.create({ciphertext:t})}},n.format.Hex)})),_n((function(e,t){var n;e.exports=(n=mn,function(){var e=n,t=e.lib.BlockCipher,o=e.algo,r=[],i=[],s=[],a=[],c=[],u=[],l=[],d=[],p=[],h=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var n=0,o=0;for(t=0;t<256;t++){var g=o^o<<1^o<<2^o<<3^o<<4;g=g>>>8^255&g^99,r[n]=g,i[g]=n;var f=e[n],_=e[f],m=e[_],v=257*e[g]^16843008*g;s[n]=v<<24|v>>>8,a[n]=v<<16|v>>>16,c[n]=v<<8|v>>>24,u[n]=v,v=16843009*m^65537*_^257*f^16843008*n,l[g]=v<<24|v>>>8,d[g]=v<<16|v>>>16,p[g]=v<<8|v>>>24,h[g]=v,n?(n=f^e[e[e[m^f]]],o^=e[e[o]]):n=o=1}}();var g=[0,1,2,4,8,16,32,64,128,27,54],f=o.AES=t.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,n=e.sigBytes/4,o=4*((this._nRounds=n+6)+1),i=this._keySchedule=[],s=0;s<o;s++)if(s<n)i[s]=t[s];else{var a=i[s-1];s%n?n>6&&s%n==4&&(a=r[a>>>24]<<24|r[a>>>16&255]<<16|r[a>>>8&255]<<8|r[255&a]):(a=r[(a=a<<8|a>>>24)>>>24]<<24|r[a>>>16&255]<<16|r[a>>>8&255]<<8|r[255&a],a^=g[s/n|0]<<24),i[s]=i[s-n]^a}for(var c=this._invKeySchedule=[],u=0;u<o;u++)s=o-u,a=u%4?i[s]:i[s-4],c[u]=u<4||s<=4?a:l[r[a>>>24]]^d[r[a>>>16&255]]^p[r[a>>>8&255]]^h[r[255&a]]}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,s,a,c,u,r)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,l,d,p,h,i),n=e[t+1],e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,o,r,i,s,a){for(var c=this._nRounds,u=e[t]^n[0],l=e[t+1]^n[1],d=e[t+2]^n[2],p=e[t+3]^n[3],h=4,g=1;g<c;g++){var f=o[u>>>24]^r[l>>>16&255]^i[d>>>8&255]^s[255&p]^n[h++],_=o[l>>>24]^r[d>>>16&255]^i[p>>>8&255]^s[255&u]^n[h++],m=o[d>>>24]^r[p>>>16&255]^i[u>>>8&255]^s[255&l]^n[h++],v=o[p>>>24]^r[u>>>16&255]^i[l>>>8&255]^s[255&d]^n[h++];u=f,l=_,d=m,p=v}f=(a[u>>>24]<<24|a[l>>>16&255]<<16|a[d>>>8&255]<<8|a[255&p])^n[h++],_=(a[l>>>24]<<24|a[d>>>16&255]<<16|a[p>>>8&255]<<8|a[255&u])^n[h++],m=(a[d>>>24]<<24|a[p>>>16&255]<<16|a[u>>>8&255]<<8|a[255&l])^n[h++],v=(a[p>>>24]<<24|a[u>>>16&255]<<16|a[l>>>8&255]<<8|a[255&d])^n[h++],e[t]=f,e[t+1]=_,e[t+2]=m,e[t+3]=v},keySize:8});e.AES=t._createHelper(f)}(),n.AES)})),_n((function(e,t){var n;e.exports=(n=mn,function(){var e=n,t=e.lib,o=t.WordArray,r=t.BlockCipher,i=e.algo,s=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],a=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],c=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],u=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],l=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],d=i.DES=r.extend({_doReset:function(){for(var e=this._key.words,t=[],n=0;n<56;n++){var o=s[n]-1;t[n]=e[o>>>5]>>>31-o%32&1}for(var r=this._subKeys=[],i=0;i<16;i++){var u=r[i]=[],l=c[i];for(n=0;n<24;n++)u[n/6|0]|=t[(a[n]-1+l)%28]<<31-n%6,u[4+(n/6|0)]|=t[28+(a[n+24]-1+l)%28]<<31-n%6;for(u[0]=u[0]<<1|u[0]>>>31,n=1;n<7;n++)u[n]=u[n]>>>4*(n-1)+3;u[7]=u[7]<<5|u[7]>>>27}var d=this._invSubKeys=[];for(n=0;n<16;n++)d[n]=r[15-n]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._subKeys)},decryptBlock:function(e,t){this._doCryptBlock(e,t,this._invSubKeys)},_doCryptBlock:function(e,t,n){this._lBlock=e[t],this._rBlock=e[t+1],p.call(this,4,252645135),p.call(this,16,65535),h.call(this,2,858993459),h.call(this,8,16711935),p.call(this,1,1431655765);for(var o=0;o<16;o++){for(var r=n[o],i=this._lBlock,s=this._rBlock,a=0,c=0;c<8;c++)a|=u[c][((s^r[c])&l[c])>>>0];this._lBlock=s,this._rBlock=i^a}var d=this._lBlock;this._lBlock=this._rBlock,this._rBlock=d,p.call(this,1,1431655765),h.call(this,8,16711935),h.call(this,2,858993459),p.call(this,16,65535),p.call(this,4,252645135),e[t]=this._lBlock,e[t+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function p(e,t){var n=(this._lBlock>>>e^this._rBlock)&t;this._rBlock^=n,this._lBlock^=n<<e}function h(e,t){var n=(this._rBlock>>>e^this._lBlock)&t;this._lBlock^=n,this._rBlock^=n<<e}e.DES=r._createHelper(d);var g=i.TripleDES=r.extend({_doReset:function(){var e=this._key.words;this._des1=d.createEncryptor(o.create(e.slice(0,2))),this._des2=d.createEncryptor(o.create(e.slice(2,4))),this._des3=d.createEncryptor(o.create(e.slice(4,6)))},encryptBlock:function(e,t){this._des1.encryptBlock(e,t),this._des2.decryptBlock(e,t),this._des3.encryptBlock(e,t)},decryptBlock:function(e,t){this._des3.decryptBlock(e,t),this._des2.encryptBlock(e,t),this._des1.decryptBlock(e,t)},keySize:6,ivSize:2,blockSize:2});e.TripleDES=r._createHelper(g)}(),n.TripleDES)})),_n((function(e,t){var n;e.exports=(n=mn,function(){var e=n,t=e.lib.StreamCipher,o=e.algo,r=o.RC4=t.extend({_doReset:function(){for(var e=this._key,t=e.words,n=e.sigBytes,o=this._S=[],r=0;r<256;r++)o[r]=r;r=0;for(var i=0;r<256;r++){var s=r%n,a=t[s>>>2]>>>24-s%4*8&255;i=(i+o[r]+a)%256;var c=o[r];o[r]=o[i],o[i]=c}this._i=this._j=0},_doProcessBlock:function(e,t){e[t]^=i.call(this)},keySize:8,ivSize:0});function i(){for(var e=this._S,t=this._i,n=this._j,o=0,r=0;r<4;r++){n=(n+e[t=(t+1)%256])%256;var i=e[t];e[t]=e[n],e[n]=i,o|=e[(e[t]+e[n])%256]<<24-8*r}return this._i=t,this._j=n,o}e.RC4=t._createHelper(r);var s=o.RC4Drop=r.extend({cfg:r.cfg.extend({drop:192}),_doReset:function(){r._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)i.call(this)}});e.RC4Drop=t._createHelper(s)}(),n.RC4)})),_n((function(e,t){var n;e.exports=(n=mn,function(){var e=n,t=e.lib.StreamCipher,o=e.algo,r=[],i=[],s=[],a=o.Rabbit=t.extend({_doReset:function(){for(var e=this._key.words,t=this.cfg.iv,n=0;n<4;n++)e[n]=16711935&(e[n]<<8|e[n]>>>24)|4278255360&(e[n]<<24|e[n]>>>8);var o=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],r=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];for(this._b=0,n=0;n<4;n++)c.call(this);for(n=0;n<8;n++)r[n]^=o[n+4&7];if(t){var i=t.words,s=i[0],a=i[1],u=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),l=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),d=u>>>16|4294901760&l,p=l<<16|65535&u;for(r[0]^=u,r[1]^=d,r[2]^=l,r[3]^=p,r[4]^=u,r[5]^=d,r[6]^=l,r[7]^=p,n=0;n<4;n++)c.call(this)}},_doProcessBlock:function(e,t){var n=this._X;c.call(this),r[0]=n[0]^n[5]>>>16^n[3]<<16,r[1]=n[2]^n[7]>>>16^n[5]<<16,r[2]=n[4]^n[1]>>>16^n[7]<<16,r[3]=n[6]^n[3]>>>16^n[1]<<16;for(var o=0;o<4;o++)r[o]=16711935&(r[o]<<8|r[o]>>>24)|4278255360&(r[o]<<24|r[o]>>>8),e[t+o]^=r[o]},blockSize:4,ivSize:2});function c(){for(var e=this._X,t=this._C,n=0;n<8;n++)i[n]=t[n];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<i[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<i[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<i[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<i[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<i[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<i[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<i[6]>>>0?1:0)|0,this._b=t[7]>>>0<i[7]>>>0?1:0,n=0;n<8;n++){var o=e[n]+t[n],r=65535&o,a=o>>>16,c=((r*r>>>17)+r*a>>>15)+a*a,u=((4294901760&o)*o|0)+((65535&o)*o|0);s[n]=c^u}e[0]=s[0]+(s[7]<<16|s[7]>>>16)+(s[6]<<16|s[6]>>>16)|0,e[1]=s[1]+(s[0]<<8|s[0]>>>24)+s[7]|0,e[2]=s[2]+(s[1]<<16|s[1]>>>16)+(s[0]<<16|s[0]>>>16)|0,e[3]=s[3]+(s[2]<<8|s[2]>>>24)+s[1]|0,e[4]=s[4]+(s[3]<<16|s[3]>>>16)+(s[2]<<16|s[2]>>>16)|0,e[5]=s[5]+(s[4]<<8|s[4]>>>24)+s[3]|0,e[6]=s[6]+(s[5]<<16|s[5]>>>16)+(s[4]<<16|s[4]>>>16)|0,e[7]=s[7]+(s[6]<<8|s[6]>>>24)+s[5]|0}e.Rabbit=t._createHelper(a)}(),n.Rabbit)})),_n((function(e,t){var n;e.exports=(n=mn,function(){var e=n,t=e.lib.StreamCipher,o=e.algo,r=[],i=[],s=[],a=o.RabbitLegacy=t.extend({_doReset:function(){var e=this._key.words,t=this.cfg.iv,n=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],o=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];this._b=0;for(var r=0;r<4;r++)c.call(this);for(r=0;r<8;r++)o[r]^=n[r+4&7];if(t){var i=t.words,s=i[0],a=i[1],u=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),l=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),d=u>>>16|4294901760&l,p=l<<16|65535&u;for(o[0]^=u,o[1]^=d,o[2]^=l,o[3]^=p,o[4]^=u,o[5]^=d,o[6]^=l,o[7]^=p,r=0;r<4;r++)c.call(this)}},_doProcessBlock:function(e,t){var n=this._X;c.call(this),r[0]=n[0]^n[5]>>>16^n[3]<<16,r[1]=n[2]^n[7]>>>16^n[5]<<16,r[2]=n[4]^n[1]>>>16^n[7]<<16,r[3]=n[6]^n[3]>>>16^n[1]<<16;for(var o=0;o<4;o++)r[o]=16711935&(r[o]<<8|r[o]>>>24)|4278255360&(r[o]<<24|r[o]>>>8),e[t+o]^=r[o]},blockSize:4,ivSize:2});function c(){for(var e=this._X,t=this._C,n=0;n<8;n++)i[n]=t[n];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<i[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<i[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<i[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<i[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<i[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<i[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<i[6]>>>0?1:0)|0,this._b=t[7]>>>0<i[7]>>>0?1:0,n=0;n<8;n++){var o=e[n]+t[n],r=65535&o,a=o>>>16,c=((r*r>>>17)+r*a>>>15)+a*a,u=((4294901760&o)*o|0)+((65535&o)*o|0);s[n]=c^u}e[0]=s[0]+(s[7]<<16|s[7]>>>16)+(s[6]<<16|s[6]>>>16)|0,e[1]=s[1]+(s[0]<<8|s[0]>>>24)+s[7]|0,e[2]=s[2]+(s[1]<<16|s[1]>>>16)+(s[0]<<16|s[0]>>>16)|0,e[3]=s[3]+(s[2]<<8|s[2]>>>24)+s[1]|0,e[4]=s[4]+(s[3]<<16|s[3]>>>16)+(s[2]<<16|s[2]>>>16)|0,e[5]=s[5]+(s[4]<<8|s[4]>>>24)+s[3]|0,e[6]=s[6]+(s[5]<<16|s[5]>>>16)+(s[4]<<16|s[4]>>>16)|0,e[7]=s[7]+(s[6]<<8|s[6]>>>24)+s[5]|0}e.RabbitLegacy=t._createHelper(a)}(),n.RabbitLegacy)})),_n((function(e,t){e.exports=mn})));function yn(){throw new Error("setTimeout has not been defined")}function Mn(){throw new Error("clearTimeout has not been defined")}var In=yn,Cn=Mn;function Tn(e){if(In===setTimeout)return setTimeout(e,0);if((In===yn||!In)&&setTimeout)return In=setTimeout,setTimeout(e,0);try{return In(e,0)}catch(t){try{return In.call(null,e,0)}catch(n){return In.call(this,e,0)}}}"function"==typeof _t.setTimeout&&(In=setTimeout),"function"==typeof _t.clearTimeout&&(Cn=clearTimeout);var En,kn=[],Dn=!1,Sn=-1;function Ln(){Dn&&En&&(Dn=!1,En.length?kn=En.concat(kn):Sn=-1,kn.length&&An())}function An(){if(!Dn){var e=Tn(Ln);Dn=!0;for(var t=kn.length;t;){for(En=kn,kn=[];++Sn<t;)En&&En[Sn].run();Sn=-1,t=kn.length}En=null,Dn=!1,function(e){if(Cn===clearTimeout)return clearTimeout(e);if((Cn===Mn||!Cn)&&clearTimeout)return Cn=clearTimeout,clearTimeout(e);try{Cn(e)}catch(t){try{return Cn.call(null,e)}catch(n){return Cn.call(this,e)}}}(e)}}function Rn(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];kn.push(new On(e,t)),1!==kn.length||Dn||Tn(An)}function On(e,t){this.fun=e,this.array=t}On.prototype.run=function(){this.fun.apply(null,this.array)};var Nn=_t.performance||{};function wn(){}function bn(){bn.init.call(this)}function Un(e){return void 0===e._maxListeners?bn.defaultMaxListeners:e._maxListeners}function Pn(e,t,n){if(t)e.call(n);else for(var o=e.length,r=Hn(e,o),i=0;i<o;++i)r[i].call(n)}function Gn(e,t,n,o){if(t)e.call(n,o);else for(var r=e.length,i=Hn(e,r),s=0;s<r;++s)i[s].call(n,o)}function xn(e,t,n,o,r){if(t)e.call(n,o,r);else for(var i=e.length,s=Hn(e,i),a=0;a<i;++a)s[a].call(n,o,r)}function Fn(e,t,n,o,r,i){if(t)e.call(n,o,r,i);else for(var s=e.length,a=Hn(e,s),c=0;c<s;++c)a[c].call(n,o,r,i)}function qn(e,t,n,o){if(t)e.apply(n,o);else for(var r=e.length,i=Hn(e,r),s=0;s<r;++s)i[s].apply(n,o)}function Bn(e,n,o,r){var i,s,a,c;if("function"!=typeof o)throw new TypeError('"listener" argument must be a function');if((s=e._events)?(s.newListener&&(e.emit("newListener",n,o.listener?o.listener:o),s=e._events),a=s[n]):(s=e._events=new wn,e._eventsCount=0),a){if("function"==typeof a?a=s[n]=r?[o,a]:[a,o]:r?a.unshift(o):a.push(o),!a.warned&&(i=Un(e))&&i>0&&a.length>i){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+n+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=n,u.count=a.length,c=u,"function"==typeof console.warn?t("warn","at pages/TUIKit/debug/lib-generate-test-usersig-es.min.js:2",c):t("log","at pages/TUIKit/debug/lib-generate-test-usersig-es.min.js:2",c)}}else a=s[n]=o,++e._eventsCount;return e}function Vn(e,t,n){var o=!1;function r(){e.removeListener(t,r),o||(o=!0,n.apply(e,arguments))}return r.listener=n,r}function Kn(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function Hn(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}Nn.now||Nn.mozNow||Nn.msNow||Nn.oNow||Nn.webkitNow,wn.prototype=Object.create(null),bn.EventEmitter=bn,bn.usingDomains=!1,bn.prototype.domain=void 0,bn.prototype._events=void 0,bn.prototype._maxListeners=void 0,bn.defaultMaxListeners=10,bn.init=function(){this.domain=null,bn.usingDomains&&(void 0).active&&(void 0).Domain,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new wn,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},bn.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},bn.prototype.getMaxListeners=function(){return Un(this)},bn.prototype.emit=function(e){var t,n,o,r,i,s,a,c="error"===e;if(s=this._events)c=c&&null==s.error;else if(!c)return!1;if(a=this.domain,c){if(t=arguments[1],!a){if(t instanceof Error)throw t;var u=new Error('Uncaught, unspecified "error" event. ('+t+")");throw u.context=t,u}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=a,t.domainThrown=!1,a.emit("error",t),!1}if(!(n=s[e]))return!1;var l="function"==typeof n;switch(o=arguments.length){case 1:Pn(n,l,this);break;case 2:Gn(n,l,this,arguments[1]);break;case 3:xn(n,l,this,arguments[1],arguments[2]);break;case 4:Fn(n,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(r=new Array(o-1),i=1;i<o;i++)r[i-1]=arguments[i];qn(n,l,this,r)}return!0},bn.prototype.addListener=function(e,t){return Bn(this,e,t,!1)},bn.prototype.on=bn.prototype.addListener,bn.prototype.prependListener=function(e,t){return Bn(this,e,t,!0)},bn.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,Vn(this,e,t)),this},bn.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,Vn(this,e,t)),this},bn.prototype.removeListener=function(e,t){var n,o,r,i,s;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(o=this._events))return this;if(!(n=o[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new wn:(delete o[e],o.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,i=n.length;i-- >0;)if(n[i]===t||n[i].listener&&n[i].listener===t){s=n[i].listener,r=i;break}if(r<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new wn,this;delete o[e]}else!function(e,t){for(var n=t,o=n+1,r=e.length;o<r;n+=1,o+=1)e[n]=e[o];e.pop()}(n,r);o.removeListener&&this.emit("removeListener",e,s||t)}return this},bn.prototype.removeAllListeners=function(e){var t,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new wn,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new wn:delete n[e]),this;if(0===arguments.length){for(var o,r=Object.keys(n),i=0;i<r.length;++i)"removeListener"!==(o=r[i])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=new wn,this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},bn.prototype.listeners=function(e){var t,n=this._events;return n&&(t=n[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[]},bn.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):Kn.call(e,t)},bn.prototype.listenerCount=Kn,bn.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var jn="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e},zn=/%[sdj%]/g;function Wn(e){if(!io(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(Xn(arguments[n]));return t.join(" ")}n=1;for(var o=arguments,r=o.length,i=String(e).replace(zn,(function(e){if("%%"===e)return"%";if(n>=r)return e;switch(e){case"%s":return String(o[n++]);case"%d":return Number(o[n++]);case"%j":try{return JSON.stringify(o[n++])}catch(t){return"[Circular]"}default:return e}})),s=o[n];n<r;s=o[++n])ro(s)||!co(s)?i+=" "+s:i+=" "+Xn(s);return i}function Yn(e,n){if(so(_t.process))return function(){return Yn(e,n).apply(this,arguments)};var o=!1;return function(){return o||(t("error","at pages/TUIKit/debug/lib-generate-test-usersig-es.min.js:2",n),o=!0),e.apply(this,arguments)}}var $n,Jn={};function Xn(e,t){var n={seen:[],stylize:Qn};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),oo(t)?n.showHidden=t:t&&function(e,t){if(!t||!co(t))return e;for(var n=Object.keys(t),o=n.length;o--;)e[n[o]]=t[n[o]]}(n,t),so(n.showHidden)&&(n.showHidden=!1),so(n.depth)&&(n.depth=2),so(n.colors)&&(n.colors=!1),so(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=Zn),eo(n,e,n.depth)}function Zn(e,t){var n=Xn.styles[t];return n?"["+Xn.colors[n][0]+"m"+e+"["+Xn.colors[n][1]+"m":e}function Qn(e,t){return e}function eo(e,t,n){if(e.customInspect&&t&&po(t.inspect)&&t.inspect!==Xn&&(!t.constructor||t.constructor.prototype!==t)){var o=t.inspect(n,e);return io(o)||(o=eo(e,o,n)),o}var r=function(e,t){if(so(t))return e.stylize("undefined","undefined");if(io(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return"number"==typeof t?e.stylize(""+t,"number"):oo(t)?e.stylize(""+t,"boolean"):ro(t)?e.stylize("null","null"):void 0}(e,t);if(r)return r;var i,s=Object.keys(t),a=(i={},s.forEach((function(e,t){i[e]=!0})),i);if(e.showHidden&&(s=Object.getOwnPropertyNames(t)),lo(t)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return to(t);if(0===s.length){if(po(t)){var c=t.name?": "+t.name:"";return e.stylize("[Function"+c+"]","special")}if(ao(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(uo(t))return e.stylize(Date.prototype.toString.call(t),"date");if(lo(t))return to(t)}var u,l,d="",p=!1,h=["{","}"];return u=t,Array.isArray(u)&&(p=!0,h=["[","]"]),po(t)&&(d=" [Function"+(t.name?": "+t.name:"")+"]"),ao(t)&&(d=" "+RegExp.prototype.toString.call(t)),uo(t)&&(d=" "+Date.prototype.toUTCString.call(t)),lo(t)&&(d=" "+to(t)),0!==s.length||p&&0!=t.length?n<0?ao(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),l=p?function(e,t,n,o,r){for(var i=[],s=0,a=t.length;s<a;++s)go(t,String(s))?i.push(no(e,t,n,o,String(s),!0)):i.push("");return r.forEach((function(r){r.match(/^\d+$/)||i.push(no(e,t,n,o,r,!0))})),i}(e,t,n,a,s):s.map((function(o){return no(e,t,n,a,o,p)})),e.seen.pop(),function(e,t,n){return e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}(l,d,h)):h[0]+d+h[1]}function to(e){return"["+Error.prototype.toString.call(e)+"]"}function no(e,t,n,o,r,i){var s,a,c;if((c=Object.getOwnPropertyDescriptor(t,r)||{value:t[r]}).get?a=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(a=e.stylize("[Setter]","special")),go(o,r)||(s="["+r+"]"),a||(e.seen.indexOf(c.value)<0?(a=ro(n)?eo(e,c.value,null):eo(e,c.value,n-1)).indexOf("\n")>-1&&(a=i?a.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+a.split("\n").map((function(e){return"   "+e})).join("\n")):a=e.stylize("[Circular]","special")),so(s)){if(i&&r.match(/^\d+$/))return a;(s=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+a}function oo(e){return"boolean"==typeof e}function ro(e){return null===e}function io(e){return"string"==typeof e}function so(e){return void 0===e}function ao(e){return co(e)&&"[object RegExp]"===ho(e)}function co(e){return"object"==typeof e&&null!==e}function uo(e){return co(e)&&"[object Date]"===ho(e)}function lo(e){return co(e)&&("[object Error]"===ho(e)||e instanceof Error)}function po(e){return"function"==typeof e}function ho(e){return Object.prototype.toString.call(e)}function go(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function fo(){this.head=null,this.tail=null,this.length=0}Xn.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},Xn.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},fo.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},fo.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},fo.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},fo.prototype.clear=function(){this.head=this.tail=null,this.length=0},fo.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},fo.prototype.concat=function(e){if(0===this.length)return Rt.alloc(0);if(1===this.length)return this.head.data;for(var t=Rt.allocUnsafe(e>>>0),n=this.head,o=0;n;)n.data.copy(t,o),o+=n.data.length,n=n.next;return t};var _o=Rt.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function mo(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),function(e){if(e&&!_o(e))throw new Error("Unknown encoding: "+e)}(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=yo;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=Mo;break;default:return void(this.write=vo)}this.charBuffer=new Rt(6),this.charReceived=0,this.charLength=0}function vo(e){return e.toString(this.encoding)}function yo(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function Mo(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}mo.prototype.write=function(e){for(var t="";this.charLength;){var n=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,n),this.charReceived+=n,this.charReceived<this.charLength)return"";if(e=e.slice(n,e.length),!((o=(t=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(t.length-1))>=55296&&o<=56319)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var o,r=e.length;if(this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,r),r-=this.charReceived),r=(t+=e.toString(this.encoding,0,r)).length-1,(o=t.charCodeAt(r))>=55296&&o<=56319){var i=this.surrogateSize;return this.charLength+=i,this.charReceived+=i,this.charBuffer.copy(this.charBuffer,i,0,i),e.copy(this.charBuffer,0,0,i),t.substring(0,r)}return t},mo.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var n=e[e.length-t];if(1==t&&n>>5==6){this.charLength=2;break}if(t<=2&&n>>4==14){this.charLength=3;break}if(t<=3&&n>>3==30){this.charLength=4;break}}this.charReceived=t},mo.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var n=this.charReceived,o=this.charBuffer,r=this.encoding;t+=o.slice(0,n).toString(r)}return t},Eo.ReadableState=To;var Io,Co=(Io="stream",so($n)&&($n=""),Io=Io.toUpperCase(),Jn[Io]||(new RegExp("\\b"+Io+"\\b","i").test($n)?Jn[Io]=function(){var e=Wn.apply(null,arguments);t("error","at pages/TUIKit/debug/lib-generate-test-usersig-es.min.js:2","%s %d: %s",Io,0,e)}:Jn[Io]=function(){}),Jn[Io]);function To(e,t){e=e||{},this.objectMode=!!e.objectMode,t instanceof Zo&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var n=e.highWaterMark,o=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:o,this.highWaterMark=~~this.highWaterMark,this.buffer=new fo,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(this.decoder=new mo(e.encoding),this.encoding=e.encoding)}function Eo(e){if(!(this instanceof Eo))return new Eo(e);this._readableState=new To(e,this),this.readable=!0,e&&"function"==typeof e.read&&(this._read=e.read),bn.call(this)}function ko(e,t,n,o,r){var i,s,a,c=(i=t,a=null,gn(s=n)||"string"==typeof s||null==s||i.objectMode||(a=new TypeError("Invalid non-string/buffer chunk")),a);if(c)e.emit("error",c);else if(null===n)t.reading=!1,function(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,Lo(e)}}(e,t);else if(t.objectMode||n&&n.length>0)if(t.ended&&!r){var u=new Error("stream.push() after EOF");e.emit("error",u)}else if(t.endEmitted&&r){var l=new Error("stream.unshift() after end event");e.emit("error",l)}else{var d;!t.decoder||r||o||(n=t.decoder.write(n),d=!t.objectMode&&0===n.length),r||(t.reading=!1),d||(t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&Lo(e))),function(e,t){t.readingMore||(t.readingMore=!0,Rn(Ro,e,t))}(e,t)}else r||(t.reading=!1);return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(t)}jn(Eo,bn),Eo.prototype.push=function(e,t){var n=this._readableState;return n.objectMode||"string"!=typeof e||(t=t||n.defaultEncoding)!==n.encoding&&(e=Rt.from(e,t),t=""),ko(this,n,e,t,!1)},Eo.prototype.unshift=function(e){return ko(this,this._readableState,e,"",!0)},Eo.prototype.isPaused=function(){return!1===this._readableState.flowing},Eo.prototype.setEncoding=function(e){return this._readableState.decoder=new mo(e),this._readableState.encoding=e,this};var Do=8388608;function So(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=((n=e)>=Do?n=Do:(n--,n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,n|=n>>>16,n++),n)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0));var n}function Lo(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(Co("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?Rn(Ao,e):Ao(e))}function Ao(e){Co("emit readable"),e.emit("readable"),wo(e)}function Ro(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(Co("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function Oo(e){Co("readable nexttick read 0"),e.read(0)}function No(e,t){t.reading||(Co("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),wo(e),t.flowing&&!t.reading&&e.read(0)}function wo(e){var t=e._readableState;for(Co("flow",t.flowing);t.flowing&&null!==e.read(););}function bo(e,t){return 0===t.length?null:(t.objectMode?s=t.buffer.shift():!e||e>=t.length?(s=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):(n=e,o=t.buffer,r=t.decoder,n<o.head.data.length?(i=o.head.data.slice(0,n),o.head.data=o.head.data.slice(n)):i=n===o.head.data.length?o.shift():r?function(e,t){var n=t.head,o=1,r=n.data;for(e-=r.length;n=n.next;){var i=n.data,s=e>i.length?i.length:e;if(s===i.length?r+=i:r+=i.slice(0,e),0==(e-=s)){s===i.length?(++o,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=i.slice(s));break}++o}return t.length-=o,r}(n,o):function(e,t){var n=Rt.allocUnsafe(e),o=t.head,r=1;for(o.data.copy(n),e-=o.data.length;o=o.next;){var i=o.data,s=e>i.length?i.length:e;if(i.copy(n,n.length-e,0,s),0==(e-=s)){s===i.length?(++r,o.next?t.head=o.next:t.head=t.tail=null):(t.head=o,o.data=i.slice(s));break}++r}return t.length-=r,n}(n,o),s=i),s);var n,o,r,i,s}function Uo(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,Rn(Po,t,e))}function Po(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function Go(e,t){for(var n=0,o=e.length;n<o;n++)if(e[n]===t)return n;return-1}function xo(){}function Fo(e,t,n){this.chunk=e,this.encoding=t,this.callback=n,this.next=null}function qo(e,t){Object.defineProperty(this,"buffer",{get:Yn((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")}),e=e||{},this.objectMode=!!e.objectMode,t instanceof Zo&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var n=e.highWaterMark,o=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:o,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var r=!1===e.decodeStrings;this.decodeStrings=!r,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n,o=e._writableState,r=o.sync,i=o.writecb;if((n=o).writing=!1,n.writecb=null,n.length-=n.writelen,n.writelen=0,t)!function(e,t,n,o,r){--t.pendingcb,n?Rn(r,o):r(o),e._writableState.errorEmitted=!0,e.emit("error",o)}(e,o,r,t,i);else{var s=jo(o);s||o.corked||o.bufferProcessing||!o.bufferedRequest||Ho(e,o),r?Rn(Ko,e,o,s,i):Ko(e,o,s,i)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new Yo(this)}function Bo(e){if(!(this instanceof Bo||this instanceof Zo))return new Bo(e);this._writableState=new qo(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev)),bn.call(this)}function Vo(e,t,n,o,r,i,s){t.writelen=o,t.writecb=s,t.writing=!0,t.sync=!0,n?e._writev(r,t.onwrite):e._write(r,i,t.onwrite),t.sync=!1}function Ko(e,t,n,o){var r,i;n||(r=e,0===(i=t).length&&i.needDrain&&(i.needDrain=!1,r.emit("drain"))),t.pendingcb--,o(),Wo(e,t)}function Ho(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var o=t.bufferedRequestCount,r=new Array(o),i=t.corkedRequestsFree;i.entry=n;for(var s=0;n;)r[s]=n,n=n.next,s+=1;Vo(e,t,!0,t.length,r,"",i.finish),t.pendingcb++,t.lastBufferedRequest=null,i.next?(t.corkedRequestsFree=i.next,i.next=null):t.corkedRequestsFree=new Yo(t)}else{for(;n;){var a=n.chunk,c=n.encoding,u=n.callback;if(Vo(e,t,!1,t.objectMode?1:a.length,a,c,u),n=n.next,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=n,t.bufferProcessing=!1}function jo(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function zo(e,t){t.prefinished||(t.prefinished=!0,e.emit("prefinish"))}function Wo(e,t){var n=jo(t);return n&&(0===t.pendingcb?(zo(e,t),t.finished=!0,e.emit("finish")):zo(e,t)),n}function Yo(e){var t=this;this.next=null,this.entry=null,this.finish=function(n){var o=t.entry;for(t.entry=null;o;){var r=o.callback;e.pendingcb--,r(n),o=o.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}}Eo.prototype.read=function(e){Co("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return Co("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?Uo(this):Lo(this),null;if(0===(e=So(e,t))&&t.ended)return 0===t.length&&Uo(this),null;var o,r=t.needReadable;return Co("need readable",r),(0===t.length||t.length-e<t.highWaterMark)&&Co("length less than watermark",r=!0),t.ended||t.reading?Co("reading or ended",r=!1):r&&(Co("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=So(n,t))),null===(o=e>0?bo(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&Uo(this)),null!==o&&this.emit("data",o),o},Eo.prototype._read=function(e){this.emit("error",new Error("not implemented"))},Eo.prototype.pipe=function(e,t){var n=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=e;break;case 1:o.pipes=[o.pipes,e];break;default:o.pipes.push(e)}o.pipesCount+=1,Co("pipe count=%d opts=%j",o.pipesCount,t);var r=t&&!1===t.end?l:s;function i(e){Co("onunpipe"),e===n&&l()}function s(){Co("onend"),e.end()}o.endEmitted?Rn(r):n.once("end",r),e.on("unpipe",i);var a,c=(a=n,function(){var e=a._readableState;Co("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&a.listeners("data").length&&(e.flowing=!0,wo(a))});e.on("drain",c);var u=!1;function l(){Co("cleanup"),e.removeListener("close",g),e.removeListener("finish",f),e.removeListener("drain",c),e.removeListener("error",h),e.removeListener("unpipe",i),n.removeListener("end",s),n.removeListener("end",l),n.removeListener("data",p),u=!0,!o.awaitDrain||e._writableState&&!e._writableState.needDrain||c()}var d=!1;function p(t){Co("ondata"),d=!1,!1!==e.write(t)||d||((1===o.pipesCount&&o.pipes===e||o.pipesCount>1&&-1!==Go(o.pipes,e))&&!u&&(Co("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,d=!0),n.pause())}function h(t){Co("onerror",t),_(),e.removeListener("error",h),0===("error",e.listeners("error").length)&&e.emit("error",t)}function g(){e.removeListener("finish",f),_()}function f(){Co("onfinish"),e.removeListener("close",g),_()}function _(){Co("unpipe"),n.unpipe(e)}return n.on("data",p),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",h),e.once("close",g),e.once("finish",f),e.emit("pipe",n),o.flowing||(Co("pipe resume"),n.resume()),e},Eo.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this)),this;if(!e){var n=t.pipes,o=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var r=0;r<o;r++)n[r].emit("unpipe",this);return this}var i=Go(t.pipes,e);return-1===i||(t.pipes.splice(i,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this)),this},Eo.prototype.on=function(e,t){var n=bn.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var o=this._readableState;o.endEmitted||o.readableListening||(o.readableListening=o.needReadable=!0,o.emittedReadable=!1,o.reading?o.length&&Lo(this):Rn(Oo,this))}return n},Eo.prototype.addListener=Eo.prototype.on,Eo.prototype.resume=function(){var e,t,n=this._readableState;return n.flowing||(Co("resume"),n.flowing=!0,e=this,(t=n).resumeScheduled||(t.resumeScheduled=!0,Rn(No,e,t))),this},Eo.prototype.pause=function(){return Co("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(Co("pause"),this._readableState.flowing=!1,this.emit("pause")),this},Eo.prototype.wrap=function(e){var t=this._readableState,n=!1,o=this;for(var r in e.on("end",(function(){if(Co("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&o.push(e)}o.push(null)})),e.on("data",(function(r){Co("wrapped data"),t.decoder&&(r=t.decoder.write(r)),t.objectMode&&null==r||(t.objectMode||r&&r.length)&&(o.push(r)||(n=!0,e.pause()))})),e)void 0===this[r]&&"function"==typeof e[r]&&(this[r]=function(t){return function(){return e[t].apply(e,arguments)}}(r));return function(e,t){for(var n=0,o=e.length;n<o;n++)t(e[n])}(["error","close","destroy","pause","resume"],(function(t){e.on(t,o.emit.bind(o,t))})),o._read=function(t){Co("wrapped _read",t),n&&(n=!1,e.resume())},o},Eo._fromList=bo,Bo.WritableState=qo,jn(Bo,bn),qo.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},Bo.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},Bo.prototype.write=function(e,t,n){var o,r,i,s=this._writableState,a=!1;return"function"==typeof t&&(n=t,t=null),Rt.isBuffer(e)?t="buffer":t||(t=s.defaultEncoding),"function"!=typeof n&&(n=xo),s.ended?(o=this,r=n,i=new Error("write after end"),o.emit("error",i),Rn(r,i)):function(e,t,n,o){var r=!0,i=!1;return null===n?i=new TypeError("May not write null values to stream"):Rt.isBuffer(n)||"string"==typeof n||void 0===n||t.objectMode||(i=new TypeError("Invalid non-string/buffer chunk")),i&&(e.emit("error",i),Rn(o,i),r=!1),r}(this,s,e,n)&&(s.pendingcb++,a=function(e,t,n,o,r){var i,s,a;s=n,a=o,(i=t).objectMode||!1===i.decodeStrings||"string"!=typeof s||(s=Rt.from(s,a)),n=s,Rt.isBuffer(n)&&(o="buffer");var c=t.objectMode?1:n.length;t.length+=c;var u=t.length<t.highWaterMark;if(u||(t.needDrain=!0),t.writing||t.corked){var l=t.lastBufferedRequest;t.lastBufferedRequest=new Fo(n,o,r),l?l.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else Vo(e,t,!1,c,n,o,r);return u}(this,s,e,t,n)),a},Bo.prototype.cork=function(){this._writableState.corked++},Bo.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||Ho(this,e))},Bo.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Bo.prototype._write=function(e,t,n){n(new Error("not implemented"))},Bo.prototype._writev=null,Bo.prototype.end=function(e,t,n){var o,r,i,s=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),s.corked&&(s.corked=1,this.uncork()),s.ending||s.finished||(o=this,i=n,(r=s).ending=!0,Wo(o,r),i&&(r.finished?Rn(i):o.once("finish",i)),r.ended=!0,o.writable=!1)},jn(Zo,Eo);for(var $o=Object.keys(Bo.prototype),Jo=0;Jo<$o.length;Jo++){var Xo=$o[Jo];Zo.prototype[Xo]||(Zo.prototype[Xo]=Bo.prototype[Xo])}function Zo(e){if(!(this instanceof Zo))return new Zo(e);Eo.call(this,e),Bo.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",Qo)}function Qo(){this.allowHalfOpen||this._writableState.ended||Rn(er,this)}function er(e){e.end()}function tr(e){this.afterTransform=function(t,n){return function(e,t,n){var o=e._transformState;o.transforming=!1;var r=o.writecb;if(!r)return e.emit("error",new Error("no writecb in Transform class"));o.writechunk=null,o.writecb=null,null!=n&&e.push(n),r(t);var i=e._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&e._read(i.highWaterMark)}(e,t,n)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function nr(e){if(!(this instanceof nr))return new nr(e);Zo.call(this,e),this._transformState=new tr(this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.once("prefinish",(function(){"function"==typeof this._flush?this._flush((function(e){or(t,e)})):or(t)}))}function or(e,t){if(t)return e.emit("error",t);var n=e._writableState,o=e._transformState;if(n.length)throw new Error("Calling transform done when ws.length != 0");if(o.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}function rr(e){if(!(this instanceof rr))return new rr(e);nr.call(this,e)}function ir(){bn.call(this)}jn(nr,Zo),nr.prototype.push=function(e,t){return this._transformState.needTransform=!1,Zo.prototype.push.call(this,e,t)},nr.prototype._transform=function(e,t,n){throw new Error("Not implemented")},nr.prototype._write=function(e,t,n){var o=this._transformState;if(o.writecb=n,o.writechunk=e,o.writeencoding=t,!o.transforming){var r=this._readableState;(o.needTransform||r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}},nr.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},jn(rr,nr),rr.prototype._transform=function(e,t,n){n(null,e)},jn(ir,bn),ir.Readable=Eo,ir.Writable=Bo,ir.Duplex=Zo,ir.Transform=nr,ir.PassThrough=rr,ir.Stream=ir,ir.prototype.pipe=function(e,t){var n=this;function o(t){e.writable&&!1===e.write(t)&&n.pause&&n.pause()}function r(){n.readable&&n.resume&&n.resume()}n.on("data",o),e.on("drain",r),e._isStdio||t&&!1===t.end||(n.on("end",s),n.on("close",a));var i=!1;function s(){i||(i=!0,e.end())}function a(){i||(i=!0,"function"==typeof e.destroy&&e.destroy())}function c(e){if(u(),0===bn.listenerCount(this,"error"))throw e}function u(){n.removeListener("data",o),e.removeListener("drain",r),n.removeListener("end",s),n.removeListener("close",a),n.removeListener("error",c),e.removeListener("error",c),n.removeListener("end",u),n.removeListener("close",u),e.removeListener("close",u)}return n.on("error",c),e.on("error",c),n.on("end",u),n.on("close",u),e.on("close",u),e.emit("pipe",n),e};var sr={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};function ar(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}function cr(e,t,n,o,r){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+o),r);else for(var i=0;i<o;i++)e[r+i]=t[n+i]}var ur=Uint8Array,lr=Uint16Array,dr=Int32Array;function pr(e){for(var t=e.length;--t>=0;)e[t]=0}var hr=256,gr=286,fr=30,_r=15,mr=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],vr=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],yr=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Mr=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Ir=new Array(576);pr(Ir);var Cr=new Array(60);pr(Cr);var Tr=new Array(512);pr(Tr);var Er=new Array(256);pr(Er);var kr=new Array(29);pr(kr);var Dr,Sr,Lr,Ar=new Array(fr);function Rr(e,t,n,o,r){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=o,this.max_length=r,this.has_stree=e&&e.length}function Or(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function Nr(e){return e<256?Tr[e]:Tr[256+(e>>>7)]}function wr(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function br(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,wr(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function Ur(e,t,n){br(e,n[2*t],n[2*t+1])}function Pr(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function Gr(e,t,n){var o,r,i=new Array(16),s=0;for(o=1;o<=_r;o++)i[o]=s=s+n[o-1]<<1;for(r=0;r<=t;r++){var a=e[2*r+1];0!==a&&(e[2*r]=Pr(i[a]++,a))}}function xr(e){var t;for(t=0;t<gr;t++)e.dyn_ltree[2*t]=0;for(t=0;t<fr;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function Fr(e){e.bi_valid>8?wr(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function qr(e,t,n,o){var r=2*t,i=2*n;return e[r]<e[i]||e[r]===e[i]&&o[t]<=o[n]}function Br(e,t,n){for(var o=e.heap[n],r=n<<1;r<=e.heap_len&&(r<e.heap_len&&qr(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!qr(t,o,e.heap[r],e.depth));)e.heap[n]=e.heap[r],n=r,r<<=1;e.heap[n]=o}function Vr(e,t,n){var o,r,i,s,a=0;if(0!==e.last_lit)do{o=e.pending_buf[e.d_buf+2*a]<<8|e.pending_buf[e.d_buf+2*a+1],r=e.pending_buf[e.l_buf+a],a++,0===o?Ur(e,r,t):(Ur(e,(i=Er[r])+hr+1,t),0!==(s=mr[i])&&br(e,r-=kr[i],s),Ur(e,i=Nr(--o),n),0!==(s=vr[i])&&br(e,o-=Ar[i],s))}while(a<e.last_lit);Ur(e,256,t)}function Kr(e,t){var n,o,r,i=t.dyn_tree,s=t.stat_desc.static_tree,a=t.stat_desc.has_stree,c=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<c;n++)0!==i[2*n]?(e.heap[++e.heap_len]=u=n,e.depth[n]=0):i[2*n+1]=0;for(;e.heap_len<2;)i[2*(r=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[r]=0,e.opt_len--,a&&(e.static_len-=s[2*r+1]);for(t.max_code=u,n=e.heap_len>>1;n>=1;n--)Br(e,i,n);r=c;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Br(e,i,1),o=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=o,i[2*r]=i[2*n]+i[2*o],e.depth[r]=(e.depth[n]>=e.depth[o]?e.depth[n]:e.depth[o])+1,i[2*n+1]=i[2*o+1]=r,e.heap[1]=r++,Br(e,i,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,o,r,i,s,a,c=t.dyn_tree,u=t.max_code,l=t.stat_desc.static_tree,d=t.stat_desc.has_stree,p=t.stat_desc.extra_bits,h=t.stat_desc.extra_base,g=t.stat_desc.max_length,f=0;for(i=0;i<=_r;i++)e.bl_count[i]=0;for(c[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(i=c[2*c[2*(o=e.heap[n])+1]+1]+1)>g&&(i=g,f++),c[2*o+1]=i,o>u||(e.bl_count[i]++,s=0,o>=h&&(s=p[o-h]),a=c[2*o],e.opt_len+=a*(i+s),d&&(e.static_len+=a*(l[2*o+1]+s)));if(0!==f){do{for(i=g-1;0===e.bl_count[i];)i--;e.bl_count[i]--,e.bl_count[i+1]+=2,e.bl_count[g]--,f-=2}while(f>0);for(i=g;0!==i;i--)for(o=e.bl_count[i];0!==o;)(r=e.heap[--n])>u||(c[2*r+1]!==i&&(e.opt_len+=(i-c[2*r+1])*c[2*r],c[2*r+1]=i),o--)}}(e,t),Gr(i,u,e.bl_count)}function Hr(e,t,n){var o,r,i=-1,s=t[1],a=0,c=7,u=4;for(0===s&&(c=138,u=3),t[2*(n+1)+1]=65535,o=0;o<=n;o++)r=s,s=t[2*(o+1)+1],++a<c&&r===s||(a<u?e.bl_tree[2*r]+=a:0!==r?(r!==i&&e.bl_tree[2*r]++,e.bl_tree[32]++):a<=10?e.bl_tree[34]++:e.bl_tree[36]++,a=0,i=r,0===s?(c=138,u=3):r===s?(c=6,u=3):(c=7,u=4))}function jr(e,t,n){var o,r,i=-1,s=t[1],a=0,c=7,u=4;for(0===s&&(c=138,u=3),o=0;o<=n;o++)if(r=s,s=t[2*(o+1)+1],!(++a<c&&r===s)){if(a<u)do{Ur(e,r,e.bl_tree)}while(0!=--a);else 0!==r?(r!==i&&(Ur(e,r,e.bl_tree),a--),Ur(e,16,e.bl_tree),br(e,a-3,2)):a<=10?(Ur(e,17,e.bl_tree),br(e,a-3,3)):(Ur(e,18,e.bl_tree),br(e,a-11,7));a=0,i=r,0===s?(c=138,u=3):r===s?(c=6,u=3):(c=7,u=4)}}pr(Ar);var zr=!1;function Wr(e,t,n,o){var r,i,s;br(e,0+(o?1:0),3),i=t,s=n,Fr(r=e),wr(r,s),wr(r,~s),cr(r.pending_buf,r.window,i,s,r.pending),r.pending+=s}function Yr(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(Er[n]+hr+1)]++,e.dyn_dtree[2*Nr(t)]++),e.last_lit===e.lit_bufsize-1}function $r(e,t,n,o){for(var r=65535&e|0,i=e>>>16&65535|0,s=0;0!==n;){n-=s=n>2e3?2e3:n;do{i=i+(r=r+t[o++]|0)|0}while(--s);r%=65521,i%=65521}return r|i<<16|0}var Jr=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var o=0;o<8;o++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();function Xr(e,t,n,o){var r=Jr,i=o+n;e^=-1;for(var s=o;s<i;s++)e=e>>>8^r[255&(e^t[s])];return-1^e}var Zr,Qr=-2,ei=258,ti=262,ni=103,oi=113,ri=666;function ii(e,t){return e.msg=sr[t],t}function si(e){return(e<<1)-(e>4?9:0)}function ai(e){for(var t=e.length;--t>=0;)e[t]=0}function ci(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(cr(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function ui(e,t){(function(e,t,n,o){var r,i,s=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<hr;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),Kr(e,e.l_desc),Kr(e,e.d_desc),s=function(e){var t;for(Hr(e,e.dyn_ltree,e.l_desc.max_code),Hr(e,e.dyn_dtree,e.d_desc.max_code),Kr(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*Mr[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),r=e.opt_len+3+7>>>3,(i=e.static_len+3+7>>>3)<=r&&(r=i)):r=i=n+5,n+4<=r&&-1!==t?Wr(e,t,n,o):4===e.strategy||i===r?(br(e,2+(o?1:0),3),Vr(e,Ir,Cr)):(br(e,4+(o?1:0),3),function(e,t,n,o){var r;for(br(e,t-257,5),br(e,n-1,5),br(e,o-4,4),r=0;r<o;r++)br(e,e.bl_tree[2*Mr[r]+1],3);jr(e,e.dyn_ltree,t-1),jr(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),Vr(e,e.dyn_ltree,e.dyn_dtree)),xr(e),o&&Fr(e)})(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ci(e.strm)}function li(e,t){e.pending_buf[e.pending++]=t}function di(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function pi(e,t){var n,o,r=e.max_chain_length,i=e.strstart,s=e.prev_length,a=e.nice_match,c=e.strstart>e.w_size-ti?e.strstart-(e.w_size-ti):0,u=e.window,l=e.w_mask,d=e.prev,p=e.strstart+ei,h=u[i+s-1],g=u[i+s];e.prev_length>=e.good_match&&(r>>=2),a>e.lookahead&&(a=e.lookahead);do{if(u[(n=t)+s]===g&&u[n+s-1]===h&&u[n]===u[i]&&u[++n]===u[i+1]){i+=2,n++;do{}while(u[++i]===u[++n]&&u[++i]===u[++n]&&u[++i]===u[++n]&&u[++i]===u[++n]&&u[++i]===u[++n]&&u[++i]===u[++n]&&u[++i]===u[++n]&&u[++i]===u[++n]&&i<p);if(o=ei-(p-i),i=p-ei,o>s){if(e.match_start=t,s=o,o>=a)break;h=u[i+s-1],g=u[i+s]}}}while((t=d[t&l])>c&&0!=--r);return s<=e.lookahead?s:e.lookahead}function hi(e){var t,n,o,r,i,s,a,c,u,l,d=e.w_size;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=d+(d-ti)){cr(e.window,e.window,d,d,0),e.match_start-=d,e.strstart-=d,e.block_start-=d,t=n=e.hash_size;do{o=e.head[--t],e.head[t]=o>=d?o-d:0}while(--n);t=n=d;do{o=e.prev[--t],e.prev[t]=o>=d?o-d:0}while(--n);r+=d}if(0===e.strm.avail_in)break;if(s=e.strm,a=e.window,c=e.strstart+e.lookahead,u=r,l=void 0,(l=s.avail_in)>u&&(l=u),n=0===l?0:(s.avail_in-=l,cr(a,s.input,s.next_in,l,c),1===s.state.wrap?s.adler=$r(s.adler,a,l,c):2===s.state.wrap&&(s.adler=Xr(s.adler,a,l,c)),s.next_in+=l,s.total_in+=l,l),e.lookahead+=n,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=(e.ins_h<<e.hash_shift^e.window[i+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[i+3-1])&e.hash_mask,e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<ti&&0!==e.strm.avail_in)}function gi(e,t){for(var n,o;;){if(e.lookahead<ti){if(hi(e),e.lookahead<ti&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-ti&&(e.match_length=pi(e,n)),e.match_length>=3)if(o=Yr(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else o=Yr(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(o&&(ui(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(ui(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(ui(e,!1),0===e.strm.avail_out)?1:2}function fi(e,t){for(var n,o,r;;){if(e.lookahead<ti){if(hi(e),e.lookahead<ti&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-ti&&(e.match_length=pi(e,n),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-3,o=Yr(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=r&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,o&&(ui(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((o=Yr(e,0,e.window[e.strstart-1]))&&ui(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(o=Yr(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(ui(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(ui(e,!1),0===e.strm.avail_out)?1:2}function _i(e,t,n,o,r){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=o,this.func=r}function mi(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new lr(1146),this.dyn_dtree=new lr(122),this.bl_tree=new lr(78),ai(this.dyn_ltree),ai(this.dyn_dtree),ai(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new lr(16),this.heap=new lr(573),ai(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new lr(573),ai(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function vi(e){var t,n,o,r=(n=e)&&n.state?(n.total_in=n.total_out=0,n.data_type=2,(o=n.state).pending=0,o.pending_out=0,o.wrap<0&&(o.wrap=-o.wrap),o.status=o.wrap?42:oi,n.adler=2===o.wrap?0:1,o.last_flush=0,function(e){zr||(function(){var e,t,n,o,r,i=new Array(16);for(n=0,o=0;o<28;o++)for(kr[o]=n,e=0;e<1<<mr[o];e++)Er[n++]=o;for(Er[n-1]=o,r=0,o=0;o<16;o++)for(Ar[o]=r,e=0;e<1<<vr[o];e++)Tr[r++]=o;for(r>>=7;o<fr;o++)for(Ar[o]=r<<7,e=0;e<1<<vr[o]-7;e++)Tr[256+r++]=o;for(t=0;t<=_r;t++)i[t]=0;for(e=0;e<=143;)Ir[2*e+1]=8,e++,i[8]++;for(;e<=255;)Ir[2*e+1]=9,e++,i[9]++;for(;e<=279;)Ir[2*e+1]=7,e++,i[7]++;for(;e<=287;)Ir[2*e+1]=8,e++,i[8]++;for(Gr(Ir,287,i),e=0;e<fr;e++)Cr[2*e+1]=5,Cr[2*e]=Pr(e,5);Dr=new Rr(Ir,mr,257,gr,_r),Sr=new Rr(Cr,vr,0,fr,_r),Lr=new Rr(new Array(0),yr,0,19,7)}(),zr=!0),e.l_desc=new Or(e.dyn_ltree,Dr),e.d_desc=new Or(e.dyn_dtree,Sr),e.bl_desc=new Or(e.bl_tree,Lr),e.bi_buf=0,e.bi_valid=0,xr(e)}(o),0):ii(n,Qr);return 0===r&&((t=e.state).window_size=2*t.w_size,ai(t.head),t.max_lazy_match=Zr[t.level].max_lazy,t.good_match=Zr[t.level].good_length,t.nice_match=Zr[t.level].nice_length,t.max_chain_length=Zr[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),r}function yi(e,t){var n,o,r,i;if(!e||!e.state||t>5||t<0)return e?ii(e,Qr):Qr;if(o=e.state,!e.output||!e.input&&0!==e.avail_in||o.status===ri&&4!==t)return ii(e,0===e.avail_out?-5:Qr);if(o.strm=e,n=o.last_flush,o.last_flush=t,42===o.status)if(2===o.wrap)e.adler=0,li(o,31),li(o,139),li(o,8),o.gzhead?(li(o,(o.gzhead.text?1:0)+(o.gzhead.hcrc?2:0)+(o.gzhead.extra?4:0)+(o.gzhead.name?8:0)+(o.gzhead.comment?16:0)),li(o,255&o.gzhead.time),li(o,o.gzhead.time>>8&255),li(o,o.gzhead.time>>16&255),li(o,o.gzhead.time>>24&255),li(o,9===o.level?2:o.strategy>=2||o.level<2?4:0),li(o,255&o.gzhead.os),o.gzhead.extra&&o.gzhead.extra.length&&(li(o,255&o.gzhead.extra.length),li(o,o.gzhead.extra.length>>8&255)),o.gzhead.hcrc&&(e.adler=Xr(e.adler,o.pending_buf,o.pending,0)),o.gzindex=0,o.status=69):(li(o,0),li(o,0),li(o,0),li(o,0),li(o,0),li(o,9===o.level?2:o.strategy>=2||o.level<2?4:0),li(o,3),o.status=oi);else{var s=8+(o.w_bits-8<<4)<<8;s|=(o.strategy>=2||o.level<2?0:o.level<6?1:6===o.level?2:3)<<6,0!==o.strstart&&(s|=32),s+=31-s%31,o.status=oi,di(o,s),0!==o.strstart&&(di(o,e.adler>>>16),di(o,65535&e.adler)),e.adler=1}if(69===o.status)if(o.gzhead.extra){for(r=o.pending;o.gzindex<(65535&o.gzhead.extra.length)&&(o.pending!==o.pending_buf_size||(o.gzhead.hcrc&&o.pending>r&&(e.adler=Xr(e.adler,o.pending_buf,o.pending-r,r)),ci(e),r=o.pending,o.pending!==o.pending_buf_size));)li(o,255&o.gzhead.extra[o.gzindex]),o.gzindex++;o.gzhead.hcrc&&o.pending>r&&(e.adler=Xr(e.adler,o.pending_buf,o.pending-r,r)),o.gzindex===o.gzhead.extra.length&&(o.gzindex=0,o.status=73)}else o.status=73;if(73===o.status)if(o.gzhead.name){r=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>r&&(e.adler=Xr(e.adler,o.pending_buf,o.pending-r,r)),ci(e),r=o.pending,o.pending===o.pending_buf_size)){i=1;break}i=o.gzindex<o.gzhead.name.length?255&o.gzhead.name.charCodeAt(o.gzindex++):0,li(o,i)}while(0!==i);o.gzhead.hcrc&&o.pending>r&&(e.adler=Xr(e.adler,o.pending_buf,o.pending-r,r)),0===i&&(o.gzindex=0,o.status=91)}else o.status=91;if(91===o.status)if(o.gzhead.comment){r=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>r&&(e.adler=Xr(e.adler,o.pending_buf,o.pending-r,r)),ci(e),r=o.pending,o.pending===o.pending_buf_size)){i=1;break}i=o.gzindex<o.gzhead.comment.length?255&o.gzhead.comment.charCodeAt(o.gzindex++):0,li(o,i)}while(0!==i);o.gzhead.hcrc&&o.pending>r&&(e.adler=Xr(e.adler,o.pending_buf,o.pending-r,r)),0===i&&(o.status=ni)}else o.status=ni;if(o.status===ni&&(o.gzhead.hcrc?(o.pending+2>o.pending_buf_size&&ci(e),o.pending+2<=o.pending_buf_size&&(li(o,255&e.adler),li(o,e.adler>>8&255),e.adler=0,o.status=oi)):o.status=oi),0!==o.pending){if(ci(e),0===e.avail_out)return o.last_flush=-1,0}else if(0===e.avail_in&&si(t)<=si(n)&&4!==t)return ii(e,-5);if(o.status===ri&&0!==e.avail_in)return ii(e,-5);if(0!==e.avail_in||0!==o.lookahead||0!==t&&o.status!==ri){var a=2===o.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(hi(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,n=Yr(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(ui(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(ui(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(ui(e,!1),0===e.strm.avail_out)?1:2}(o,t):3===o.strategy?function(e,t){for(var n,o,r,i,s=e.window;;){if(e.lookahead<=ei){if(hi(e),e.lookahead<=ei&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(o=s[r=e.strstart-1])===s[++r]&&o===s[++r]&&o===s[++r]){i=e.strstart+ei;do{}while(o===s[++r]&&o===s[++r]&&o===s[++r]&&o===s[++r]&&o===s[++r]&&o===s[++r]&&o===s[++r]&&o===s[++r]&&r<i);e.match_length=ei-(i-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=Yr(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=Yr(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(ui(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(ui(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(ui(e,!1),0===e.strm.avail_out)?1:2}(o,t):Zr[o.level].func(o,t);if(3!==a&&4!==a||(o.status=ri),1===a||3===a)return 0===e.avail_out&&(o.last_flush=-1),0;if(2===a&&(1===t?function(e){var t;br(e,2,3),Ur(e,256,Ir),16===(t=e).bi_valid?(wr(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(o):5!==t&&(Wr(o,0,0,!1),3===t&&(ai(o.head),0===o.lookahead&&(o.strstart=0,o.block_start=0,o.insert=0))),ci(e),0===e.avail_out))return o.last_flush=-1,0}return 4!==t?0:o.wrap<=0?1:(2===o.wrap?(li(o,255&e.adler),li(o,e.adler>>8&255),li(o,e.adler>>16&255),li(o,e.adler>>24&255),li(o,255&e.total_in),li(o,e.total_in>>8&255),li(o,e.total_in>>16&255),li(o,e.total_in>>24&255)):(di(o,e.adler>>>16),di(o,65535&e.adler)),ci(e),o.wrap>0&&(o.wrap=-o.wrap),0!==o.pending?0:1)}Zr=[new _i(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(hi(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var o=e.block_start+n;if((0===e.strstart||e.strstart>=o)&&(e.lookahead=e.strstart-o,e.strstart=o,ui(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-ti&&(ui(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(ui(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(ui(e,!1),e.strm.avail_out),1)})),new _i(4,4,8,4,gi),new _i(4,5,16,8,gi),new _i(4,6,32,32,gi),new _i(4,4,16,16,fi),new _i(8,16,32,32,fi),new _i(8,16,128,128,fi),new _i(8,32,128,256,fi),new _i(32,128,258,1024,fi),new _i(32,258,258,4096,fi)];function Mi(e,t){var n,o,r,i,s,a,c,u,l,d,p,h,g,f,_,m,v,y,M,I,C,T,E,k,D;n=e.state,o=e.next_in,k=e.input,r=o+(e.avail_in-5),i=e.next_out,D=e.output,s=i-(t-e.avail_out),a=i+(e.avail_out-257),c=n.dmax,u=n.wsize,l=n.whave,d=n.wnext,p=n.window,h=n.hold,g=n.bits,f=n.lencode,_=n.distcode,m=(1<<n.lenbits)-1,v=(1<<n.distbits)-1;e:do{g<15&&(h+=k[o++]<<g,g+=8,h+=k[o++]<<g,g+=8),y=f[h&m];t:for(;;){if(h>>>=M=y>>>24,g-=M,0==(M=y>>>16&255))D[i++]=65535&y;else{if(!(16&M)){if(0==(64&M)){y=f[(65535&y)+(h&(1<<M)-1)];continue t}if(32&M){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}I=65535&y,(M&=15)&&(g<M&&(h+=k[o++]<<g,g+=8),I+=h&(1<<M)-1,h>>>=M,g-=M),g<15&&(h+=k[o++]<<g,g+=8,h+=k[o++]<<g,g+=8),y=_[h&v];n:for(;;){if(h>>>=M=y>>>24,g-=M,!(16&(M=y>>>16&255))){if(0==(64&M)){y=_[(65535&y)+(h&(1<<M)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(C=65535&y,g<(M&=15)&&(h+=k[o++]<<g,(g+=8)<M&&(h+=k[o++]<<g,g+=8)),(C+=h&(1<<M)-1)>c){e.msg="invalid distance too far back",n.mode=30;break e}if(h>>>=M,g-=M,C>(M=i-s)){if((M=C-M)>l&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(T=0,E=p,0===d){if(T+=u-M,M<I){I-=M;do{D[i++]=p[T++]}while(--M);T=i-C,E=D}}else if(d<M){if(T+=u+d-M,(M-=d)<I){I-=M;do{D[i++]=p[T++]}while(--M);if(T=0,d<I){I-=M=d;do{D[i++]=p[T++]}while(--M);T=i-C,E=D}}}else if(T+=d-M,M<I){I-=M;do{D[i++]=p[T++]}while(--M);T=i-C,E=D}for(;I>2;)D[i++]=E[T++],D[i++]=E[T++],D[i++]=E[T++],I-=3;I&&(D[i++]=E[T++],I>1&&(D[i++]=E[T++]))}else{T=i-C;do{D[i++]=D[T++],D[i++]=D[T++],D[i++]=D[T++],I-=3}while(I>2);I&&(D[i++]=D[T++],I>1&&(D[i++]=D[T++]))}break}}break}}while(o<r&&i<a);o-=I=g>>3,h&=(1<<(g-=I<<3))-1,e.next_in=o,e.next_out=i,e.avail_in=o<r?r-o+5:5-(o-r),e.avail_out=i<a?a-i+257:257-(i-a),n.hold=h,n.bits=g}var Ii=15,Ci=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],Ti=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],Ei=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],ki=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];function Di(e,t,n,o,r,i,s,a){var c,u,l,d,p,h,g,f,_,m=a.bits,v=0,y=0,M=0,I=0,C=0,T=0,E=0,k=0,D=0,S=0,L=null,A=0,R=new lr(16),O=new lr(16),N=null,w=0;for(v=0;v<=Ii;v++)R[v]=0;for(y=0;y<o;y++)R[t[n+y]]++;for(C=m,I=Ii;I>=1&&0===R[I];I--);if(C>I&&(C=I),0===I)return r[i++]=20971520,r[i++]=20971520,a.bits=1,0;for(M=1;M<I&&0===R[M];M++);for(C<M&&(C=M),k=1,v=1;v<=Ii;v++)if(k<<=1,(k-=R[v])<0)return-1;if(k>0&&(0===e||1!==I))return-1;for(O[1]=0,v=1;v<Ii;v++)O[v+1]=O[v]+R[v];for(y=0;y<o;y++)0!==t[n+y]&&(s[O[t[n+y]]++]=y);if(0===e?(L=N=s,h=19):1===e?(L=Ci,A-=257,N=Ti,w-=257,h=256):(L=Ei,N=ki,h=-1),S=0,y=0,v=M,p=i,T=C,E=0,l=-1,d=(D=1<<C)-1,1===e&&D>852||2===e&&D>592)return 1;for(;;){g=v-E,s[y]<h?(f=0,_=s[y]):s[y]>h?(f=N[w+s[y]],_=L[A+s[y]]):(f=96,_=0),c=1<<v-E,M=u=1<<T;do{r[p+(S>>E)+(u-=c)]=g<<24|f<<16|_|0}while(0!==u);for(c=1<<v-1;S&c;)c>>=1;if(0!==c?(S&=c-1,S+=c):S=0,y++,0==--R[v]){if(v===I)break;v=t[n+s[y]]}if(v>C&&(S&d)!==l){for(0===E&&(E=C),p+=M,k=1<<(T=v-E);T+E<I&&!((k-=R[T+E])<=0);)T++,k<<=1;if(D+=1<<T,1===e&&D>852||2===e&&D>592)return 1;r[l=S&d]=C<<24|T<<16|p-i|0}}return 0!==S&&(r[p+S]=v-E<<24|64<<16|0),a.bits=C,0}var Si=-2,Li=12,Ai=30;function Ri(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function Oi(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new lr(320),this.work=new lr(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function Ni(e){var t,n,o;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,(n=e)&&n.state?(o=n.state,n.total_in=n.total_out=o.total=0,n.msg="",o.wrap&&(n.adler=1&o.wrap),o.mode=1,o.last=0,o.havedict=0,o.dmax=32768,o.head=null,o.hold=0,o.bits=0,o.lencode=o.lendyn=new dr(852),o.distcode=o.distdyn=new dr(592),o.sane=1,o.back=-1,0):Si):Si}var wi,bi,Ui=!0;function Pi(e){if(Ui){var t;for(wi=new dr(512),bi=new dr(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Di(1,e.lens,0,288,wi,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Di(2,e.lens,0,32,bi,0,e.work,{bits:5}),Ui=!1}e.lencode=wi,e.lenbits=9,e.distcode=bi,e.distbits=5}var Gi;function xi(e){if(e<1||e>7)throw new TypeError("Bad argument");this.mode=e,this.init_done=!1,this.write_in_progress=!1,this.pending_close=!1,this.windowBits=0,this.level=0,this.memLevel=0,this.strategy=0,this.dictionary=null}function Fi(e,t){for(var n=0;n<e.length;n++)this[t+n]=e[n]}xi.prototype.init=function(e,t,n,o,r){var i;switch(this.windowBits=e,this.level=t,this.memLevel=n,this.strategy=o,3!==this.mode&&4!==this.mode||(this.windowBits+=16),7===this.mode&&(this.windowBits+=32),5!==this.mode&&6!==this.mode||(this.windowBits=-this.windowBits),this.strm=new ar,this.mode){case 1:case 3:case 5:i=function(e,t,n,o,r,i){if(!e)return Qr;var s=1;if(-1===t&&(t=6),o<0?(s=0,o=-o):o>15&&(s=2,o-=16),r<1||r>9||o<8||o>15||t<0||t>9||i<0||i>4)return ii(e,Qr);8===o&&(o=9);var a=new mi;return e.state=a,a.strm=e,a.wrap=s,a.gzhead=null,a.w_bits=o,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=r+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new ur(2*a.w_size),a.head=new lr(a.hash_size),a.prev=new lr(a.w_size),a.lit_bufsize=1<<r+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new ur(a.pending_buf_size),a.d_buf=1*a.lit_bufsize,a.l_buf=3*a.lit_bufsize,a.level=t,a.strategy=i,a.method=8,vi(e)}(this.strm,this.level,0,this.windowBits,this.memLevel,this.strategy);break;case 2:case 4:case 6:case 7:i=function(e,t){var n,o,r,i,s,a;return e?(o=new Oi,e.state=o,o.window=null,0!==(i=t,n=(r=e)&&r.state?(a=r.state,i<0?(s=0,i=-i):(s=1+(i>>4),i<48&&(i&=15)),i&&(i<8||i>15)?Si:(null!==a.window&&a.wbits!==i&&(a.window=null),a.wrap=s,a.wbits=i,Ni(r))):Si)&&(e.state=null),n):Si}(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}0===i?(this.write_in_progress=!1,this.init_done=!0):this._error(i)},xi.prototype.params=function(){throw new Error("deflateParams Not supported")},xi.prototype._writeCheck=function(){if(!this.init_done)throw new Error("write before init");if(0===this.mode)throw new Error("already finalized");if(this.write_in_progress)throw new Error("write already in progress");if(this.pending_close)throw new Error("close is pending")},xi.prototype.write=function(e,t,n,o,r,i,s){this._writeCheck(),this.write_in_progress=!0;var a=this;return Rn((function(){a.write_in_progress=!1;var c=a._write(e,t,n,o,r,i,s);a.callback(c[0],c[1]),a.pending_close&&a.close()})),this},xi.prototype.writeSync=function(e,t,n,o,r,i,s){return this._writeCheck(),this._write(e,t,n,o,r,i,s)},xi.prototype._write=function(e,t,n,o,r,i,s){if(this.write_in_progress=!0,0!==e&&1!==e&&2!==e&&3!==e&&4!==e&&5!==e)throw new Error("Invalid flush value");null==t&&(t=new Rt(0),o=0,n=0),r._set?r.set=r._set:r.set=Fi;var a,c=this.strm;switch(c.avail_in=o,c.input=t,c.next_in=n,c.avail_out=s,c.output=r,c.next_out=i,this.mode){case 1:case 3:case 5:a=yi(c,e);break;case 7:case 2:case 4:case 6:a=function(e,t){var n,o,r,i,s,a,c,u,l,d,p,h,g,f,_,m,v,y,M,I,C,T,E,k,D,S,L,A,R,O,N=0,w=new ur(4),b=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return Si;(n=e.state).mode===Li&&(n.mode=13),s=e.next_out,r=e.output,c=e.avail_out,i=e.next_in,o=e.input,a=e.avail_in,u=n.hold,l=n.bits,d=a,p=c,T=0;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;l<16;){if(0===a)break e;a--,u+=o[i++]<<l,l+=8}if(2&n.wrap&&35615===u){n.check=0,w[0]=255&u,w[1]=u>>>8&255,n.check=Xr(n.check,w,2,0),u=0,l=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&u)<<8)+(u>>8))%31){e.msg="incorrect header check",n.mode=Ai;break}if(8!=(15&u)){e.msg="unknown compression method",n.mode=Ai;break}if(l-=4,C=8+(15&(u>>>=4)),0===n.wbits)n.wbits=C;else if(C>n.wbits){e.msg="invalid window size",n.mode=Ai;break}n.dmax=1<<C,e.adler=n.check=1,n.mode=512&u?10:Li,u=0,l=0;break;case 2:for(;l<16;){if(0===a)break e;a--,u+=o[i++]<<l,l+=8}if(n.flags=u,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=Ai;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=Ai;break}n.head&&(n.head.text=u>>8&1),512&n.flags&&(w[0]=255&u,w[1]=u>>>8&255,n.check=Xr(n.check,w,2,0)),u=0,l=0,n.mode=3;case 3:for(;l<32;){if(0===a)break e;a--,u+=o[i++]<<l,l+=8}n.head&&(n.head.time=u),512&n.flags&&(w[0]=255&u,w[1]=u>>>8&255,w[2]=u>>>16&255,w[3]=u>>>24&255,n.check=Xr(n.check,w,4,0)),u=0,l=0,n.mode=4;case 4:for(;l<16;){if(0===a)break e;a--,u+=o[i++]<<l,l+=8}n.head&&(n.head.xflags=255&u,n.head.os=u>>8),512&n.flags&&(w[0]=255&u,w[1]=u>>>8&255,n.check=Xr(n.check,w,2,0)),u=0,l=0,n.mode=5;case 5:if(1024&n.flags){for(;l<16;){if(0===a)break e;a--,u+=o[i++]<<l,l+=8}n.length=u,n.head&&(n.head.extra_len=u),512&n.flags&&(w[0]=255&u,w[1]=u>>>8&255,n.check=Xr(n.check,w,2,0)),u=0,l=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((h=n.length)>a&&(h=a),h&&(n.head&&(C=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),cr(n.head.extra,o,i,h,C)),512&n.flags&&(n.check=Xr(n.check,o,h,i)),a-=h,i+=h,n.length-=h),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===a)break e;h=0;do{C=o[i+h++],n.head&&C&&n.length<65536&&(n.head.name+=String.fromCharCode(C))}while(C&&h<a);if(512&n.flags&&(n.check=Xr(n.check,o,h,i)),a-=h,i+=h,C)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===a)break e;h=0;do{C=o[i+h++],n.head&&C&&n.length<65536&&(n.head.comment+=String.fromCharCode(C))}while(C&&h<a);if(512&n.flags&&(n.check=Xr(n.check,o,h,i)),a-=h,i+=h,C)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;l<16;){if(0===a)break e;a--,u+=o[i++]<<l,l+=8}if(u!==(65535&n.check)){e.msg="header crc mismatch",n.mode=Ai;break}u=0,l=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=Li;break;case 10:for(;l<32;){if(0===a)break e;a--,u+=o[i++]<<l,l+=8}e.adler=n.check=Ri(u),u=0,l=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=s,e.avail_out=c,e.next_in=i,e.avail_in=a,n.hold=u,n.bits=l,2;e.adler=n.check=1,n.mode=Li;case Li:if(5===t||6===t)break e;case 13:if(n.last){u>>>=7&l,l-=7&l,n.mode=27;break}for(;l<3;){if(0===a)break e;a--,u+=o[i++]<<l,l+=8}switch(n.last=1&u,l-=1,3&(u>>>=1)){case 0:n.mode=14;break;case 1:if(Pi(n),n.mode=20,6===t){u>>>=2,l-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=Ai}u>>>=2,l-=2;break;case 14:for(u>>>=7&l,l-=7&l;l<32;){if(0===a)break e;a--,u+=o[i++]<<l,l+=8}if((65535&u)!=(u>>>16^65535)){e.msg="invalid stored block lengths",n.mode=Ai;break}if(n.length=65535&u,u=0,l=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(h=n.length){if(h>a&&(h=a),h>c&&(h=c),0===h)break e;cr(r,o,i,h,s),a-=h,i+=h,c-=h,s+=h,n.length-=h;break}n.mode=Li;break;case 17:for(;l<14;){if(0===a)break e;a--,u+=o[i++]<<l,l+=8}if(n.nlen=257+(31&u),u>>>=5,l-=5,n.ndist=1+(31&u),u>>>=5,l-=5,n.ncode=4+(15&u),u>>>=4,l-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=Ai;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;l<3;){if(0===a)break e;a--,u+=o[i++]<<l,l+=8}n.lens[b[n.have++]]=7&u,u>>>=3,l-=3}for(;n.have<19;)n.lens[b[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,E={bits:n.lenbits},T=Di(0,n.lens,0,19,n.lencode,0,n.work,E),n.lenbits=E.bits,T){e.msg="invalid code lengths set",n.mode=Ai;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;m=(N=n.lencode[u&(1<<n.lenbits)-1])>>>16&255,v=65535&N,!((_=N>>>24)<=l);){if(0===a)break e;a--,u+=o[i++]<<l,l+=8}if(v<16)u>>>=_,l-=_,n.lens[n.have++]=v;else{if(16===v){for(k=_+2;l<k;){if(0===a)break e;a--,u+=o[i++]<<l,l+=8}if(u>>>=_,l-=_,0===n.have){e.msg="invalid bit length repeat",n.mode=Ai;break}C=n.lens[n.have-1],h=3+(3&u),u>>>=2,l-=2}else if(17===v){for(k=_+3;l<k;){if(0===a)break e;a--,u+=o[i++]<<l,l+=8}l-=_,C=0,h=3+(7&(u>>>=_)),u>>>=3,l-=3}else{for(k=_+7;l<k;){if(0===a)break e;a--,u+=o[i++]<<l,l+=8}l-=_,C=0,h=11+(127&(u>>>=_)),u>>>=7,l-=7}if(n.have+h>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=Ai;break}for(;h--;)n.lens[n.have++]=C}}if(n.mode===Ai)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=Ai;break}if(n.lenbits=9,E={bits:n.lenbits},T=Di(1,n.lens,0,n.nlen,n.lencode,0,n.work,E),n.lenbits=E.bits,T){e.msg="invalid literal/lengths set",n.mode=Ai;break}if(n.distbits=6,n.distcode=n.distdyn,E={bits:n.distbits},T=Di(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,E),n.distbits=E.bits,T){e.msg="invalid distances set",n.mode=Ai;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(a>=6&&c>=258){e.next_out=s,e.avail_out=c,e.next_in=i,e.avail_in=a,n.hold=u,n.bits=l,Mi(e,p),s=e.next_out,r=e.output,c=e.avail_out,i=e.next_in,o=e.input,a=e.avail_in,u=n.hold,l=n.bits,n.mode===Li&&(n.back=-1);break}for(n.back=0;m=(N=n.lencode[u&(1<<n.lenbits)-1])>>>16&255,v=65535&N,!((_=N>>>24)<=l);){if(0===a)break e;a--,u+=o[i++]<<l,l+=8}if(m&&0==(240&m)){for(y=_,M=m,I=v;m=(N=n.lencode[I+((u&(1<<y+M)-1)>>y)])>>>16&255,v=65535&N,!(y+(_=N>>>24)<=l);){if(0===a)break e;a--,u+=o[i++]<<l,l+=8}u>>>=y,l-=y,n.back+=y}if(u>>>=_,l-=_,n.back+=_,n.length=v,0===m){n.mode=26;break}if(32&m){n.back=-1,n.mode=Li;break}if(64&m){e.msg="invalid literal/length code",n.mode=Ai;break}n.extra=15&m,n.mode=22;case 22:if(n.extra){for(k=n.extra;l<k;){if(0===a)break e;a--,u+=o[i++]<<l,l+=8}n.length+=u&(1<<n.extra)-1,u>>>=n.extra,l-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;m=(N=n.distcode[u&(1<<n.distbits)-1])>>>16&255,v=65535&N,!((_=N>>>24)<=l);){if(0===a)break e;a--,u+=o[i++]<<l,l+=8}if(0==(240&m)){for(y=_,M=m,I=v;m=(N=n.distcode[I+((u&(1<<y+M)-1)>>y)])>>>16&255,v=65535&N,!(y+(_=N>>>24)<=l);){if(0===a)break e;a--,u+=o[i++]<<l,l+=8}u>>>=y,l-=y,n.back+=y}if(u>>>=_,l-=_,n.back+=_,64&m){e.msg="invalid distance code",n.mode=Ai;break}n.offset=v,n.extra=15&m,n.mode=24;case 24:if(n.extra){for(k=n.extra;l<k;){if(0===a)break e;a--,u+=o[i++]<<l,l+=8}n.offset+=u&(1<<n.extra)-1,u>>>=n.extra,l-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=Ai;break}n.mode=25;case 25:if(0===c)break e;if(h=p-c,n.offset>h){if((h=n.offset-h)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=Ai;break}h>n.wnext?(h-=n.wnext,g=n.wsize-h):g=n.wnext-h,h>n.length&&(h=n.length),f=n.window}else f=r,g=s-n.offset,h=n.length;h>c&&(h=c),c-=h,n.length-=h;do{r[s++]=f[g++]}while(--h);0===n.length&&(n.mode=21);break;case 26:if(0===c)break e;r[s++]=n.length,c--,n.mode=21;break;case 27:if(n.wrap){for(;l<32;){if(0===a)break e;a--,u|=o[i++]<<l,l+=8}if(p-=c,e.total_out+=p,n.total+=p,p&&(e.adler=n.check=n.flags?Xr(n.check,r,p,s-p):$r(n.check,r,p,s-p)),p=c,(n.flags?u:Ri(u))!==n.check){e.msg="incorrect data check",n.mode=Ai;break}u=0,l=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;l<32;){if(0===a)break e;a--,u+=o[i++]<<l,l+=8}if(u!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=Ai;break}u=0,l=0}n.mode=29;case 29:T=1;break e;case Ai:T=-3;break e;case 31:return-4;default:return Si}return e.next_out=s,e.avail_out=c,e.next_in=i,e.avail_in=a,n.hold=u,n.bits=l,(n.wsize||p!==e.avail_out&&n.mode<Ai&&(n.mode<27||4!==t))&&(D=e,S=e.output,L=e.next_out,A=p-e.avail_out,null===(O=D.state).window&&(O.wsize=1<<O.wbits,O.wnext=0,O.whave=0,O.window=new ur(O.wsize)),A>=O.wsize?(cr(O.window,S,L-O.wsize,O.wsize,0),O.wnext=0,O.whave=O.wsize):((R=O.wsize-O.wnext)>A&&(R=A),cr(O.window,S,L-A,R,O.wnext),(A-=R)?(cr(O.window,S,L-A,A,0),O.wnext=A,O.whave=O.wsize):(O.wnext+=R,O.wnext===O.wsize&&(O.wnext=0),O.whave<O.wsize&&(O.whave+=R)))),d-=e.avail_in,p-=e.avail_out,e.total_in+=d,e.total_out+=p,n.total+=p,n.wrap&&p&&(e.adler=n.check=n.flags?Xr(n.check,r,p,e.next_out-p):$r(n.check,r,p,e.next_out-p)),e.data_type=n.bits+(n.last?64:0)+(n.mode===Li?128:0)+(20===n.mode||15===n.mode?256:0),(0===d&&0===p||4===t)&&0===T&&(T=-5),T}(c,e);break;default:throw new Error("Unknown mode "+this.mode)}return 1!==a&&0!==a&&this._error(a),this.write_in_progress=!1,[c.avail_in,c.avail_out]},xi.prototype.close=function(){this.write_in_progress?this.pending_close=!0:(this.pending_close=!1,1===this.mode||3===this.mode||5===this.mode?function(e){var t;e&&e.state&&(42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&t!==ni&&t!==oi&&t!==ri?ii(e,Qr):(e.state=null,t===oi&&ii(e,-3)))}(this.strm):function(e){if(!e||!e.state)return Si;var t=e.state;t.window&&(t.window=null),e.state=null}(this.strm),this.mode=0)},xi.prototype.reset=function(){switch(this.mode){case 1:case 5:Gi=vi(this.strm);break;case 2:case 6:Gi=Ni(this.strm)}0!==Gi&&this._error(Gi)},xi.prototype._error=function(e){this.onerror(sr[e]+": "+this.strm.msg,e),this.write_in_progress=!1,this.pending_close&&this.close()};var qi=Object.freeze({NONE:0,DEFLATE:1,INFLATE:2,GZIP:3,GUNZIP:4,DEFLATERAW:5,INFLATERAW:6,UNZIP:7,Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8,Zlib:xi}),Bi={};Object.keys(qi).forEach((function(e){Bi[e]=qi[e]})),Bi.Z_MIN_WINDOWBITS=8,Bi.Z_MAX_WINDOWBITS=15,Bi.Z_DEFAULT_WINDOWBITS=15,Bi.Z_MIN_CHUNK=64,Bi.Z_MAX_CHUNK=1/0,Bi.Z_DEFAULT_CHUNK=16384,Bi.Z_MIN_MEMLEVEL=1,Bi.Z_MAX_MEMLEVEL=9,Bi.Z_DEFAULT_MEMLEVEL=8,Bi.Z_MIN_LEVEL=-1,Bi.Z_MAX_LEVEL=9,Bi.Z_DEFAULT_LEVEL=Bi.Z_DEFAULT_COMPRESSION;var Vi={Z_OK:Bi.Z_OK,Z_STREAM_END:Bi.Z_STREAM_END,Z_NEED_DICT:Bi.Z_NEED_DICT,Z_ERRNO:Bi.Z_ERRNO,Z_STREAM_ERROR:Bi.Z_STREAM_ERROR,Z_DATA_ERROR:Bi.Z_DATA_ERROR,Z_MEM_ERROR:Bi.Z_MEM_ERROR,Z_BUF_ERROR:Bi.Z_BUF_ERROR,Z_VERSION_ERROR:Bi.Z_VERSION_ERROR};function Ki(e,t){if("string"==typeof t&&(t=new Rt(t)),!gn(t))throw new TypeError("Not a string or buffer");var n=Bi.Z_FINISH;return e._processChunk(t,n)}function Hi(e){if(!(this instanceof Hi))return new Hi(e);Xi.call(this,e,Bi.DEFLATE)}function ji(e){if(!(this instanceof ji))return new ji(e);Xi.call(this,e,Bi.INFLATE)}function zi(e){if(!(this instanceof zi))return new zi(e);Xi.call(this,e,Bi.GZIP)}function Wi(e){if(!(this instanceof Wi))return new Wi(e);Xi.call(this,e,Bi.GUNZIP)}function Yi(e){if(!(this instanceof Yi))return new Yi(e);Xi.call(this,e,Bi.DEFLATERAW)}function $i(e){if(!(this instanceof $i))return new $i(e);Xi.call(this,e,Bi.INFLATERAW)}function Ji(e){if(!(this instanceof Ji))return new Ji(e);Xi.call(this,e,Bi.UNZIP)}function Xi(e,t){if(this._opts=e=e||{},this._chunkSize=e.chunkSize||Bi.Z_DEFAULT_CHUNK,nr.call(this,e),e.flush&&e.flush!==Bi.Z_NO_FLUSH&&e.flush!==Bi.Z_PARTIAL_FLUSH&&e.flush!==Bi.Z_SYNC_FLUSH&&e.flush!==Bi.Z_FULL_FLUSH&&e.flush!==Bi.Z_FINISH&&e.flush!==Bi.Z_BLOCK)throw new Error("Invalid flush flag: "+e.flush);if(this._flushFlag=e.flush||Bi.Z_NO_FLUSH,e.chunkSize&&(e.chunkSize<Bi.Z_MIN_CHUNK||e.chunkSize>Bi.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+e.chunkSize);if(e.windowBits&&(e.windowBits<Bi.Z_MIN_WINDOWBITS||e.windowBits>Bi.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+e.windowBits);if(e.level&&(e.level<Bi.Z_MIN_LEVEL||e.level>Bi.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+e.level);if(e.memLevel&&(e.memLevel<Bi.Z_MIN_MEMLEVEL||e.memLevel>Bi.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+e.memLevel);if(e.strategy&&e.strategy!=Bi.Z_FILTERED&&e.strategy!=Bi.Z_HUFFMAN_ONLY&&e.strategy!=Bi.Z_RLE&&e.strategy!=Bi.Z_FIXED&&e.strategy!=Bi.Z_DEFAULT_STRATEGY)throw new Error("Invalid strategy: "+e.strategy);if(e.dictionary&&!gn(e.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._binding=new Bi.Zlib(t);var n=this;this._hadError=!1,this._binding.onerror=function(e,t){n._binding=null,n._hadError=!0;var o=new Error(e);o.errno=t,o.code=Bi.codes[t],n.emit("error",o)};var o=Bi.Z_DEFAULT_COMPRESSION;"number"==typeof e.level&&(o=e.level);var r=Bi.Z_DEFAULT_STRATEGY;"number"==typeof e.strategy&&(r=e.strategy),this._binding.init(e.windowBits||Bi.Z_DEFAULT_WINDOWBITS,o,e.memLevel||Bi.Z_DEFAULT_MEMLEVEL,r,e.dictionary),this._buffer=new Rt(this._chunkSize),this._offset=0,this._closed=!1,this._level=o,this._strategy=r,this.once("end",this.close)}Object.keys(Vi).forEach((function(e){Vi[Vi[e]]=e})),jn(Xi,nr),Xi.prototype.params=function(e,t,n){if(e<Bi.Z_MIN_LEVEL||e>Bi.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+e);if(t!=Bi.Z_FILTERED&&t!=Bi.Z_HUFFMAN_ONLY&&t!=Bi.Z_RLE&&t!=Bi.Z_FIXED&&t!=Bi.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+t);if(this._level!==e||this._strategy!==t){var o=this;this.flush(Bi.Z_SYNC_FLUSH,(function(){o._binding.params(e,t),o._hadError||(o._level=e,o._strategy=t,n&&n())}))}else Rn(n)},Xi.prototype.reset=function(){return this._binding.reset()},Xi.prototype._flush=function(e){this._transform(new Rt(0),"",e)},Xi.prototype.flush=function(e,t){var n=this._writableState;if(("function"==typeof e||void 0===e&&!t)&&(t=e,e=Bi.Z_FULL_FLUSH),n.ended)t&&Rn(t);else if(n.ending)t&&this.once("end",t);else if(n.needDrain){var o=this;this.once("drain",(function(){o.flush(t)}))}else this._flushFlag=e,this.write(new Rt(0),"",t)},Xi.prototype.close=function(e){if(e&&Rn(e),!this._closed){this._closed=!0,this._binding.close();var t=this;Rn((function(){t.emit("close")}))}},Xi.prototype._transform=function(e,t,n){var o,r=this._writableState,i=(r.ending||r.ended)&&(!e||r.length===e.length);if(null===!e&&!gn(e))return n(new Error("invalid input"));i?o=Bi.Z_FINISH:(o=this._flushFlag,e.length>=r.length&&(this._flushFlag=this._opts.flush||Bi.Z_NO_FLUSH)),this._processChunk(e,o,n)},Xi.prototype._processChunk=function(e,t,n){var o=e&&e.length,r=this._chunkSize-this._offset,i=0,s=this,a="function"==typeof n;if(!a){var c,u=[],l=0;this.on("error",(function(e){c=e}));do{var d=this._binding.writeSync(t,e,i,o,this._buffer,this._offset,r)}while(!this._hadError&&g(d[0],d[1]));if(this._hadError)throw c;var p=Rt.concat(u,l);return this.close(),p}var h=this._binding.write(t,e,i,o,this._buffer,this._offset,r);function g(c,d){if(!s._hadError){var p=r-d;if(function(e,t){if(!e)throw new Error("have should not go down")}(p>=0),p>0){var h=s._buffer.slice(s._offset,s._offset+p);s._offset+=p,a?s.push(h):(u.push(h),l+=h.length)}if((0===d||s._offset>=s._chunkSize)&&(r=s._chunkSize,s._offset=0,s._buffer=new Rt(s._chunkSize)),0===d){if(i+=o-c,o=c,!a)return!0;var f=s._binding.write(t,e,i,o,s._buffer,s._offset,s._chunkSize);return f.callback=g,void(f.buffer=e)}if(!a)return!1;n()}}h.buffer=e,h.callback=g},jn(Hi,Xi),jn(ji,Xi),jn(zi,Xi),jn(Wi,Xi),jn(Yi,Xi),jn($i,Xi),jn(Ji,Xi);var Zi=function(e,t){return Ki(new Hi(t),e)},Qi=function(e,t){return Ki(new ji(t),e)};class es{constructor(e,t,n){this.SDKAPPID=e,this.EXPIRETIME=n,this.PRIVATEKEY=t}genTestUserSig(e){return this._isNumber(this.SDKAPPID)?this._isString(this.PRIVATEKEY)?this._isString(e)?this._isNumber(this.EXPIRETIME)?(t("log","at pages/TUIKit/debug/lib-generate-test-usersig-es.min.js:2","sdkAppID="+this.SDKAPPID+" key="+this.PRIVATEKEY+" userID="+e+" expire="+this.EXPIRETIME),this.genSigWithUserbuf(e,this.EXPIRETIME,null)):(t("error","at pages/TUIKit/debug/lib-generate-test-usersig-es.min.js:2","expireTime must be a number"),""):(t("error","at pages/TUIKit/debug/lib-generate-test-usersig-es.min.js:2","userID must be a string"),""):(t("error","at pages/TUIKit/debug/lib-generate-test-usersig-es.min.js:2","privateKey must be a string"),""):(t("error","at pages/TUIKit/debug/lib-generate-test-usersig-es.min.js:2","sdkAppID must be a number"),"")}newBuffer(e,t){return Rt.from?Rt.from(e,t):new Rt(e,t)}unescape(e){return e.replace(/_/g,"=").replace(/\-/g,"/").replace(/\*/g,"+")}escape(e){return e.replace(/\+/g,"*").replace(/\//g,"-").replace(/=/g,"_")}encode(e){return this.escape(this.newBuffer(e).toString("base64"))}decode(e){return this.newBuffer(this.unescape(e),"base64")}base64encode(e){return this.newBuffer(e).toString("base64")}base64decode(e){return this.newBuffer(e,"base64").toString()}_hmacsha256(e,t,n,o){let r="TLS.identifier:"+e+"\n";r+="TLS.sdkappid:"+this.SDKAPPID+"\n",r+="TLS.time:"+t+"\n",r+="TLS.expire:"+n+"\n",null!=o&&(r+="TLS.userbuf:"+o+"\n");let i=vn.HmacSHA256(r,this.PRIVATEKEY);return vn.enc.Base64.stringify(i)}_utc(){return Math.round(Date.now()/1e3)}_isNumber(e){return null!==e&&("number"==typeof e&&!isNaN(e-0)||"object"==typeof e&&e.constructor===Number)}_isString(e){return"string"==typeof e}genSigWithUserbuf(e,n,o){let r=this._utc(),i={"TLS.ver":"2.0","TLS.identifier":e,"TLS.sdkappid":this.SDKAPPID,"TLS.time":r,"TLS.expire":n},s="";if(null!=o){let t=this.base64encode(o);i["TLS.userbuf"]=t,s=this._hmacsha256(e,r,n,t)}else s=this._hmacsha256(e,r,n,null);i["TLS.sig"]=s;let a=JSON.stringify(i),c=Zi(this.newBuffer(a)).toString("base64"),u=this.escape(c);return t("log","at pages/TUIKit/debug/lib-generate-test-usersig-es.min.js:2","ret="+u),u}validate(e){let n=this.decode(e);t("log","at pages/TUIKit/debug/lib-generate-test-usersig-es.min.js:2","validate ret="+Qi(n))}}var ts="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},ns={};({get exports(){return ns},set exports(e){ns=e}}).exports=function(){function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function n(t){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?e(Object(o),!0).forEach((function(e){a(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function s(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function d(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(he){return!1}}function p(e,t,n){return(p=d()?Reflect.construct.bind():function(e,t,n){var o=[null];o.push.apply(o,t);var r=new(Function.bind.apply(e,o));return n&&l(r,n.prototype),r}).apply(null,arguments)}function h(e){var t="function"==typeof Map?new Map:void 0;return(h=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,o)}function o(){return p(e,arguments,u(this).constructor)}return o.prototype=Object.create(e.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),l(o,e)})(e)}function g(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return f(e)}function m(e){var t=d();return function(){var n,o=u(e);if(t){var r=u(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return _(this,n)}}function v(e,t){return M(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,i=[],s=!0,a=!1;try{for(n=n.call(e);!(s=(o=n.next()).done)&&(i.push(o.value),!t||i.length!==t);s=!0);}catch(c){a=!0,r=c}finally{try{s||null==n.return||n.return()}finally{if(a)throw r}}return i}}(e,t)||C(e,t)||E()}function y(e){return function(e){if(Array.isArray(e))return T(e)}(e)||I(e)||C(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function M(e){if(Array.isArray(e))return e}function I(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function C(e,t){if(e){if("string"==typeof e)return T(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?T(e,t):void 0}}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function E(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function k(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=C(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw i}}}}var D={SDK_READY:"sdkStateReady",SDK_NOT_READY:"sdkStateNotReady",SDK_DESTROY:"sdkDestroy",MESSAGE_RECEIVED:"onMessageReceived",MESSAGE_MODIFIED:"onMessageModified",MESSAGE_REVOKED:"onMessageRevoked",MESSAGE_READ_BY_PEER:"onMessageReadByPeer",MESSAGE_READ_RECEIPT_RECEIVED:"onMessageReadReceiptReceived",MESSAGE_EXTENSIONS_UPDATED:"onMessageExtensionsUpdated",MESSAGE_EXTENSIONS_DELETED:"onMessageExtensionsDeleted",CONVERSATION_LIST_UPDATED:"onConversationListUpdated",TOTAL_UNREAD_MESSAGE_COUNT_UPDATED:"onTotalUnreadMessageCountUpdated",CONVERSATION_GROUP_LIST_UPDATED:"onConversationGroupListUpdated",CONVERSATION_IN_GROUP_UPDATED:"onConversationInGroupUpdated",GROUP_LIST_UPDATED:"onGroupListUpdated",GROUP_SYSTEM_NOTICE_RECEIVED:"receiveGroupSystemNotice",GROUP_ATTRIBUTES_UPDATED:"groupAttributesUpdated",GROUP_COUNTER_UPDATED:"onGroupCounterUpdated",TOPIC_CREATED:"onTopicCreated",TOPIC_DELETED:"onTopicDeleted",TOPIC_UPDATED:"onTopicUpdated",PROFILE_UPDATED:"onProfileUpdated",USER_STATUS_UPDATED:"onUserStatusUpdated",BLACKLIST_UPDATED:"blacklistUpdated",FRIEND_LIST_UPDATED:"onFriendListUpdated",FRIEND_GROUP_LIST_UPDATED:"onFriendGroupListUpdated",FRIEND_APPLICATION_LIST_UPDATED:"onFriendApplicationListUpdated",KICKED_OUT:"kickedOut",ERROR:"error",NET_STATE_CHANGE:"netStateChange",SDK_RELOAD:"sdkReload"},S={MSG_TEXT:"TIMTextElem",MSG_IMAGE:"TIMImageElem",MSG_SOUND:"TIMSoundElem",MSG_AUDIO:"TIMSoundElem",MSG_FILE:"TIMFileElem",MSG_FACE:"TIMFaceElem",MSG_VIDEO:"TIMVideoFileElem",MSG_GEO:"TIMLocationElem",MSG_LOCATION:"TIMLocationElem",MSG_GRP_TIP:"TIMGroupTipElem",MSG_GRP_SYS_NOTICE:"TIMGroupSystemNoticeElem",MSG_CUSTOM:"TIMCustomElem",MSG_MERGER:"TIMRelayElem",MSG_PRIORITY_HIGH:"High",MSG_PRIORITY_NORMAL:"Normal",MSG_PRIORITY_LOW:"Low",MSG_PRIORITY_LOWEST:"Lowest",CONV_C2C:"C2C",CONV_GROUP:"GROUP",CONV_TOPIC:"TOPIC",CONV_SYSTEM:"@TIM#SYSTEM",CONV_AT_ME:1,CONV_AT_ALL:2,CONV_AT_ALL_AT_ME:3,CONV_MARK_TYPE_STAR:1,CONV_MARK_TYPE_UNREAD:2,CONV_MARK_TYPE_FOLD:4,CONV_MARK_TYPE_HIDE:8,GRP_PRIVATE:"Private",GRP_WORK:"Private",GRP_PUBLIC:"Public",GRP_CHATROOM:"ChatRoom",GRP_MEETING:"ChatRoom",GRP_AVCHATROOM:"AVChatRoom",GRP_COMMUNITY:"Community",GRP_MBR_ROLE_OWNER:"Owner",GRP_MBR_ROLE_ADMIN:"Admin",GRP_MBR_ROLE_MEMBER:"Member",GRP_MBR_ROLE_CUSTOM:"Custom",GRP_TIP_MBR_JOIN:1,GRP_TIP_MBR_QUIT:2,GRP_TIP_MBR_KICKED_OUT:3,GRP_TIP_MBR_SET_ADMIN:4,GRP_TIP_MBR_CANCELED_ADMIN:5,GRP_TIP_GRP_PROFILE_UPDATED:6,GRP_TIP_MBR_PROFILE_UPDATED:7,GRP_TIP_BAN_AVCHATROOM_MEMBER:10,GRP_TIP_UNBAN_AVCHATROOM_MEMBER:11,MSG_REMIND_ACPT_AND_NOTE:"AcceptAndNotify",MSG_REMIND_ACPT_NOT_NOTE:"AcceptNotNotify",MSG_REMIND_DISCARD:"Discard",GENDER_UNKNOWN:"Gender_Type_Unknown",GENDER_FEMALE:"Gender_Type_Female",GENDER_MALE:"Gender_Type_Male",KICKED_OUT_MULT_ACCOUNT:"multipleAccount",KICKED_OUT_MULT_DEVICE:"multipleDevice",KICKED_OUT_USERSIG_EXPIRED:"userSigExpired",KICKED_OUT_REST_API:"REST_API_Kick",ALLOW_TYPE_ALLOW_ANY:"AllowType_Type_AllowAny",ALLOW_TYPE_NEED_CONFIRM:"AllowType_Type_NeedConfirm",ALLOW_TYPE_DENY_ANY:"AllowType_Type_DenyAny",FORBID_TYPE_NONE:"AdminForbid_Type_None",FORBID_TYPE_SEND_OUT:"AdminForbid_Type_SendOut",JOIN_OPTIONS_FREE_ACCESS:"FreeAccess",JOIN_OPTIONS_NEED_PERMISSION:"NeedPermission",JOIN_OPTIONS_DISABLE_APPLY:"DisableApply",JOIN_STATUS_SUCCESS:"JoinedSuccess",JOIN_STATUS_ALREADY_IN_GROUP:"AlreadyInGroup",JOIN_STATUS_WAIT_APPROVAL:"WaitAdminApproval",INVITE_OPTIONS_DISABLE_INVITE:"DisableInvite",INVITE_OPTIONS_NEED_PERMISSION:"NeedPermission",INVITE_OPTIONS_FREE_ACCESS:"FreeAccess",GRP_PROFILE_OWNER_ID:"ownerID",GRP_PROFILE_CREATE_TIME:"createTime",GRP_PROFILE_LAST_INFO_TIME:"lastInfoTime",GRP_PROFILE_MEMBER_NUM:"memberNum",GRP_PROFILE_MAX_MEMBER_NUM:"maxMemberNum",GRP_PROFILE_JOIN_OPTION:"joinOption",GRP_PROFILE_INVITE_OPTION:"inviteOption",GRP_PROFILE_INTRODUCTION:"introduction",GRP_PROFILE_NOTIFICATION:"notification",GRP_PROFILE_MUTE_ALL_MBRS:"muteAllMembers",SNS_ADD_TYPE_SINGLE:"Add_Type_Single",SNS_ADD_TYPE_BOTH:"Add_Type_Both",SNS_DELETE_TYPE_SINGLE:"Delete_Type_Single",SNS_DELETE_TYPE_BOTH:"Delete_Type_Both",SNS_APPLICATION_TYPE_BOTH:"Pendency_Type_Both",SNS_APPLICATION_SENT_TO_ME:"Pendency_Type_ComeIn",SNS_APPLICATION_SENT_BY_ME:"Pendency_Type_SendOut",SNS_APPLICATION_AGREE:"Response_Action_Agree",SNS_APPLICATION_AGREE_AND_ADD:"Response_Action_AgreeAndAdd",SNS_CHECK_TYPE_BOTH:"CheckResult_Type_Both",SNS_CHECK_TYPE_SINGLE:"CheckResult_Type_Single",SNS_TYPE_NO_RELATION:"CheckResult_Type_NoRelation",SNS_TYPE_A_WITH_B:"CheckResult_Type_AWithB",SNS_TYPE_B_WITH_A:"CheckResult_Type_BWithA",SNS_TYPE_BOTH_WAY:"CheckResult_Type_BothWay",NET_STATE_CONNECTED:"connected",NET_STATE_CONNECTING:"connecting",NET_STATE_DISCONNECTED:"disconnected",MSG_AT_ALL:"__kImSDK_MesssageAtALL__",READ_ALL_C2C_MSG:"readAllC2CMessage",READ_ALL_GROUP_MSG:"readAllGroupMessage",READ_ALL_MSG:"readAllMessage",USER_STATUS_UNKNOWN:0,USER_STATUS_ONLINE:1,USER_STATUS_OFFLINE:2,USER_STATUS_UNLOGINED:3},L=function(){function e(){r(this,e),this.cache=[],this.options=null}return s(e,[{key:"use",value:function(e){if("function"!=typeof e)throw"middleware must be a function";return this.cache.push(e),this}},{key:"next",value:function(e){if(this.middlewares&&this.middlewares.length>0)return this.middlewares.shift().call(this,this.options,this.next.bind(this))}},{key:"run",value:function(e){return this.middlewares=this.cache.map((function(e){return e})),this.options=e,this.next()}}]),e}(),A=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;r(this,e),this.high=t,this.low=n}return s(e,[{key:"equal",value:function(e){return null!==e&&this.low===e.low&&this.high===e.high}},{key:"toString",value:function(){var e=Number(this.high).toString(16),t=Number(this.low).toString(16);if(t.length<8)for(var n=8-t.length;n;)t="0"+t,n--;return e+t}}]),e}(),R={TEST:{CHINA:{DEFAULT:"wss://wss-dev.tim.qq.com"},OVERSEA:{DEFAULT:"wss://wss-dev.tim.qq.com"},SINGAPORE:{DEFAULT:"wss://wsssgp-dev.im.qcloud.com"},KOREA:{DEFAULT:"wss://wsskr-dev.im.qcloud.com"},GERMANY:{DEFAULT:"wss://wssger-dev.im.qcloud.com"},IND:{DEFAULT:"wss://wssind-dev.im.qcloud.com"},JPN:{DEFAULT:"wss://wssjpn-dev.im.qcloud.com"},USA:{DEFAULT:"wss://wssusa-dev.im.qcloud.com"}},PRODUCTION:{CHINA:{DEFAULT:"wss://wss.im.qcloud.com",BACKUP:"wss://wss.tim.qq.com",STAT:"https://events.im.qcloud.com",ANYCAST:"wss://162.14.13.203"},OVERSEA:{DEFAULT:"wss://wss.im.qcloud.com",BACKUP:"wss://wss.my-imcloud.com",STAT:"https://api.my-imcloud.com"},SINGAPORE:{DEFAULT:"wss://wsssgp.im.qcloud.com",BACKUP:"wss://wsssgp.my-imcloud.com",STAT:"https://apisgp.my-imcloud.com"},KOREA:{DEFAULT:"wss://wsskr.im.qcloud.com",BACKUP:"wss://wsskr.my-imcloud.com",STAT:"https://apikr.my-imcloud.com"},GERMANY:{DEFAULT:"wss://wssger.im.qcloud.com",BACKUP:"wss://wssger.my-imcloud.com",STAT:"https://apiger.my-imcloud.com"},IND:{DEFAULT:"wss://wssind.my-imcloud.com",BACKUP:"wss://wssind.im.qcloud.com",STAT:"https://apiind.my-imcloud.com"},JPN:{DEFAULT:"wss://wssjpn.im.qcloud.com",BACKUP:"wss://wssjpn.my-imcloud.com",STAT:"https://apijpn.my-imcloud.com"},USA:{DEFAULT:"wss://wssusa.im.qcloud.com",BACKUP:"wss://wssusa.my-imcloud.com",STAT:"https://apiusa.my-imcloud.com"}}},O={ANDROID:2,IOS:3,MAC:4,WEB:7,WX_MP:8,QQ_MP:9,TT_MP:10,BAIDU_MP:11,ALI_MP:12,IPAD:13,UNI_NATIVE_APP:15},N="1.7.3",w=537048168,b="CHINA",U="OVERSEA",P="SINGAPORE",G="KOREA",x="GERMANY",F="IND",q="JPN",B="USA",V={HOST:{CURRENT:{DEFAULT:"wss://wss.im.qcloud.com",STAT:"https://events.im.qcloud.com"},setCurrent:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b;this.CURRENT=R.PRODUCTION[e]}},NAME:{OPEN_IM:"openim",OPEN_IM_MSG_EXT:"openim_msg_ext_http_svc",GROUP:"group_open_http_svc",GROUP_AVCHATROOM:"group_open_avchatroom_http_svc",GROUP_COMMUNITY:"million_group_open_http_svc",GROUP_ATTR:"group_open_attr_http_svc",FRIEND:"sns",PROFILE:"profile",RECENT_CONTACT:"recentcontact",PIC:"openpic",BIG_GROUP_NO_AUTH:"group_open_http_noauth_svc",BIG_GROUP_LONG_POLLING:"group_open_long_polling_http_svc",BIG_GROUP_LONG_POLLING_NO_AUTH:"group_open_long_polling_http_noauth_svc",IM_OPEN_STAT:"imopenstat",WEB_IM:"webim",IM_COS_SIGN:"im_cos_sign_svr",CUSTOM_UPLOAD:"im_cos_msg",HEARTBEAT:"heartbeat",IM_OPEN_PUSH:"im_open_push",IM_OPEN_STATUS:"im_open_status",IM_LONG_MESSAGE:"im_long_msg",IM_CONFIG_MANAGER:"im_sdk_config_mgr",STAT_SERVICE:"StatSvc",OVERLOAD_PUSH:"OverLoadPush",IM_MSG_AUDIT_MGR:"im_msg_audit_mgr",TUIROOM_SVR:"tui_room_svr",IM_OPEN_TRANSLATE:"im_open_translate"},CMD:{LOGIN:"wslogin",LOGOUT_LONG_POLL:"longpollinglogout",LOGOUT:"wslogout",HELLO:"wshello",STAT_BACKGROUND:"ws_stat_background",STAT_FOREGROUND:"ws_stat_foreground",SET_TOKEN:"ws_stat_settoken",PORTRAIT_GET:"portrait_get_all",PORTRAIT_SET:"portrait_set",GET_LONG_POLL_ID:"getlongpollingid",LONG_POLL:"longpolling",AVCHATROOM_LONG_POLL:"get_msg",ADD_FRIEND:"friend_add",UPDATE_FRIEND:"friend_update",GET_FRIEND_LIST:"friend_get",GET_FRIEND_PROFILE:"friend_get_specified",DELETE_FRIEND:"friend_delete",CHECK_FRIEND:"friend_check",GET_FRIEND_GROUP_LIST:"group_get",RESPOND_FRIEND_APPLICATION:"friend_response",GET_FRIEND_APPLICATION_LIST:"pendency_get",DELETE_FRIEND_APPLICATION:"pendency_delete",REPORT_FRIEND_APPLICATION:"pendency_report",GET_GROUP_APPLICATION:"get_pendency",CREATE_FRIEND_GROUP:"group_add",DELETE_FRIEND_GROUP:"group_delete",UPDATE_FRIEND_GROUP:"group_update",GET_BLACKLIST:"black_list_get",ADD_BLACKLIST:"black_list_add",DELETE_BLACKLIST:"black_list_delete",CREATE_GROUP:"create_group",GET_JOINED_GROUPS:"get_joined_group_list",SET_GROUP_ATTRIBUTES:"set_group_attr",MODIFY_GROUP_ATTRIBUTES:"modify_group_attr",DELETE_GROUP_ATTRIBUTES:"delete_group_attr",CLEAR_GROUP_ATTRIBUTES:"clear_group_attr",GET_GROUP_ATTRIBUTES:"get_group_attr",SEND_MESSAGE:"sendmsg",REVOKE_C2C_MESSAGE:"msgwithdraw",DELETE_C2C_MESSAGE:"delete_c2c_msg_ramble",MODIFY_C2C_MESSAGE:"modify_c2c_msg",MODIFY_C2C_MESSAGE_EXTENSIONS:"set_key_values",GET_C2C_MESSAGE_EXTENSIONS:"get_key_values",SEND_GROUP_MESSAGE:"send_group_msg",REVOKE_GROUP_MESSAGE:"group_msg_recall",DELETE_GROUP_MESSAGE:"delete_group_ramble_msg_by_seq",MODIFY_GROUP_MESSAGE:"modify_group_msg",MODIFY_GROUP_MESSAGE_EXTENSIONS:"group_set_key_values",GET_GROUP_MESSAGE_EXTENSIONS:"group_get_key_values",GET_GROUP_INFO:"get_group_self_member_info",GET_GROUP_MEMBER_INFO:"get_specified_group_member_info",GET_GROUP_MEMBER_LIST:"get_group_member_info",GET_AVCHATROOM_MEMBER_LIST:"get_members",MARK_AVCHATROOM_MEMBER_INFO:"modify_user_info",QUIT_GROUP:"quit_group",CHANGE_GROUP_OWNER:"change_group_owner",DESTROY_GROUP:"destroy_group",ADD_GROUP_MEMBER:"add_group_member",DELETE_GROUP_MEMBER:"delete_group_member",BAN_AVCHATROOM_MEMBER:"ban_group_member",SEARCH_GROUP_BY_ID:"get_group_public_info",APPLY_JOIN_GROUP:"apply_join_group",HANDLE_APPLY_JOIN_GROUP:"handle_apply_join_group",HANDLE_INVITE_JOIN_GROUP:"handle_invite_join_permission_group",HANDLE_GROUP_INVITATION:"handle_invite_join_group",MODIFY_GROUP_INFO:"modify_group_base_info",MODIFY_GROUP_MEMBER_INFO:"modify_group_member_info",DELETE_GROUP_SYSTEM_MESSAGE:"deletemsg",DELETE_GROUP_AT_TIPS:"deletemsg",GET_GROUP_NOTIFY:"get_group_notify",GET_CONVERSATION_LIST:"get",PAGING_GET_CONVERSATION_LIST:"page_get",DELETE_CONVERSATION:"batch_delete",CLEAR_HISTORY_MESSAGE:"clear_msg",PIN_CONVERSATION:"top",SET_CONVERSATION_CUSTOM_DATA:"mark_contact",MARK_CONVERSATION:"mark_contact",CREATE_CONVERSATION_GROUP:"create_contact_group",DELETE_CONVERSATION_GROUP:"del_contact_group",UPDATE_CONVERSATION_GROUP:"update_contact_group",GET_CONVERSATION_GROUP_LIST:"get_contact_group",GET_MESSAGES:"getmsg",GET_C2C_ROAM_MESSAGES:"getroammsg",SET_C2C_PEER_MUTE_NOTIFICATIONS:"set_c2c_peer_mute_notifications",GET_C2C_PEER_MUTE_NOTIFICATIONS:"get_c2c_peer_mute_notifications",GET_GROUP_ROAM_MESSAGES:"group_msg_get",GET_READ_RECEIPT:"get_group_msg_receipt",GET_READ_RECEIPT_DETAIL:"get_group_msg_receipt_detail",SEND_READ_RECEIPT:"group_msg_receipt",SEND_C2C_READ_RECEIPT:"c2c_msg_read_receipt",SET_C2C_MESSAGE_READ:"msgreaded",GET_PEER_READ_TIME:"get_peer_read_time",SET_GROUP_MESSAGE_READ:"msg_read_report",FILE_READ_AND_WRITE_AUTHKEY:"authkey",FILE_UPLOAD:"pic_up",COS_SIGN:"cos",COS_PRE_SIG:"pre_sig",VIDEO_COVER:"video_cover",TIM_WEB_REPORT_V2:"tim_web_report_v2",BIG_DATA_HALLWAY_AUTH_KEY:"authkey",GET_ONLINE_MEMBER_NUM:"get_online_member_num",ALIVE:"alive",MESSAGE_PUSH:"msg_push",MULTI_MESSAGE_PUSH:"multi_msg_push_ws",MESSAGE_PUSH_ACK:"ws_msg_push_ack",STATUS_FORCE_OFFLINE:"stat_forceoffline",DOWNLOAD_MERGER_MESSAGE:"get_relay_json_msg",UPLOAD_MERGER_MESSAGE:"save_relay_json_msg",FETCH_CLOUD_CONTROL_CONFIG:"fetch_config",PUSHED_CLOUD_CONTROL_CONFIG:"push_configv2",FETCH_COMMERCIAL_CONFIG:"fetch_imsdk_purchase_bitsv2",PUSHED_COMMERCIAL_CONFIG:"push_imsdk_purchase_bitsv2",KICK_OTHER:"KickOther",OVERLOAD_NOTIFY:"notify2",SET_ALL_MESSAGE_READ:"read_all_unread_msg",CREATE_TOPIC:"create_topic",DELETE_TOPIC:"destroy_topic",UPDATE_TOPIC_PROFILE:"modify_topic",GET_TOPIC_LIST:"get_topic",SET_SELF_STATUS:"ws_set_custom_status",GET_USER_STATUS:"ws_get_user_status",SUBSCRIBE_USER_STATUS:"ws_status_subscribe",UNSUBSCRIBE_USER_STATUS:"ws_status_unsubscribe",GET_RPOFANITY_LIST:"get_local_words",TRANSLATE_TEXT:"ws_batch_trans_text",UPDATE_GROUP_COUNTER:"update_group_counter",GET_GROUP_COUNTER:"get_group_counter"},CHANNEL:{SOCKET:1,XHR:2,AUTO:0},NAME_VERSION:{openim:"v4",group_open_http_svc:"v4",sns:"v4",profile:"v4",recentcontact:"v4",openpic:"v4",group_open_http_noauth_svc:"v4",group_open_long_polling_http_svc:"v4",group_open_long_polling_http_noauth_svc:"v4",imopenstat:"v4",im_cos_sign_svr:"v4",im_cos_msg:"v4",webim:"v4",im_open_push:"v4",im_open_status:"v4"}},K={SEARCH_MSG:new A(0,Math.pow(2,0)).toString(),SEARCH_GRP_SNS:new A(0,Math.pow(2,1)).toString(),AVCHATROOM_HISTORY_MSG:new A(0,Math.pow(2,2)).toString(),GRP_COMMUNITY:new A(0,Math.pow(2,3)).toString(),MSG_TO_SPECIFIED_GRP_MBR:new A(0,Math.pow(2,4)).toString(),AVCHATROOM_MBR_LIST:new A(0,Math.pow(2,6)).toString(),USER_STATUS:new A(0,Math.pow(2,7)).toString(),CONV_MARK:new A(0,Math.pow(2,9)).toString(),CONV_GROUP:new A(0,Math.pow(2,10)).toString(),AVCHATROOM_BAN_MBR:new A(0,Math.pow(2,11)).toString(),MSG_EXT:new A(0,Math.pow(2,13)).toString(),GRP_COUNTER:new A(0,Math.pow(2,15)).toString()},H="c2c_text_message",j="c2c_custom_message",z="group_text_message",W="group_custom_message",Y="user_profile",$="group_profile",J="group_member_profile";V.HOST.setCurrent(b);var X="undefined"!=typeof wx&&"function"==typeof wx.getSystemInfoSync&&Boolean(wx.getSystemInfoSync().fontSizeSetting),Z="undefined"!=typeof qq&&"function"==typeof qq.getSystemInfoSync&&Boolean(qq.getSystemInfoSync().fontSizeSetting),Q="undefined"!=typeof tt&&"function"==typeof tt.getSystemInfoSync&&Boolean(tt.getSystemInfoSync().fontSizeSetting),ee="undefined"!=typeof swan&&"function"==typeof swan.getSystemInfoSync&&Boolean(swan.getSystemInfoSync().fontSizeSetting),te="undefined"!=typeof my&&"function"==typeof my.getSystemInfoSync&&Boolean(my.getSystemInfoSync().fontSizeSetting),ne="undefined"!=typeof jd&&"function"==typeof jd.getSystemInfoSync,oe="undefined"!=typeof uni&&"undefined"==typeof window&&!0,re="undefined"!=typeof uni,ie=X||Z||Q||ee||te||oe||ne,se=("undefined"!=typeof uni||"undefined"!=typeof window)&&!ie,ae=Z?qq:Q?tt:ee?swan:te?my:X?wx:oe?uni:ne?jd:{},ce=se&&window&&window.navigator&&window.navigator.userAgent||"",ue=/(micromessenger|webbrowser)/i.test(ce),le=/AppleWebKit\/([\d.]+)/i.exec(ce);le&&parseFloat(le.pop());var de,pe,he,ge=(de="WEB",ue?de="WEB":Z?de="QQ_MP":Q?de="TT_MP":ee?de="BAIDU_MP":te?de="ALI_MP":X?de="WX_MP":oe&&(de="UNI_NATIVE_APP"),O[de]),fe=/iPad/i.test(ce),_e=/iPhone/i.test(ce)&&!fe,me=/iPod/i.test(ce),ve=_e||fe||me,ye=(pe=ce.match(/OS (\d+)_/i))&&pe[1]?pe[1]:null,Me=/Android/i.test(ce),Ie=function(){var e=ce.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!e)return null;var t=e[1]&&parseFloat(e[1]),n=e[2]&&parseFloat(e[2]);return t&&n?parseFloat(e[1]+"."+e[2]):t||null}();(he=ce.match(/Chrome\/(\d+)/))&&he[1]&&parseFloat(he[1]);var Ce=/MSIE/.test(ce)||ce.indexOf("Trident")>-1&&ce.indexOf("rv:11.0")>-1,Te=function(){var e=/MSIE\s(\d+)\.\d/.exec(ce),t=e&&parseFloat(e[1]);return!t&&/Trident\/7.0/i.test(ce)&&/rv:11.0/.test(ce)&&(t=11),t}();!function(){var e=ce.match(/TBS\/(\d+)/i);e&&e[1]&&e[1]}();var Ee,ke,De=/Windows/i.test(ce),Se=/MAC OS X/i.test(ce),Le=se&&"undefined"!=typeof Worker&&!Ce,Ae=Me||ve,Re=se&&void 0!==window.tencent_cloud_im_csig_flutter_for_web_25F_cy;Ee="undefined"!=typeof console?console:void 0!==ts&&ts.console?ts.console:"undefined"!=typeof window&&window.console?window.console:{};for(var Oe=function(){},Ne=["assert","clear","count","debug","dir","dirxml","error","group","groupCollapsed","groupEnd","info","log","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],we=Ne.length;we--;)ke=Ne[we],console[ke]||(Ee[ke]=Oe);var be=Ee,Ue=0,Pe=function(){return(new Date).getTime()+Ue},Ge=function(){Ue=0},xe=function(){return Math.floor(Pe()/1e3)},Fe=0;function qe(){return jt()?"%c TIM %c":"TIM"}function Be(){var e,t=((e=new Date).setTime(Pe()),e);return t.toLocaleTimeString("en-US",{hour12:!1})+"."+function(e){var t;switch(e.toString().length){case 1:t="00"+e;break;case 2:t="0"+e;break;default:t=e}return t}(t.getMilliseconds())}var Ve={arguments2String:function(e){var t="";if(1===e.length)t=e[0];else for(var n=0,o=e.length;n<o;n++)ct(e[n])?lt(e[n])?t+=gt(e[n]):t+=JSON.stringify(e[n]):t+=e[n],t+=" ";return t},_exec:function(e,t){jt()?be[e](qe(),"background:#0abf5b; padding:1px; border-radius:3px; color: #fff","background:transparent",Be(),t):be[e]("".concat(qe()," ").concat(Be()," ").concat(t))},d:function(){if(Fe<=-1){var e=this.arguments2String(arguments);this._exec("debug",e)}},l:function(){if(Fe<=0){var e=this.arguments2String(arguments);this._exec("log",e)}},log:function(){if(Fe<=0){var e=this.arguments2String(arguments);this._exec("log",e)}},i:function(){if(Fe<=1){var e=this.arguments2String(arguments);this._exec("info",e)}},w:function(){if(Fe<=2){var e=this.arguments2String(arguments);this._exec("warn",e)}},e:function(){if(Fe<=3){var e=this.arguments2String(arguments);this._exec("error",e)}},setLevel:function(e){e<4&&this._exec("log","set level from "+Fe+" to "+e),Fe=e},getLevel:function(){return Fe}},Ke={JPG:1,JPEG:1,GIF:2,PNG:3,BMP:4,UNKNOWN:255},He={NICK:"Tag_Profile_IM_Nick",GENDER:"Tag_Profile_IM_Gender",BIRTHDAY:"Tag_Profile_IM_BirthDay",LOCATION:"Tag_Profile_IM_Location",SELFSIGNATURE:"Tag_Profile_IM_SelfSignature",ALLOWTYPE:"Tag_Profile_IM_AllowType",LANGUAGE:"Tag_Profile_IM_Language",AVATAR:"Tag_Profile_IM_Image",MESSAGESETTINGS:"Tag_Profile_IM_MsgSettings",ADMINFORBIDTYPE:"Tag_Profile_IM_AdminForbidType",LEVEL:"Tag_Profile_IM_Level",ROLE:"Tag_Profile_IM_Role"},je={UNKNOWN:"Gender_Type_Unknown",FEMALE:"Gender_Type_Female",MALE:"Gender_Type_Male"},ze={NONE:"AdminForbid_Type_None",SEND_OUT:"AdminForbid_Type_SendOut"},We={NEED_CONFIRM:"AllowType_Type_NeedConfirm",ALLOW_ANY:"AllowType_Type_AllowAny",DENY_ANY:"AllowType_Type_DenyAny"},Ye="JoinedSuccess",$e="WaitAdminApproval",Je="@TGS#_",Xe="@TOPIC#_",Ze=["url"],Qe=function(e){return"map"===dt(e)},et=function(e){return"file"===dt(e)},nt=function(e){return null!==e&&("number"==typeof e&&!isNaN(e-0)||"object"===o(e)&&e.constructor===Number)},ot=function(e){return"string"==typeof e},rt=function(e){return null!==e&&"object"===o(e)},it=function(e){if("object"!==o(e)||null===e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;for(var n=t;null!==Object.getPrototypeOf(n);)n=Object.getPrototypeOf(n);return t===n},st=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"array"===dt(e)},at=function(e){return void 0===e},ct=function(e){return st(e)||rt(e)},ut=function(e){return"function"==typeof e},lt=function(e){return e instanceof Error},dt=function(e){return Object.prototype.toString.call(e).match(/^\[object (.*)\]$/)[1].toLowerCase()},pt=function(e){if("string"!=typeof e)return!1;var t=e[0];return!/[^a-zA-Z0-9]/.test(t)};Date.now||(Date.now=function(){return(new Date).getTime()});var ht=function e(t,n,o,r){if(!ct(t)||!ct(n))return 0;for(var i,s=0,a=Object.keys(n),c=0,u=a.length;c<u;c++)if(i=a[c],!(at(n[i])||o&&o.includes(i)))if(ct(t[i])&&ct(n[i]))s+=e(t[i],n[i],o,r);else{if(r&&r.includes(n[i]))continue;t[i]!==n[i]&&(t[i]=n[i],s+=1)}return s},gt=function(e){return JSON.stringify(e,["message","code"])},ft=function(e){if(0===e.length)return 0;for(var t=0,n=0,o="undefined"!=typeof document&&void 0!==document.characterSet?document.characterSet:"UTF-8";void 0!==e[t];)n+=e[t++].charCodeAt[t]<=255?1:!1===o?3:2;return n},_t=function(e){var t=e||99999999;return Math.round(Math.random()*t)},mt="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",vt=mt.length,yt=function(e,t){for(var n in e)if(e[n]===t)return!0;return!1},Mt={},It=function(e){return-1===e.indexOf("http://")||-1===e.indexOf("https://")?"https://"+e:e.replace(/https|http/,"https")},Ct=function e(t){if(0===Object.getOwnPropertyNames(t).length)return Object.create(null);var n=Array.isArray(t)?[]:Object.create(null),r="";for(var i in t)null!==t[i]?void 0!==t[i]?(r=o(t[i]),["string","number","function","boolean"].indexOf(r)>=0?n[i]=t[i]:n[i]=e(t[i])):n[i]=void 0:n[i]=null;return n};function Tt(e,t){if(!st(e)||!st(t))return!1;var n=!1;return t.forEach((function(t){var o=t.key,r=t.value,i=e.find((function(e){return e.key===o}));i?i.value!==r&&(i.value=r,n=!0):(e.push({key:o,value:r}),n=!0)})),n}var Et=function(e){return e===S.GRP_AVCHATROOM},kt=function(e){var t=e.type,n=e.groupID;return t===S.GRP_COMMUNITY||"".concat(n).startsWith(Je)&&!"".concat(n).includes(Xe)},Dt=function(e){return"".concat(e).startsWith(Je)&&"".concat(e).includes(Xe)},St=function(e){return ot(e)&&e.slice(0,3)===S.CONV_C2C},Lt=function(e){return ot(e)&&e.slice(0,5)===S.CONV_GROUP},At=function(e){return ot(e)&&e===S.CONV_SYSTEM};function Rt(e,t){var n={};return Object.keys(e).forEach((function(o){n[o]=t(e[o],o)})),n}function Ot(e){return ie?new Promise((function(t,n){ae.getImageInfo({src:e,success:function(e){t({width:e.width,height:e.height})},fail:function(){t({width:0,height:0})}})})):Ce&&9===Te?Promise.resolve({width:0,height:0}):new Promise((function(t,n){var o=new Image;o.onload=function(){t({width:this.width,height:this.height}),o=null},o.onerror=function(){t({width:0,height:0}),o=null},o.src=e}))}function Nt(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return"".concat(e()+e()).concat(e()).concat(e()).concat(e()).concat(e()).concat(e()).concat(e())}function wt(){var e="unknown";if(Se&&(e="mac"),De&&(e="windows"),ve&&(e="ios"),Me&&(e="android"),ie)try{var t=ae.getSystemInfoSync().platform;void 0!==t&&(e=t)}catch(n){}return e}function bt(e,t){e=e.split("."),t=t.split(".");for(var n=Math.max(e.length,t.length);e.length<n;)e.push("0");for(;t.length<n;)t.push("0");for(var o=0;o<n;o++){var r=parseInt(e[o]),i=parseInt(t[o]);if(r>i)return 1;if(r<i)return-1}return 0}function Ut(e){var t=e.originUrl,n=void 0===t?void 0:t,o=e.originWidth,r=e.originHeight,i=e.min,s=void 0===i?198:i,a=parseInt(o),c=parseInt(r),u={url:void 0,width:0,height:0};if((a<=c?a:c)<=s)u.url=n,u.width=a,u.height=c;else{c<=a?(u.width=Math.ceil(a*s/c),u.height=s):(u.width=s,u.height=Math.ceil(c*s/a));var l=n&&n.indexOf("?")>-1?"".concat(n,"&"):"".concat(n,"?");u.url="".concat(l,198===s?"imageView2/3/w/198/h/198":"imageView2/3/w/720/h/720")}return at(n)?(u.url,g(u,Ze)):u}function Pt(e){var t=e[2];e[2]=e[1],e[1]=t;for(var n=0;n<e.length;n++)e[n].setType(n)}function Gt(e){var t=e.servcmd;return t.slice(t.indexOf(".")+1)}function xt(e,t){return Math.round(Number(e)*Math.pow(10,t))/Math.pow(10,t)}function Ft(e,t){return e.includes(t)}function qt(e,t){return e.includes(t)}function Bt(e){return e.split(Xe)[0]}var Vt=function(e,t,n){if(at(t))return"";switch(e){case S.MSG_TEXT:return t.text;case S.MSG_IMAGE:return n?"[Image]":"[图片]";case S.MSG_LOCATION:return n?"[Location]":"[位置]";case S.MSG_AUDIO:return n?"[Voice]":"[语音]";case S.MSG_VIDEO:return n?"[Video]":"[视频]";case S.MSG_FILE:return n?"[File]":"[文件]";case S.MSG_CUSTOM:return n?"[Custom Messages]":"[自定义消息]";case S.MSG_GRP_TIP:return n?"[Group Notification]":"[群提示消息]";case S.MSG_GRP_SYS_NOTICE:return n?"[Group System Message]":"[群系统通知]";case S.MSG_FACE:return n?"[Animated Sticker]":"[动画表情]";case S.MSG_MERGER:return n?"[Chat Record]":"[聊天记录]";default:return""}};function Kt(e){return e===S.MSG_TEXT||e===S.MSG_CUSTOM||e===S.MSG_LOCATION||e===S.MSG_FACE}function Ht(e){var t=[];if(!ot(e))return t;var n=e.length;if(0===n)return t;for(var o=n-1;o>=0;o--)"1"===e[o]&&t.push(Math.pow(2,n-o-1));return t}function jt(){return!Ce&&!ie}function zt(e){return"the length of userIDList cannot exceed ".concat(e)}function Wt(e,t){if(e){var n=e;return t&&(e.startsWith("http://")?n=e.replace(/^http:\/\/[^/]+/,t):e.startsWith("https://")&&(n=e.replace(/^https:\/\/[^/]+/,t))),n}}var Yt=Object.prototype.hasOwnProperty;function $t(e){if(null==e)return!0;if("boolean"==typeof e)return!1;if("number"==typeof e)return 0===e;if("string"==typeof e)return 0===e.length;if("function"==typeof e)return 0===e.length;if(Array.isArray(e))return 0===e.length;if(e instanceof Error)return""===e.message;if(it(e)){for(var t in e)if(Yt.call(e,t))return!1;return!0}return!(!Qe(e)&&(n=e,"set"!==dt(n))&&!et(e))&&0===e.size;var n}function Jt(e,t,n){if(void 0===t)return!0;var o=!0;if(it(t))Object.keys(t).forEach((function(r){var i=1===e.length?e[0][r]:void 0;o=!!Xt(i,t[r],n,r)&&o}));else if(st(t))for(var r=0;r<t.length;r++)o=!!Xt(e[r],t[r],n,t[r].name)&&o;if(o)return o;throw new Error("Params validate failed.")}function Xt(e,t,n,o){if(void 0===t)return!0;var r=!0;if(t.required&&$t(e)&&(Ve.e("[".concat(n,'] Missing required params: "').concat(o,'".')),r=!1),!$t(e)){var i=dt(e),s=t.type.toLowerCase();i!==s&&("asyncfunction"===i&&"function"===s||(Ve.e("[".concat(n,'] Invalid params: type check failed for "').concat(o,'".Expected ').concat(t.type,".")),r=!1))}return t.validator&&!t.validator(e)&&(Ve.e("[".concat(n,"] Invalid params: custom validator check failed for params.")),r=!1),r}var Zt,Qt={UNSEND:"unSend",SUCCESS:"success",FAIL:"fail"},en={NOT_START:"notStart",PENDING:"pending",RESOLVED:"resolved",REJECTED:"rejected"},tn=function(e){if(!e)return!1;if(St(e)||Lt(e)||At(e))return!0;var t=Ln("InvalidConversationID",e);return t&&Ve.w(t),!1},nn=function(e){""!==e.desc&&""!==Ln("API_REFER")&&Ve.w("[".concat(e.api,"] | ").concat(e.param," | ").concat(e.desc,", ").concat(Ln("API_REFER")).concat(e.api))},on=function(){return Ln("StringRequiredLog")},rn=function(e){return Ln("NonEmptyStringRequiredLog",e)},sn=function(){return Ln("NumberRequiredLog")},an=function(){return Ln("UndefinedNotAllowedLog")},cn=function(){return Ln("FileRequiredLog")},un=function(){return Ln("FunctionRequiredLog")},ln=function(){return Ln("ArrayRequiredLog")},dn=function(){return Ln("NonEmptyArrayLog")},pn=function(){return Ln("CallbackMissingLog")},hn=function(){return Ln("PositiveIntegerRequiredLog")},gn=function(e,t){return Ln("StringNotLongerThanLog",e,t)},fn=function(e,t){return Ln("NumberLessThanLog",e,t)},_n=function(e){return Ln("KeyValueStringRequiredLog",e)},mn=function(){return Ln("PlainObjectRequiredLog")},vn=function(){return Ln("NonEmptyContentRequiredLog")},yn=function(){return Ln("FileNotSelectedLog")},Mn=function(){return Ln("MessageInstanceRequiredLog")},In=function(){return Ln("NonAnonymousFunctionLog")},Cn=function(){return Ln("MessageExtensionNotAvailableLog")},Tn={type:"String",required:!0},En={type:"Array",required:!0},kn={type:"Object",required:!0},Dn={type:"Boolean",required:!0},Sn={type:"number",required:!0},Ln=null,An={hookGetAPITips:function(e){Ln=e},login:{userID:Tn,userSig:Tn},addToBlacklist:{userIDList:En},removeFromBlacklist:{userIDList:En},on:[{name:"eventName",type:"String",validator:function(e){return"string"==typeof e&&0!==e.length||(nn({api:"on",param:"eventName",desc:rn("eventName")}),!1)}},{name:"handler",type:"Function",validator:function(e){return"function"!=typeof e?(nn({api:"on",param:"handler",desc:un()}),!1):(""===e.name&&nn({api:"on",param:"handler",desc:In()}),!0)}}],once:[{name:"eventName",type:"String",validator:function(e){return"string"==typeof e&&0!==e.length||(nn({api:"once",param:"eventName",desc:rn("eventName")}),!1)}},{name:"handler",type:"Function",validator:function(e){return"function"!=typeof e?(nn({api:"once",param:"handler",desc:un()}),!1):(""===e.name&&nn({api:"once",param:"handler",desc:In()}),!0)}}],off:[{name:"eventName",type:"String",validator:function(e){return"string"==typeof e&&0!==e.length||(nn({api:"off",param:"eventName",desc:rn("eventName")}),!1)}},{name:"handler",type:"Function",validator:function(e){return"function"!=typeof e?(nn({api:"off",param:"handler",desc:un()}),!1):(""===e.name&&nn({api:"off",param:"handler",desc:In()}),!0)}}],sendMessage:[n({name:"message"},kn)],setMessageExtensions:[n(n({name:"message"},kn),{},{validator:function(e){return e.status===Qt.SUCCESS&&!0===e.isSupportExtension||(nn({api:"setMessageExtensions",param:"message",desc:Cn()}),!1)}}),n({name:"extensions"},En)],getMessageExtensions:[n(n({name:"message"},kn),{},{validator:function(e){return e.status===Qt.SUCCESS&&!0===e.isSupportExtension||(nn({api:"getMessageExtensions",param:"message",desc:Cn()}),!1)}})],deleteMessageExtensions:[n(n({name:"message"},kn),{},{validator:function(e){return e.status===Qt.SUCCESS&&!0===e.isSupportExtension||(nn({api:"deleteMessageExtensions",param:"message",desc:Cn()}),!1)}})],getMessageList:{conversationID:n(n({},Tn),{},{validator:function(e){return tn(e)}}),nextReqMessageID:{type:"String"},count:{type:"Number",validator:function(e){return!(!at(e)&&!/^[1-9][0-9]*$/.test(e)&&(nn({api:"getMessageList",param:"count",desc:hn()}),1))}}},getMessageListHopping:{conversationID:n(n({},Tn),{},{validator:function(e){return tn(e)}}),sequence:{type:"Number"},time:{type:"Number"},direction:{type:"Number",validator:function(e){return!(!at(e)&&0!==e&&1!==e&&(nn({api:"getMessageListHopping",param:"direction",desc:Ln("0Or1RequiredLog")}),1))}},count:{type:"Number",validator:function(e){return!(!at(e)&&!/^[1-9][0-9]*$/.test(e)&&(nn({api:"getMessageListHopping",param:"count",desc:hn}),1))}}},setMessageRead:{conversationID:n(n({},Tn),{},{validator:function(e){return tn(e)}})},setAllMessageRead:{scope:{type:"String",required:!1,validator:function(e){return!e||-1!==[S.READ_ALL_C2C_MSG,S.READ_ALL_GROUP_MSG,S.READ_ALL_MSG].indexOf(e)||(nn({api:"setAllMessageRead",param:"scope",desc:"TIM.TYPES.READ_ALL_C2C_MSG or TIM.TYPES.READ_ALL_GROUP_MSG or TIM.TYPES.READ_ALL_MSG required"}),!1)}}},getConversationProfile:[n(n({name:"conversationID"},Tn),{},{validator:function(e){return tn(e)}})],clearHistoryMessage:[n(n({name:"conversationID"},Tn),{},{validator:function(e){return tn(e)}})],pinConversation:{conversationID:n(n({},Tn),{},{validator:function(e){return tn(e)}}),isPinned:n({},Dn)},setConversationCustomData:{conversationIDList:n({},En),customData:{type:"String",validator:function(e){return ot(e)?!(e.length>256&&(nn({api:"setConversationCustomData",param:"customData",desc:gn("customData",256)}),1)):(nn({api:"setConversationCustomData",param:"customData",desc:on()}),!1)}}},markConversation:{conversationIDList:n({},En),markType:{type:"number",validator:function(e){return nt(e)?e<=0?(nn({api:"markConversation",param:"markType",desc:(t="markType",n=0,Ln("NumberGreaterThanLog",t,n))}),!1):!(e>=Math.pow(2,64)&&(nn({api:"markConversation",param:"markType",desc:fn("markType","Math.pow(2,64)")}),1)):(nn({api:"markConversation",param:"markType",desc:sn()}),!1);var t,n}},enableMark:n({},Dn)},createConversationGroup:{conversationIDList:n({},En),groupName:n(n({},Tn),{},{validator:function(e){return!(!e||e.length>32&&(nn({api:"createConversationGroup",param:"groupName",desc:gn("groupName",32)}),1))}})},deleteConversationGroup:[n({name:"groupName"},Tn)],renameConversationGroup:{oldName:n({},Tn),newName:n(n({},Tn),{},{validator:function(e){return!(!e||e.length>32&&(nn({api:"renameConversationGroup",param:"newName",desc:gn("newName",32)}),1))}})},addConversationsToGroup:{conversationIDList:n({},En),groupName:n({},Tn)},deleteConversationsFromGroup:{conversationIDList:n({},En),groupName:n({},Tn)},getGroupList:{groupProfileFilter:{type:"Array"}},getGroupProfile:{groupID:Tn,groupCustomFieldFilter:{type:"Array"},memberCustomFieldFilter:{type:"Array"}},getGroupProfileAdvance:{groupIDList:En},createGroup:{name:Tn},joinGroup:{groupID:Tn,type:{type:"String"},applyMessage:{type:"String"}},quitGroup:[n({name:"groupID"},Tn)],handleApplication:{message:kn,handleAction:Tn,handleMessage:{type:"String"}},changeGroupOwner:{groupID:Tn,newOwnerID:Tn},updateGroupProfile:{groupID:Tn,muteAllMembers:{type:"Boolean"}},dismissGroup:[n({name:"groupID"},Tn)],searchGroupByID:[n({name:"groupID"},Tn)],initGroupAttributes:{groupID:Tn,groupAttributes:n(n({},kn),{},{validator:function(e){var t=!0;return Object.keys(e).forEach((function(n){if(!ot(e[n]))return nn({api:"initGroupAttributes",param:"groupAttributes",desc:_n("value")}),t=!1})),t}})},setGroupAttributes:{groupID:Tn,groupAttributes:n(n({},kn),{},{validator:function(e){var t=!0;return Object.keys(e).forEach((function(n){if(!ot(e[n]))return nn({api:"setGroupAttributes",param:"groupAttributes",desc:_n("value")}),t=!1})),t}})},deleteGroupAttributes:{groupID:Tn,keyList:{type:"Array",validator:function(e){if(at(e)||!st(e))return nn({api:"deleteGroupAttributes",param:"keyList",desc:ln()}),!1;if(!$t(e)){var t=!0;return e.forEach((function(e){if(!ot(e))return nn({api:"deleteGroupAttributes",param:"keyList",desc:Ln("StringArrayRequiredLog")}),t=!1})),t}return!0}}},getGroupAttributes:{groupID:Tn,keyList:{type:"Array",validator:function(e){if(at(e)||!st(e))return nn({api:"getGroupAttributes",param:"keyList",desc:ln()}),!1;if(!$t(e)){var t=!0;return e.forEach((function(e){if(!ot(e))return nn({api:"getGroupAttributes",param:"keyList",desc:_n("key")}),t=!1})),t}return!0}}},setGroupCounters:{groupID:Tn,counters:kn},increaseGroupCounter:{groupID:Tn,key:Tn,value:Sn},decreaseGroupCounter:{groupID:Tn,key:Tn,value:Sn},getGroupCounters:{groupID:Tn},getGroupMemberList:{groupID:Tn,count:{type:"Number"}},getGroupMemberProfile:{groupID:Tn,userIDList:En,memberCustomFieldFilter:{type:"Array"}},addGroupMember:{groupID:Tn,userIDList:En},setGroupMemberRole:{groupID:Tn,userID:Tn,role:Tn},setGroupMemberMuteTime:{groupID:Tn,userID:Tn,muteTime:{type:"Number",validator:function(e){return e>=0}}},setGroupMemberNameCard:{groupID:Tn,userID:{type:"String"},nameCard:{type:"String",validator:function(e){return ot(e)?(e.length,!0):(nn({api:"setGroupMemberNameCard",param:"nameCard",desc:on()}),!1)}}},setGroupMemberCustomField:{groupID:Tn,userID:{type:"String"},memberCustomField:En},deleteGroupMember:{groupID:Tn},markGroupMemberList:{groupID:Tn,markType:{type:"number",validator:function(e){return nt(e)?!(e<1e3&&(nn({api:"markGroupMemberList",param:"markType",desc:(t="markType",n=1e3,Ln("NumberGreaterOrEqualLog",t,n))}),1)):(nn({api:"markGroupMemberList",param:"markType",desc:sn()}),!1);var t,n}},userIDList:n({},En),enableMark:n({},Dn)},createTextMessage:{to:Tn,conversationType:Tn,payload:n(n({},kn),{},{validator:function(e){return it(e)?ot(e.text)?0!==e.text.length||(nn({api:"createTextMessage",param:"payload.text",desc:vn()}),!1):(nn({api:"createTextMessage",param:"payload.text",desc:on()}),!1):(nn({api:"createTextMessage",param:"payload",desc:mn()}),!1)}})},createTextAtMessage:{to:Tn,conversationType:Tn,payload:n(n({},kn),{},{validator:function(e){return it(e)?ot(e.text)?0===e.text.length?(nn({api:"createTextAtMessage",param:"payload.text",desc:vn()}),!1):!(e.atUserList&&!st(e.atUserList)&&(nn({api:"createTextAtMessage",param:"payload.atUserList",desc:ln()}),1)):(nn({api:"createTextAtMessage",param:"payload.text",desc:on()}),!1):(nn({api:"createTextAtMessage",param:"payload",desc:mn()}),!1)}})},createCustomMessage:{to:Tn,conversationType:Tn,payload:n(n({},kn),{},{validator:function(e){return it(e)?e.data&&!ot(e.data)?(nn({api:"createCustomMessage",param:"payload.data",desc:on()}),!1):e.description&&!ot(e.description)?(nn({api:"createCustomMessage",param:"payload.description",desc:on()}),!1):!(e.extension&&!ot(e.extension)&&(nn({api:"createCustomMessage",param:"payload.extension",desc:on()}),1)):(nn({api:"createCustomMessage",param:"payload",desc:mn()}),!1)}})},createImageMessage:{to:Tn,conversationType:Tn,payload:n(n({},kn),{},{validator:function(e){if(!it(e))return nn({api:"createImageMessage",param:"payload",desc:mn()}),!1;if(at(e.file))return nn({api:"createImageMessage",param:"payload.file",desc:an()}),!1;if(se){if(!(e.file instanceof HTMLInputElement||et(e.file)))return it(e.file)&&"undefined"!=typeof uni?0!==e.file.tempFilePaths.length&&0!==e.file.tempFiles.length||(nn({api:"createImageMessage",param:"payload.file",desc:yn()}),!1):(nn({api:"createImageMessage",param:"payload.file",desc:cn()}),!1);if(e.file instanceof HTMLInputElement&&0===e.file.files.length)return nn({api:"createImageMessage",param:"payload.file",desc:yn()}),!1}return!0},onProgress:{type:"Function",required:!1,validator:function(e){return at(e)&&nn({api:"createImageMessage",param:"onProgress",desc:pn()}),!0}}})},createAudioMessage:{to:Tn,conversationType:Tn,payload:n(n({},kn),{},{validator:function(e){return!!it(e)||(nn({api:"createAudioMessage",param:"payload",desc:mn()}),!1)}}),onProgress:{type:"Function",required:!1,validator:function(e){return at(e)&&nn({api:"createAudioMessage",param:"onProgress",desc:pn()}),!0}}},createVideoMessage:{to:Tn,conversationType:Tn,payload:n(n({},kn),{},{validator:function(e){if(!it(e))return nn({api:"createVideoMessage",param:"payload",desc:mn()}),!1;if(at(e.file))return nn({api:"createVideoMessage",param:"payload.file",desc:an()}),!1;if(se){if(!(e.file instanceof HTMLInputElement||et(e.file)))return it(e.file)&&"undefined"!=typeof uni?!!et(e.file.tempFile)||(nn({api:"createVideoMessage",param:"payload.file",desc:yn()}),!1):(nn({api:"createVideoMessage",param:"payload.file",desc:cn()}),!1);if(e.file instanceof HTMLInputElement&&0===e.file.files.length)return nn({api:"createVideoMessage",param:"payload.file",desc:yn()}),!1}return!0}}),onProgress:{type:"Function",required:!1,validator:function(e){return at(e)&&nn({api:"createVideoMessage",param:"onProgress",desc:pn()}),!0}}},createFaceMessage:{to:Tn,conversationType:Tn,payload:n(n({},kn),{},{validator:function(e){return it(e)?nt(e.index)?!!ot(e.data)||(nn({api:"createFaceMessage",param:"payload.data",desc:on()}),!1):(nn({api:"createFaceMessage",param:"payload.index",desc:sn()}),!1):(nn({api:"createFaceMessage",param:"payload",desc:mn()}),!1)}})},createFileMessage:{to:Tn,conversationType:Tn,payload:n(n({},kn),{},{validator:function(e){if(!it(e))return nn({api:"createFileMessage",param:"payload",desc:mn()}),!1;if(at(e.file))return nn({api:"createFileMessage",param:"payload.file",desc:an()}),!1;if(se){if(!(e.file instanceof HTMLInputElement||et(e.file)))return it(e.file)&&"undefined"!=typeof uni?0!==e.file.tempFilePaths.length&&0!==e.file.tempFiles.length||(nn({api:"createFileMessage",param:"payload.file",desc:yn()}),!1):(nn({api:"createFileMessage",param:"payload.file",desc:cn()}),!1);if(e.file instanceof HTMLInputElement&&0===e.file.files.length)return nn({api:"createFileMessage",param:"payload.file",desc:yn()}),!1}return!0}}),onProgress:{type:"Function",required:!1,validator:function(e){return at(e)&&nn({api:"createFileMessage",param:"onProgress",desc:pn()}),!0}}},createLocationMessage:{to:Tn,conversationType:Tn,payload:n(n({},kn),{},{validator:function(e){return it(e)?ot(e.description)?nt(e.longitude)?!!nt(e.latitude)||(nn({api:"createLocationMessage",param:"payload.latitude",desc:sn()}),!1):(nn({api:"createLocationMessage",param:"payload.longitude",desc:sn()}),!1):(nn({api:"createLocationMessage",param:"payload.description",desc:on()}),!1):(nn({api:"createLocationMessage",param:"payload",desc:mn()}),!1)}})},createMergerMessage:{to:Tn,conversationType:Tn,payload:n(n({},kn),{},{validator:function(e){if($t(e.messageList))return nn({api:"createMergerMessage",param:"payload.messageList",desc:dn()}),!1;if($t(e.compatibleText))return nn({api:"createMergerMessage",param:"payload.compatibleText",desc:rn("compatibleText")}),!1;var t=!1;return e.messageList.forEach((function(e){e.status===Qt.FAIL&&(t=!0)})),!t||(nn({api:"createMergerMessage",param:"payload.messageList",desc:Ln("MergeFailedMessageLog")}),!1)}})},revokeMessage:[n(n({name:"message"},kn),{},{validator:function(e){return $t(e)?(nn({api:"revokeMessage",param:"message",desc:Mn()}),!1):e.conversationType===S.CONV_SYSTEM?(nn({api:"revokeMessage",param:"message",desc:Ln("MessageCanBeRevokedDesc")}),!1):!0!==e.isRevoked||(nn({api:"revokeMessage",param:"message",desc:Ln("MessageRevokedLog")}),!1)}})],deleteMessage:[n(n({name:"messageList"},En),{},{validator:function(e){return!$t(e)||(nn({api:"deleteMessage",param:"messageList",desc:dn()}),!1)}})],translateText:{sourceTextList:En,sourceLanguage:Tn,targetLanguage:Tn},modifyMessage:[n(n({name:"message"},kn),{},{validator:function(e){return $t(e)?(nn({api:"modifyMessage",param:"message",desc:Mn()}),!1):e.conversationType===S.CONV_SYSTEM?(nn({api:"modifyMessage",param:"message",desc:Ln("MessageCanBeModifiedLog")}),!1):!0!==e._onlineOnlyFlag||(nn({api:"modifyMessage",param:"message",desc:Ln("OnlineMessageNotSupportLog")}),!1)}})],getUserProfile:{userIDList:{type:"Array",validator:function(e){return st(e)?(0===e.length&&nn({api:"getUserProfile",param:"userIDList",desc:dn()}),!0):(nn({api:"getUserProfile",param:"userIDList",desc:ln()}),!1)}}},updateMyProfile:{profileCustomField:{type:"Array",validator:function(e){return!!at(e)||!!st(e)||(nn({api:"updateMyProfile",param:"profileCustomField",desc:ln()}),!1)}}},setSelfStatus:{customStatus:{type:"String",validator:function(e){return!!ot(e)||(nn({api:"setSelfStatus",param:"customStatus",desc:on()}),!1)}}},getUserStatus:{userIDList:{type:"Array",validator:function(e){return st(e)?0!==e.length||(nn({api:"getUserStatus",param:"userIDList",desc:dn()}),!1):(nn({api:"getUserStatus",param:"userIDList",desc:ln()}),!1)}}},subscribeUserStatus:{userIDList:{type:"Array",validator:function(e){return st(e)?0!==e.length||(nn({api:"subscribeUserStatus",param:"userIDList",desc:dn()}),!1):(nn({api:"subscribeUserStatus",param:"userIDList",desc:ln()}),!1)}}},unsubscribeUserStatus:{userIDList:{type:"Array",validator:function(e){return!e||!!st(e)||(nn({api:"subscribeUserStatus",param:"userIDList",desc:ln()}),!1)}}},addFriend:{to:Tn,source:{type:"String",required:!0,validator:function(e){return!(!e||(e.startsWith("AddSource_Type_")?e.replace("AddSource_Type_","").length>8&&(nn({api:"addFriend",param:"source",desc:gn("keyword",8)}),1):(nn({api:"addFriend",param:"source",desc:Ln("SourcePrefixLog")}),1)))}},remark:{type:"String",required:!1,validator:function(e){return!(ot(e)&&e.length>96&&(nn({api:"addFriend",param:"remark",desc:gn("remark",96)}),1))}}},deleteFriend:{userIDList:En},checkFriend:{userIDList:En},getFriendProfile:{userIDList:En},updateFriend:{userID:Tn,remark:{type:"String",required:!1,validator:function(e){return!(ot(e)&&e.length>96&&(nn({api:"updateFriend",param:"remark",desc:gn("remark",96)}),1))}},friendCustomField:{type:"Array",required:!1,validator:function(e){if(e){if(!st(e))return nn({api:"updateFriend",param:"friendCustomField",desc:ln()}),!1;var t=!0;return e.forEach((function(e){return ot(e.key)&&-1!==e.key.indexOf("Tag_SNS_Custom")?ot(e.value)?e.key.replace("Tag_SNS_Custom_","").length>8?(nn({api:"updateFriend",param:"friendCustomField",desc:gn("keyword",8)}),t=!1):void 0:(nn({api:"updateFriend",param:"friendCustomField",desc:_n("value")}),t=!1):(nn({api:"updateFriend",param:"friendCustomField",desc:Ln("FriendCustomFieldPrefixLog")}),t=!1)})),t}return!0}}},acceptFriendApplication:{userID:Tn},refuseFriendApplication:{userID:Tn},deleteFriendApplication:{userID:Tn},createFriendGroup:{name:Tn},deleteFriendGroup:{name:Tn},addToFriendGroup:{name:Tn,userIDList:En},removeFromFriendGroup:{name:Tn,userIDList:En},renameFriendGroup:{oldName:Tn,newName:Tn},sendMessageReadReceipt:[{name:"messageList",type:"Array",validator:function(e){return st(e)?0!==e.length||(nn({api:"sendMessageReadReceipt",param:"messageList",desc:dn()}),!1):(nn({api:"sendMessageReadReceipt",param:"messageList",desc:ln()}),!1)}}],getMessageReadReceiptList:[{name:"messageList",type:"Array",validator:function(e){return st(e)?0!==e.length||(nn({api:"getMessageReadReceiptList",param:"messageList",desc:dn()}),!1):(nn({api:"getMessageReadReceiptList",param:"messageList",desc:ln()}),!1)}}],createTopicInCommunity:{groupID:Tn,topicName:Tn},deleteTopicFromCommunity:{groupID:Tn,topicIDList:{type:"Array",validator:function(e){return!e||!!st(e)||(nn({api:"deleteTopicFromCommunity",param:"topicIDList",desc:ln()}),!1)}}},updateTopicProfile:{groupID:Tn,topicID:Tn},getTopicList:{groupID:Tn,topicIDList:{type:"Array",validator:function(e){return!e||!!st(e)||(nn({api:"getTopicList",param:"topicIDList",desc:ln()}),!1)}}}},Rn={login:1,logout:1,on:1,once:1,off:1,setLogLevel:1,registerPlugin:1,destroy:1,createTextMessage:1,createTextAtMessage:1,createImageMessage:1,createAudioMessage:1,createVideoMessage:1,createCustomMessage:1,createFaceMessage:1,createFileMessage:1,createLocationMessage:1,createMergerMessage:1,downloadMergerMessage:1,createForwardMessage:1,sendMessage:1,resendMessage:1,revokeMessage:1,deleteMessage:1,translateText:1,modifyMessage:1,sendMessageReadReceipt:1,getGroupMessageReadMemberList:1,getMessageReadReceiptList:1,setMessageExtensions:1,getMessageExtensions:1,deleteMessageExtensions:1,getMessageList:1,findMessage:1,getMessageListHopping:1,setMessageRead:1,setAllMessageRead:1,getConversationList:1,getConversationProfile:1,deleteConversation:1,pinConversation:1,getTotalUnreadMessageCount:1,setConversationCustomData:1,markConversation:1,createConversationGroup:1,getConversationGroupList:1,deleteConversationGroup:1,renameConversationGroup:1,addConversationsToGroup:1,deleteConversationsFromGroup:1,clearHistoryMessage:1,getGroupList:1,getGroupProfile:1,createGroup:1,joinGroup:1,updateGroupProfile:1,quitGroup:1,dismissGroup:1,changeGroupOwner:1,searchGroupByID:1,setMessageRemindType:1,getGroupApplicationList:1,handleGroupApplication:1,initGroupAttributes:1,setGroupAttributes:1,deleteGroupAttributes:1,getGroupAttributes:1,setGroupCounters:1,increaseGroupCounter:1,decreaseGroupCounter:1,getGroupCounters:1,getJoinedCommunityList:1,createTopicInCommunity:1,deleteTopicFromCommunity:1,updateTopicProfile:1,getTopicList:1,getGroupMemberProfile:1,getGroupMemberList:1,addGroupMember:1,deleteGroupMember:1,setGroupMemberNameCard:1,setGroupMemberMuteTime:1,setGroupMemberRole:1,setGroupMemberCustomField:1,getGroupOnlineMemberCount:1,markGroupMemberList:1,getMyProfile:1,getUserProfile:1,updateMyProfile:1,setSelfStatus:1,getUserStatus:1,subscribeUserStatus:1,unsubscribeUserStatus:1,getBlacklist:1,addToBlacklist:1,removeFromBlacklist:1,getFriendList:1,addFriend:1,deleteFriend:1,checkFriend:1,updateFriend:1,getFriendProfile:1,getFriendApplicationList:1,refuseFriendApplication:1,deleteFriendApplication:1,acceptFriendApplication:1,setFriendApplicationRead:1,getFriendGroupList:1,createFriendGroup:1,renameFriendGroup:1,deleteFriendGroup:1,addToFriendGroup:1,removeFromFriendGroup:1,callExperimentalAPI:1},On=1,Nn=2,wn=3,bn=4,Un=6,Pn=7,Gn=8,xn=9,Fn=10,qn=11,Bn=12,Vn=13,Kn=14,Hn=15,jn=16,zn=17,Wn=18,Yn=19,$n=20,Jn=21,Xn=22,Zn=23,Qn=24,eo=25,to=26,no=27,oo=28,ro=29,io=30,so=31,ao=32,co=function(){function e(t){r(this,e),this._m=t,this._n=""}return s(e,[{key:"isLoggedIn",value:function(){return this._m.getModule(Bn).isLoggedIn()}},{key:"isOversea",value:function(){return this._m.getModule(Bn).isOversea()}},{key:"isPrivateNetWork",value:function(){return this._m.getModule(Bn).isPrivateNetWork()}},{key:"getFileDownloadProxy",value:function(){return this._m.getModule(Bn).getFileDownloadProxy()}},{key:"getMyUserID",value:function(){return this._m.getModule(Bn).getUserID()}},{key:"getMyTinyID",value:function(){return this._m.getModule(Bn).getTinyID()}},{key:"getSDKAppID",value:function(){return this._m.getModule(Bn).getSDKAppID()}},{key:"isIntl",value:function(){return this._m.getModule(Bn).isIntl()}},{key:"isDevMode",value:function(){return this._m.getModule(Bn).isDevMode()}},{key:"getModule",value:function(e){return this._m.getModule(e)}},{key:"getPlatform",value:function(){return ge}},{key:"getNetworkType",value:function(){return this._m.getModule(Hn).getNetworkType()}},{key:"probeNetwork",value:function(e){return this._m.getModule(Hn).probe(e)}},{key:"getCloudConfig",value:function(e){return this._m.getModule(Zn).getCloudConfig(e)}},{key:"emitOuterEvent",value:function(e,t){this._m.getOuterEmitterInstance().emit(e,t)}},{key:"emitInnerEvent",value:function(e,t){this._m.getInnerEmitterInstance().emit(e,t)}},{key:"getInnerEmitterInstance",value:function(){return this._m.getInnerEmitterInstance()}},{key:"generateTjgID",value:function(e){return this._m.getModule(Bn).getTinyID()+"-"+e.random}},{key:"filterModifiedMessage",value:function(e){if(!$t(e)){var t=e.filter((function(e){return!0===e.isModified}));t.length>0&&this.emitOuterEvent(D.MESSAGE_MODIFIED,t)}}},{key:"filterUnmodifiedMessage",value:function(e){return $t(e)?[]:e.filter((function(e){return!1===e.isModified}))}},{key:"request",value:function(e){return this._m.getModule($n).request(e)}},{key:"canIUse",value:function(e){return this._m.getModule(no).canIUse(e)}},{key:"getErrorMessage",value:function(e,t,n){return this._m.getErrorMessage(e,t,n)}},{key:"outputWarning",value:function(e,t,n){var o=this.getErrorMessage(e,t,n);o&&Ve.w(o)}}]),e}(),uo="wslogin",lo="wslogout",po="wshello",ho="KickOther",go="getmsg",fo="authkey",_o="sendmsg",mo="send_group_msg",vo="portrait_get_all",yo="portrait_set",Mo="black_list_get",Io="black_list_add",Co="black_list_delete",To="msgwithdraw",Eo="msgreaded",ko="set_c2c_peer_mute_notifications",Do="get_c2c_peer_mute_notifications",So="getroammsg",Lo="get_peer_read_time",Ao="delete_c2c_msg_ramble",Ro="modify_c2c_msg",Oo="set_key_values",No="get_key_values",wo="page_get",bo="get",Uo="batch_delete",Po="clear_msg",Go="top",xo="deletemsg",Fo="set_conv_custom_data",qo="mark_contact",Bo="create_contact_group",Vo="del_contact_group",Ko="update_contact_group",Ho="add_conv_to_group",jo="del_conv_from_group",zo="get_contact_group",Wo="get_joined_group_list",Yo="get_group_self_member_info",$o="create_group",Jo="destroy_group",Xo="modify_group_base_info",Zo="apply_join_group",Qo="apply_join_group_noauth",er="quit_group",tr="get_group_public_info",nr="change_group_owner",or="handle_apply_join_group",rr="handle_invite_join_permission_group",ir="handle_invite_join_group",sr="group_msg_recall",ar="msg_read_report",cr="read_all_unread_msg",ur="group_msg_get",lr="get_group_msg_receipt",dr="group_msg_receipt",pr="c2c_msg_read_receipt",hr="get_group_msg_receipt_detail",gr="get_pendency",fr="deletemsg",_r="get_msg",mr="get_msg_noauth",vr="get_online_member_num",yr="delete_group_ramble_msg_by_seq",Mr="modify_group_msg",Ir="set_group_attr",Cr="modify_group_attr",Tr="delete_group_attr",Er="clear_group_attr",kr="get_group_attr",Dr="group_set_key_values",Sr="group_get_key_values",Lr="get_group_notify",Ar="update_group_counter",Rr="get_group_counter",Or="get_group_member_info",Nr="get_members",wr="get_specified_group_member_info",br="add_group_member",Ur="delete_group_member",Pr="ban_group_member",Gr="modify_group_member_info",xr="modify_user_info",Fr="cos",qr="pre_sig",Br="video_cover",Vr="tim_web_report_v2",Kr="alive",Hr="msg_push",jr="multi_msg_push_ws",zr="ws_msg_push_ack",Wr="stat_forceoffline",Yr="save_relay_json_msg",$r="get_relay_json_msg",Jr="fetch_config",Xr="push_configv2",Zr="fetch_imsdk_purchase_bitsv2",Qr="push_imsdk_purchase_bitsv2",ei="notify2",ti="create_topic",ni="destroy_topic",oi="modify_topic",ri="get_topic",ii="ws_set_custom_status",si="ws_get_user_status",ai="ws_status_subscribe",ci="ws_status_unsubscribe",ui="ws_stat_background",li="ws_stat_foreground",di="ws_stat_settoken",pi="get_local_words",hi="ws_batch_trans_text",gi={NO_SDKAPPID:2e3,NO_ACCOUNT_TYPE:2001,NO_IDENTIFIER:2002,NO_USERSIG:2003,NO_TINYID:2022,NO_A2KEY:2023,USER_NOT_LOGGED_IN:2024,REPEAT_LOGIN:2025,COS_UNDETECTED:2040,COS_GET_SIG_FAIL:2041,MESSAGE_SEND_FAIL:2100,MESSAGE_SEND_FAIL_NOT_IN_AVCHATROOM:2101,MESSAGE_SEND_NEED_MESSAGE_INSTANCE:2105,MESSAGE_SEND_INVALID_CONVERSATION_TYPE:2106,MESSAGE_FILE_IS_EMPTY:2108,MESSAGE_ONPROGRESS_FUNCTION_ERROR:2109,MESSAGE_REVOKE_FAIL:2110,MESSAGE_DELETE_FAIL:2111,MESSAGE_UNREAD_ALL_FAIL:2112,READ_RECEIPT_MESSAGE_LIST_EMPTY:2114,MESSAGE_SEND_GROUP_WITH_TOPIC_FAIL:2115,CANNOT_DELETE_GROUP_SYSTEM_NOTICE:2116,TRANSLATE_TEXT_FAIL:2117,MESSAGE_IMAGE_SELECT_FILE_FIRST:2251,MESSAGE_IMAGE_TYPES_LIMIT:2252,MESSAGE_IMAGE_SIZE_LIMIT:2253,MESSAGE_AUDIO_UPLOAD_FAIL:2300,MESSAGE_AUDIO_SIZE_LIMIT:2301,MESSAGE_VIDEO_UPLOAD_FAIL:2350,MESSAGE_VIDEO_SIZE_LIMIT:2351,MESSAGE_VIDEO_TYPES_LIMIT:2352,MESSAGE_FILE_UPLOAD_FAIL:2400,MESSAGE_FILE_SELECT_FILE_FIRST:2401,MESSAGE_FILE_SIZE_LIMIT:2402,MESSAGE_FILE_URL_IS_EMPTY:2403,MESSAGE_MERGER_TYPE_INVALID:2450,MESSAGE_MERGER_KEY_INVALID:2451,MESSAGE_MERGER_DOWNLOAD_FAIL:2452,MESSAGE_FORWARD_TYPE_INVALID:2453,MESSAGE_MODIFY_CONFLICT:2480,MESSAGE_MODIFY_DISABLED_IN_AVCHATROOM:2481,CONVERSATION_NOT_FOUND:2500,USER_OR_GROUP_NOT_FOUND:2501,CONVERSATION_UN_RECORDED_TYPE:2502,INVALID_CONVERSATION_ID:2503,ILLEGAL_GROUP_TYPE:2600,CANNOT_JOIN_WORK:2601,ILLEGAL_GROUP_ID:2602,CANNOT_FIND_GROUP:2603,CANNOT_CHANGE_OWNER_IN_AVCHATROOM:2620,CANNOT_CHANGE_OWNER_TO_SELF:2621,CANNOT_DISMISS_WORK:2622,MEMBER_NOT_IN_GROUP:2623,JOIN_GROUP_FAIL:2660,CANNOT_ADD_MEMBER_IN_AVCHATROOM:2661,CANNOT_JOIN_NON_AVCHATROOM_WITHOUT_LOGIN:2662,NOT_OWNER:2681,CANNOT_SET_MEMBER_ROLE_IN_WORK_AND_AVCHATROOM:2682,INVALID_MEMBER_ROLE:2683,CANNOT_SET_SELF_MEMBER_ROLE:2684,CANNOT_MUTE_SELF:2685,BAN_DURATION_INVALID:2686,NOT_MY_FRIEND:2700,ALREADY_MY_FRIEND:2701,FRIEND_GROUP_EXISTED:2710,FRIEND_GROUP_NOT_EXIST:2711,FRIEND_APPLICATION_NOT_EXIST:2716,UPDATE_PROFILE_INVALID_PARAM:2721,UPDATE_PROFILE_NO_KEY:2722,CANNOT_ADD_SELF_TO_BLACKLIST:2742,NETWORK_ERROR:2800,NETWORK_TIMEOUT:2801,NO_NETWORK:2805,UNCAUGHT_ERROR:2903,INVALID_OPERATION:2905,INVALID_TRTC_CMD:2995,OVER_FREQUENCY_LIMIT:2996,CANNOT_FIND_PROTOCOL:2997,CANNOT_FIND_MODULE:2998,SDK_IS_NOT_READY:2999,LOGGING_IN:3e3,LOGIN_FAILED:3001,KICKED_OUT_MULT_DEVICE:3002,KICKED_OUT_MULT_ACCOUNT:3003,KICKED_OUT_USERSIG_EXPIRED:3004,LOGGED_OUT:3005,KICKED_OUT_REST_API:3006,ILLEGAL_TOPIC_ID:3021,CANNOT_USE_COMMERCIAL_ABILITY:3122,PROFANITY_FOUND:3123,MESSAGE_A2KEY_EXPIRED:20002,ACCOUNT_A2KEY_EXPIRED:70001,HELLO_ANSWER_KICKED_OUT:1002,OPEN_SERVICE_OVERLOAD_ERROR:60022},fi="networkRTT",_i="messageE2EDelay",mi="sendMessageC2C",vi="sendMessageGroup",yi="sendMessageGroupAV",Mi="sendMessageRichMedia",Ii="cosUpload",Ci="messageReceivedGroup",Ti="messageReceivedGroupAVPush",Ei="messageReceivedGroupAVPull",ki=(a(Zt={},fi,2),a(Zt,_i,3),a(Zt,mi,4),a(Zt,vi,5),a(Zt,yi,6),a(Zt,Mi,7),a(Zt,Ci,8),a(Zt,Ti,9),a(Zt,Ei,10),a(Zt,Ii,11),Zt),Di={info:4,warning:5,error:6},Si={wifi:1,"2g":2,"3g":3,"4g":4,"5g":5,unknown:6,none:7,online:8},Li={login:4},Ai=function(){function e(t){r(this,e),this._n="SSOLogData",this.eventType=Li[t]||0,this.timestamp=0,this.networkType=8,this.code=0,this.message="",this.moreMessage="",this.extension=t,this.costTime=0,this.duplicate=!1,this.level=4,this.uiPlatform=void 0,this._sentFlag=!1,this._startts=Pe()}return s(e,[{key:"updateTimeStamp",value:function(){this.timestamp=Pe()}},{key:"start",value:function(e){return this._startts=e,this}},{key:"end",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this._sentFlag){var n=Pe();0===this.costTime&&(this.costTime=n-this._startts),this.setMoreMessage("startts:".concat(this._startts," endts:").concat(n)),t?(this._sentFlag=!0,this._eventStatModule&&this._eventStatModule.pushIn(this)):setTimeout((function(){e._sentFlag=!0,e._eventStatModule&&e._eventStatModule.pushIn(e)}),0)}}},{key:"setError",value:function(e,t,n){if(!(e instanceof Error))return Ve.w("".concat(this._n,".setError value not instanceof Error, please check!")),this;if(this._sentFlag)return this;if(this.setNetworkType(n),t)e.code&&this.setCode(e.code),e.message&&this.setMoreMessage(e.message);else{var o=gi.NO_NETWORK;this.setCode(o)}return this.setLevel("error"),this}},{key:"setCode",value:function(e){return at(e)||this._sentFlag||("ECONNABORTED"===e&&(this.code=103),nt(e)?this.code=e:Ve.w("".concat(this._n,".setCode value not a number, please check!"),e,o(e))),this}},{key:"setMessage",value:function(e){return at(e)||this._sentFlag||(nt(e)&&(this.message=e.toString()),ot(e)&&(this.message=e)),this}},{key:"setCostTime",value:function(e){return this.costTime=e,this}},{key:"setLevel",value:function(e){return at(e)||this._sentFlag||(this.level=Di[e]),this}},{key:"setMoreMessage",value:function(e){return $t(this.moreMessage)?this.moreMessage="".concat(e):this.moreMessage+=" ".concat(e),this}},{key:"setNetworkType",value:function(e){if(at(e))Ve.w("".concat(this._n,".setNetworkType value is undefined, please check!"));else{var t=Si[e.toLowerCase()];at(t)||(this.networkType=t)}return this}},{key:"getStartTs",value:function(){return this._startts}},{key:"setUIPlatform",value:function(e){this.uiPlatform=e}}],[{key:"bindEventStatModule",value:function(t){e.prototype._eventStatModule=t}}]),e}(),Ri=function(){function e(t){r(this,e),this.type=S.MSG_TEXT,this.content={text:t.text||""}}return s(e,[{key:"setText",value:function(e){this.content.text=e}},{key:"sendable",value:function(){return 0!==this.content.text.length}}]),e}(),Oi=function(){function e(t,n){r(this,e),this._imageMemoryURL="",this._fileDownloadProxy=n,ie?this.createImageDataASURLInWXMiniApp(t.file):this.createImageDataASURLInWeb(t.file),this._initImageInfoModel(),this.type=S.MSG_IMAGE,this._percent=0,this.content={imageFormat:t.imageFormat||Ke.UNKNOWN,uuid:t.uuid,imageInfoArray:[]},this.initImageInfoArray(t.imageInfoArray),this._autoFixUrl()}return s(e,[{key:"_initImageInfoModel",value:function(){var e=this;this._ImageInfoModel=function(t){this.instanceID=_t(9999999),this.sizeType=t.type||0,this.type=0,this.size=t.size||0,this.width=t.width||0,this.height=t.height||0,this.imageUrl=t.url||"",this.url=Wt(t.url||e._imageMemoryURL,e._fileDownloadProxy)},this._ImageInfoModel.prototype={setSizeType:function(e){this.sizeType=e},setType:function(e){this.type=e},setImageUrl:function(e){e&&(this.imageUrl=e)},getImageUrl:function(){return this.imageUrl}}}},{key:"initImageInfoArray",value:function(e){for(var t=0,n=null,o=null;t<=2;)o=at(e)||at(e[t])?{type:0,size:0,width:0,height:0,url:""}:e[t],(n=new this._ImageInfoModel(o)).setSizeType(t+1),n.setType(t),this.addImageInfo(n),t++;this.updateAccessSideImageInfoArray()}},{key:"updateImageInfoArray",value:function(e){for(var t,n=this.content.imageInfoArray.length,o=0;o<n;o++)t=this.content.imageInfoArray[o],e[o].size&&(t.size=e[o].size),e[o].url&&t.setImageUrl(e[o].url),e[o].width&&(t.width=e[o].width),e[o].height&&(t.height=e[o].height)}},{key:"_autoFixUrl",value:function(){for(var e=this.content.imageInfoArray.length,t="",n="",o=["http","https"],r=null,i=0;i<e;i++)this.content.imageInfoArray[i].url&&""!==(r=this.content.imageInfoArray[i]).imageUrl&&(n=r.imageUrl.slice(0,r.imageUrl.indexOf("://")+1),t=r.imageUrl.slice(r.imageUrl.indexOf("://")+1),o.indexOf(n)<0&&(n="https:"),this.content.imageInfoArray[i].setImageUrl([n,t].join("")))}},{key:"updatePercent",value:function(e){this._percent=e,this._percent>1&&(this._percent=1)}},{key:"updateImageFormat",value:function(e){this.content.imageFormat=Ke[e.toUpperCase()]||Ke.UNKNOWN}},{key:"createImageDataASURLInWeb",value:function(e){void 0!==e&&e.files.length>0&&(this._imageMemoryURL=window.URL.createObjectURL(e.files[0]))}},{key:"createImageDataASURLInWXMiniApp",value:function(e){e&&e.url&&(this._imageMemoryURL=e.url)}},{key:"replaceImageInfo",value:function(e,t){this.content.imageInfoArray[t]instanceof this._ImageInfoModel||(this.content.imageInfoArray[t]=e)}},{key:"addImageInfo",value:function(e){this.content.imageInfoArray.length>=3||this.content.imageInfoArray.push(e)}},{key:"updateAccessSideImageInfoArray",value:function(){var e=this.content.imageInfoArray,t=e[0],n=t.width,o=void 0===n?0:n,r=t.height,i=void 0===r?0:r;0!==o&&0!==i&&(Pt(e),Object.assign(e[2],Ut({originWidth:o,originHeight:i,min:720})))}},{key:"sendable",value:function(){return 0!==this.content.imageInfoArray.length&&""!==this.content.imageInfoArray[0].imageUrl&&0!==this.content.imageInfoArray[0].size}}]),e}(),Ni=function(){function e(t){r(this,e),this.type=S.MSG_FACE,this.content=t||null}return s(e,[{key:"sendable",value:function(){return null!==this.content}}]),e}(),wi=function(){function e(t,n){r(this,e),this.type=S.MSG_AUDIO,this._percent=0,this.content={downloadFlag:2,second:t.second,size:t.size,url:Wt(t.url,n),remoteAudioUrl:t.url||"",uuid:t.uuid}}return s(e,[{key:"updatePercent",value:function(e){this._percent=e,this._percent>1&&(this._percent=1)}},{key:"updateAudioUrl",value:function(e){this.content.remoteAudioUrl=e}},{key:"sendable",value:function(){return""!==this.content.remoteAudioUrl}}]),e}(),bi={from:!0,groupID:!0,groupName:!0,to:!0},Ui=function(){function e(t){r(this,e),this.type=S.MSG_GRP_TIP,this.content={},this._initContent(t)}return s(e,[{key:"_initContent",value:function(e){var t=this;Object.keys(e).forEach((function(n){switch(n){case"remarkInfo":case"operatorInfo":case"memberExtraInfo":case"onlineMemberInfo":break;case"groupProfile":t.content.groupProfile={},t._initGroupProfile(e[n]);break;case"memberInfoList":case"msgMemberInfo":t._updateMemberList(e[n]);break;case"memberNum":t.content[n]=e[n],t.content.memberCount=e[n];break;case"newGroupProfile":t.content.newGroupProfile={},t._initNewGroupProfile(e[n]);break;default:t.content[n]=e[n]}})),this.content.userIDList||(this.content.userIDList=[this.content.operatorID])}},{key:"_initGroupProfile",value:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var o=t[n];bi[o]&&(this.content.groupProfile[o]=e[o])}}},{key:"_updateMemberList",value:function(e){$t(this.content.memberList)?this.content.memberList=e:this.content.memberList.forEach((function(t){e.forEach((function(e){t.userID===e.userID&&Object.assign(t,e)}))}))}},{key:"_initNewGroupProfile",value:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var o=t[n];this.content.newGroupProfile[o]="muteAllMembers"!==o?e[o]:1===e[o]}}}]),e}(),Pi={from:!0,groupID:!0,groupName:!0,to:!0},Gi=function(){function e(t){r(this,e),this.type=S.MSG_GRP_SYS_NOTICE,this.content={},this._initContent(t)}return s(e,[{key:"_initContent",value:function(e){var t=this;Object.keys(e).forEach((function(n){switch(n){case"memberInfoList":break;case"remarkInfo":t.content.handleMessage=e[n];break;case"groupProfile":t.content.groupProfile={},t._initGroupProfile(e[n]);break;default:t.content[n]=e[n]}}))}},{key:"_initGroupProfile",value:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var o=t[n];Pi[o]&&("groupName"===o?this.content.groupProfile.name=e[o]:this.content.groupProfile[o]=e[o])}}}]),e}(),xi=function(){function e(t,n){r(this,e),this.type=S.MSG_FILE,this._percent=0;var o=this._getFileInfo(t);this.content={downloadFlag:2,fileUrl:Wt(t.url,n)||"",uuid:t.uuid,fileName:o.name||"",fileSize:o.size||0}}return s(e,[{key:"_getFileInfo",value:function(e){if(!at(e.fileName)&&!at(e.fileSize))return{size:e.fileSize,name:e.fileName};var t=e.file.files[0];if(oe){if(t.path&&-1!==t.path.indexOf(".")){var n=t.path.slice(t.path.lastIndexOf(".")+1).toLowerCase();t.type=n,t.name||(t.name="".concat(_t(999999),".").concat(n))}t.name||(t.type="",t.name=t.path.slice(t.path.lastIndexOf("/")+1).toLowerCase()),t.suffix&&(t.type=t.suffix),t.url||(t.url=t.path)}return{size:t.size,name:t.name}}},{key:"updatePercent",value:function(e){this._percent=e,this._percent>1&&(this._percent=1)}},{key:"updateFileUrl",value:function(e){this.content.fileUrl=e}},{key:"sendable",value:function(){return""!==this.content.fileUrl&&""!==this.content.fileName&&0!==this.content.fileSize}}]),e}(),Fi=function(){function e(t){r(this,e),this.type=S.MSG_CUSTOM,this.content={data:t.data||"",description:t.description||"",extension:t.extension||""}}return s(e,[{key:"setData",value:function(e){return this.content.data=e,this}},{key:"setDescription",value:function(e){return this.content.description=e,this}},{key:"setExtension",value:function(e){return this.content.extension=e,this}},{key:"sendable",value:function(){return 0!==this.content.data.length||0!==this.content.description.length||0!==this.content.extension.length}}]),e}(),qi=function(){function e(t,n){r(this,e),this.type=S.MSG_VIDEO,this._percent=0,this.content={remoteVideoUrl:t.remoteVideoUrl||t.videoUrl||"",videoFormat:t.videoFormat,videoSecond:parseInt(t.videoSecond,10),videoSize:t.videoSize,videoUrl:Wt(t.videoUrl,n),videoDownloadFlag:2,videoUUID:t.videoUUID,thumbUUID:t.thumbUUID,thumbFormat:t.thumbFormat,thumbWidth:t.thumbWidth,snapshotWidth:t.thumbWidth,thumbHeight:t.thumbHeight,snapshotHeight:t.thumbHeight,thumbSize:t.thumbSize,snapshotSize:t.thumbSize,thumbDownloadFlag:2,thumbUrl:Wt(t.thumbUrl,n),snapshotUrl:Wt(t.thumbUrl,n)}}return s(e,[{key:"updatePercent",value:function(e){this._percent=e,this._percent>1&&(this._percent=1)}},{key:"updateVideoUrl",value:function(e){e&&(this.content.remoteVideoUrl=e)}},{key:"updateSnapshotInfo",value:function(e){var t=e.snapshotUrl,n=e.snapshotWidth,o=e.snapshotHeight;$t(t)||(this.content.thumbUrl=this.content.snapshotUrl=t),$t(n)||(this.content.thumbWidth=this.content.snapshotWidth=Number(n)),$t(o)||(this.content.thumbHeight=this.content.snapshotHeight=Number(o))}},{key:"sendable",value:function(){return""!==this.content.remoteVideoUrl}}]),e}(),Bi=function(){function e(t){r(this,e),this.type=S.MSG_LOCATION;var n=t.description,o=t.longitude,i=t.latitude;this.content={description:n,longitude:o,latitude:i}}return s(e,[{key:"sendable",value:function(){return!0}}]),e}(),Vi=function(){function e(t,n){if(r(this,e),this.from=t.from,this.messageSender=t.from,this.time=t.time,this.messageSequence=t.sequence,this.clientSequence=t.clientSequence||t.sequence,this.messageRandom=t.random,this.cloudCustomData=t.cloudCustomData||"",this.clientTime=t.clientTime||void 0,t.ID)this.ID=t.ID||"",this.nick=t.nick||"",this.avatar=t.avatar||"",this.messageBody=[{type:t.type,payload:t.payload}],t.conversationType.startsWith(S.CONV_C2C)?this.receiverUserID=t.to:t.conversationType.startsWith(S.CONV_GROUP)&&(this.receiverGroupID=t.to),this.messageReceiver=t.to;else{this.nick=t.nick||"",this.avatar=t.avatar||"",this.messageBody=[];var o=t.elements[0].type,i=t.elements[0].content;this._patchRichMediaPayload(o,i),this._updateRichMediaDownloadUrl(o,i,n),o===S.MSG_MERGER?this.messageBody.push({type:o,payload:new Ki(i).content}):this.messageBody.push({type:o,payload:i}),t.groupID&&(this.receiverGroupID=t.groupID,this.messageReceiver=t.groupID),t.to&&(this.receiverUserID=t.to,this.messageReceiver=t.to),this.ID="".concat(t.tinyID,"-").concat(t.clientTime,"-").concat(t.random)}}return s(e,[{key:"_patchRichMediaPayload",value:function(e,t){e===S.MSG_IMAGE?t.imageInfoArray.forEach((function(e){!e.imageUrl&&e.url&&(e.imageUrl=e.url,e.sizeType=e.type,1===e.type?e.type=0:3===e.type&&(e.type=1))})):e===S.MSG_VIDEO?!t.remoteVideoUrl&&t.videoUrl&&(t.remoteVideoUrl=t.videoUrl):e===S.MSG_AUDIO?!t.remoteAudioUrl&&t.url&&(t.remoteAudioUrl=t.url):e===S.MSG_FILE&&!t.fileUrl&&t.url&&(t.fileUrl=t.url,t.url=void 0)}},{key:"_updateRichMediaDownloadUrl",value:function(e,t,n){n&&(e===S.MSG_IMAGE?t.imageInfoArray.forEach((function(e){e.url=Wt(e.url,n)})):e===S.MSG_VIDEO?(t.videoUrl=Wt(t.videoUrl,n),t.snapshotUrl=Wt(t.thumbUrl,n),t.snapshotHeight=t.thumbHeight,t.snapshotWidth=t.thumbWidth):e===S.MSG_AUDIO?t.url=Wt(t.url,n):e===S.MSG_FILE&&(t.fileUrl=Wt(t.fileUrl,n)))}}]),e}(),Ki=function(){function e(t,n){if(r(this,e),this.type=S.MSG_MERGER,this.content={downloadKey:"",pbDownloadKey:"",messageList:[],title:"",abstractList:[],compatibleText:"",version:0,layersOverLimit:!1},t.downloadKey){var o=t.downloadKey,i=t.pbDownloadKey,s=t.title,a=t.abstractList,c=t.compatibleText,u=t.version;this.content.downloadKey=o,this.content.pbDownloadKey=i,this.content.title=s,this.content.abstractList=a,this.content.compatibleText=c,this.content.version=u||0}else if($t(t.messageList))1===t.layersOverLimit&&(this.content.layersOverLimit=!0);else{var l=t.messageList,d=t.title,p=t.abstractList,h=t.compatibleText,g=t.version,f=[];l.forEach((function(e){if(!$t(e)){var t=new Vi(e,n);f.push(t)}})),this.content.messageList=f,this.content.title=d,this.content.abstractList=p,this.content.compatibleText=h,this.content.version=g||0}}return s(e,[{key:"sendable",value:function(){return!$t(this.content.messageList)||!$t(this.content.downloadKey)}}]),e}(),Hi={1:S.MSG_PRIORITY_HIGH,2:S.MSG_PRIORITY_NORMAL,3:S.MSG_PRIORITY_LOW,4:S.MSG_PRIORITY_LOWEST},ji=function(){function e(t){r(this,e),this.ID="",this.conversationID=t.conversationID||null,this.conversationType=t.conversationType||S.CONV_C2C,this.conversationSubType=t.conversationSubType,this.time=t.time||Math.ceil(Date.now()/1e3),this.sequence=t.sequence||0,this.clientSequence=t.clientSequence||t.sequence||0,this.random=t.random||0===t.random?t.random:_t(),this.priority=this._computePriority(t.priority),this.nick=t.nick||"",this.avatar=t.avatar||"",this.isPeerRead=!1,this.nameCard="",this._elements=[],this.isPlaceMessage=t.isPlaceMessage||0,this.isRevoked=2===t.isPlaceMessage||8===t.msgFlagBits,this.from=t.from||null,this.to=t.to||null,this.flow="",this.isSystemMessage=t.isSystemMessage||!1,this.protocol=t.protocol||"JSON",this.isResend=!1,this.isRead=!1,this.status=t.status||Qt.SUCCESS,this._onlineOnlyFlag=!1,this._groupAtInfoList=[],this._relayFlag=!1,this.atUserList=[],this.cloudCustomData=t.cloudCustomData||"",this.isDeleted=!1,this.isModified=!1,this._isExcludedFromUnreadCount=!(!t.messageControlInfo||1!==t.messageControlInfo.excludedFromUnreadCount),this._isExcludedFromLastMessage=!(!t.messageControlInfo||1!==t.messageControlInfo.excludedFromLastMessage),this.clientTime=t.clientTime||xe()||0,this.senderTinyID=t.senderTinyID||t.tinyID||"",this.readReceiptInfo=t.readReceiptInfo||{readCount:void 0,unreadCount:void 0,isPeerRead:void 0},this.needReadReceipt=!0===t.needReadReceipt||1===t.needReadReceipt,this.version=t.messageVersion||0,this.isBroadcastMessage=t.isBroadcastMessage||!1,this._receiverList=t.receiverList||void 0,this.isSupportExtension=!0===t.isSupportExtension||1===t.isSupportExtension,this.revoker=t.revokerInfo&&t.revokerInfo.revoker||null,this.reInitialize(t.currentUser),this.extractGroupInfo(t.groupProfile||null),this.handleGroupAtInfo(t),this.initC2CReadReceiptInfo(t.readReceiptSentByPeer)}return s(e,[{key:"elements",get:function(){return this._elements}},{key:"getElements",value:function(){return this._elements}},{key:"extractGroupInfo",value:function(e){if(null!==e){ot(e.nick)&&(this.nick=e.nick),ot(e.avatar)&&(this.avatar=e.avatar);var t=e.messageFromAccountExtraInformation;it(t)&&ot(t.nameCard)&&(this.nameCard=t.nameCard)}}},{key:"handleGroupAtInfo",value:function(e){var t=this;e.payload&&e.payload.atUserList&&e.payload.atUserList.forEach((function(e){e!==S.MSG_AT_ALL?(t._groupAtInfoList.push({groupAtAllFlag:0,groupAtUserID:e}),t.atUserList.push(e)):(t._groupAtInfoList.push({groupAtAllFlag:1}),t.atUserList.push(S.MSG_AT_ALL))})),st(e.groupAtInfo)&&e.groupAtInfo.forEach((function(e){0===e.groupAtAllFlag?t.atUserList.push(e.groupAtUserID):1===e.groupAtAllFlag&&t.atUserList.push(S.MSG_AT_ALL)}))}},{key:"getGroupAtInfoList",value:function(){return this._groupAtInfoList}},{key:"_initProxy",value:function(){this._elements[0]&&(this.payload=this._elements[0].content,this.type=this._elements[0].type)}},{key:"reInitialize",value:function(e){e&&(this.status=this.from?Qt.SUCCESS:Qt.UNSEND,!this.from&&(this.from=e)),this._initFlow(e),this._initSequence(e),this._concatConversationID(e),this.generateMessageID()}},{key:"isSendable",value:function(){return 0!==this._elements.length&&"function"==typeof this._elements[0].sendable&&this._elements[0].sendable()}},{key:"_initTo",value:function(e){this.conversationType===S.CONV_GROUP&&(this.to=e.groupID)}},{key:"_initSequence",value:function(e){0===this.clientSequence&&e&&(this.clientSequence=function(e){if(!e)return!1;if(void 0===Mt[e]){var t=new Date,n="3".concat(t.getHours()).slice(-2),o="0".concat(t.getMinutes()).slice(-2),r="0".concat(t.getSeconds()).slice(-2);Mt[e]=parseInt([n,o,r,"0001"].join("")),n=null,o=null,r=null,Ve.l("autoIncrementIndex start index:".concat(Mt[e]))}return Mt[e]++}(e)),0===this.sequence&&this.conversationType===S.CONV_C2C&&(this.sequence=this.clientSequence)}},{key:"generateMessageID",value:function(){this.from===S.CONV_SYSTEM&&(this.senderTinyID="144115198244471703"),this.ID="".concat(this.senderTinyID,"-").concat(this.clientTime,"-").concat(this.random)}},{key:"_initFlow",value:function(e){""!==e&&(e===this.from?(this.flow="out",this.isRead=!0):this.flow="in")}},{key:"_concatConversationID",value:function(e){var t=this.to,n="",o=this.conversationType;o!==S.CONV_SYSTEM?(n=o===S.CONV_C2C?e===this.from?t:this.from:this.to,this.conversationID=n?"".concat(o).concat(n):null):this.conversationID=S.CONV_SYSTEM}},{key:"isElement",value:function(e){return e instanceof Ri||e instanceof Oi||e instanceof Ni||e instanceof wi||e instanceof xi||e instanceof qi||e instanceof Ui||e instanceof Gi||e instanceof Fi||e instanceof Bi||e instanceof Ki}},{key:"setElement",value:function(e,t){var n=this;if(this.isElement(e))return this._elements=[e],void this._initProxy();var o=function(e){if(e.type&&e.content)switch(e.type){case S.MSG_TEXT:n.setTextElement(e.content);break;case S.MSG_IMAGE:n.setImageElement(e.content,t);break;case S.MSG_AUDIO:n.setAudioElement(e.content,t);break;case S.MSG_FILE:n.setFileElement(e.content,t);break;case S.MSG_VIDEO:n.setVideoElement(e.content,t);break;case S.MSG_CUSTOM:n.setCustomElement(e.content);break;case S.MSG_LOCATION:n.setLocationElement(e.content);break;case S.MSG_GRP_TIP:n.setGroupTipElement(e.content);break;case S.MSG_GRP_SYS_NOTICE:n.setGroupSystemNoticeElement(e.content);break;case S.MSG_FACE:n.setFaceElement(e.content);break;case S.MSG_MERGER:n.setMergerElement(e.content,t)}};if(st(e))for(var r=0;r<e.length;r++)o(e[r]);else o(e);this._initProxy()}},{key:"clearElement",value:function(){this._elements.length=0}},{key:"setTextElement",value:function(e){var t="string"==typeof e?e:e.text,n=new Ri({text:t});this._elements.push(n)}},{key:"setImageElement",value:function(e,t){var n=new Oi(e,t);this._elements.push(n)}},{key:"setAudioElement",value:function(e,t){var n=new wi(e,t);this._elements.push(n)}},{key:"setFileElement",value:function(e,t){var n=new xi(e,t);this._elements.push(n)}},{key:"setVideoElement",value:function(e,t){var n=new qi(e,t);this._elements.push(n)}},{key:"setLocationElement",value:function(e){var t=new Bi(e);this._elements.push(t)}},{key:"setCustomElement",value:function(e){var t=new Fi(e);this._elements.push(t)}},{key:"setGroupTipElement",value:function(e){var t={},n=e.operationType;if($t(e.memberInfoList)?e.operatorInfo&&(t=e.operatorInfo):n!==S.GRP_TIP_MBR_JOIN&&n!==S.GRP_TIP_MBR_KICKED_OUT&&n!==S.GRP_TIP_MBR_SET_ADMIN&&n!==S.GRP_TIP_MBR_CANCELED_ADMIN||(t=e.memberInfoList[0]),!$t(e.memberExtraInfo)){var o=e.memberExtraInfo.reason;e.msgMemberInfo.forEach((function(e){e.reason=o}))}var r=t,i=r.nick,s=r.avatar;ot(i)&&(this.nick=i),ot(s)&&(this.avatar=s);var a=new Ui(e);this._elements.push(a)}},{key:"setGroupSystemNoticeElement",value:function(e){var t=new Gi(e);this._elements.push(t)}},{key:"setFaceElement",value:function(e){var t=new Ni(e);this._elements.push(t)}},{key:"setMergerElement",value:function(e,t){var n=new Ki(e,t);this._elements.push(n)}},{key:"setIsRead",value:function(e){this.isRead=e}},{key:"setRelayFlag",value:function(e){this._relayFlag=e}},{key:"getRelayFlag",value:function(){return this._relayFlag}},{key:"_computePriority",value:function(e){if(at(e))return S.MSG_PRIORITY_NORMAL;if(ot(e)&&-1!==Object.values(Hi).indexOf(e))return e;if(nt(e)){var t=""+e;if(-1!==Object.keys(Hi).indexOf(t))return Hi[t]}return S.MSG_PRIORITY_NORMAL}},{key:"setNickAndAvatar",value:function(e){var t=e.nick,n=e.avatar;ot(t)&&(this.nick=t),ot(n)&&(this.avatar=n)}},{key:"setNameCard",value:function(e){ot(e)&&(this.nameCard=e)}},{key:"initC2CReadReceiptInfo",value:function(e){this.conversationType===S.CONV_C2C&&!0===this.needReadReceipt&&(this.readReceiptInfo.isPeerRead=1===e)}}]),e}(),zi=function(e){return{code:0,data:e||{}}},Wi=function(e){c(n,e);var t=m(n);function n(e){var o;r(this,n),o=t.call(this);var i=e.code,s=e.message,a=e.data;return o.code=i,o.message=s||o._getErrorMessage(o.code),o.data=a||{},o}return s(n)}(h(Error)),Yi=null,$i=function(e){Yi=e},Ji=function(e){return Promise.resolve(zi(e))},Xi=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e instanceof Wi)return t&&null!==Yi&&Yi.emit(D.ERROR,e),Promise.reject(e);if(e instanceof Error){var n=new Wi({code:gi.UNCAUGHT_ERROR});return t&&null!==Yi&&Yi.emit(D.ERROR,n),Promise.reject(n)}if(!at(e)&&!at(e.code)){var o=new Wi(e);return t&&null!==Yi&&Yi.emit(D.ERROR,o),Promise.reject(o)}},Zi=function(e){c(o,e);var t=m(o);function o(e){var n;return r(this,o),(n=t.call(this,e))._n="C2CModule",n._messageFromUnreadDBMap=new Map,n._signalingFromUnreadDBList=[],n}return s(o,[{key:"onNewC2CMessage",value:function(e){var t=e.dataList,n=e.isInstantMessage,o=e.C2CRemainingUnreadList,r=e.C2CPairUnreadList;Ve.d("".concat(this._n,".onNewC2CMessage count:").concat(t.length," isInstantMessage:").concat(n));var i=this._newC2CMessageStoredAndSummary({dataList:t,C2CRemainingUnreadList:o,C2CPairUnreadList:r,isInstantMessage:n}),s=i.conversationOptionsList,a=i.messageList,c=i.isUnreadC2CMessage;this.filterModifiedMessage(a),s.length>0&&this.getModule(qn).onNewMessage({conversationOptionsList:s,isInstantMessage:n,isUnreadC2CMessage:c});var u=this.filterUnmodifiedMessage(a);n&&u.length>0&&this.emitOuterEvent(D.MESSAGE_RECEIVED,u),a.length=0}},{key:"_newC2CMessageStoredAndSummary",value:function(e){for(var t=e.dataList,n=e.C2CRemainingUnreadList,o=e.C2CPairUnreadList,r=e.isInstantMessage,i=null,s=[],a=[],c={},u=this.getModule(jn),l=this.getModule(to),d=!1,p=this.getModule(qn),h=this.getFileDownloadProxy(),g=0,f=t.length;g<f;g++)if(this._isSignaling(t[g]))this._signalingFromUnreadDBList.push(t[g].eventArray[0].c2CNotifyMsgArray[0]);else{var _=t[g];_.currentUser=this.getMyUserID(),_.conversationType=S.CONV_C2C,_.isSystemMessage=!!_.isSystemMessage,(at(_.nick)||at(_.avatar))&&(d=!0,Ve.d("".concat(this._n,"._newC2CMessageStoredAndSummary nick or avatar missing!"))),i=new ji(_),_.elements=u.parseElements(_.elements,_.from),i.setElement(_.elements,h),i.setNickAndAvatar({nick:_.nick,avatar:_.avatar});var m=i.conversationID;if(r){if(1===this._messageFromUnreadDBMap.get(i.ID))continue;var v=!1;if(i.from!==this.getMyUserID()){var y=p.getLatestMessageSentByPeer(m);if(y){var M=y.nick,I=y.avatar;d?i.setNickAndAvatar({nick:M,avatar:I}):M===i.nick&&I===i.avatar||(v=!0)}}else{var C=p.getLatestMessageSentByMe(m);if(C){var T=C.nick,E=C.avatar;T===i.nick&&E===i.avatar||p.modifyMessageSentByMe({conversationID:m,latestNick:i.nick,latestAvatar:i.avatar})}}var k=1===t[g].isModified;if(p.isMessageSentByCurrentInstance(i)?i.isModified=k:k=!1,0===_.msgLifeTime)i._onlineOnlyFlag=!0,p.isMessageSentByCurrentInstance(i)||a.push(i);else{if(!p.pushIntoMessageList(a,i,k))continue;v&&(p.modifyMessageSentByPeer({conversationID:m,latestNick:i.nick,latestAvatar:i.avatar}),p.updateUserProfileSpecifiedKey({conversationID:m,nick:i.nick,avatar:i.avatar}))}r&&i.clientTime>0&&l.addMessageDelay(i.clientTime)}else this._messageFromUnreadDBMap.set(i.ID,1);if(0!==_.msgLifeTime){if(!1===i._onlineOnlyFlag){var D=p.getLastMessageTime(m);if(nt(D)&&i.time<D)continue;if(at(c[m])){var L=0;"in"===i.flow&&(i._isExcludedFromUnreadCount||(L=1)),c[m]=s.push({conversationID:m,unreadCount:L,type:i.conversationType,subType:i.conversationSubType,lastMessage:i._isExcludedFromLastMessage?"":i})-1}else{var A=c[m];s[A].type=i.conversationType,s[A].subType=i.conversationSubType,s[A].lastMessage=i._isExcludedFromLastMessage?"":i,"in"===i.flow&&(i._isExcludedFromUnreadCount||s[A].unreadCount++)}}}else i._onlineOnlyFlag=!0}this._handleSignalingFromUnreadDB();var R=!1;if(st(o))for(var O=function(e,t){if(o[e].unreadCount>0){R=!0;var n=s.find((function(t){return t.conversationID==="C2C".concat(o[e].from)}));n?n.unreadCount=o[e].unreadCount:s.push({conversationID:"C2C".concat(o[e].from),unreadCount:o[e].unreadCount,type:S.CONV_C2C})}},N=0,w=o.length;N<w;N++)O(N);if(st(n))for(var b=function(e,t){s.find((function(t){return t.conversationID==="C2C".concat(n[e].from)}))||s.push({conversationID:"C2C".concat(n[e].from),type:S.CONV_C2C,lastMsgTime:n[e].lastMsgTime})},U=0,P=n.length;U<P;U++)b(U);return{conversationOptionsList:s,messageList:a,isUnreadC2CMessage:R}}},{key:"_isSignaling",value:function(e){var t=e.eventArray;return!(!st(t)||10!==t[0].event)}},{key:"_handleSignalingFromUnreadDB",value:function(){var e=this._signalingFromUnreadDBList.length;if(Ve.l("".concat(this._n,"._handleSignalingFromUnreadDB signalingCount:").concat(e)),0!==e){var t=[];this._signalingFromUnreadDBList.forEach((function(e){e.hasOwnProperty("c2cMessageRevokedNotify")&&t.push(e)})),this.onC2CMessageRevoked({dataList:t}),this._signalingFromUnreadDBList.length=0,t.length=0}}},{key:"onC2CMessageRevoked",value:function(e){var t=this,n=this.getModule(qn),o=[],r=null,i=!0;e.dataList.forEach((function(e){if(e.c2cMessageRevokedNotify){var s=e.c2cMessageRevokedNotify.revokedInfos;at(s)||s.forEach((function(e){var s=t.getMyUserID()===e.from?"".concat(S.CONV_C2C).concat(e.to):"".concat(S.CONV_C2C).concat(e.from);r=n.revoke(s,e.sequence,e.random);var a=e.revokerInfo&&e.revokerInfo.revoker;if(r)r.revoker||(r.revoker=a,o.push(r));else{var c={conversationID:s,sequence:e.sequence,time:e.time,revoker:a};n.isLastMessageRevoked(c)&&(o.push(c),i=!1)}}))}})),0!==o.length&&(n.onMessageRevoked(o),!0===i&&(Ve.l("".concat(this._n,".onC2CMessageRevoked count:").concat(o.length)),this.emitOuterEvent(D.MESSAGE_REVOKED,o)))}},{key:"onC2CMessageReadReceipt",value:function(e){var t=this;e.dataList.forEach((function(e){if(!$t(e.c2cMessageReadReceipt)){var n=e.c2cMessageReadReceipt.to;e.c2cMessageReadReceipt.uinPairReadArray.forEach((function(e){var o=e.peerReadTime;Ve.d("".concat(t._n,"._onC2CMessageReadReceipt to:").concat(n," peerReadTime:").concat(o));var r="".concat(S.CONV_C2C).concat(n),i=t.getModule(qn);i.recordPeerReadTime(r,o),i.updateMessageIsPeerReadProperty(r,o)}))}}))}},{key:"onC2CMessageReadNotice",value:function(e){var t=this;e.dataList.forEach((function(e){if(!$t(e.c2cMessageReadNotice)){var n=t.getModule(qn);e.c2cMessageReadNotice.uinPairReadArray.forEach((function(e){var o=e.from,r=e.peerReadTime;Ve.d("".concat(t._n,".onC2CMessageReadNotice from:").concat(o," lastReadTime:").concat(r));var i="".concat(S.CONV_C2C).concat(o);n.updateIsReadAfterReadReport({conversationID:i,lastMessageTime:r}),n.updateUnreadCount(i)}))}}))}},{key:"onC2CMessageModified",value:function(e){Ve.d("".concat(this._n,".onC2CMessageModified options:"),JSON.stringify(e));var t=this.getModule(qn);e.dataList.forEach((function(e){t.onMessageModified(n(n({},e),{},{conversationType:S.CONV_C2C}))}))}},{key:"onReadReceiptList",value:function(e){Ve.d("".concat(this._n,".onReadReceiptList options:"),JSON.stringify(e));var t=e.dataList,n=t.userID,o=t.readReceiptList;this.getModule(qn).updateReadReceiptInfo({userID:n,readReceiptList:o})}},{key:"sendMessage",value:function(e,t){var n=this._createC2CMessagePack(e,t);return this.request(n)}},{key:"_createC2CMessagePack",value:function(e,t){var n=null;t&&(t.offlinePushInfo&&(n=t.offlinePushInfo),!0===t.onlineUserOnly&&(n?n.disablePush=!0:n={disablePush:!0}));var o="";ot(e.cloudCustomData)&&e.cloudCustomData.length>0&&(o=e.cloudCustomData);var r=[];if(it(t)&&it(t.messageControlInfo)){var i=t.messageControlInfo,s=i.excludedFromUnreadCount,a=i.excludedFromLastMessage,c=i.excludedFromContentModeration;!0===s&&r.push("NoUnread"),!0===a&&r.push("NoLastMsg"),!0===c&&r.push("NoMsgCheck")}var u=this.isOnlineMessage(e,t)?0:void 0;return{protocolName:_o,tjgID:this.generateTjgID(e),requestData:{fromAccount:this.getMyUserID(),toAccount:e.to,msgBody:e.getElements(),cloudCustomData:o,msgSeq:e.sequence,msgRandom:e.random,msgLifeTime:u,nick:e.nick,avatar:e.avatar,offlinePushInfo:n?{pushFlag:!0===n.disablePush?1:0,title:n.title||"",desc:n.description||"",ext:n.extension||"",apnsInfo:{badgeMode:!0===n.ignoreIOSBadge?1:0,isVoipPush:this._isVoipPush(n)},androidInfo:{OPPOChannelID:n.androidOPPOChannelID||""}}:void 0,messageControlInfo:0!==u?r:void 0,clientTime:e.clientTime,needReadReceipt:!0===e.needReadReceipt?1:0,isSupportExtension:!0===e.isSupportExtension?1:0}}}},{key:"_isVoipPush",value:function(e){var t=void 0;return at(e.disableVoipPush)||(t=!1===e.disableVoipPush?1:0),t}},{key:"isOnlineMessage",value:function(e,t){return!(!t||!0!==t.onlineUserOnly)}},{key:"revokeMessage",value:function(e){return this.request({protocolName:To,requestData:{msgInfo:{fromAccount:e.from,toAccount:e.to,msgSeq:e.sequence,msgRandom:e.random,msgTimeStamp:e.time}}})}},{key:"deleteMessage",value:function(e){var t=e.to,n=e.keyList;return Ve.l("".concat(this._n,".deleteMessage toAccount:").concat(t," count:").concat(n.length)),this.request({protocolName:Ao,requestData:{fromAccount:this.getMyUserID(),to:t,keyList:n}})}},{key:"modifyRemoteMessage",value:function(e){var t=e.from,n=e.to,o=e.version,r=void 0===o?0:o,i=e.sequence,s=e.random,a=e.time,c=e.payload,u=e.type,l=e.cloudCustomData,d=void 0;return Kt(u)&&(d=[]).push({type:u,content:c}),this.request({protocolName:Ro,requestData:{from:t,to:n,version:r,sequence:i,random:s,time:a,elements:d,cloudCustomData:l}})}},{key:"setMessageRead",value:function(e){var t=this,n=e.conversationID,o=e.lastMessageTime,r="".concat(this._n,".setMessageRead");Ve.l("".concat(r," conversationID:").concat(n," lastMessageTime:").concat(o)),nt(o)||this.outputWarning("DoNotModifyLastTime");var i=new Ai("setC2CMessageRead");return i.setMessage("conversationID:".concat(n," lastMessageTime:").concat(o)),this.request({protocolName:Eo,requestData:{C2CMsgReaded:{cookie:"",C2CMsgReadedItem:[{toAccount:n.replace("C2C",""),lastMessageTime:o,receipt:1}]}}}).then((function(){i.setNetworkType(t.getNetworkType()).end(),Ve.l("".concat(r," ok"));var e=t.getModule(qn);return e.updateIsReadAfterReadReport({conversationID:n,lastMessageTime:o}),e.updateUnreadCount(n),zi()})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];i.setError(e,o,r).end()})),Ve.l("".concat(r," failed. error:"),e),Xi(e)}))}},{key:"getRoamingMessage",value:function(e){var t=this,n="".concat(this._n,".getRoamingMessage"),o=e.peerAccount,r=e.conversationID,i=e.count,s=e.lastMessageTime,a=e.messageKey,c="peerAccount:".concat(o," count:").concat(i||15," lastMessageTime:").concat(s||0," messageKey:").concat(a);Ve.l("".concat(n," ").concat(c));var u=new Ai("getC2CRoamingMessages");return this.request({protocolName:So,requestData:{peerAccount:o,count:i||15,lastMessageTime:s||0,messageKey:a}}).then((function(e){var o=e.data,i=o.complete,s=o.messageList,a=o.messageKey,l=o.lastMessageTime;at(s)?Ve.l("".concat(n," ok. complete:").concat(i," but messageList is undefined!")):Ve.l("".concat(n," ok. complete:").concat(i," count:").concat(s.length)),u.setNetworkType(t.getNetworkType()).setMessage("".concat(c," complete:").concat(i," length:").concat(s.length)).end();var d=t.getModule(qn);1===i&&d.setCompleted(r);var p=d.onRoamingMessage(s,r);d.modifyMessageList(r),d.updateIsRead(r),d.updateRoamingMessageKeyAndTime(r,a,l);var h=d.getPeerReadTime(r);if(Ve.l("".concat(n," update isPeerRead property. conversationID:").concat(r," peerReadTime:").concat(h)),h)d.updateMessageIsPeerReadProperty(r,h);else{var g=r.replace(S.CONV_C2C,"");t.getRemotePeerReadTime([g]).then((function(){d.updateMessageIsPeerReadProperty(r,d.getPeerReadTime(r))}))}var f="";if(p.length>0)f=p[0].ID;else{var _=d.getLocalOldestMessage(r);_&&(f=_.ID)}return Ve.l("".concat(n," nextReqID:").concat(f," stored message count:").concat(p.length)),{nextReqID:f,storedMessageList:p}})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];u.setMessage(c).setError(e,o,r).end()})),Ve.w("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"getRoamingMessagesHopping",value:function(e){var t=this,n="".concat(this._n,".getRoamingMessagesHopping"),o=e.peerAccount,r=e.time,i=void 0===r?0:r,s=e.count,a=e.direction,c="".concat(S.CONV_C2C).concat(o),u="peerAccount:".concat(o," count:").concat(s," time:").concat(i," direction:").concat(a);Ve.l("".concat(n," ").concat(u));var l=new Ai("getC2CRoamingMessagesHopping");return this.request({protocolName:So,requestData:{peerAccount:o,count:s+1,lastMessageTime:i,direction:a}}).then((function(e){var o=e.data,r=o.complete,i=o.messageList,s=void 0===i?[]:i,d=o.lastMessageTime;Ve.l("".concat(n," ok. complete:").concat(r," count:").concat(s.length)),l.setNetworkType(t.getNetworkType()).setMessage("".concat(u," complete:").concat(r," length:").concat(s.length)).end(),1!==r&&(1===a?s.pop():s.shift());var p=t.getModule(qn).onRoamingMessage(s,c,!1);t._modifyMessageList(c,p);var h=t._computeResult({complete:r,lastMessageTime:d,resultList:p});return zi(h)})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];l.setMessage(u).setError(e,o,r).end()})),Ve.w("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"_computeResult",value:function(e){var t=e.complete,n=void 0===t?0:t,o=e.lastMessageTime,r=e.resultList,i={messageList:y(void 0===r?[]:r),isCompleted:!1,nextMessageTime:""};return 1===n?(i.isCompleted=!0,i):(i.nextMessageTime=o,i)}},{key:"_modifyMessageList",value:function(e,t){var n=this.getModule(qn).getLocalConversation(e);if(n)for(var o=n.userProfile.nick,r=n.userProfile.avatar,i=this.getModule(bn).getNickAndAvatarByUserID(this.getMyUserID()),s=i.nick,a=i.avatar,c=t.length-1;c>=0;c--){var u=t[c];"in"===u.flow&&(u.nick!==o&&u.setNickAndAvatar({nick:o}),u.avatar!==r&&u.setNickAndAvatar({avatar:r})),"out"===u.flow&&(u.nick!==s&&u.setNickAndAvatar({nick:s}),u.avatar!==a&&u.setNickAndAvatar({avatar:a}))}}},{key:"getRemotePeerReadTime",value:function(e){var t=this,n="".concat(this._n,".getRemotePeerReadTime");if($t(e))return Ve.w("".concat(n," userIDList is empty!")),Promise.resolve();var o=new Ai("getPeerReadTime");return Ve.l("".concat(n," userIDList:").concat(e)),this.request({protocolName:Lo,requestData:{userIDList:e}}).then((function(r){var i=r.data.peerReadTimeList;Ve.l("".concat(n," ok. peerReadTimeList:").concat(i));for(var s="",a=t.getModule(qn),c=0;c<e.length;c++)s+="".concat(e[c],"-").concat(i[c]," "),i[c]>0&&a.recordPeerReadTime("C2C".concat(e[c]),i[c]);o.setNetworkType(t.getNetworkType()).setMessage(s).end()})).catch((function(e){t.probeNetwork().then((function(t){var n=v(t,2),r=n[0],i=n[1];o.setError(e,r,i).end()})),Ve.w("".concat(n," failed. error:"),e)}))}},{key:"sendReadReceipt",value:function(e){var t=this,n=e[0].conversationID.replace(S.CONV_C2C,""),o=new Ai("sendC2CReadReceipt");o.setMessage("peerAccount:".concat(n));var r=this.getMyUserID(),i=e.filter((function(e){return e.from!==r&&!0===e.needReadReceipt})).map((function(e){return{fromAccount:e.from,toAccount:e.to,sequence:e.sequence,random:e.random,time:e.time,clientTime:e.clientTime}}));if(0===i.length)return Xi({code:gi.READ_RECEIPT_MESSAGE_LIST_EMPTY});var s="".concat(this._n,".sendReadReceipt");return Ve.l("".concat(s,". peerAccount:").concat(n," messageInfoList length:").concat(i.length)),this.request({protocolName:pr,requestData:{peerAccount:n,messageInfoList:i}}).then((function(e){return o.end(),Ve.l("".concat(s," ok")),zi()})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),r=n[0],i=n[1];o.setError(e,r,i).end()})),Ve.w("".concat(s," failed. error:"),e),Xi(e)}))}},{key:"getReadReceiptList",value:function(e){var t="".concat(this._n,".getReadReceiptList"),n=this.getMyUserID(),o=e.filter((function(e){return e.from===n&&!0===e.needReadReceipt}));return Ve.l("".concat(t," userID:").concat(n," messageList length:").concat(o.length)),Ji({messageList:o})}},{key:"getMessageExtensions",value:function(e,t){return Ve.l("".concat(this._n,".getMessageExtensions startSequence:").concat(t)),this.request({protocolName:No,requestData:{from:e.from,to:e.to,messageKey:this._getMessageKey(e),startSequence:t}})}},{key:"modifyMessageExtensions",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Ve.l("".concat(this._n,".modifyMessageExtensions operateType:").concat(n)),this.request({protocolName:Oo,requestData:{from:e.from,to:e.to,messageKey:this._getMessageKey(e),extensionList:t,operateType:n}})}},{key:"_getMessageKey",value:function(e){var t=e.clientSequence,n=e.random,o=e.time;return"".concat(t,"_").concat(n,"_").concat(o)}},{key:"reset",value:function(){Ve.l("".concat(this._n,".reset")),this._messageFromUnreadDBMap.clear(),this._signalingFromUnreadDBList.length=0}}]),o}(co),Qi=function(){function e(){r(this,e),this.list=new Map,this._n="MessageListHandler",this._latestMessageSentByPeerMap=new Map,this._latestMessageSentByMeMap=new Map}return s(e,[{key:"getLocalOldestMessageByConversationID",value:function(e){if(!e)return null;if(!this.list.has(e))return null;var t=this.list.get(e).values();return t?t.next().value:null}},{key:"pushIn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.conversationID,o=!0;this.list.has(n)||this.list.set(n,new Map);var r=this._getUniqueIDOfMessage(e);if(this.list.get(n).has(r)){var i=this.list.get(n).get(r);if(!t||!0===i.isModified)return!1}return this.list.get(n).set(r,e),this._setLatestMessageSentByPeer(n,e),this._setLatestMessageSentByMe(n,e),o}},{key:"unshift",value:function(e,t){var n;if(st(e)?e.length>0&&(n=e[0].conversationID,this._unshiftMultipleMessages(e,t)):(n=e.conversationID,this._unshiftSingleMessage(e,t)),n&&n.startsWith(S.CONV_C2C)){var o=Array.from(this.list.get(n).values()),r=o.length;if(0===r)return;for(var i=r-1;i>=0;i--)if("out"===o[i].flow){this._setLatestMessageSentByMe(n,o[i]);break}for(var s=r-1;s>=0;s--)if("in"===o[s].flow){this._setLatestMessageSentByPeer(n,o[s]);break}}}},{key:"_unshiftSingleMessage",value:function(e,t){var n=e.conversationID,o=this._getUniqueIDOfMessage(e);if(!this.list.has(n))return this.list.set(n,new Map),this.list.get(n).set(o,e),void t.push(e);var r=this.list.get(n),i=Array.from(r);r.has(o)||(i.unshift([o,e]),this.list.set(n,new Map(i)),t.push(e))}},{key:"_unshiftMultipleMessages",value:function(e,t){for(var n=e.length,o=[],r=e[0].conversationID,i=this.list.get(r),s=this.list.has(r)?Array.from(i):[],a=0;a<n;a++){var c=this._getUniqueIDOfMessage(e[a]);i&&i.has(c)||(o.push([c,e[a]]),t.push(e[a]))}this.list.set(r,new Map(o.concat(s)))}},{key:"remove",value:function(e){var t=e.conversationID,n=this._getUniqueIDOfMessage(e);this.list.has(t)&&this.list.get(t).delete(n)}},{key:"revoke",value:function(e,t,n){if(Ve.d("revoke message",e,t,n),this.list.has(e)){var o,r=k(this.list.get(e));try{for(r.s();!(o=r.n()).done;){var i=v(o.value,2)[1];if(i.sequence===t&&(at(n)||i.random===n))return i.isRevoked||(i.isRevoked=!0),i}}catch(s){r.e(s)}finally{r.f()}}return null}},{key:"removeByConversationID",value:function(e){this.list.has(e)&&(this.list.delete(e),this._latestMessageSentByPeerMap.delete(e),this._latestMessageSentByMeMap.delete(e))}},{key:"findMessage",value:function(e){var t,n=null,o=k(this.list);try{for(o.s();!(t=o.n()).done;)for(var r=y(v(t.value,2)[1].values()),i=r.length,s=0;s<i;s++)if(r[s].ID===e){n=r[s];break}}catch(a){o.e(a)}finally{o.f()}return n}},{key:"updateMessageIsPeerReadProperty",value:function(e,t){var n=[];if(this.list.has(e)){var o,r=k(this.list.get(e));try{for(r.s();!(o=r.n()).done;){var i=v(o.value,2)[1];i.time<=t&&!i.isPeerRead&&"out"===i.flow&&(i.isPeerRead=!0,n.push(i))}}catch(s){r.e(s)}finally{r.f()}Ve.l("".concat(this._n,".updateMessageIsPeerReadProperty conversationID:").concat(e," peerReadTime:").concat(t," count:").concat(n.length))}return n}},{key:"updateMessageIsModifiedProperty",value:function(e){var t=e.conversationID;if(this.list.has(t)){var n=this._getUniqueIDOfMessage(e),o=this.list.get(t).get(n);o&&(o.isModified=!0)}}},{key:"hasLocalMessageList",value:function(e){return this.list.has(e)}},{key:"getLocalMessageList",value:function(e){return this.hasLocalMessageList(e)?y(this.list.get(e).values()):[]}},{key:"hasLocalMessage",value:function(e,t){for(var n=!1,o=this.getLocalMessageList(e),r=o.length,i=0;i<r;i++)o[i].ID===t&&(n=!0);return n}},{key:"getLocalMessage",value:function(e,t){for(var n=null,o=this.getLocalMessageList(e),r=o.length,i=0;i<r;i++)if(o[i].ID===t){n=o[i];break}return n}},{key:"getLocalLastMessage",value:function(e){var t=this.getLocalMessageList(e);return t[t.length-1]}},{key:"getLocalOldestMessage",value:function(e){return this.getLocalMessageList(e)[0]}},{key:"_setLatestMessageSentByPeer",value:function(e,t){e.startsWith(S.CONV_C2C)&&"in"===t.flow&&this._latestMessageSentByPeerMap.set(e,t)}},{key:"_setLatestMessageSentByMe",value:function(e,t){e.startsWith(S.CONV_C2C)&&"out"===t.flow&&this._latestMessageSentByMeMap.set(e,t)}},{key:"getLatestMessageSentByPeer",value:function(e){return this._latestMessageSentByPeerMap.get(e)}},{key:"getLatestMessageSentByMe",value:function(e){return this._latestMessageSentByMeMap.get(e)}},{key:"modifyMessageSentByPeer",value:function(e){var t=e.conversationID,n=e.latestNick,o=e.latestAvatar,r=this.list.get(t);if(!$t(r)){var i=Array.from(r.values()),s=i.length;if(0!==s){for(var a=null,c=0,u=!1,l=s-1;l>=0;l--)"in"===i[l].flow&&((a=i[l]).nick!==n&&(a.setNickAndAvatar({nick:n}),u=!0),a.avatar!==o&&(a.setNickAndAvatar({avatar:o}),u=!0),u&&(c+=1));Ve.l("".concat(this._n,".modifyMessageSentByPeer conversationID:").concat(t," count:").concat(c))}}}},{key:"modifyMessageSentByMe",value:function(e){var t=e.conversationID,n=e.latestNick,o=e.latestAvatar,r=this.list.get(t);if(!$t(r)){var i=Array.from(r.values()),s=i.length;if(0!==s){for(var a=null,c=0,u=!1,l=s-1;l>=0;l--)"out"===i[l].flow&&((a=i[l]).nick!==n&&(a.setNickAndAvatar({nick:n}),u=!0),a.avatar!==o&&(a.setNickAndAvatar({avatar:o}),u=!0),u&&(c+=1));Ve.l("".concat(this._n,".modifyMessageSentByMe conversationID:").concat(t," count:").concat(c))}}}},{key:"getTopicConversationIDList",value:function(e){return y(this.list.keys()).filter((function(t){return t.startsWith("".concat(S.CONV_GROUP).concat(e))}))}},{key:"traversal",value:function(){if(0!==this.list.size&&-1===Ve.getLevel()){console.group("conversationID-messageCount");var e,n=k(this.list);try{for(n.s();!(e=n.n()).done;){var o=v(e.value,2),r=o[0],i=o[1];t("log","at node_modules/tim-wx-sdk/tim-wx.js:1","".concat(r,"-").concat(i.size))}}catch(s){n.e(s)}finally{n.f()}console.groupEnd()}}},{key:"onMessageModified",value:function(e,t){if(!this.list.has(e))return{isUpdated:!1,message:null};var n=this._getUniqueIDOfMessage(t),o=this.list.get(e).has(n);if(Ve.d("".concat(this._n,".onMessageModified conversationID:").concat(e," uniqueID:").concat(n," has:").concat(o)),o){var r=this.list.get(e).get(n),i=t.messageVersion,s=t.elements,a=t.cloudCustomData;return r.version<i?(r.version=i,r._elements=JSON.parse(JSON.stringify(s)),r.payload=JSON.parse(JSON.stringify(s[0].content)),r.type=s[0].type,r.cloudCustomData=a,r.isModified=!0,{isUpdated:!0,message:r}):{isUpdated:!1,message:r}}return{isUpdated:!1,message:null}}},{key:"_getUniqueIDOfMessage",value:function(e){var t=e.from,n=e.to,o=e.random,r=e.sequence,i=e.time;return"".concat(t,"-").concat(n,"-").concat(o,"-").concat(r,"-").concat(i)}},{key:"reset",value:function(){this.list.clear(),this._latestMessageSentByPeerMap.clear(),this._latestMessageSentByMeMap.clear()}}]),e}(),es="_a2KeyAndTinyIDUpdated",ns="_cloudConfigUpdated",os="_profileUpdated";function rs(e){this.mixin(e)}rs.mixin=function(e){var t=e.prototype||e;t._isReady=!1,t.ready=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e)return this._isReady?void(t?e.call(this):setTimeout(e,1)):(this._readyQueue=this._readyQueue||[],void this._readyQueue.push(e))},t.triggerReady=function(){var e=this;this._isReady=!0,setTimeout((function(){var t=e._readyQueue;e._readyQueue=[],t&&t.length>0&&t.forEach((function(e){e.call(this)}),e)}),1)},t.resetReady=function(){this._isReady=!1,this._readyQueue=[]},t.isReady=function(){return this._isReady}};var is=["jpg","jpeg","gif","png","bmp","image","webp"],ss=["mp4","quicktime","mov"],as=1,cs=2,us=3,ls=255,ds=function(){function e(t){var n=this;r(this,e),$t(t)||(this.userID=t.userID||"",this.nick=t.nick||"",this.gender=t.gender||"",this.birthday=t.birthday||0,this.location=t.location||"",this.selfSignature=t.selfSignature||"",this.allowType=t.allowType||S.ALLOW_TYPE_ALLOW_ANY,this.language=t.language||0,this.avatar=t.avatar||"",this.messageSettings=t.messageSettings||0,this.adminForbidType=t.adminForbidType||S.FORBID_TYPE_NONE,this.level=t.level||0,this.role=t.role||0,this.lastUpdatedTime=0,this.profileCustomField=[],$t(t.profileCustomField)||t.profileCustomField.forEach((function(e){n.profileCustomField.push({key:e.key,value:e.value})})))}return s(e,[{key:"validate",value:function(e){var t=!0,n="";if($t(e))return{valid:!1,tips:"empty options"};if(e.profileCustomField)for(var o=e.profileCustomField.length,r=null,i=0;i<o;i++){if(r=e.profileCustomField[i],!ot(r.key)||-1===r.key.indexOf("Tag_Profile_Custom"))return{valid:!1,tips:"The prefix of keys of the custom profile key-value pairs (which is profileCustomField) must be Tag_Profile_Custom"};if(!ot(r.value))return{valid:!1,tips:"The type of values of the custom profile key-value pairs (which is profileCustomField) must be String"}}for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){if("profileCustomField"===s)continue;if($t(e[s])&&!ot(e[s])&&!nt(e[s])){n="key:"+s+", invalid value:"+e[s],t=!1;continue}switch(s){case"nick":ot(e[s])||(n="nick must be a string",t=!1),ft(e[s])>500&&(n="nick name limited: must less than or equal to ".concat(500," bytes, current size: ").concat(ft(e[s])," bytes"),t=!1);break;case"gender":yt(je,e.gender)||(n="key:gender, invalid value:"+e.gender,t=!1);break;case"birthday":nt(e.birthday)||(n="birthday must be a number",t=!1);break;case"location":ot(e.location)||(n="location must be a string",t=!1);break;case"selfSignature":ot(e.selfSignature)||(n="selfSignature must be a string",t=!1);break;case"allowType":yt(We,e.allowType)||(n="key:allowType, invalid value:"+e.allowType,t=!1);break;case"language":nt(e.language)||(n="language must be a number",t=!1);break;case"avatar":ot(e.avatar)||(n="avatar must be a string",t=!1);break;case"messageSettings":0!==e.messageSettings&&1!==e.messageSettings&&(n="messageSettings must be 0 or 1",t=!1);break;case"adminForbidType":yt(ze,e.adminForbidType)||(n="key:adminForbidType, invalid value:"+e.adminForbidType,t=!1);break;case"level":nt(e.level)||(n="level must be a number",t=!1);break;case"role":nt(e.role)||(n="role must be a number",t=!1);break;default:n="unknown key:"+s+"  "+e[s],t=!1}}return{valid:t,tips:n}}}]),e}(),ps=s((function e(t){r(this,e),this.value=t,this.next=null})),hs=function(){function e(t){r(this,e),this.MAX_LENGTH=t,this.pTail=null,this.pNodeToDel=null,this.map=new Map}return s(e,[{key:"set",value:function(e){var t=new ps(e);if(this.map.size<this.MAX_LENGTH)null===this.pTail?(this.pTail=t,this.pNodeToDel=t):(this.pTail.next=t,this.pTail=t),this.map.set(e,1);else{var n=this.pNodeToDel;this.pNodeToDel=this.pNodeToDel.next,this.map.delete(n.value),n.next=null,n=null,this.pTail.next=t,this.pTail=t,this.map.set(e,1)}}},{key:"has",value:function(e){return this.map.has(e)}},{key:"delete",value:function(e){this.has(e)&&this.map.delete(e)}},{key:"tail",value:function(){return this.pTail}},{key:"size",value:function(){return this.map.size}},{key:"data",value:function(){return Array.from(this.map.keys())}},{key:"reset",value:function(){for(var e;null!==this.pNodeToDel;)e=this.pNodeToDel,this.pNodeToDel=this.pNodeToDel.next,e.next=null,e=null;this.pTail=null,this.map.clear()}}]),e}(),gs=["groupID","name","avatar","type","introduction","notification","ownerID","selfInfo","createTime","infoSequence","lastInfoTime","lastMessage","nextMessageSeq","memberNum","maxMemberNum","memberList","joinOption","groupCustomField","muteAllMembers","isSupportTopic","inviteOption","_lastRevokedTime"],fs=function(){function e(t){r(this,e),this.groupID="",this.name="",this.avatar="",this.type="",this.introduction="",this.notification="",this.ownerID="",this.createTime="",this.infoSequence="",this.lastInfoTime="",this.selfInfo={messageRemindType:"",joinTime:"",nameCard:"",role:"",userID:"",memberCustomField:void 0,readedSequence:0,excludedUnreadSequenceList:void 0},this.lastMessage={lastTime:"",lastSequence:"",fromAccount:"",messageForShow:""},this.nextMessageSeq="",this.memberNum="",this.memberCount="",this.maxMemberNum="",this.maxMemberCount="",this.joinOption="",this.inviteOption="",this.groupCustomField=[],this.muteAllMembers=!1,this.isSupportTopic=!1,this._lastRevokedTime=0,this._initGroup(t)}return s(e,[{key:"memberNum",get:function(){return this.memberCount},set:function(e){}},{key:"maxMemberNum",get:function(){return this.maxMemberCount},set:function(e){}},{key:"_initGroup",value:function(e){for(var t in e)gs.indexOf(t)<0||("selfInfo"!==t?("memberNum"===t&&(this.memberCount=e[t]),"maxMemberNum"===t&&(this.maxMemberCount=e[t]),"isSupportTopic"!==t?this[t]=e[t]:this.isSupportTopic=1===e[t]):this.updateSelfInfo(e[t]))}},{key:"updateGroup",value:function(e){var t=this;e.appid=void 0,e.grossTopicNextMsgSeq=void 0,e.selfInfo&&(e.selfInfo.grossTopicReadSeq=void 0);var n=JSON.parse(JSON.stringify(e));n.lastMsgTime&&(this.lastMessage.lastTime=n.lastMsgTime),at(n.muteAllMembers)||("On"===n.muteAllMembers?n.muteAllMembers=!0:n.muteAllMembers=!1),n.groupCustomField&&Tt(this.groupCustomField,n.groupCustomField),at(n.memberNum)||(this.memberCount=n.memberNum),at(n.maxMemberNum)||(this.maxMemberCount=n.maxMemberNum),at(n.isSupportTopic)||(this.isSupportTopic=nt(n.isSupportTopic)?1===n.isSupportTopic:n.isSupportTopic),ht(this,n,["members","errorCode","lastMsgTime","groupCustomField","memberNum","maxMemberNum","isSupportTopic"]),st(n.members)&&n.members.length>0&&n.members.forEach((function(e){e.userID===t.selfInfo.userID&&ht(t.selfInfo,e,["sequence"])}))}},{key:"updateSelfInfo",value:function(e){var t={nameCard:e.nameCard,joinTime:e.joinTime,role:e.role,messageRemindType:e.messageRemindType,readedSequence:e.readedSequence,excludedUnreadSequenceList:e.excludedUnreadSequenceList};ht(this.selfInfo,n({},t),[],["",null,void 0,0,NaN])}},{key:"setSelfNameCard",value:function(e){this.selfInfo.nameCard=e}}]),e}(),_s=function(e,t){return at(e)?{lastTime:0,lastSequence:0,fromAccount:0,messageForShow:"",payload:null,type:"",isRevoked:!1,cloudCustomData:"",onlineOnlyFlag:!1,nick:"",nameCard:"",version:0,isPeerRead:!1,revoker:null}:e instanceof ji?{lastTime:e.time||0,lastSequence:e.sequence||0,fromAccount:e.from||"",messageForShow:Vt(e.type,e.payload,t),payload:e.payload||null,type:e.type||null,isRevoked:e.isRevoked||!1,cloudCustomData:e.cloudCustomData||"",onlineOnlyFlag:e._onlineOnlyFlag||!1,nick:e.nick||"",nameCard:e.nameCard||"",version:e.version||0,isPeerRead:e.isPeerRead||!1,revoker:e.revoker||null}:n(n({},e),{},{messageForShow:Vt(e.type,e.payload,t)})},ms=function(){function e(t,n){r(this,e),this.conversationID=t.conversationID||"",this.unreadCount=t.unreadCount||0,this.type=t.type||"",this.lastMessage=_s(t.lastMessage,n),t.lastMsgTime&&(this.lastMessage.lastTime=t.lastMsgTime),this._isInfoCompleted=!1,this.peerReadTime=t.peerReadTime||0,this.groupAtInfoList=[],this.remark="",this.isPinned=t.isPinned||!1,this.messageRemindType="",this.markList=t.markList||[],this.customData=t.customData||"",this.conversationGroupList=t.conversationGroupList||[],this._initProfile(t)}return s(e,[{key:"toAccount",get:function(){return this.conversationID.startsWith(S.CONV_C2C)?this.conversationID.replace(S.CONV_C2C,""):this.conversationID.startsWith(S.CONV_GROUP)?this.conversationID.replace(S.CONV_GROUP,""):""}},{key:"subType",get:function(){return this.groupProfile?this.groupProfile.type:""}},{key:"_initProfile",value:function(e){var t=this;Object.keys(e).forEach((function(n){switch(n){case"userProfile":t.userProfile=e.userProfile;break;case"groupProfile":t.groupProfile=e.groupProfile}})),at(this.userProfile)&&this.type===S.CONV_C2C?this.userProfile=new ds({userID:e.conversationID.replace("C2C","")}):at(this.groupProfile)&&this.type===S.CONV_GROUP&&(this.groupProfile=new fs({groupID:e.conversationID.replace("GROUP","")}))}},{key:"updateUnreadCount",value:function(e){var t=e.nextUnreadCount,n=e.isFromGetConversations,o=e.isUnreadC2CMessage;at(t)||(Et(this.subType)?this.unreadCount=0:n&&this.type===S.CONV_GROUP||n&&this.type===S.CONV_TOPIC||o&&this.type===S.CONV_C2C?this.unreadCount=t:this.unreadCount=this.unreadCount+t)}},{key:"updateLastMessage",value:function(e){this.lastMessage=_s(e)}},{key:"updateGroupAtInfoList",value:function(e){if(!this._isNeedMergeGroupAtInfo(e)){var t,n=(M(t=e.groupAtType)||I(t)||C(t)||E()).slice(0);-1!==n.indexOf(S.CONV_AT_ME)&&-1!==n.indexOf(S.CONV_AT_ALL)&&(n=[S.CONV_AT_ALL_AT_ME]);var o={from:e.from,groupID:e.groupID,topicID:e.topicID,messageSequence:e.sequence,atTypeArray:n,__random:e.__random,__sequence:e.__sequence};this.groupAtInfoList.push(o)}}},{key:"_isNeedMergeGroupAtInfo",value:function(e){var t=e.groupID,n=e.sequence;if(!kt({groupID:t}))return!1;var o=!1;return this.groupAtInfoList.forEach((function(t){t.messageSequence===n&&(t.atTypeArray.indexOf(S.CONV_AT_ME)>-1&&e.groupAtType.indexOf(S.CONV_AT_ALL)>-1&&(t.atTypeArray=[S.CONV_AT_ALL_AT_ME]),t.atTypeArray.indexOf(S.CONV_AT_ALL)>-1&&e.groupAtType.indexOf(S.CONV_AT_ME)>-1&&(t.atTypeArray=[S.CONV_AT_ALL_AT_ME],t.__random=e.__random,t.__sequence=e.__sequence),o=!0)})),o}},{key:"clearGroupAtInfoList",value:function(){this.groupAtInfoList.length=0}},{key:"reduceUnreadCount",value:function(){return this.unreadCount>=1&&(this.unreadCount-=1,!0)}},{key:"isLastMessageRevoked",value:function(e){var t=e.sequence,n=e.time;return this.type===S.CONV_C2C&&t===this.lastMessage.lastSequence&&n===this.lastMessage.lastTime||this.type===S.CONV_GROUP&&t===this.lastMessage.lastSequence}},{key:"setLastMessageRevoked",value:function(e){this.lastMessage.isRevoked=e}},{key:"setLastMessageRevoker",value:function(e){this.lastMessage.revoker=e}}]),e}(),vs=function(){function e(t){r(this,e),this._conversationModule=t,this._n="MessageRemindHandler",this._updateSequence=0}return s(e,[{key:"getC2CMessageRemindType",value:function(){var e=this,t="".concat(this._n,".getC2CMessageRemindType");return this._conversationModule.request({protocolName:Do,updateSequence:this._updateSequence}).then((function(n){Ve.l("".concat(t," ok"));var o=n.data,r=o.updateSequence,i=o.muteFlagList;e._updateSequence=r,e._patchC2CMessageRemindType(i)})).catch((function(e){Ve.e("".concat(t," failed. error:"),e)}))}},{key:"_patchC2CMessageRemindType",value:function(e){var t=this,n=0,o="";st(e)&&e.length>0&&e.forEach((function(e){var r=e.userID,i=e.muteFlag;0===i?o=S.MSG_REMIND_ACPT_AND_NOTE:1===i?o=S.MSG_REMIND_DISCARD:2===i&&(o=S.MSG_REMIND_ACPT_NOT_NOTE),!0===t._conversationModule.patchMessageRemindType({ID:r,isC2CConversation:!0,messageRemindType:o})&&(n+=1)})),Ve.l("".concat(this._n,"._patchC2CMessageRemindType count:").concat(n))}},{key:"set",value:function(e){return e.groupID?this._setGroupMessageRemindType(e):st(e.userIDList)?this._setC2CMessageRemindType(e):void 0}},{key:"_setGroupMessageRemindType",value:function(e){var t=this,n="".concat(this._n,"._setGroupMessageRemindType"),o=e.groupID,r=e.messageRemindType,i="groupID:".concat(o," messageRemindType:").concat(r),s=new Ai("setMessageRemindType");return s.setMessage(i),this._getModule(xn).modifyGroupMemberInfo({groupID:o,messageRemindType:r,userID:this._conversationModule.getMyUserID()}).then((function(){s.setNetworkType(t._conversationModule.getNetworkType()).end(),Ve.l("".concat(n," ok. ").concat(i));var o=t.onGroupMessageRemindTypeUpdated(e);return t._conversationModule.emitTotalUnreadMessageCountUpdate(),zi(o)})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];s.setError(e,o,r).end()})),Ve.e("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"onGroupMessageRemindTypeUpdated",value:function(e){var t=e.groupID,n=e.messageRemindType,o=this._getModule(Pn).getLocalGroupProfile(t);if(o&&(o.selfInfo.messageRemindType=n),Dt(t)){var r=t,i=Bt(r),s=this._getModule(Fn).getLocalTopic(i,r);return s&&(s.updateSelfInfo({messageRemindType:n}),this._conversationModule.emitOuterEvent(D.TOPIC_UPDATED,{groupID:i,topic:s})),{topic:s}}return this._conversationModule.patchMessageRemindType({ID:t,isC2CConversation:!1,messageRemindType:n})&&this._emitConversationUpdate(),{group:o}}},{key:"_setC2CMessageRemindType",value:function(e){var t=this,n="".concat(this._n,"._setC2CMessageRemindType"),o=e.userIDList,r=e.messageRemindType,i=o.slice(0,30),s=0;r===S.MSG_REMIND_DISCARD?s=1:r===S.MSG_REMIND_ACPT_NOT_NOTE&&(s=2);var a="userIDList:".concat(i," messageRemindType:").concat(r),c=new Ai("setMessageRemindType");return c.setMessage(a),this._conversationModule.request({protocolName:ko,requestData:{userIDList:i,muteFlag:s}}).then((function(e){c.setNetworkType(t._conversationModule.getNetworkType()).end();var o=e.data,s=o.updateSequence,a=o.errorList;t._updateSequence=s;var u=[],l=[];st(a)&&a.forEach((function(e){u.push(e.userID),l.push({userID:e.userID,code:e.errorCode})}));var d=i.filter((function(e){return-1===u.indexOf(e)}));Ve.l("".concat(n," ok. successUserIDList:").concat(d," failureUserIDList:").concat(JSON.stringify(l)));var p=0;return d.forEach((function(e){t._conversationModule.patchMessageRemindType({ID:e,isC2CConversation:!0,messageRemindType:r})&&(p+=1)})),p>=1&&t._emitConversationUpdate(),i.length=u.length=0,t._conversationModule.emitTotalUnreadMessageCountUpdate(),Ji({successUserIDList:d.map((function(e){return{userID:e}})),failureUserIDList:l})})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];c.setError(e,o,r).end()})),Ve.e("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"_getModule",value:function(e){return this._conversationModule.getModule(e)}},{key:"_emitConversationUpdate",value:function(){this._conversationModule.emitConversationUpdate(!0,!1)}},{key:"setUpdateSequence",value:function(e){this._updateSequence=e}},{key:"reset",value:function(){Ve.l("".concat(this._n,".reset")),this._updateSequence=0}}]),e}(),ys=function(){function e(t){r(this,e),this._conversationModule=t,this._n="ConvGroupHandler",this._convGroupMap=new Map,this._startIndex=0,this._pagingStatus=en.NOT_START}return s(e,[{key:"setConvCustomData",value:function(e){var t=this,n="".concat(this._n,".").concat("setConvCustomData"),o=e.conversationIDList,r=e.customData;Ve.l("".concat(n," options:"),e);var i=new Ai("setConvCustomData");i.setMessage(JSON.stringify(e));var s={fromAccount:this._getMyUserID(),itemList:[]},a=[],c=[];return o.forEach((function(e){if(!t._hasLocalConversation(e))return t._onConversationNotFound(c,e),!0;if(!St(e)&&!Lt(e))return t._onConversationIDInvalid(c,e),!0;var n={operationType:2,contactItem:void 0,customMark:r};St(e)?n.contactItem={type:1,toAccount:e.replace(S.CONV_C2C,"")}:Lt(e)&&(n.contactItem={type:2,groupID:e.replace(S.CONV_GROUP,"")}),s.itemList.push(n)})),c.length===o.length?Ji({successConversationIDList:a,failureConversationIDList:c}):this._conversationModule.request({protocolName:Fo,requestData:s}).then((function(e){i.setNetworkType(t._conversationModule.getNetworkType()).end(),Ve.l("".concat(n," ok"));var o=e.data.resultItem;if(st(o)){var s,u,l=!1;o.forEach((function(e){s=t._concatConversationID(e.contactItem),0===e.resultCode?(a.push(s),(u=t._getLocalConversation(s))&&u.customData!==r&&(u.customData=r,l=!0)):c.push({conversationID:s,code:e.resultCode,message:e.resultInfo})})),!0===l&&t._emitConversationUpdate()}return zi({successConversationIDList:a,failureConversationIDList:c})})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];i.setError(e,o,r).end()})),Ve.e("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"markConversation",value:function(e){var t=this;if(!this._conversationModule.canIUse(K.CONV_MARK))return Xi({code:gi.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".").concat("markConversation"),o=e.conversationIDList,r=e.markType,i=e.enableMark;Ve.l("".concat(n," options:"),e);var s=new Ai("markConversation");s.setMessage(JSON.stringify(e));var a=void 0,c=void 0,u=this._getFlagBit(r);!0===i?c=[u]:a=[u];var l={fromAccount:this._getMyUserID(),itemList:[]},d=[],p=[];return o.forEach((function(e){if(!t._hasLocalConversation(e))return t._onConversationNotFound(p,e),!0;if(!St(e)&&!Lt(e))return t._onConversationIDInvalid(p,e),!0;var n={operationType:1,contactItem:void 0,clearMark:a,setMark:c};St(e)?n.contactItem={type:1,toAccount:e.replace(S.CONV_C2C,"")}:Lt(e)&&(n.contactItem={type:2,groupID:e.replace(S.CONV_GROUP,"")}),l.itemList.push(n)})),p.length===o.length?Ji({successConversationIDList:d,failureConversationIDList:p}):this._conversationModule.request({protocolName:qo,requestData:l}).then((function(e){s.setNetworkType(t._conversationModule.getNetworkType()).end(),Ve.l("".concat(n," ok"));var o=e.data.resultItem;if(st(o)){var a,c,u=!1;o.forEach((function(e){if(a=t._concatConversationID(e.contactItem),0===e.resultCode){if(d.push(a),c=t._getLocalConversation(a)){var n=c.markList.indexOf(r);!0===i?-1===n&&(c.markList.push(r),u=!0):-1!==n&&(c.markList.splice(n,1),u=!0)}}else p.push({conversationID:a,code:e.resultCode,message:e.resultInfo})})),!0===u&&t._emitConversationUpdate()}return zi({successConversationIDList:d,failureConversationIDList:p})})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];s.setError(e,o,r).end()})),Ve.e("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"getLocalConvGroupList",value:function(){var e=this;return Ve.l("".concat(this._n,".getLocalConvGroupList pagingStatus:").concat(this._pagingStatus)),this._pagingStatus===en.REJECTED?this.getRemoteConvGroupList().then((function(){return zi(y(e._convGroupMap.values()))})):Ji(y(this._convGroupMap.values()))}},{key:"getRemoteConvGroupList",value:function(){var e=this,t="".concat(this._n,".getRemoteConvGroupList");return this._pagingStatus=en.PENDING,this._conversationModule.request({protocolName:zo,requestData:{fromAccount:this._getMyUserID(),startIndex:this._startIndex,startTime:xe()}}).then((function(n){var o,r,i=n.data,s=i.completeFlag,a=i.contactItem,c=i.nextStartIndex,u=void 0===c?0:c,l=i.groupItem;if(e._startIndex=u,Ve.l("".concat(t," completeFlag:").concat(s," nextStartIndex:").concat(u)),st(l)&&l.forEach((function(t){var n=t.convGroupID,o=t.groupName;e._convGroupMap.set(n,o)})),st(a)&&a.forEach((function(t){var n=t.standardMark,i=t.customData,s=t.convGroupIDList;if(o=e._concatConversationID(t),(r=e._getLocalConversation(o))&&(r.markList=Ht(n),r.customData=i||"",st(s))){var a=[];s.forEach((function(t){e._convGroupMap.has(t)&&a.push(e._convGroupMap.get(t))})),r.conversationGroupList=[].concat(a),a.length=0}})),0===s)return e.getRemoteConvGroupList();1===s&&(e._pagingStatus=en.RESOLVED,e._emitConversationUpdate(),e._emitConvGroupListUpdate())})).catch((function(n){e._pagingStatus=en.REJECTED,Ve.w("".concat(t," failed. error:"),n)}))}},{key:"createConvGroup",value:function(e){var t=this;if(!this._conversationModule.canIUse(K.CONV_GROUP))return Xi({code:gi.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".").concat("createConvGroup");Ve.l("".concat(n," options:"),e);var o=new Ai("createConvGroup");o.setMessage(JSON.stringify(e));var r=e.groupName,i=e.conversationIDList,s={fromAccount:this._getMyUserID(),itemList:[{groupName:r,contactItem:[]}]},a=[],c=[];return i.forEach((function(e){return t._hasLocalConversation(e)?St(e)||Lt(e)?void(St(e)?s.itemList[0].contactItem.push({type:1,toAccount:e.replace(S.CONV_C2C,"")}):Lt(e)&&s.itemList[0].contactItem.push({type:2,groupID:e.replace(S.CONV_GROUP,"")})):(t._onConversationIDInvalid(c,e),!0):(t._onConversationNotFound(c,e),!0)})),c.length===i.length?Ji({successConversationIDList:a,failureConversationIDList:c}):this._conversationModule.request({protocolName:Bo,requestData:s}).then((function(e){o.setNetworkType(t._conversationModule.getNetworkType()).end(),Ve.l("".concat(n," ok"));var i=e.data.groupResultItem[0],s=i.groupItem,u=i.resultItem;if(it(s)&&(t._convGroupMap.set(s.convGroupID,s.groupName),t._emitConvGroupListUpdate()),st(u)){var l,d,p=!1;u.forEach((function(e){l=t._concatConversationID(e.contactItem),0===e.resultCode?(a.push(l),(d=t._getLocalConversation(l))&&-1===d.conversationGroupList.indexOf(r)&&(d.conversationGroupList.push(r),p=!0)):c.push({conversationID:l,code:e.resultCode,message:e.resultInfo})})),!0===p&&(t._emitConversationUpdate(),t._emitConvGroupListUpdate())}return zi({successConversationIDList:a,failureConversationIDList:c})})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=v(t,2),r=n[0],i=n[1];o.setError(e,r,i).end()})),Ve.e("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"deleteConvGroup",value:function(e){var t=this;if(!this._conversationModule.canIUse(K.CONV_GROUP))return Xi({code:gi.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".").concat("deleteConvGroup");Ve.l("".concat(n," groupName:").concat(e));var o=new Ai("deleteConvGroup");return o.setMessage(e),this._conversationModule.request({protocolName:Vo,requestData:{fromAccount:this._getMyUserID(),groupName:[e]}}).then((function(r){o.setNetworkType(t._conversationModule.getNetworkType()).end(),Ve.l("".concat(n," ok"));var i=r.data.groupItem;if(st(i)){var s=!1;i.forEach((function(e){t._convGroupMap.has(e.convGroupID)&&(t._convGroupMap.delete(e.convGroupID),s=!0)})),!0===s&&t._emitConvGroupListUpdate()}t._eraseFromConversationGroupList([e])})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=v(t,2),r=n[0],i=n[1];o.setError(e,r,i).end()})),Ve.e("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"renameConvGroup",value:function(e){var t=this;if(!this._conversationModule.canIUse(K.CONV_GROUP))return Xi({code:gi.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".").concat("renameConvGroup");Ve.l("".concat(n," options:"),e);var o=new Ai("renameConvGroup");o.setMessage(JSON.stringify(e));var r=e.oldName,i=e.newName;return this._conversationModule.request({protocolName:Ko,requestData:{fromAccount:this._getMyUserID(),updateType:1,updateGroup:{updateGroupType:1,oldName:r,newName:i}}}).then((function(e){o.setNetworkType(t._conversationModule.getNetworkType()).end(),Ve.l("".concat(n," ok"));var s=e.data.updateGroupResult.convGroupID;t._convGroupMap.set(s,i),t._emitConvGroupListUpdate();var a,c,u=t._conversationModule.getLocalConversationList(),l=!1;u.forEach((function(e){a=e.conversationGroupList,-1!==(c=a.indexOf(r))&&(a.splice(c,1,i),l=!0)})),!0===l&&t._emitConversationUpdate()})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=v(t,2),r=n[0],i=n[1];o.setError(e,r,i).end()})),Ve.e("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"addConvsToGroup",value:function(e){var t=this;if(!this._conversationModule.canIUse(K.CONV_GROUP))return Xi({code:gi.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".").concat("addConvsToGroup");Ve.l("".concat(n," options:"),e);var o=new Ai("addConvsToGroup");o.setMessage(JSON.stringify(e));var r=e.conversationIDList,i=e.groupName,s={fromAccount:this._getMyUserID(),updateType:1,updateGroup:{updateGroupType:2,groupName:i,updateItem:[]}},a=[],c=[];return r.forEach((function(e){return t._hasLocalConversation(e)?St(e)||Lt(e)?void(St(e)?s.updateGroup.updateItem.push({operationType:1,contactItem:{type:1,toAccount:e.replace(S.CONV_C2C,"")}}):Lt(e)&&s.updateGroup.updateItem.push({operationType:1,contactItem:{type:2,groupID:e.replace(S.CONV_GROUP,"")}})):(t._onConversationIDInvalid(c,e),!0):(t._onConversationNotFound(c,e),!0)})),c.length===r.length?Ji({successConversationIDList:a,failureConversationIDList:c}):this._conversationModule.request({protocolName:Ho,requestData:s}).then((function(e){o.setNetworkType(t._conversationModule.getNetworkType()).end(),Ve.l("".concat(n," ok"));var r=e.data.updateGroupResult.contactResultItem;if(st(r)){var s,u,l=!1;r.forEach((function(e){s=t._concatConversationID(e.contactItem),0===e.resultCode?(u=t._getLocalConversation(s))&&-1===u.conversationGroupList.indexOf(i)&&(u.conversationGroupList.push(i),a.push(s),l=!0):c.push({conversationID:s,code:e.resultCode,message:e.resultInfo})})),!0===l&&(t._emitConversationUpdate(),t._emitConvInGroupUpdate(i))}return zi({successConversationIDList:a,failureConversationIDList:c})})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=v(t,2),r=n[0],i=n[1];o.setError(e,r,i).end()})),Ve.e("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"deleteConvsFromGroup",value:function(e){var t=this;if(!this._conversationModule.canIUse(K.CONV_GROUP))return Xi({code:gi.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".").concat("deleteConvsFromGroup");Ve.l("".concat(n," options:"),e);var o=new Ai("deleteConvsFromGroup");o.setMessage(JSON.stringify(e));var r=e.conversationIDList,i=e.groupName,s={fromAccount:this._getMyUserID(),updateType:1,updateGroup:{updateGroupType:2,groupName:i,updateItem:[]}},a=[],c=[];return r.forEach((function(e){return t._hasLocalConversation(e)?St(e)||Lt(e)?void(St(e)?s.updateGroup.updateItem.push({operationType:2,contactItem:{type:1,toAccount:e.replace(S.CONV_C2C,"")}}):Lt(e)&&s.updateGroup.updateItem.push({operationType:2,contactItem:{type:2,groupID:e.replace(S.CONV_GROUP,"")}})):(t._onConversationIDInvalid(c,e),!0):(t._onConversationNotFound(c,e),!0)})),c.length===r.length?Ji({successConversationIDList:a,failureConversationIDList:c}):this._conversationModule.request({protocolName:jo,requestData:s}).then((function(e){o.setNetworkType(t._conversationModule.getNetworkType()).end(),Ve.l("".concat(n," ok"));var r=e.data.updateGroupResult.contactResultItem;if(st(r)){var s,u,l=!1;r.forEach((function(e){if(s=t._concatConversationID(e.contactItem),0===e.resultCode){if(u=t._getLocalConversation(s)){var n=u.conversationGroupList.indexOf(i);-1!==n&&(u.conversationGroupList.splice(n,1),a.push(s),l=!0)}}else c.push({conversationID:s,code:e.resultCode,message:e.resultInfo})})),!0===l&&(t._emitConversationUpdate(),t._emitConvInGroupUpdate(i))}return zi({successConversationIDList:a,failureConversationIDList:c})})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=v(t,2),r=n[0],i=n[1];o.setError(e,r,i).end()})),Ve.e("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"onConvMarkUpdated",value:function(e){var t=this;if(!$t(e)){var n,o;Ve.d("".concat(this._n,".onConvMarkUpdated markItemList:"),e);var r=!1;e.forEach((function(e){var i=e.recentContactItem,s=e.optType,a=e.standardMark,c=e.customMark;if(n=t._concatConversationID(i),o=t._getLocalConversation(n))if(1===s){var u=Ht(a);!0!==function(e,t){if(e===t)return!0;if(!e||!t)return!1;if(e.length!==t.length)return!1;for(var n=0,o=e.length;n<o;n++)if(e[n]!==t[n])return!1;return!0}(o.markList,u)&&(o.markList=u,r=!0)}else 2===s&&o.customData!==c&&void 0!==c&&(o.customData=c,r=!0)})),!0===r&&this._emitConversationUpdate()}}},{key:"onConvGroupCreated",value:function(e){var t=this;Ve.d("".concat(this._n,".onConvGroupCreated resultList:"),e);var n=!1,o=!1;st(e)&&(e.forEach((function(e){var r=e.msgGroupItem,i=r.groupID,s=r.groupName;t._convGroupMap.get(i)!==s&&(t._convGroupMap.set(i,s),o=!0);var a,c,u=e.msgRecentContactItem;st(u)&&u.forEach((function(e){a=t._concatConversationID(e),(c=t._getLocalConversation(a))&&-1===c.conversationGroupList.indexOf(s)&&(c.conversationGroupList.push(s),n=!0)}))})),!0===n&&this._emitConversationUpdate(),!0===o&&this._emitConvGroupListUpdate())}},{key:"onConvGroupDeleted",value:function(e){var t=this;Ve.d("".concat(this._n,".onConvGroupDeleted groupItemList:"),e);var n=[];if(st(e)){var o=!1;e.forEach((function(e){var r=e.groupID,i=e.groupName;t._convGroupMap.has(r)&&(t._convGroupMap.delete(r),o=!0,n.push(i))})),!0===o&&this._emitConvGroupListUpdate()}this._eraseFromConversationGroupList(n)}},{key:"_eraseFromConversationGroupList",value:function(e){$t(e)||(this._conversationModule.getLocalConversationList().forEach((function(t){t.conversationGroupList=t.conversationGroupList.filter((function(t){return!e.includes(t)}))})),this._emitConversationUpdate())}},{key:"onConvGroupNameUpdated",value:function(e){Ve.d("".concat(this._n,".onConvGroupNameUpdated options:"),e);var t=e.groupID,n=e.groupName,o=e.oldGroupName;if(this._convGroupMap.get(t)!==n){this._convGroupMap.set(t,n),this._emitConvGroupListUpdate();var r,i,s=this._conversationModule.getLocalConversationList(),a=!1;s.forEach((function(e){r=e.conversationGroupList,-1!==(i=r.indexOf(o))&&(r.splice(i,1,n),a=!0)})),!0===a&&this._emitConversationUpdate()}}},{key:"onConvInGroupUpdated",value:function(e){var t=this;Ve.d("".concat(this._n,".onConvInGroupUpdated options:"),e);var n=e.oldGroupName,o=e.recentContactUpdateGroupItem;if(st(o)){var r,i,s,a=!1;o.forEach((function(e){var o=e.contactOptType,c=e.recentContactItem;r=t._concatConversationID(c),(i=t._getLocalConversation(r))&&(s=i.conversationGroupList.indexOf(n),1===o?-1===s&&(i.conversationGroupList.push(n),a=!0):2===o&&-1!==s&&(i.conversationGroupList.splice(s,1),a=!0))})),!0===a&&(this._emitConversationUpdate(),this._emitConvInGroupUpdate(n))}}},{key:"onConvAddedToOrDeletedFromGroup",value:function(e){var t=this;Ve.d("".concat(this._n,".onConvAddedToOrDeletedFromGroup options:"),e);var n=e.msgRecentContactItem,o=e.msgRecentContactUpdateContactItem,r=this._concatConversationID(n),i=this._getLocalConversation(r);if(i&&st(o)){var s,a=!1;o.forEach((function(e){var n=e.groupOptType,o=e.recentContactGroupItem.groupName;s=i.conversationGroupList.indexOf(o),1===n?-1===s&&(i.conversationGroupList.push(o),a=!0):2===n&&-1!==s&&(i.conversationGroupList.splice(s,1),a=!0),!0===a&&t._emitConvInGroupUpdate(o)})),!0===a&&this._emitConversationUpdate()}}},{key:"onConvGroupListSynced",value:function(e){var t=this;st(e)&&0!==e.length&&(Ve.l("".concat(this._n,".onConvGroupListSynced groupItemList:"),e),e.forEach((function(e){t._convGroupMap.set(e.convGroupID,e.groupName)})))}},{key:"getConvGroupListByID",value:function(e){var t=this;if(!$t(e)){var n=[];return e.forEach((function(e){t._convGroupMap.has(e)&&n.push(t._convGroupMap.get(e))})),n}}},{key:"_onConversationNotFound",value:function(e,t){e.push({conversationID:t,code:gi.CONVERSATION_NOT_FOUND,message:this._conversationModule.getErrorMessage(gi.CONVERSATION_NOT_FOUND)})}},{key:"_onConversationIDInvalid",value:function(e,t){e.push({conversationID:t,code:gi.INVALID_CONVERSATION_ID,message:this._conversationModule.getErrorMessage(gi.INVALID_CONVERSATION_ID)})}},{key:"_getFlagBit",value:function(e){for(var t=e.toString(2),n=t.length,o=n-1;o>=0;o--)if("1"===t[o])return n-o-1}},{key:"_concatConversationID",value:function(e){var t,n=e.type,o=e.to,r=e.groupID,i=e.userID;return 1===n?at(i)?at(o)||(t="".concat(S.CONV_C2C).concat(o)):t="".concat(S.CONV_C2C).concat(i):2===n&&(t="".concat(S.CONV_GROUP).concat(r)),t}},{key:"_getMyUserID",value:function(){return this._conversationModule.getMyUserID()}},{key:"_insertConversationGroup",value:function(e,t){var n=this._getLocalConversation(e);if(n){var o=n.conversationGroupList;-1===o.indexOf(t)&&o.push(t)}}},{key:"_getLocalConversation",value:function(e){return this._conversationModule.getLocalConversation(e)}},{key:"_hasLocalConversation",value:function(e){return this._conversationModule.hasLocalConversation(e)}},{key:"_emitConversationUpdate",value:function(){this._conversationModule.emitConversationUpdate(!0,!1)}},{key:"_emitConvGroupListUpdate",value:function(){this._conversationModule.emitOuterEvent(D.CONVERSATION_GROUP_LIST_UPDATED,y(this._convGroupMap.values()))}},{key:"_emitConvInGroupUpdate",value:function(e){var t={groupName:e,conversationList:[]},n=this._conversationModule.getLocalConversationList();t.conversationList=n.filter((function(t){return t.conversationGroupList.includes(e)})),this._conversationModule.emitOuterEvent(D.CONVERSATION_IN_GROUP_UPDATED,t)}},{key:"reset",value:function(){Ve.l("".concat(this._n,".reset")),this._convGroupMap.clear(),this._startIndex=0,this._pagingStatus=en.NOT_START}}]),e}(),Ms=function(e){c(o,e);var t=m(o);function o(e){var n;return r(this,o),(n=t.call(this,e))._n="ConversationModule",rs.mixin(f(n)),n._messageListHandler=new Qi,n._messageRemindHandler=new vs(f(n)),n._convGroupHandler=new ys(f(n)),n.singlyLinkedList=new hs(100),n._pagingStatus=en.NOT_START,n._pagingTimeStamp=0,n._pagingStartIndex=0,n._pagingPinnedTimeStamp=0,n._pagingPinnedStartIndex=0,n._pagingConvIDMap=new Map,n._convIDFromUnreadDBMap=new Map,n._conversationMap=new Map,n._tmpGroupList=[],n._tmpGroupAtTipsList=[],n._peerReadTimeMap=new Map,n._completedMap=new Map,n._roamingMessageKeyAndTimeMap=new Map,n._roamingMessageSequenceMap=new Map,n._remoteGroupReadSequenceMap=new Map,n._convTotalUnreadCount=0,n._pagingGetCostList=[],n._initListeners(),n}return s(o,[{key:"_initListeners",value:function(){var e=this.getInnerEmitterInstance();e.on(es,this._initLocalConversationList,this),e.on(os,this._onProfileUpdated,this)}},{key:"onCheckTimer",value:function(e){e%60==0&&this._messageListHandler.traversal()}},{key:"_initLocalConversationList",value:function(){var e=this,t=new Ai("_initLocalConversationList");Ve.l("".concat(this._n,".").concat("_initLocalConversationList"));var n="",o=this._getStorageConversationList(),r=this.isIntl();if(o){for(var i=o.length,s=0;s<i;s++){var a=o[s];if(a){if(a.conversationID==="".concat(S.CONV_C2C,"@TLS#ERROR")||a.conversationID==="".concat(S.CONV_C2C,"@TLS#NOT_FOUND"))continue;if(a.groupProfile){var c=a.groupProfile.type;if(Et(c))continue}}this._conversationMap.set(o[s].conversationID,new ms(o[s],r))}this.emitConversationUpdate(!0,!1),n="count:".concat(i)}else n="count:0";t.setNetworkType(this.getNetworkType()).setMessage(n).end(),this.getModule(Un)||this.triggerReady(),this.ready((function(){e._tmpGroupList.length>0&&(e.updateConversationGroupProfile(e._tmpGroupList),e._tmpGroupList.length=0)})),this.syncConversationList()}},{key:"onMessageSent",value:function(e){this._onSendOrReceiveMessage({conversationOptionsList:e.conversationOptionsList,isInstantMessage:!0})}},{key:"onNewMessage",value:function(e){this._onSendOrReceiveMessage(e)}},{key:"_onSendOrReceiveMessage",value:function(e){var t=this,n=e.conversationOptionsList,o=e.isInstantMessage,r=void 0===o||o,i=e.isUnreadC2CMessage,s=void 0!==i&&i,a=e.updateUnreadCount,c=void 0===a||a;this._isReady?0!==n.length&&(this._getC2CPeerReadTime(n),this._updateLocalConversationList({conversationOptionsList:n,isInstantMessage:r,isUnreadC2CMessage:s,isFromGetConversations:!1,updateUnreadCount:c}),r||(this._convIDFromUnreadDBMap=new Map([].concat(y(this._convIDFromUnreadDBMap),y(n.map((function(e){return[e.conversationID,1]}))))),this._diffAndDeleteConversation()),this._setStorageConversationList(),n.filter((function(e){return e.type===S.CONV_TOPIC})).length>0||this.emitConversationUpdate()):this.ready((function(){t._onSendOrReceiveMessage(e)}))}},{key:"updateConversationGroupProfile",value:function(e){var t=this;if(!st(e)||0!==e.length)if(0!==this._conversationMap.size){var n=!1;e.forEach((function(e){var o="GROUP".concat(e.groupID);if(t._conversationMap.has(o)){n=!0;var r=t._conversationMap.get(o);r.groupProfile=JSON.parse(JSON.stringify(e)),r.lastMessage.lastSequence<e.nextMessageSeq&&(r.lastMessage.lastSequence=e.nextMessageSeq-1),r.subType||(r.subType=e.type)}})),n&&this.emitConversationUpdate(!0,!1)}else this._tmpGroupList=e}},{key:"_updateConversationUserProfile",value:function(e){var t=this;e.data.forEach((function(e){var n="C2C".concat(e.userID);t._conversationMap.has(n)&&(t._conversationMap.get(n).userProfile=e)})),this.emitConversationUpdate(!0,!1)}},{key:"onMessageRevoked",value:function(e){var t=this;if(0!==e.length){var n=null,o=!1,r=[];e.forEach((function(e){(n=t._conversationMap.get(e.conversationID))&&(n.type===S.CONV_TOPIC?r.push(e):(n.reduceUnreadCount()&&(o=!0),n.isLastMessageRevoked({sequence:e.sequence,time:e.time})&&(n.setLastMessageRevoked(!0),n.setLastMessageRevoker(e.revoker),o=!0)))})),this.getModule(Fn).onMessageRevoked(r),o&&(this.emitConversationUpdate(!0,!1),this.emitTotalUnreadMessageCountUpdate())}}},{key:"isLastMessageRevoked",value:function(e){var t=!1,n=e.conversationID,o=e.sequence,r=e.time,i=this._conversationMap.get(n);return i&&(t=i.type===S.CONV_TOPIC?this.getModule(Fn).isLastMessageRevoked({topicID:n.replace(S.CONV_GROUP,""),sequence:o}):i.isLastMessageRevoked({sequence:o,time:r})),Ve.l("".concat(this._n,".isLastMessageRevoked options:").concat(JSON.stringify(e)," ret:").concat(t)),t}},{key:"onMessageDeleted",value:function(e){var t=this;if(0!==e.length){var n=null;e.forEach((function(e){(n=t._messageListHandler.getLocalMessage(e.conversationID,e.ID))&&(n.isDeleted=!0),e!==n&&(e.isDeleted=!0)}));for(var o=e[0].conversationID,r=this._messageListHandler.getLocalMessageList(o),i={},s=r.length-1;s>=0;s--)if(!r[s].isDeleted){i=r[s];break}var a=this._conversationMap.get(o);if(a){var c=!1;a.lastMessage.lastSequence===i.sequence&&a.lastMessage.lastTime===i.time||($t(i)&&(i=void 0),a.updateLastMessage(i),a.type!==S.CONV_TOPIC&&(c=!0),Ve.l("".concat(this._n,".onMessageDeleted. update conversationID:").concat(o," with lastMessage:"),a.lastMessage)),o.startsWith(S.CONV_C2C)&&this.updateUnreadCount(o),c&&this.emitConversationUpdate(!0,!1)}}}},{key:"onMessageModified",value:function(e){var t=e.conversationType,n=e.from,o=e.to,r=e.time,i=e.sequence,s=e.elements,a=e.cloudCustomData,c=e.messageVersion,u=this.getMyUserID(),l="".concat(t).concat(o);o===u&&t===S.CONV_C2C&&(l="".concat(t).concat(n));var d=this._messageListHandler.onMessageModified(l,e),p=d.isUpdated,h=d.message;!0===p&&this.emitOuterEvent(D.MESSAGE_MODIFIED,[h]);var g=this._isTopicConversation(l);if(Ve.l("".concat(this._n,".onMessageModified isUpdated:").concat(p," isTopicMessage:").concat(g," from:").concat(n," to:").concat(o)),g)this.getModule(Fn).onMessageModified(e);else{var f=this._conversationMap.get(l);if(f){var _=f.lastMessage;Ve.d("".concat(this._n.onMessageModified," lastMessage:"),JSON.stringify(_),"options:",JSON.stringify(e)),_&&_.lastTime===r&&_.lastSequence===i&&_.version!==c&&(_.type=s[0].type,_.payload=s[0].content,_.messageForShow=Vt(_.type,_.payload,this.isIntl()),_.cloudCustomData=a,_.version=c,this.emitConversationUpdate(!0,!1))}}return h}},{key:"onNewGroupAtTips",value:function(e){var t=this,o=e.dataList,r=null;o.forEach((function(e){e.groupAtTips?r=e.groupAtTips:e.elements?r=n(n({},e.elements),{},{sync:!0}):e.groupAtType&&(r=n(n({},e),{},{sync:!0})),r.__random=e.random,r.__sequence=e.clientSequence,t._tmpGroupAtTipsList.push(r)})),Ve.d("".concat(this._n,".onNewGroupAtTips isReady:").concat(this._isReady),this._tmpGroupAtTipsList),this._isReady&&this._handleGroupAtTipsList()}},{key:"_handleGroupAtTipsList",value:function(){var e=this;if(0!==this._tmpGroupAtTipsList.length){var t=!1;this._tmpGroupAtTipsList.forEach((function(n){var o=n.groupID,r=n.from,i=n.topicID,s=void 0===i?void 0:i,a=n.sync,c=void 0!==a&&a;if(r!==e.getMyUserID())if(at(s)){var u=e._conversationMap.get("".concat(S.CONV_GROUP).concat(o));u&&(u.updateGroupAtInfoList(n),t=!0)}else{var l=e._conversationMap.get("".concat(S.CONV_GROUP).concat(s));if(l){l.updateGroupAtInfoList(n);var d=e.getModule(Fn),p=l.groupAtInfoList;d.onConversationProxy({topicID:s,groupAtInfoList:p})}$t(l)&&c&&(e.updateTopicConversation([{conversationID:"".concat(S.CONV_GROUP).concat(s),type:S.CONV_TOPIC}]),e._conversationMap.get("".concat(S.CONV_GROUP).concat(s)).updateGroupAtInfoList(n))}})),t&&this.emitConversationUpdate(!0,!1),this._tmpGroupAtTipsList.length=0}}},{key:"_getC2CPeerReadTime",value:function(e){var t=this,n=[];if(e.forEach((function(e){t._conversationMap.has(e.conversationID)||e.type!==S.CONV_C2C||n.push(e.conversationID.replace(S.CONV_C2C,""))})),n.length>0){Ve.d("".concat(this._n,"._getC2CPeerReadTime userIDList:").concat(n));var o=this.getModule(Un);o&&o.getRemotePeerReadTime(n)}}},{key:"_getStorageConversationList",value:function(){return this.getModule(Vn).getItem("conversationMap")}},{key:"_setStorageConversationList",value:function(){var e=this.getLocalConversationList().filter((function(e){return e.type===S.CONV_C2C||e.type===S.CONV_GROUP&&e.lastMessage.type!==S.MSG_GRP_TIP})).slice(0,20).map((function(e){return{conversationID:e.conversationID,type:e.type,subType:e.subType,lastMessage:e.lastMessage,groupProfile:e.groupProfile,userProfile:e.userProfile}}));this.getModule(Vn).setItem("conversationMap",e)}},{key:"emitConversationUpdate",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.getLocalConversationList();if(t){var o=this.getModule(Pn);o&&o.updateGroupLastMessage(n)}e&&this.emitOuterEvent(D.CONVERSATION_LIST_UPDATED)}},{key:"getLocalConversationList",value:function(){return y(this._conversationMap.values()).filter((function(e){return e.type!==S.CONV_TOPIC}))}},{key:"getLocalConversation",value:function(e){return this._conversationMap.get(e)}},{key:"hasLocalConversation",value:function(e){return this._conversationMap.has(e)}},{key:"getLocalOldestMessage",value:function(e){return this._messageListHandler.getLocalOldestMessage(e)}},{key:"syncConversationList",value:function(){var e=this,t=new Ai("syncConversationList");return this._pagingStatus===en.NOT_START&&this._conversationMap.clear(),this._pagingGetConversationList().then((function(n){var o=function(e){if(st(e)&&0!==e.length){var t=0;return e.forEach((function(e){t+=e})),(t/e.length).toFixed(0)}}(e._pagingGetCostList);return Ve.l("".concat(e._n,".").concat("syncConversationList",". sum ").concat(function(e){if(st(e)&&0!==e.length){var t=0;return e.forEach((function(e){t+=e})),t.toFixed(0)}}(e._pagingGetCostList)," ms, average ").concat(o," ms")),e._pagingGetCostList.length=0,e._pagingStatus=en.RESOLVED,e._diffAndDeleteConversation(),e.emitConversationUpdate(!0,!1),e._setStorageConversationList(),e._handleC2CPeerReadTime(),e._patchConversationProperties(),t.setMessage(e._conversationMap.size).setMoreMessage(o).setNetworkType(e.getNetworkType()).end(),n})).catch((function(n){return e._pagingStatus=en.REJECTED,t.setMessage(e._pagingTimeStamp),e.probeNetwork().then((function(e){var o=v(e,2),r=o[0],i=o[1];t.setError(n,r,i).end()})),Xi(n)}))}},{key:"_diffAndDeleteConversation",value:function(){var e=this;if(this._isSyncCompleted()){var t=[];this._conversationMap.forEach((function(n,o){!e._pagingConvIDMap.has(o)&&e._convIDFromUnreadDBMap.has(o)&&(e._conversationMap.delete(o),t.push(o))})),Ve.l("".concat(this._n,"._diffAndDeleteConversation list:").concat(t))}}},{key:"_patchConversationProperties",value:function(){var e=this,t=Date.now(),n=this.checkAndPatchRemark(),o=this._messageRemindHandler.getC2CMessageRemindType(),r=this.getModule(Pn).getGroupList();Promise.all([n,o,r]).then((function(){var n=Date.now()-t;Ve.l("".concat(e._n,"._patchConversationProperties ok. cost ").concat(n," ms")),e.emitConversationUpdate(!0,!1),e.emitTotalUnreadMessageCountUpdate()}))}},{key:"_pagingGetConversationList",value:function(){var e=this,t="".concat(this._n,"._pagingGetConversationList");Ve.l("".concat(t," timeStamp:").concat(this._pagingTimeStamp," startIndex:").concat(this._pagingStartIndex)+" pinnedTimeStamp:".concat(this._pagingPinnedTimeStamp," pinnedStartIndex:").concat(this._pagingPinnedStartIndex));var n=Date.now();return this._pagingStatus=en.PENDING,this.request({protocolName:wo,requestData:{fromAccount:this.getMyUserID(),timeStamp:this._pagingTimeStamp,startIndex:this._pagingStartIndex,pinnedTimeStamp:this._pagingPinnedTimeStamp,pinnedStartIndex:this._pagingPinnedStartIndex,orderType:1}}).then((function(o){var r=o.data,i=r.completeFlag,s=r.conversations,a=void 0===s?[]:s,c=r.timeStamp,u=r.startIndex,l=r.pinnedTimeStamp,d=r.pinnedStartIndex,p=r.groupItem,h=Date.now()-n;if(e._pagingGetCostList.push(h),Ve.l("".concat(t," ok. completeFlag:").concat(i," count:").concat(a.length," cost ").concat(h," ms")),e._convGroupHandler.onConvGroupListSynced(p),a.length>0){var g=e._getConversationOptions(a);e._pagingConvIDMap=new Map([].concat(y(e._pagingConvIDMap),y(g.map((function(e){return[e.conversationID,1]}))))),e._updateLocalConversationList({conversationOptionsList:g,isFromGetConversations:!0}),e.isLoggedIn()&&e.emitConversationUpdate()}if(!e._isReady){if(!e.isLoggedIn())return Ji();e.triggerReady()}return e._pagingTimeStamp=c,e._pagingStartIndex=u,e._pagingPinnedTimeStamp=l,e._pagingPinnedStartIndex=d,1!==i?e._pagingGetConversationList():(e._handleGroupAtTipsList(),e._convGroupHandler.getRemoteConvGroupList(),Ji())})).catch((function(n){throw e.isLoggedIn()&&(e._isReady||(Ve.w("".concat(t," failed. error:"),n),e.triggerReady())),n}))}},{key:"_updateLocalConversationList",value:function(e){var t,n=e.isFromGetConversations,o=e.isInstantMessage,r=Date.now();t=this._getTmpConversationListMapping(e),this._conversationMap=new Map(this._sortConversationList([].concat(y(t.toBeUpdatedConversationList),y(this._conversationMap)))),n||(this._updateUserOrGroupProfile(t.newConversationList),o&&this.emitTotalUnreadMessageCountUpdate()),Ve.d("".concat(this._n,"._updateLocalConversationList cost ").concat(Date.now()-r," ms"))}},{key:"_getTmpConversationListMapping",value:function(e){for(var t=e.conversationOptionsList,n=e.isFromGetConversations,o=e.isInstantMessage,r=e.isUnreadC2CMessage,i=void 0!==r&&r,s=e.updateUnreadCount,a=[],c=[],u=this.getModule(Pn),l=this.getModule(Gn),d=this.isIntl(),p=0,h=t.length;p<h;p++){var g=new ms(t[p],d),f=g.conversationID;if(f!=="".concat(S.CONV_C2C,"@TLS#ERROR")&&f!=="".concat(S.CONV_C2C,"@TLS#NOT_FOUND"))if(this._conversationMap.has(f)){var _=this._conversationMap.get(f),m=["unreadCount","allowType","adminForbidType","payload","isPinned"];!1===o&&m.push("lastMessage");var v=t[p].lastMessage,y=!at(v);y||t[p].type===S.CONV_TOPIC||this._onLastMessageNotExist(t[p]),at(o)&&y&&null===_.lastMessage.payload&&(_.lastMessage.payload=v.payload),$t(_.lastMessage.revoker)||(_.lastMessage.revoker=null),ht(_,g,m,[null,void 0,"",0,NaN]),!0===s&&_.updateUnreadCount({nextUnreadCount:g.unreadCount,isFromGetConversations:n,isUnreadC2CMessage:i}),o&&y&&(v.payload&&(_.lastMessage.payload=v.payload),_.type===S.CONV_GROUP&&(_.lastMessage.nameCard=v.nameCard,_.lastMessage.nick=v.nick)),y&&_.lastMessage.cloudCustomData!==v.cloudCustomData&&(_.lastMessage.cloudCustomData=v.cloudCustomData||""),this._conversationMap.delete(f),a.push([f,_])}else{if(g.type===S.CONV_GROUP&&u){var M=g.groupProfile.groupID,I=u.getLocalGroupProfile(M);I&&(g.groupProfile=I,!0===s&&g.updateUnreadCount({nextUnreadCount:0}))}else if(g.type===S.CONV_C2C){var C=f.replace(S.CONV_C2C,"");l&&l.isMyFriend(C)&&(g.remark=l.getFriendRemark(C))}c.push(g),a.push([f,g])}}var T=this.getModule(Fn);return a.forEach((function(e){if(e[1].type===S.CONV_TOPIC){var t=e[1],n=t.conversationID,o=t.unreadCount,r=t.groupAtInfoList;T.onConversationProxy({topicID:n.replace(S.CONV_GROUP,""),unreadCount:o,groupAtInfoList:$t(r)?void 0:r})}})),{toBeUpdatedConversationList:a,newConversationList:c}}},{key:"_onLastMessageNotExist",value:function(e){new Ai("lastMessageNotExist").setMessage("".concat(JSON.stringify(e))).setNetworkType(this.getNetworkType()).end()}},{key:"_sortConversationList",value:function(e){var t=[],n=[],o=[],r=[];return e.forEach((function(e){!0===e[1].isPinned?$t(e[1].lastMessage.lastTime)?n.push(e):t.push(e):$t(e[1].lastMessage.lastTime)?r.push(e):o.push(e)})),t.sort((function(e,t){return t[1].lastMessage.lastTime-e[1].lastMessage.lastTime})).concat(n).concat(o.sort((function(e,t){return t[1].lastMessage.lastTime-e[1].lastMessage.lastTime}))).concat(r)}},{key:"_sortConversationListAndEmitEvent",value:function(){this._conversationMap=new Map(this._sortConversationList(y(this._conversationMap))),this.emitConversationUpdate(!0,!1)}},{key:"_updateUserOrGroupProfile",value:function(e){var t=this;if(0!==e.length){var n=[],o=[],r=this.getModule(bn),i=this.getModule(Pn);e.forEach((function(e){if(e.type===S.CONV_C2C)n.push(e.toAccount);else if(e.type===S.CONV_GROUP){var t=e.toAccount;i.hasLocalGroup(t)?e.groupProfile=i.getLocalGroupProfile(t):o.push(t)}})),Ve.l("".concat(this._n,"._updateUserOrGroupProfile c2cUserIDList:").concat(n," groupIDList:").concat(o)),n.length>0&&r.getUserProfile({userIDList:n}).then((function(e){var n=e.data;st(n)?n.forEach((function(e){t._doUpdateUserProfile("C2C".concat(e.userID),e)})):t._doUpdateUserProfile("C2C".concat(n.userID),n)})),o.length>0&&i.getGroupProfileAdvance({groupIDList:o,responseFilter:{groupBaseInfoFilter:["Type","Name","FaceUrl"]}}).then((function(e){e.data.successGroupList.forEach((function(e){var n="GROUP".concat(e.groupID);if(t._conversationMap.has(n)){var o=t._conversationMap.get(n);ht(o.groupProfile,e,[],[null,void 0,"",0,NaN]),!o.subType&&e.type&&(o.subType=e.type)}}))}))}}},{key:"_doUpdateUserProfile",value:function(e,t){this.hasLocalConversation(e)&&(this.getLocalConversation(e).userProfile=t)}},{key:"_getConversationOptions",value:function(e){var t=this,o=[],r=e.filter((function(e){var t=e.type,n=e.userID;return 1===t&&"@TLS#NOT_FOUND"!==n&&"@TLS#ERROR"!==n||2===t})),i=this.getMyUserID(),s=r.map((function(e){if(at(e.lastMsg)&&(e.lastMsg={elements:[]}),1===e.type){var r={userID:e.userID,nick:e.peerNick,avatar:e.peerAvatar};return o.push(r),{conversationID:"C2C".concat(e.userID),type:"C2C",lastMessage:{lastTime:e.time,lastSequence:e.sequence,fromAccount:e.lastC2CMsgFromAccount,messageForShow:e.messageShow,type:e.lastMsg.elements[0]?e.lastMsg.elements[0].type:null,payload:e.lastMsg.elements[0]?t._amendLayersOverLimitProperty(e.lastMsg.elements[0].content):null,cloudCustomData:e.lastMsg.cloudCustomData||"",isRevoked:8===e.lastMessageFlag,onlineOnlyFlag:!1,nick:"",nameCard:"",version:0,isPeerRead:e.lastC2CMsgFromAccount===i&&e.time<=e.c2cPeerReadTime,revoker:e.lastMsg.revokerInfo?e.lastMsg.revokerInfo.revoker:null},userProfile:new ds(r),peerReadTime:e.c2cPeerReadTime,isPinned:1===e.isPinned,messageRemindType:"",customData:e.customMark||"",markList:Ht(e.standardMark),conversationGroupList:t._convGroupHandler.getConvGroupListByID(e.contactGroupId)}}return{conversationID:"GROUP".concat(e.groupID),type:"GROUP",lastMessage:n(n({lastTime:e.time,lastSequence:e.sequence,fromAccount:e.msgGroupFromAccount,messageForShow:e.messageShow},t._patchTypeAndPayload(e)),{},{cloudCustomData:e.lastMsg.cloudCustomData||"",isRevoked:2===e.lastMessageFlag,onlineOnlyFlag:!1,nick:e.senderNick||"",nameCard:e.senderNameCard||"",revoker:e.lastMsg.revokerInfo?e.lastMsg.revokerInfo.revoker:null}),groupProfile:new fs({groupID:e.groupID,name:e.groupNick,avatar:e.groupImage}),unreadCount:e.unreadCount,peerReadTime:0,isPinned:1===e.isPinned,messageRemindType:"",version:0,customData:e.customMark||"",markList:Ht(e.standardMark),conversationGroupList:t._convGroupHandler.getConvGroupListByID(e.contactGroupId)}}));return o.length>0&&this.getModule(bn).onConversationsProfileUpdated(o),s}},{key:"_patchTypeAndPayload",value:function(e){var t=e.lastMsg,o=t.event,r=void 0===o?void 0:o,i=t.elements,s=void 0===i?[]:i,a=t.groupTips,c=void 0===a?{}:a;if(!at(r)&&!$t(c)){var u=new ji(c);u.setElement({type:S.MSG_GRP_TIP,content:n(n({},c.elements),{},{groupProfile:c.groupProfile})});var l=JSON.parse(JSON.stringify(u.payload));return u=null,{type:S.MSG_GRP_TIP,payload:l}}return{type:s[0]?s[0].type:null,payload:s[0]?this._amendLayersOverLimitProperty(s[0].content):null}}},{key:"_amendLayersOverLimitProperty",value:function(e){var t=e.layersOverLimit;return 0===t?e.layersOverLimit=!1:1===t&&(e.layersOverLimit=!0),e}},{key:"getLocalMessageList",value:function(e){return this._messageListHandler.getLocalMessageList(e)}},{key:"deleteLocalMessage",value:function(e){e instanceof ji&&this._messageListHandler.remove(e)}},{key:"onConversationDeleted",value:function(e){if(st(e)){var t=e.map((function(e){var t=e.type,n=e.userID,o=e.groupID;return 1===t?"".concat(S.CONV_C2C).concat(n):2===t?"".concat(S.CONV_GROUP).concat(o):void 0}));Ve.l("".concat(this._n,".onConversationDeleted conversationIDList:").concat(t)),this.deleteLocalConversationList(t)}}},{key:"onConversationPinned",value:function(e){var t=this;if(st(e)){var n=!1;e.forEach((function(e){var o,r=e.type,i=e.userID,s=e.groupID;1===r?o=t.getLocalConversation("".concat(S.CONV_C2C).concat(i)):2===r&&(o=t.getLocalConversation("".concat(S.CONV_GROUP).concat(s))),o&&(Ve.l("".concat(t._n,".onConversationPinned conversationID:").concat(o.conversationID," isPinned:").concat(o.isPinned)),o.isPinned||(o.isPinned=!0,n=!0))})),n&&this._sortConversationListAndEmitEvent()}}},{key:"onConversationUnpinned",value:function(e){var t=this;if(st(e)){var n=!1;e.forEach((function(e){var o,r=e.type,i=e.userID,s=e.groupID;1===r?o=t.getLocalConversation("".concat(S.CONV_C2C).concat(i)):2===r&&(o=t.getLocalConversation("".concat(S.CONV_GROUP).concat(s))),o&&(Ve.l("".concat(t._n,".onConversationUnpinned conversationID:").concat(o.conversationID," isPinned:").concat(o.isPinned)),o.isPinned&&(o.isPinned=!1,n=!0))})),n&&this._sortConversationListAndEmitEvent()}}},{key:"getMessageList",value:function(e){var t=this,n=e.conversationID,o=e.nextReqMessageID,r=e.count,i="".concat(this._n,".getMessageList"),s=this.getLocalConversation(n),a="";if(s&&s.groupProfile&&(a=s.groupProfile.type),Et(a))return Ve.l("".concat(i," not available in avchatroom. conversationID:").concat(n)),Ji({messageList:[],nextReqMessageID:"",isCompleted:!0});(at(r)||r>15)&&(r=15),!o&&this._isNotInCommunity(n)&&(this._messageListHandler.removeByConversationID(n),this._completedMap.delete(n),this._roamingMessageSequenceMap.delete(n));var c=this._computeRemainingCount({conversationID:n,nextReqMessageID:o}),u=this._completedMap.has(n);if(Ve.l("".concat(i," conversationID:").concat(n," nextReqMessageID:").concat(o)+" remainingCount:".concat(c," count:").concat(r," isCompleted:").concat(u)),this._needGetHistory({conversationID:n,remainingCount:c,count:r}))return this.getHistoryMessages({conversationID:n,nextReqMessageID:o,count:20}).then((function(e){var o=e.nextReqID,r=e.storedMessageList,s=t._completedMap.has(n),a=r;c>0&&(a=t._messageListHandler.getLocalMessageList(n).slice(0,r.length+c));var u={nextReqMessageID:s?"":o,messageList:a,isCompleted:s};return Ve.l("".concat(i," ret.nextReqMessageID:").concat(u.nextReqMessageID," ret.isCompleted:").concat(u.isCompleted," ret.length:").concat(a.length)),zi(u)}));this.modifyMessageList(n);var l=this._getMessageListFromMemory({conversationID:n,nextReqMessageID:o,count:r});return Ji(l)}},{key:"_getMessageListFromMemory",value:function(e){var t=e.conversationID,n=e.nextReqMessageID,o=e.count,r="".concat(this._n,"._getMessageListFromMemory"),i=this._messageListHandler.getLocalMessageList(t),s=i.length,a=0,c={isCompleted:!1,nextReqMessageID:"",messageList:[]};return n?(a=i.findIndex((function(e){return e.ID===n})))>o?(c.messageList=i.slice(a-o,a),c.nextReqMessageID=i[a-o].ID):(c.messageList=i.slice(0,a),c.isCompleted=!0):s>o?(a=s-o,c.messageList=i.slice(a,s),c.nextReqMessageID=i[a].ID):(c.messageList=i.slice(0,s),c.isCompleted=!0),Ve.l("".concat(r," conversationID:").concat(t)+" ret.nextReqMessageID:".concat(c.nextReqMessageID," ret.isCompleted:").concat(c.isCompleted," ret.length:").concat(c.messageList.length)),c}},{key:"getMessageListHopping",value:function(e){var t=e.conversationID,n=e.sequence,o=e.time,r=e.count,i=e.direction,s=void 0===i?0:i;if((at(r)||r>15)&&(r=15),t.startsWith(S.CONV_C2C)){var a=this.getModule(Un),c=t.replace(S.CONV_C2C,"");return a.getRoamingMessagesHopping({peerAccount:c,time:o,count:r,direction:s})}if(t.startsWith(S.CONV_GROUP)){var u=this.getModule(Pn),l=t.replace(S.CONV_GROUP,"");return u.getRoamingMessagesHopping({groupID:l,sequence:n,count:r,direction:s})}}},{key:"_computeRemainingCount",value:function(e){var t=e.conversationID,n=e.nextReqMessageID,o=this._messageListHandler.getLocalMessageList(t),r=o.length;if(!n)return r;var i=0;return St(t)?i=o.findIndex((function(e){return e.ID===n})):Lt(t)&&(i=-1!==n.indexOf("-")?o.findIndex((function(e){return e.ID===n})):o.findIndex((function(e){return e.sequence===n}))),-1===i&&(i=0),i}},{key:"_getMessageListSize",value:function(e){return this._messageListHandler.getLocalMessageList(e).length}},{key:"_needGetHistory",value:function(e){var t=e.conversationID,n=e.remainingCount,o=e.count,r=this.getLocalConversation(t),i="";return r&&r.groupProfile&&(i=r.groupProfile.type),!At(t)&&!Et(i)&&!(Lt(t)&&this._isPagingGetGroupListCompleted()&&this._getLocalGroupCount()<=4e3&&!this._hasLocalGroup(t)&&!this._isTopicConversation(t))&&n<=o&&!this._completedMap.has(t)}},{key:"_isTopicConversation",value:function(e){var t=e.replace(S.CONV_GROUP,"");return Dt(t)}},{key:"getHistoryMessages",value:function(e){var t=e.conversationID,n=e.count;if(t===S.CONV_SYSTEM)return Ji();var o=15;n>20&&(o=20);var r=null;if(St(t)){var i=this._roamingMessageKeyAndTimeMap.has(t);return(r=this.getModule(Un))?r.getRoamingMessage({conversationID:t,peerAccount:t.replace(S.CONV_C2C,""),count:o,lastMessageTime:i?this._roamingMessageKeyAndTimeMap.get(t).lastMessageTime:0,messageKey:i?this._roamingMessageKeyAndTimeMap.get(t).messageKey:""}):Xi({code:gi.CANNOT_FIND_MODULE})}if(Lt(t)){if(!(r=this.getModule(Pn)))return Xi({code:gi.CANNOT_FIND_MODULE});var s=null;this._conversationMap.has(t)&&(s=this._conversationMap.get(t).lastMessage);var a=0;s&&(a=s.lastSequence);var c=this._roamingMessageSequenceMap.get(t);return r.getRoamingMessage({conversationID:t,groupID:t.replace(S.CONV_GROUP,""),count:o,sequence:c||a})}return Ji()}},{key:"patchConversationLastMessage",value:function(e){var t=this.getLocalConversation(e);if(t){var n=t.lastMessage,o=n.messageForShow,r=n.payload;if($t(o)||$t(r)){var i=this._messageListHandler.getLocalMessageList(e);if(0===i.length)return;var s=i[i.length-1];Ve.l("".concat(this._n,".patchConversationLastMessage conversationID:").concat(e," payload:"),s.payload),t.updateLastMessage(s)}}}},{key:"onRoamingMessage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.startsWith(S.CONV_C2C)?S.CONV_C2C:S.CONV_GROUP,i=null,s=[],a=[],c=0,u=e.length,l=null,d=r===S.CONV_GROUP,p=this.getModule(jn),h=this.getFileDownloadProxy(),g=function(){c=d?e.length-1:0,u=d?0:e.length},f=function(){d?--c:++c},_=function(){return d?c>=u:c<u};for(g();_();f())if(d&&1===e[c].sequence&&o&&this.setCompleted(t),1!==e[c].isPlaceMessage)if((i=new ji(e[c])).to=e[c].to,r!==S.CONV_GROUP||at(e[c].topicID)||(i.to=e[c].topicID),i.isSystemMessage=!!e[c].isSystemMessage,i.conversationType=r,4===e[c].event?l={type:S.MSG_GRP_TIP,content:n(n({},e[c].elements),{},{groupProfile:e[c].groupProfile})}:(e[c].elements=p.parseElements(e[c].elements,e[c].from),l=e[c].elements),d||i.setNickAndAvatar({nick:e[c].nick,avatar:e[c].avatar}),$t(l)){var m=new Ai("emptyMessageBody");m.setMessage("from:".concat(i.from," to:").concat(i.to," sequence:").concat(i.sequence," event:").concat(e[c].event)),m.setNetworkType(this.getNetworkType()).setLevel("warning").end()}else i.setElement(l,h),i.reInitialize(this.getMyUserID()),s.push(i);return g=f=_=null,o?(this._messageListHandler.unshift(s,a),s=null,a):(a=null,s)}},{key:"findMessage",value:function(e){return this._messageListHandler.findMessage(e)}},{key:"_isNotInCommunity",value:function(e){var t=!1;if(e.startsWith(S.CONV_GROUP)&&this._isTopicConversation(e)){var n=Bt(e.replace(S.CONV_GROUP,""));this.getModule(Pn).hasLocalGroup(n)||(t=!0)}return t}},{key:"deleteTopicRoamingMessageInfo",value:function(e){var t=this;kt({groupID:e})&&this._messageListHandler.getTopicConversationIDList(e).forEach((function(e){t._messageListHandler.removeByConversationID(e),t._completedMap.delete(e),t._roamingMessageSequenceMap.delete(e)}))}},{key:"deleteGroupRomaingMessageInfo",value:function(e){var t="".concat(S.CONV_GROUP).concat(e);this._messageListHandler.removeByConversationID(t),this._completedMap.delete(t),this._roamingMessageSequenceMap.delete(t)}},{key:"setMessageRead",value:function(e){var t=e.conversationID,n=this.getLocalConversation(t);if(Ve.l("".concat(this._n,".setMessageRead conversationID:").concat(t," unreadCount:").concat(n?n.unreadCount:0)),!n)return Ji();if(n.type!==S.CONV_GROUP&&n.type!==S.CONV_TOPIC||$t(n.groupAtInfoList)||this.deleteGroupAtTips(t),0===n.unreadCount)return Ji();if(n.type===S.CONV_GROUP&&!this._hasLocalGroup(t))return 0!==n.unreadCount&&(n.unreadCount=0,this.emitConversationUpdate(!0,!1)),Ji();var o=this._messageListHandler.getLocalLastMessage(t),r=n.lastMessage.lastTime;o&&r<o.time&&(r=o.time);var i=n.lastMessage.lastSequence;if(o&&i<o.sequence&&(i=o.sequence),n.type===S.CONV_TOPIC&&at(o)){var s=this.getModule(Fn),a=t.replace(S.CONV_GROUP,""),c=Bt(a),u=s.getLocalTopic(c,a);u&&(i=u.nextMessageSeq-1)}var l=null;switch(n.type){case S.CONV_C2C:return(l=this.getModule(Un))?l.setMessageRead({conversationID:t,lastMessageTime:r}):Xi({code:gi.CANNOT_FIND_MODULE});case S.CONV_GROUP:case S.CONV_TOPIC:return(l=this.getModule(Pn))?l.setMessageRead({conversationID:t,lastMessageSeq:i}):Xi({code:gi.CANNOT_FIND_MODULE});case S.CONV_SYSTEM:return n.unreadCount=0,this.emitConversationUpdate(!0,!1),Ji();default:return Ji()}}},{key:"setAllMessageRead",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n="setAllMessageRead",o="".concat(this._n,".").concat(n);t.scope||(t.scope=S.READ_ALL_MSG),Ve.l("".concat(o," options:"),t);var r=this._createSetAllMessageReadPack(t);if(0===r.readAllC2CMessage&&0===r.groupMessageReadInfoList.length)return Ji();var i=new Ai(n);return this.request({protocolName:cr,requestData:r}).then((function(n){var o=n.data,r=e._handleAllMessageRead(o);return i.setMessage("scope:".concat(t.scope," failureGroups:").concat(JSON.stringify(r))).setNetworkType(e.getNetworkType()).end(),Ji()})).catch((function(t){return e.probeNetwork().then((function(e){var n=v(e,2),o=n[0],r=n[1];i.setError(t,o,r).end()})),Ve.w("".concat(o," failed. error:"),t),Xi({code:t&&t.code?t.code:gi.MESSAGE_UNREAD_ALL_FAIL,message:t&&t.message?t.message:void 0})}))}},{key:"setConversationCustomData",value:function(e){return this._convGroupHandler.setConvCustomData(e)}},{key:"markConversation",value:function(e){return this._convGroupHandler.markConversation(e)}},{key:"getConversationGroupList",value:function(){return this._convGroupHandler.getLocalConvGroupList()}},{key:"createConversationGroup",value:function(e){return this._convGroupHandler.createConvGroup(e)}},{key:"deleteConversationGroup",value:function(e){return this._convGroupHandler.deleteConvGroup(e)}},{key:"renameConversationGroup",value:function(e){return this._convGroupHandler.renameConvGroup(e)}},{key:"addConversationsToGroup",value:function(e){return this._convGroupHandler.addConvsToGroup(e)}},{key:"deleteConversationsFromGroup",value:function(e){return this._convGroupHandler.deleteConvsFromGroup(e)}},{key:"onConversationMarkUpdated",value:function(e){this._convGroupHandler.onConvMarkUpdated(e)}},{key:"onConversationGroupCreated",value:function(e){this._convGroupHandler.onConvGroupCreated(e)}},{key:"onConversationGroupDeleted",value:function(e){this._convGroupHandler.onConvGroupDeleted(e)}},{key:"onConversationGroupNameUpdated",value:function(e){this._convGroupHandler.onConvGroupNameUpdated(e)}},{key:"onConversationInGroupUpdated",value:function(e){this._convGroupHandler.onConvInGroupUpdated(e)}},{key:"onConversationAddedToOrDeletedFromGroup",value:function(e){this._convGroupHandler.onConvAddedToOrDeletedFromGroup(e)}},{key:"_getConversationLastMessageSequence",value:function(e){var t=this._messageListHandler.getLocalLastMessage(e.conversationID),n=e.lastMessage.lastSequence;return t&&n<t.sequence&&(n=t.sequence),n}},{key:"_getConversationLastMessageTime",value:function(e){var t=this._messageListHandler.getLocalLastMessage(e.conversationID),n=e.lastMessage.lastTime;return t&&n<t.time&&(n=t.time),n}},{key:"_createSetAllMessageReadPack",value:function(e){var t,n={readAllC2CMessage:0,groupMessageReadInfoList:[]},o=e.scope,r=k(this._conversationMap);try{for(r.s();!(t=r.n()).done;){var i=v(t.value,2)[1];if(i.unreadCount>0)if(i.type===S.CONV_C2C&&0===n.readAllC2CMessage){if(o===S.READ_ALL_MSG)n.readAllC2CMessage=1;else if(o===S.READ_ALL_C2C_MSG){n.readAllC2CMessage=1;break}}else if(i.type===S.CONV_GROUP&&(o===S.READ_ALL_GROUP_MSG||o===S.READ_ALL_MSG)){var s=this._getConversationLastMessageSequence(i);n.groupMessageReadInfoList.push({groupID:i.groupProfile.groupID,messageSequence:s})}}}catch(a){r.e(a)}finally{r.f()}return n}},{key:"onPushedAllMessageRead",value:function(e){this._handleAllMessageRead(e)}},{key:"_handleAllMessageRead",value:function(e){var t=e.groupMessageReadInfoList,n=e.readAllC2CMessage,o=this._parseGroupReadInfo(t);return this._updateAllConversationUnreadCount({readAllC2CMessage:n})>=1&&(this.emitConversationUpdate(!0,!1),this.emitTotalUnreadMessageCountUpdate()),o}},{key:"_parseGroupReadInfo",value:function(e){var t=[];if(e&&e.length)for(var n=0,o=e.length;n<o;n++){var r=e[n],i=r.groupID,s=r.sequence,a=r.retCode,c=r.lastMessageSeq;at(a)?this._remoteGroupReadSequenceMap.set(i,c):(this._remoteGroupReadSequenceMap.set(i,s),0!==a&&t.push("".concat(i,"-").concat(s,"-").concat(a)))}return t}},{key:"_updateAllConversationUnreadCount",value:function(e){var t,n=e.readAllC2CMessage,o=0,r=k(this._conversationMap);try{for(r.s();!(t=r.n()).done;){var i=v(t.value,2),s=i[0],a=i[1];if(a.unreadCount>=1){if(1===n&&a.type===S.CONV_C2C){var c=this._getConversationLastMessageTime(a);this.updateIsReadAfterReadReport({conversationID:s,lastMessageTime:c})}else if(a.type===S.CONV_GROUP){var u=s.replace(S.CONV_GROUP,"");if(this._remoteGroupReadSequenceMap.has(u)){var l=this._remoteGroupReadSequenceMap.get(u),d=this._getConversationLastMessageSequence(a);this.updateIsReadAfterReadReport({conversationID:s,remoteReadSequence:l}),d>=l&&this._remoteGroupReadSequenceMap.delete(u)}}this.updateUnreadCount(s,!1)&&(o+=1)}}}catch(p){r.e(p)}finally{r.f()}return o}},{key:"isRemoteRead",value:function(e){var t=e.conversationID,n=e.sequence,o=t.replace(S.CONV_GROUP,""),r=!1;if(this._remoteGroupReadSequenceMap.has(o)){var i=this._remoteGroupReadSequenceMap.get(o);n<=i&&(r=!0,Ve.l("".concat(this._n,".isRemoteRead conversationID:").concat(t," messageSequence:").concat(n," remoteReadSequence:").concat(i))),n>=i+10&&this._remoteGroupReadSequenceMap.delete(o)}return r}},{key:"updateIsReadAfterReadReport",value:function(e){var t=e.conversationID,n=e.lastMessageSeq,o=e.lastMessageTime,r=this._messageListHandler.getLocalMessageList(t);if(0!==r.length)for(var i,s=r.length-1;s>=0;s--)if(i=r[s],!(o&&i.time>o||n&&i.sequence>n)){if("in"===i.flow&&i.isRead)break;i.setIsRead(!0)}}},{key:"updateUnreadCount",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!1,o=this.getLocalConversation(e),r=this._messageListHandler.getLocalMessageList(e);if(o){var i=o.unreadCount,s=r.filter((function(e){return!e.isRead&&!e._onlineOnlyFlag&&!e.isDeleted})).length;if(i!==s&&(o.unreadCount=s,n=!0,Ve.l("".concat(this._n,".updateUnreadCount from ").concat(i," to ").concat(s,", conversationID:").concat(e)),!0===t&&(this.emitConversationUpdate(!0,!1),this.emitTotalUnreadMessageCountUpdate())),n&&o.type===S.CONV_TOPIC){var a=o.unreadCount,c=this.getModule(Fn),u=e.replace(S.CONV_GROUP,"");c.onConversationProxy({topicID:u,unreadCount:a})}return n}}},{key:"clearGroupAtInfoList",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.getLocalConversation(e);if(n&&n.groupAtInfoList.length>0){if(n.clearGroupAtInfoList(),Ve.l("".concat(this._n,".clearGroupAtInfoList conversationID:").concat(e)),n.type===S.CONV_TOPIC){var o=n.groupAtInfoList,r=this.getModule(Fn),i=e.replace(S.CONV_GROUP,"");r.onConversationProxy({topicID:i,groupAtInfoList:o})}!0===t&&this.emitConversationUpdate(!0,!1)}}},{key:"updateReadReceiptInfo",value:function(e){var t=this,n=e.userID,o=void 0===n?void 0:n,r=e.groupID,i=void 0===r?void 0:r,s=e.readReceiptList;if(!$t(s)){var a=[];if(at(o)){if(!at(i)){var c="".concat(S.CONV_GROUP).concat(i);s.forEach((function(e){var n=e.tinyID,o=e.clientTime,r=e.random,s=e.readCount,u=e.unreadCount,l="".concat(n,"-").concat(o,"-").concat(r),d=t._messageListHandler.getLocalMessage(c,l),p={groupID:i,messageID:l,readCount:0,unreadCount:0};d&&(nt(s)&&(d.readReceiptInfo.readCount=s,p.readCount=s),nt(u)&&(d.readReceiptInfo.unreadCount=u,p.unreadCount=u),a.push(p))}))}}else{var u="".concat(S.CONV_C2C).concat(o);s.forEach((function(e){var n=e.tinyID,r=e.clientTime,i=e.random,s="".concat(n,"-").concat(r,"-").concat(i),c=t._messageListHandler.getLocalMessage(u,s);if(c){c.readReceiptInfo.isPeerRead=!0;var l={userID:o,messageID:s,isPeerRead:!0};a.push(l)}}))}a.length>0&&this.emitOuterEvent(D.MESSAGE_READ_RECEIPT_RECEIVED,a)}}},{key:"recomputeGroupUnreadCount",value:function(e){var t=e.conversationID,n=e.count,o=this.getLocalConversation(t);if(o){var r=o.unreadCount,i=r-n;i<0&&(i=0),o.unreadCount=i,Ve.l("".concat(this._n,".recomputeGroupUnreadCount from ").concat(r," to ").concat(i,", conversationID:").concat(t))}}},{key:"updateIsRead",value:function(e){var t=this.getLocalConversation(e),n=this.getLocalMessageList(e);if(t&&0!==n.length&&!At(t.type)){for(var o=[],r=0,i=n.length;r<i;r++)"in"!==n[r].flow?"out"!==n[r].flow||n[r].isRead||n[r].setIsRead(!0):o.push(n[r]);var s=0;if(t.type===S.CONV_C2C){var a=o.slice(-t.unreadCount).filter((function(e){return e.isRevoked})).length;s=o.length-t.unreadCount-a}else s=o.length-t.unreadCount;for(var c=0;c<s&&!o[c].isRead;c++)o[c].setIsRead(!0)}}},{key:"deleteGroupAtTips",value:function(e){var t=this,n="".concat(this._n,".deleteGroupAtTips");Ve.l("".concat(n));var o=this._conversationMap.get(e);if(!o)return Promise.resolve();var r=o.groupAtInfoList;if(0===r.length)return Promise.resolve();var i=void 0;e.startsWith(S.CONV_GROUP)&&(i=e.replace(S.CONV_GROUP,""));var s=y(r);if((kt({groupID:i})||Dt(i))&&0===(s=r.filter((function(e){return!e.atTypeArray.includes(S.CONV_AT_ALL)}))).length)return this.clearGroupAtInfoList(e,!1),Promise.resolve();var a=this.getMyUserID();return this.request({protocolName:xo,requestData:{messageListToDelete:s.map((function(e){return{from:e.from,to:a,messageSeq:e.__sequence,messageRandom:e.__random,groupID:at(e.topicID)?e.groupID:e.topicID}}))}}).then((function(){return Ve.l("".concat(n," ok. count:").concat(r.length)),t.clearGroupAtInfoList(e,!1),Promise.resolve()})).catch((function(e){return Ve.e("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"appendToMessageList",value:function(e){this._messageListHandler.pushIn(e)}},{key:"setMessageRandom",value:function(e){this.singlyLinkedList.set(e.random)}},{key:"deleteMessageRandom",value:function(e){this.singlyLinkedList.delete(e.random)}},{key:"pushIntoMessageList",value:function(e,t,n){return!(!this._messageListHandler.pushIn(t,n)||this._isMessageFromCurrentInstance(t)&&!n||(e.push(t),0))}},{key:"_isMessageFromCurrentInstance",value:function(e){return this.singlyLinkedList.has(e.random)}},{key:"revoke",value:function(e,t,n){return this._messageListHandler.revoke(e,t,n)}},{key:"getPeerReadTime",value:function(e){return this._peerReadTimeMap.get(e)}},{key:"recordPeerReadTime",value:function(e,t){this._peerReadTimeMap.has(e)?this._peerReadTimeMap.get(e)<t&&this._peerReadTimeMap.set(e,t):this._peerReadTimeMap.set(e,t)}},{key:"updateMessageIsPeerReadProperty",value:function(e,t){if(e.startsWith(S.CONV_C2C)&&t>0){var n=this._messageListHandler.updateMessageIsPeerReadProperty(e,t);if(n.length>0&&this.emitOuterEvent(D.MESSAGE_READ_BY_PEER,n),this._conversationMap.has(e)){var o=this._conversationMap.get(e).lastMessage;$t(o)||o.fromAccount===this.getMyUserID()&&o.lastTime<=t&&!o.isPeerRead&&(o.isPeerRead=!0,this.emitConversationUpdate(!0,!1))}}}},{key:"updateMessageIsModifiedProperty",value:function(e){this._messageListHandler.updateMessageIsModifiedProperty(e)}},{key:"setCompleted",value:function(e){Ve.l("".concat(this._n,".setCompleted. conversationID:").concat(e)),this._completedMap.set(e,!0)}},{key:"updateRoamingMessageKeyAndTime",value:function(e,t,n){this._roamingMessageKeyAndTimeMap.set(e,{messageKey:t,lastMessageTime:n})}},{key:"updateRoamingMessageSequence",value:function(e,t){this._roamingMessageSequenceMap.set(e,t)}},{key:"getConversationList",value:function(e){var t=this,n="getConversationList",o="".concat(this._n,".").concat(n),r="pagingStatus:".concat(this._pagingStatus,", local conversation count:").concat(this._conversationMap.size,", options:").concat(e);if(Ve.l("".concat(o,". ").concat(r)),this._pagingStatus===en.REJECTED){var i=new Ai(n);return i.setMessage(r),this.syncConversationList().then((function(){i.setNetworkType(t.getNetworkType()).end();var n=t._getConversationList(e);return zi({conversationList:n,isSyncCompleted:t._isSyncCompleted()})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];i.setError(e,o,r).end()})),Ve.e("".concat(o," failed. error:"),e),Xi(e)}))}if(0===this._conversationMap.size){var s=new Ai(n);return s.setMessage(r),this.syncConversationList().then((function(){s.setNetworkType(t.getNetworkType()).end();var n=t._getConversationList(e);return zi({conversationList:n,isSyncCompleted:t._isSyncCompleted()})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];s.setError(e,o,r).end()})),Ve.e("".concat(o," failed. error:"),e),Xi(e)}))}var a=this._getConversationList(e);return Ve.l("".concat(o,". returned conversation count:").concat(a.length)),Ji({conversationList:a,isSyncCompleted:this._isSyncCompleted()})}},{key:"_getConversationList",value:function(e){if(at(e))return this.getLocalConversationList();if(st(e))return 0===e.length?[]:this.getLocalConversationList().filter((function(t){return e.includes(t.conversationID)}));if(it(e)){var t=e.type,n=e.markType,o=e.groupName;return this.getLocalConversationList().filter((function(e){return(t!==S.CONV_C2C&&t!==S.CONV_GROUP||e.type===t)&&(!ot(o)||e.conversationGroupList.includes(o))&&(!nt(n)||e.markList.includes(n))}))}return[]}},{key:"_handleC2CPeerReadTime",value:function(){var e,t=k(this._conversationMap);try{for(t.s();!(e=t.n()).done;){var n=v(e.value,2),o=n[0],r=n[1];r.type===S.CONV_C2C&&(Ve.d("".concat(this._n,"._handleC2CPeerReadTime conversationID:").concat(o," peerReadTime:").concat(r.peerReadTime)),this.recordPeerReadTime(o,r.peerReadTime))}}catch(i){t.e(i)}finally{t.f()}}},{key:"_isPagingGetGroupListCompleted",value:function(){return this.getModule(Pn).isPagingGetCompleted()}},{key:"_getLocalGroupCount",value:function(){return this.getModule(Pn).getLocalGroupList().length}},{key:"_hasLocalGroup",value:function(e){return this.getModule(Pn).hasLocalGroup(e.replace(S.CONV_GROUP,""))}},{key:"getConversationProfile",value:function(e){var t,n=this;if((t=this._conversationMap.has(e)?this._conversationMap.get(e):new ms({conversationID:e,type:e.slice(0,3)===S.CONV_C2C?S.CONV_C2C:S.CONV_GROUP},this.isIntl()))._isInfoCompleted||t.type===S.CONV_SYSTEM)return Ji({conversation:t});if(Lt(e)&&!this._hasLocalGroup(e))return Ji({conversation:t});var o="".concat(this._n,".").concat("getConversationProfile"),r=new Ai("getConversationProfile");return Ve.l("".concat(o,". conversationID:").concat(e," remark:").concat(t.remark," lastMessage:"),t.lastMessage),this._updateUserOrGroupProfileCompletely(t).then((function(i){r.setNetworkType(n.getNetworkType()).setMessage("conversationID:".concat(e," unreadCount:").concat(i.data.conversation.unreadCount)).end();var s=n.getModule(Gn);if(s&&t.type===S.CONV_C2C){var a=e.replace(S.CONV_C2C,"");if(s.isMyFriend(a)){var c=s.getFriendRemark(a);t.remark!==c&&(t.remark=c,Ve.l("".concat(o,". conversationID:").concat(e," patch remark:").concat(t.remark)))}}return Ve.l("".concat(o," ok. conversationID:").concat(e)),i})).catch((function(t){return n.probeNetwork().then((function(n){var o=v(n,2),i=o[0],s=o[1];r.setError(t,i,s).setMessage("conversationID:".concat(e)).end()})),Ve.e("".concat(o," failed. error:"),t),Xi(t)}))}},{key:"_updateUserOrGroupProfileCompletely",value:function(e){var t=this;return e.type===S.CONV_C2C?this.getModule(bn).getUserProfile({userIDList:[e.toAccount]}).then((function(n){var o=n.data;return 0===o.length?Xi(new Wi({code:gi.USER_OR_GROUP_NOT_FOUND})):(e.userProfile=o[0],e._isInfoCompleted=!0,t._unshiftConversation(e),Ji({conversation:e}))})):this.getModule(Pn).getGroupProfile({groupID:e.toAccount}).then((function(n){return e.groupProfile=n.data.group,e._isInfoCompleted=!0,t._unshiftConversation(e),Ji({conversation:e})}))}},{key:"_unshiftConversation",value:function(e){e instanceof ms&&!this._conversationMap.has(e.conversationID)&&(this._conversationMap=new Map([[e.conversationID,e]].concat(y(this._conversationMap))),this._setStorageConversationList(),this.emitConversationUpdate(!0,!1))}},{key:"_onProfileUpdated",value:function(e){var t=this;e.data.forEach((function(e){var n=e.userID;if(n===t.getMyUserID())t._onMyProfileModified({latestNick:e.nick,latestAvatar:e.avatar});else{var o=t._conversationMap.get("".concat(S.CONV_C2C).concat(n));o&&(o.userProfile=e)}}))}},{key:"_isSyncCompleted",value:function(){return this._pagingStatus===en.RESOLVED}},{key:"_errorLog",value:function(e,t,n,o){var r=new Error("Params validate failed."),i="".concat(this.getErrorMessage("API_REFER")).concat(e);throw Ve.w("[".concat(e,"] | ").concat(t," | ").concat(this.getErrorMessage(n,o),", ").concat(i)),Ve.e("[".concat(e,"] Invalid ").concat(t,": type check failed for ").concat(t,".")),r}},{key:"_isValidConversationID",value:function(e){return St(e)||Lt(e)||At(e)}},{key:"deleteConversation",value:function(e){var t=this,n="deleteConversation";return ot(e)||rt(e)||this._errorLog(n,"options","StringOrObjectRequiredLog"),ot(e)?(this._isValidConversationID(e)||this._errorLog(n,"options","InvalidConversationID",e),Ve.l("".concat(this._n,".").concat(n," conversationID:").concat(e)),this.deleteConversationList({conversationIDList:[e],flag:1})):(st(e.conversationIDList)||this._errorLog(n,"conversationIDList","ArrayRequiredLog"),0===e.conversationIDList.length&&this._errorLog(n,"conversationIDList","NonEmptyArrayLog"),e.conversationIDList.forEach((function(e){t._isValidConversationID(e)||t._errorLog(n,"conversationIDList","InvalidConversationID",e)})),"clearHistoryMessage"in e&&"boolean"!=typeof e.clearHistoryMessage&&this._errorLog(n,"clearHistoryMessage","BooleanRequiredLog"),e.conversationIDList.length>100&&(e.conversationIDList=e.conversationIDList.slice(0,100)),this.deleteConversationList(e))}},{key:"deleteConversationList",value:function(e){var t=this,n=e.conversationIDList,o=void 0===n?[]:n,r=e.clearHistoryMessage,i=void 0===r||r,s=e.flag,a=void 0===s?0:s,c="".concat(this._n,".").concat("deleteConversationList");Ve.l("".concat(c," conversationIDList.length:").concat(o.length," clearHistoryMessage:").concat(i));var u=new Ai("deleteConversationList");return u.setMessage("conversationIDList:".concat(o)),Promise.all([this.rmLocalOnlyConversationList(o),this.rmLocalAndRemoteConversationList(o,i)]).then((function(e){u.setNetworkType(t.getNetworkType()).end();var n=[].concat(y(e[0]),y(e[1]));return 0===n.length?Xi(new Wi({code:gi.CONVERSATION_NOT_FOUND})):(Ve.l("".concat(c," ok")),Ji(1===a?{conversationID:n[0]}:{conversationIDList:n}))})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];u.setError(e,o,r).end()})),Ve.e("".concat(c," failed. error:"),e),Xi(e)}))}},{key:"rmLocalOnlyConversationList",value:function(e){var t=this;return e.filter((function(e){if(!t._conversationMap.has(e))return!1;var n=t.getLocalConversation(e).type;return n!==S.CONV_GROUP||t._hasLocalGroup(e)?n===S.CONV_SYSTEM&&(t.getModule(Pn).deleteGroupSystemNotice({messageList:t._messageListHandler.getLocalMessageList(e)}),t.deleteLocalConversation(e),!0):(t.deleteLocalConversation(e),!0)}))}},{key:"rmLocalAndRemoteConversationList",value:function(e,t){var n=this,o={fromAccount:this.getMyUserID(),conversationList:[],clearHistoryMessage:t?1:0};return e.forEach((function(e){if(n._conversationMap.has(e)){var t=n.getLocalConversation(e).type;t===S.CONV_C2C?o.conversationList.push({toAccount:e.replace(t,""),type:1}):t===S.CONV_GROUP&&n._hasLocalGroup(e)&&o.conversationList.push({toGroupID:e.replace(t,""),type:2})}})),0===o.conversationList.length?[]:this.request({protocolName:Uo,requestData:o}).then((function(e){var t=[];return e.data.resultList.length>0&&e.data.resultList.map((function(e){if(0===e.code){var n=1===e.type?"".concat(S.CONV_C2C).concat(e.to):"".concat(S.CONV_GROUP).concat(e.groupID);t.push(n)}})),n.deleteLocalConversationList(t),t}))}},{key:"clearHistoryMessage",value:function(e){var t=this,n={fromAccount:this.getMyUserID(),toAccount:void 0,type:void 0,toGroupID:void 0};if(!this._conversationMap.has(e))return Xi({code:gi.CONVERSATION_NOT_FOUND});var o=this._conversationMap.get(e).type;if(o===S.CONV_C2C)n.type=1,n.toAccount=e.replace(S.CONV_C2C,"");else{if(o!==S.CONV_GROUP)return o===S.CONV_SYSTEM?(this.getModule(Pn).deleteGroupSystemNotice({messageList:this._messageListHandler.getLocalMessageList(e)}),Ji({conversationID:e})):Xi({code:gi.CONVERSATION_UN_RECORDED_TYPE});n.type=2,n.toGroupID=e.replace(S.CONV_GROUP,"")}var r="".concat(this._n,".").concat("clearHistoryMessage"),i=new Ai("clearHistoryMessage");return i.setMessage("conversationID:".concat(e)),Ve.l("".concat(r,". conversationID:").concat(e)),this.setMessageRead({conversationID:e}).then((function(){return t.request({protocolName:Po,requestData:n})})).then((function(){i.setNetworkType(t.getNetworkType()).end(),Ve.l("".concat(r," ok")),t._messageListHandler.removeByConversationID(e),t.setCompleted(e);var n=t.getLocalConversation(e);return n&&(n.updateLastMessage(),t._sortConversationListAndEmitEvent()),Ji({conversationID:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];i.setError(e,o,r).end()})),Ve.e("".concat(r," failed. error:"),e),Xi(e)}))}},{key:"pinConversation",value:function(e){var t=this,n=e.conversationID,o=e.isPinned;if(!this._conversationMap.has(n))return Xi({code:gi.CONVERSATION_NOT_FOUND});var r=this.getLocalConversation(n);if(r.isPinned===o)return Ji({conversationID:n});var i="".concat(this._n,".").concat("pinConversation"),s=new Ai("pinConversation");s.setMessage("conversationID:".concat(n," isPinned:").concat(o)),Ve.l("".concat(i,". conversationID:").concat(n," isPinned:").concat(o));var a=null;return St(n)?a={type:1,toAccount:n.replace(S.CONV_C2C,"")}:Lt(n)&&(a={type:2,groupID:n.replace(S.CONV_GROUP,"")}),this.request({protocolName:Go,requestData:{fromAccount:this.getMyUserID(),operationType:!0===o?1:2,itemList:[a]}}).then((function(){return s.setNetworkType(t.getNetworkType()).end(),Ve.l("".concat(i," ok")),r.isPinned!==o&&(r.isPinned=o,t._sortConversationListAndEmitEvent()),zi({conversationID:n})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];s.setError(e,o,r).end()})),Ve.e("".concat(i," failed. error:"),e),Xi(e)}))}},{key:"setMessageRemindType",value:function(e){return this._messageRemindHandler.set(e)}},{key:"patchMessageRemindType",value:function(e){var t=e.ID,n=e.isC2CConversation,o=e.messageRemindType,r=!1,i=this.getLocalConversation(n?"".concat(S.CONV_C2C).concat(t):"".concat(S.CONV_GROUP).concat(t));return i&&i.messageRemindType!==o&&(i.messageRemindType=o,r=!0),Ve.d("".concat(this._n,".patchMessageRemindType options:"),e,"ret:".concat(r)),r}},{key:"onC2CMessageRemindTypeSynced",value:function(e){var t=this,n="".concat(this._n,".onC2CMessageRemindTypeSynced");Ve.d(n,e),e.dataList.forEach((function(e){if(!$t(e.muteNotificationsSync)){var o,r=e.muteNotificationsSync,i=r.to,s=r.updateSequence,a=r.muteFlag;t._messageRemindHandler.setUpdateSequence(s),0===a?o=S.MSG_REMIND_ACPT_AND_NOTE:1===a?o=S.MSG_REMIND_DISCARD:2===a&&(o=S.MSG_REMIND_ACPT_NOT_NOTE);var c=0;t.patchMessageRemindType({ID:i,isC2CConversation:!0,messageRemindType:o})&&(c+=1),Ve.l("".concat(n," updateCount:").concat(c)),c>=1&&t.emitConversationUpdate(!0,!1)}}))}},{key:"onGroupMessageRemindTypeSynced",value:function(e){Ve.d("".concat(this._n,".onGroupMessageRemindTypeSynced options:"),e),this._messageRemindHandler.onGroupMessageRemindTypeUpdated(e)}},{key:"deleteLocalConversation",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this._conversationMap.has(e);if(Ve.d("".concat(this._n,".deleteLocalConversation conversationID:").concat(e," has:").concat(n)),n&&(this._conversationMap.delete(e),this._roamingMessageKeyAndTimeMap.has(e)&&this._roamingMessageKeyAndTimeMap.delete(e),this._roamingMessageSequenceMap.has(e)&&this._roamingMessageSequenceMap.delete(e),this._setStorageConversationList(),this._messageListHandler.removeByConversationID(e),this._completedMap.delete(e),t)){var o=!this._isTopicConversation(e);this.emitConversationUpdate(o,!1)}}},{key:"deleteLocalConversationList",value:function(e){var t=this,n=0,o=!1;e.forEach((function(e){t._conversationMap.has(e)&&(n+=t._conversationMap.get(e).unreadCount||0,t.deleteLocalConversation(e,!1),o=!0)})),Ve.l("".concat(this._n,".deleteLocalConversationList conversationIDList.length:").concat(e.length," isConvIDExisted:").concat(o)),o&&(this.emitConversationUpdate(!0,!1),n>0&&this.emitTotalUnreadMessageCountUpdate())}},{key:"isMessageSentByCurrentInstance",value:function(e){return!(!this._messageListHandler.hasLocalMessage(e.conversationID,e.ID)&&!this.singlyLinkedList.has(e.random))}},{key:"modifyMessageList",value:function(e){if(e.startsWith(S.CONV_C2C)&&this._conversationMap.has(e)){var t=this._conversationMap.get(e),n=Date.now();this._messageListHandler.modifyMessageSentByPeer({conversationID:e,latestNick:t.userProfile.nick,latestAvatar:t.userProfile.avatar});var o=this.getModule(bn).getNickAndAvatarByUserID(this.getMyUserID());this._messageListHandler.modifyMessageSentByMe({conversationID:e,latestNick:o.nick,latestAvatar:o.avatar}),Ve.l("".concat(this._n,".modifyMessageList conversationID:").concat(e," cost ").concat(Date.now()-n," ms"))}}},{key:"updateUserProfileSpecifiedKey",value:function(e){Ve.l("".concat(this._n,".updateUserProfileSpecifiedKey options:"),e);var t=e.conversationID,n=e.nick,o=e.avatar;if(this._conversationMap.has(t)){var r=this._conversationMap.get(t).userProfile;ot(n)&&r.nick!==n&&(r.nick=n),ot(o)&&r.avatar!==o&&(r.avatar=o),this.emitConversationUpdate(!0,!1)}}},{key:"_onMyProfileModified",value:function(e){var t=this,o=this.getLocalConversationList(),r=Date.now();o.forEach((function(o){t.modifyMessageSentByMe(n({conversationID:o.conversationID},e))})),Ve.l("".concat(this._n,"._onMyProfileModified. modify all messages sent by me, cost ").concat(Date.now()-r," ms"))}},{key:"modifyMessageSentByMe",value:function(e){this._messageListHandler.modifyMessageSentByMe(e)}},{key:"getLatestMessageSentByMe",value:function(e){return this._messageListHandler.getLatestMessageSentByMe(e)}},{key:"modifyMessageSentByPeer",value:function(e){this._messageListHandler.modifyMessageSentByPeer(e)}},{key:"getLatestMessageSentByPeer",value:function(e){return this._messageListHandler.getLatestMessageSentByPeer(e)}},{key:"pushIntoNoticeResult",value:function(e,t){return!(!this._messageListHandler.pushIn(t)||this.singlyLinkedList.has(t.random)||(e.push(t),0))}},{key:"getLocalLastMessage",value:function(e){return this._messageListHandler.getLocalLastMessage(e)}},{key:"checkAndPatchRemark",value:function(){var e=Promise.resolve();if(0===this._conversationMap.size)return e;var t=this.getModule(Gn);if(!t)return e;var n=y(this._conversationMap.values()).filter((function(e){return e.type===S.CONV_C2C}));if(0===n.length)return e;var o=0;return n.forEach((function(e){var n=e.conversationID.replace(S.CONV_C2C,"");if(t.isMyFriend(n)){var r=t.getFriendRemark(n);e.remark!==r&&(e.remark=r,o+=1)}})),Ve.l("".concat(this._n,".checkAndPatchRemark. c2c conversation count:").concat(n.length,", patched count:").concat(o)),e}},{key:"updateTopicConversation",value:function(e){this._updateLocalConversationList({conversationOptionsList:e,isFromGetConversations:!0})}},{key:"sendReadReceipt",value:function(e){var t=e[0],n=null;return t.conversationType===S.CONV_C2C?n=this._m.getModule(Un):t.conversationType===S.CONV_GROUP&&(n=this._m.getModule(Pn)),n?n.sendReadReceipt(e):Xi({code:gi.CANNOT_FIND_MODULE})}},{key:"getReadReceiptList",value:function(e){var t=e[0],n=null;return t.conversationType===S.CONV_C2C?n=this._m.getModule(Un):t.conversationType===S.CONV_GROUP&&(n=this._m.getModule(Pn)),n?n.getReadReceiptList(e):Xi({code:gi.CANNOT_FIND_MODULE})}},{key:"getLastMessageTime",value:function(e){var t=this.getLocalConversation(e);return t?t.lastMessage.lastTime:0}},{key:"getTotalUnreadMessageCount",value:function(){var e=this.getLocalConversationList(),t=0;return e.forEach((function(e){e.type!==S.CONV_SYSTEM&&(""!==e.messageRemindType&&e.messageRemindType!==S.MSG_REMIND_ACPT_AND_NOTE||(t+=e.unreadCount))})),t}},{key:"emitTotalUnreadMessageCountUpdate",value:function(){var e=this.getTotalUnreadMessageCount();this._convTotalUnreadCount!==e&&(Ve.l("".concat(this._n,".emitTotalUnreadMessageCountUpdate from ").concat(this._convTotalUnreadCount," to ").concat(e)),this._convTotalUnreadCount=e,this.emitOuterEvent(D.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED))}},{key:"reset",value:function(){Ve.l("".concat(this._n,".reset")),this._pagingStatus=en.NOT_START,this._messageListHandler.reset(),this._messageRemindHandler.reset(),this._roamingMessageKeyAndTimeMap.clear(),this._roamingMessageSequenceMap.clear(),this.singlyLinkedList.reset(),this._peerReadTimeMap.clear(),this._completedMap.clear(),this._conversationMap.clear(),this._pagingTimeStamp=0,this._pagingStartIndex=0,this._pagingPinnedTimeStamp=0,this._pagingPinnedStartIndex=0,this._remoteGroupReadSequenceMap.clear(),this._convTotalUnreadCount=0,this._pagingGetCostList.length=0,this.resetReady()}}]),o}(co),Is=function(){function e(t){r(this,e),this._groupModule=t,this._n="GroupTipsHandler",this._cachedGroupTipsMap=new Map,this._checkCountMap=new Map,this.MAX_CHECK_COUNT=4,this._getTopicPendingMap=new Map}return s(e,[{key:"onCheckTimer",value:function(e){e%1==0&&this._cachedGroupTipsMap.size>0&&this._checkCachedGroupTips()}},{key:"_checkCachedGroupTips",value:function(){var e=this;this._cachedGroupTipsMap.forEach((function(t,n){var o=e._checkCountMap.get(n),r=e._groupModule.hasLocalGroup(n);Ve.l("".concat(e._n,"._checkCachedGroupTips groupID:").concat(n," hasLocalGroup:").concat(r," checkCount:").concat(o)),r?(e._notifyCachedGroupTips(n),e._checkCountMap.delete(n),e._groupModule.deleteUnjoinedAVChatRoom(n)):o>=e.MAX_CHECK_COUNT?(e._deleteCachedGroupTips(n),e._checkCountMap.delete(n)):(o++,e._checkCountMap.set(n,o))}))}},{key:"onNewGroupTips",value:function(e){Ve.d("".concat(this._n,".onReceiveGroupTips count:").concat(e.dataList.length));var t=this.newGroupTipsStoredAndSummary(e),n=t.eventDataList,o=t.result,r=t.AVChatRoomMessageList;r.length>0&&this._groupModule.onAVChatRoomMessage(r),n.length>0&&(this._groupModule.updateNextMessageSeq(n),this._groupModule.getModule(qn).onNewMessage({conversationOptionsList:n,isInstantMessage:!0})),o.length>0&&(this._groupModule.emitOuterEvent(D.MESSAGE_RECEIVED,o),this.handleMessageList(o))}},{key:"newGroupTipsStoredAndSummary",value:function(e){for(var t=this,o=e.event,r=e.dataList,i=null,s=[],a=[],c={},u=[],l=function(e,l){var d=Ct(r[e]);if(6===o){if(t._groupModule.isGroupAttributesUpdatedNotice(d))return"continue";if(t._groupModule.isGroupCountersNotice(d))return"continue"}var p=d.groupProfile,h=p.groupID,g=p.communityType,f=void 0===g?0:g,_=p.topicID,m=void 0===_?void 0:_,v=p.invisible,y=void 0,M=t._groupModule.isMessageFromTopic(f,m);if(M){y=S.CONV_TOPIC,d.to=m;var I=t._groupModule.getModule(Fn);I.hasLocalTopic(h,m)||t._getTopicPendingMap.has(m)||(t._getTopicPendingMap.set(m,1),I.getTopicList({groupID:h,topicIDList:[m]}).finally((function(){t._getTopicPendingMap.delete(m)})))}var C=t._groupModule.hasLocalGroup(h);if(!C&&t._groupModule.isUnjoinedAVChatRoom(h))return"continue";if(!C&&!M)return t._cacheGroupTipsAndProbe({groupID:h,event:o,item:d}),"continue";if(t._groupModule.isMessageFromOrToAVChatroom(h))return d.event=o,u.push(d),"continue";if(d.currentUser=t._groupModule.getMyUserID(),d.conversationType=S.CONV_GROUP,(i=new ji(d)).setElement({type:S.MSG_GRP_TIP,content:n(n({},d.elements),{},{groupProfile:d.groupProfile})}),i.isSystemMessage=!1,1===v)return t._qualityStat(i),"continue";var T=t._groupModule.getModule(qn),E=i,k=E.conversationID,D=E.sequence;if(6===o)i._onlineOnlyFlag=!0,a.push(i);else if(!T.pushIntoNoticeResult(a,i))return"continue";if(t._groupModule.isMessageFromCommunityOfTopic(f,m))return"continue";if(6===o&&T.getLocalConversation(k))return"continue";6!==o&&t._qualityStat(i);var L=T.isRemoteRead({conversationID:k,sequence:D});if(at(c[k])){var A=0;"in"===i.flow&&(i._isExcludedFromUnreadCount||i._onlineOnlyFlag||L||(A=1)),c[k]=s.push({conversationID:k,unreadCount:A,type:at(y)?i.conversationType:y,subType:i.conversationSubType,lastMessage:i._isExcludedFromLastMessage?"":i})-1}else{var R=c[k];s[R].type=i.conversationType,s[R].subType=i.conversationSubType,s[R].lastMessage=i._isExcludedFromLastMessage?"":i,"in"===i.flow&&(i._isExcludedFromUnreadCount||i._onlineOnlyFlag||L||s[R].unreadCount++)}},d=0,p=r.length;d<p;d++)l(d);return{eventDataList:s,result:a,AVChatRoomMessageList:u}}},{key:"_qualityStat",value:function(e){this._groupModule.getModule(to).addMessageSequence({key:Ci,message:e})}},{key:"handleMessageList",value:function(e){var t=this;e.forEach((function(e){switch(e.payload.operationType){case 1:t._onNewMemberComeIn(e);break;case 2:t._onMemberQuit(e);break;case 3:t._onMemberKickedOut(e);break;case 4:t._onMemberSetAdmin(e);break;case 5:t._onMemberCancelledAdmin(e);break;case 6:t._onGroupProfileModified(e);break;case 7:t._onMemberInfoModified(e);break;case 8:t._onTopicProfileUpdated(e);break;default:Ve.w("".concat(t._n,".handleMessageList unknown operationType:").concat(e.payload.operationType))}}))}},{key:"_onNewMemberComeIn",value:function(e){var t=e.payload,n=t.memberNum,o=t.groupProfile.groupID,r=this._groupModule.getLocalGroupProfile(o);r&&nt(n)&&r.memberCount!==n&&(r.memberCount=n,this._updateConversationGroupProfile(r))}},{key:"_onMemberQuit",value:function(e){var t=e.payload,n=t.memberNum,o=t.groupProfile.groupID,r=this._groupModule.getLocalGroupProfile(o);r&&nt(n)&&r.memberCount!==n&&(r.memberCount=n,this._updateConversationGroupProfile(r)),this._groupModule.getModule(xn).deleteLocalGroupMembers(o,e.payload.userIDList)}},{key:"_onMemberKickedOut",value:function(e){var t=e.payload,n=t.memberNum,o=t.groupProfile.groupID,r=this._groupModule.getLocalGroupProfile(o);r&&nt(n)&&r.memberCount!==n&&(r.memberCount=n,this._updateConversationGroupProfile(r)),this._groupModule.getModule(xn).deleteLocalGroupMembers(o,e.payload.userIDList)}},{key:"_updateConversationGroupProfile",value:function(e){this._groupModule.getModule(qn).updateConversationGroupProfile([e])}},{key:"_onMemberSetAdmin",value:function(e){var t=e.payload.groupProfile.groupID,n=e.payload.userIDList,o=this._groupModule.getModule(xn);n.forEach((function(e){var n=o.getLocalGroupMemberInfo(t,e);n&&n.updateRole(S.GRP_MBR_ROLE_ADMIN)}))}},{key:"_onMemberCancelledAdmin",value:function(e){var t=e.payload.groupProfile.groupID,n=e.payload.userIDList,o=this._groupModule.getModule(xn);n.forEach((function(e){var n=o.getLocalGroupMemberInfo(t,e);n&&n.updateRole(S.GRP_MBR_ROLE_MEMBER)}))}},{key:"_onGroupProfileModified",value:function(e){var t=this,n=e.payload,o=n.newGroupProfile,r=n.groupProfile.groupID,i=this._groupModule.getLocalGroupProfile(r);Object.keys(o).forEach((function(e){switch(e){case"ownerID":t._ownerChanged(i,o);break;case"groupName":i.name=o[e];break;default:i[e]=o[e]}}));var s=!i.isSupportTopic;this._groupModule.emitGroupListUpdate(!0,s)}},{key:"_ownerChanged",value:function(e,t){var n=e.groupID,o=this._groupModule.getLocalGroupProfile(n),r=this._groupModule.getMyUserID();if(r===t.ownerID){o.updateGroup({selfInfo:{role:S.GRP_MBR_ROLE_OWNER}});var i=this._groupModule.getModule(xn),s=i.getLocalGroupMemberInfo(n,r),a=this._groupModule.getLocalGroupProfile(n).ownerID,c=i.getLocalGroupMemberInfo(n,a);s&&s.updateRole(S.GRP_MBR_ROLE_OWNER),c&&c.updateRole(S.GRP_MBR_ROLE_MEMBER)}}},{key:"_onMemberInfoModified",value:function(e){var t=e.to,n=e.payload,o=n.groupProfile,r=n.memberList,i=o.groupID;Dt(t)&&this._updateTopicMuteTime(e);var s=this._groupModule.getModule(xn);r.forEach((function(e){var t=s.getLocalGroupMemberInfo(i,e.userID);t&&nt(e.muteTime)&&t.updateMuteUntil(e.muteTime)}))}},{key:"_updateTopicMuteTime",value:function(e){var t=e.to,n=e.payload,o=n.groupProfile,r=n.memberList,i=void 0===r?[]:r,s=this._groupModule.getModule(Fn),a=o.groupID,c=s.getLocalTopic(a,t);if(c){for(var u=!1,l=0;l<i.length;l++){var d=i[l];if(d.userID===this._groupModule.getMyUserID()&&d.muteTime>=0){c.updateSelfInfo({muteTime:d.muteTime}),u=!0;break}}u&&this._groupModule.emitOuterEvent(D.TOPIC_UPDATED,{groupID:a,topic:c})}}},{key:"_onTopicProfileUpdated",value:function(e){var t=e.payload,o=t.groupProfile.groupID,r=t.newTopicInfo;this._groupModule.getModule(Fn).onTopicProfileUpdated(n({groupID:o,topicID:e.to},r))}},{key:"_cacheGroupTips",value:function(e,t){this._cachedGroupTipsMap.has(e)||this._cachedGroupTipsMap.set(e,[]),this._cachedGroupTipsMap.get(e).push(t)}},{key:"_deleteCachedGroupTips",value:function(e){this._cachedGroupTipsMap.has(e)&&this._cachedGroupTipsMap.delete(e)}},{key:"_notifyCachedGroupTips",value:function(e){var t=this,n=this._cachedGroupTipsMap.get(e)||[];n.forEach((function(e){t.onNewGroupTips(e)})),this._deleteCachedGroupTips(e),Ve.l("".concat(this._n,"._notifyCachedGroupTips groupID:").concat(e," count:").concat(n.length))}},{key:"_cacheGroupTipsAndProbe",value:function(e){var t=this,n=e.groupID,o=e.event,r=e.item;this._cacheGroupTips(n,{event:o,dataList:[r]}),this._groupModule.getGroupSimplifiedInfo(n).then((function(e){e.type===S.GRP_AVCHATROOM?t._groupModule.hasLocalGroup(n)?t._notifyCachedGroupTips(n):t._groupModule.setUnjoinedAVChatRoom(n):(t._groupModule.updateGroupMap([e]),t._notifyCachedGroupTips(n))})),this._checkCountMap.has(n)||this._checkCountMap.set(n,0),Ve.l("".concat(this._n,"._cacheGroupTipsAndProbe groupID:").concat(n))}},{key:"reset",value:function(){this._cachedGroupTipsMap.clear(),this._checkCountMap.clear(),this._getTopicPendingMap.clear()}}]),e}(),Cs=function(){function e(t){r(this,e),this._groupModule=t,this._n="CommonGroupHandler",this.tempConversationList=null,this._cachedGroupMessageMap=new Map,this._checkCountMap=new Map,this.MAX_CHECK_COUNT=4,this._getTopicPendingMap=new Map,this._isPagingGetCompleted=!1,t.getInnerEmitterInstance().once(es,this._initGroupList,this)}return s(e,[{key:"onCheckTimer",value:function(e){e%1==0&&this._cachedGroupMessageMap.size>0&&this._checkCachedGroupMessage()}},{key:"_checkCachedGroupMessage",value:function(){var e=this;this._cachedGroupMessageMap.forEach((function(t,n){var o=e._checkCountMap.get(n),r=e._groupModule.hasLocalGroup(n);Ve.l("".concat(e._n,"._checkCachedGroupMessage groupID:").concat(n," hasLocalGroup:").concat(r," checkCount:").concat(o)),r?(e._notifyCachedGroupMessage(n),e._checkCountMap.delete(n),e._groupModule.deleteUnjoinedAVChatRoom(n)):o>=e.MAX_CHECK_COUNT?(e._deleteCachedGroupMessage(n),e._checkCountMap.delete(n)):(o++,e._checkCountMap.set(n,o))}))}},{key:"_initGroupList",value:function(){var e=this;Ve.l("".concat(this._n,"._initGroupList"));var t=new Ai("getGroupListInStorage"),n=this._groupModule.getStorageGroupList();if(st(n)&&n.length>0){n.forEach((function(t){e._groupModule.initGroupMap(t)})),this._groupModule.emitGroupListUpdate(!0,!1);var o=this._groupModule.getLocalGroupList().length;t.setNetworkType(this._groupModule.getNetworkType()).setMessage("group count:".concat(o)).end()}else t.setNetworkType(this._groupModule.getNetworkType()).setMessage("group count:0").end();Ve.l("".concat(this._n,"._initGroupList ok"))}},{key:"handleUpdateGroupLastMessage",value:function(e){var t="".concat(this._n,".handleUpdateGroupLastMessage");if(Ve.l("".concat(t," conversation count:").concat(e.length,", local group count:").concat(this._groupModule.getLocalGroupList().length)),0!==this._groupModule.getGroupMap().size){for(var o,r,i,s=!1,a=0,c=e.length;a<c;a++)(o=e[a]).type===S.CONV_GROUP&&(r=o.conversationID.split(/^GROUP/)[1],(i=this._groupModule.getLocalGroupProfile(r))&&(i.lastMessage=n({},o.lastMessage),s=!0));s&&(this._groupModule.sortLocalGroupList(),this._groupModule.emitGroupListUpdate(!0,!1))}else this.tempConversationList=e}},{key:"onNewGroupMessage",value:function(e){Ve.d("".concat(this._n,".onNewGroupMessage count:").concat(e.dataList.length));var t=this._newGroupMessageStoredAndSummary(e),n=t.conversationOptionsList,o=t.messageList,r=t.AVChatRoomMessageList;r.length>0&&this._groupModule.onAVChatRoomMessage(r),this._groupModule.filterModifiedMessage(o),n.length>0&&(this._groupModule.updateNextMessageSeq(n),this._groupModule.getModule(qn).onNewMessage({conversationOptionsList:n,isInstantMessage:e.isInstantMessage||!0,updateUnreadCount:e.updateUnreadCount||!0}));var i=this._groupModule.filterUnmodifiedMessage(o);i.length>0&&this._groupModule.emitOuterEvent(D.MESSAGE_RECEIVED,i),o.length=0}},{key:"_newGroupMessageStoredAndSummary",value:function(e){var t=this,n=e.dataList,o=e.event,r=e.isInstantMessage,i=null,s=[],a=[],c=[],u={},l=this._groupModule.getModule(jn),d=this._groupModule.getFileDownloadProxy(),p=n.length;p>1&&n.sort((function(e,t){return e.sequence-t.sequence}));for(var h=function(e){var p=Ct(n[e]),h=p.groupProfile,g=h.groupID,f=h.communityType,_=void 0===f?0:f,m=h.topicID,v=void 0===m?void 0:m,y=h.invisible,M=void 0,I=t._groupModule.isMessageFromTopic(_,v);if(I){M=S.CONV_TOPIC,p.to=v;var C=t._groupModule.getModule(Fn);C.hasLocalTopic(g,v)||t._getTopicPendingMap.has(v)||(t._getTopicPendingMap.set(v,1),C.getTopicList({groupID:g,topicIDList:[v]}).finally((function(){t._getTopicPendingMap.delete(v)})))}var T=t._groupModule.hasLocalGroup(g);if(!T&&t._groupModule.isUnjoinedAVChatRoom(g))return"continue";if(!T&&!I)return t._cacheGroupMessageAndProbe({groupID:g,event:o,item:p}),"continue";if(t._groupModule.isMessageFromOrToAVChatroom(g))return p.event=o,c.push(p),"continue";if(p.currentUser=t._groupModule.getMyUserID(),p.conversationType=S.CONV_GROUP,p.isSystemMessage=!!p.isSystemMessage,i=new ji(p),p.elements=l.parseElements(p.elements,p.from),i.setElement(p.elements,d),1===y)return t._qualityStat(r,i),"continue";var E=1===n[e].isModified,k=t._groupModule.getModule(qn);if(k.isMessageSentByCurrentInstance(i)?i.isModified=E:E=!1,1===p.onlineOnlyFlag)i._onlineOnlyFlag=!0,k.isMessageSentByCurrentInstance(i)||a.push(i);else{if(t._groupModule.isMessageFromCommunityOfTopic(_,v))return a.push(i),"continue";if(!k.pushIntoMessageList(a,i,E))return"continue";t._qualityStat(r,i);var D=i,L=D.conversationID,A=D.sequence,R=k.isRemoteRead({conversationID:L,sequence:A});if(at(u[L])){var O=0;"in"===i.flow&&(i._isExcludedFromUnreadCount||R||(O=1)),u[L]=s.push({conversationID:L,unreadCount:O,type:at(M)?i.conversationType:M,subType:i.conversationSubType,lastMessage:i._isExcludedFromLastMessage?"":i})-1}else{var N=u[L];s[N].type=at(M)?i.conversationType:M,s[N].subType=i.conversationSubType,s[N].lastMessage=i._isExcludedFromLastMessage?"":i,"in"===i.flow&&(i._isExcludedFromUnreadCount||R||s[N].unreadCount++)}}},g=0;g<p;g++)h(g);return{conversationOptionsList:s,messageList:a,AVChatRoomMessageList:c}}},{key:"_qualityStat",value:function(e,t){var n=this._groupModule.getModule(to);n.addMessageSequence({key:Ci,message:t}),e&&t.clientTime>0&&n.addMessageDelay(t.clientTime)}},{key:"onGroupMessageRevoked",value:function(e){var t=this._groupModule.getModule(qn),n=[],o=null,r=!0;e.dataList.forEach((function(e){var i=e.elements.revokedInfos;at(i)||i.forEach((function(e){var i=$t(e.topicID)?"GROUP".concat(e.groupID):"GROUP".concat(e.topicID);o=t.revoke(i,e.sequence,e.random);var s=e.revokerInfo&&e.revokerInfo.revoker;if(o)o.revoker=s,n.push(o);else{var a={conversationID:i,to:e.topicID||"",sequence:e.sequence,time:e.time,revoker:s};t.isLastMessageRevoked(a)&&(n.push(a),r=!1)}}))})),0!==n.length&&(t.onMessageRevoked(n),!0===r&&(Ve.l("".concat(this._n,".onGroupMessageRevoked count:").concat(n.length)),this._groupModule.emitOuterEvent(D.MESSAGE_REVOKED,n)))}},{key:"_groupListTreeShaking",value:function(e){for(var t=new Map(y(this._groupModule.getGroupMap())),n=0,o=e.length;n<o;n++)t.delete(e[n].groupID);this._groupModule.hasJoinedAVChatRoom()&&this._groupModule.getJoinedAVChatRoom().forEach((function(e){t.delete(e)})),this._groupModule.getGroupMap().forEach((function(e,n){e.isSupportTopic&&t.delete(n)}));for(var r=y(t.keys()),i=0,s=r.length;i<s;i++)this._groupModule.deleteGroup(r[i])}},{key:"getGroupList",value:function(e){var t=this,n="".concat(this._n,".").concat("getGroupList"),o=new Ai("getGroupList");Ve.l("".concat(n));var r={introduction:"Introduction",notification:"Notification",createTime:"CreateTime",ownerID:"Owner_Account",lastInfoTime:"LastInfoTime",memberNum:"MemberNum",maxMemberNum:"MaxMemberNum",joinOption:"ApplyJoinOption",inviteOption:"InviteJoinOption",muteAllMembers:"ShutUpAllMember"},i=["Type","Name","FaceUrl","NextMsgSeq","LastMsgTime","AtInfoList","LastRecallTime"],s=[];e&&e.groupProfileFilter&&e.groupProfileFilter.forEach((function(e){r[e]&&i.push(r[e])}));var a=(e||{}).isGroupWithTopicOnly,c=void 0!==a&&a;return this._pagingGetGroupList({limit:50,offset:0,groupBaseInfoFilter:i,groupList:s,isGroupWithTopicOnly:c}).then((function(){Ve.l("".concat(n," ok. count:").concat(s.length," isGroupWithTopicOnly:").concat(c)),c||t._groupListTreeShaking(s),t._groupModule.updateGroupMap(s);var e=t._groupModule.getLocalGroupList().length;o.setNetworkType(t._groupModule.getNetworkType()).setMessage("remote count:".concat(s.length,", after tree shaking, local count:").concat(e,", isGroupWithTopicOnly:").concat(c)).end(),t.tempConversationList&&(t.handleUpdateGroupLastMessage(t.tempConversationList),t.tempConversationList=null),t._groupModule.patchGroupMessageRemindType(),t._groupModule.recomputeUnreadCount(),t._groupModule.emitGroupListUpdate(!0,!c);var r=t._groupModule.getLocalGroupList();if(c){var i=r.filter((function(e){return!0===e.isSupportTopic}));return zi({groupList:i})}return t._isPagingGetCompleted=!0,zi({groupList:r})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=v(t,2),r=n[0],i=n[1];o.setError(e,r,i).end()})),Ve.e("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"isPagingGetCompleted",value:function(){return this._isPagingGetCompleted}},{key:"_pagingGetGroupList",value:function(e){var t=this,n="".concat(this._n,".").concat("_pagingGetGroupList"),o=e.isCommunityRelay,r=void 0!==o&&o,i=e.isGroupWithTopicOnly,s=void 0!==i&&i,a=e.limit,c=e.offset,u=e.groupBaseInfoFilter,l=e.groupList;if(s)return this._pagingGetGroupListWithTopic({limit:a,offset:c,groupBaseInfoFilter:u,groupList:l});var d=new Ai("_pagingGetGroupList");return this._groupModule.request({protocolName:Wo,requestData:{type:r?S.GRP_COMMUNITY:void 0,memberAccount:this._groupModule.getMyUserID(),limit:a,offset:c,responseFilter:{groupBaseInfoFilter:u,selfInfoFilter:["Role","JoinTime","MsgFlag","MsgSeq"]}}}).then((function(e){var o=e.data,i=o.groups,s=void 0===i?[]:i,p=o.totalCount;l.push.apply(l,y(s)),t._handleGroupAtInfoWithoutTopic(r,s);var h=c+a,g=!(p>h),f="offset:".concat(c," totalCount:").concat(p," isCompleted:").concat(g," ")+"currentCount:".concat(l.length," isCommunityRelay:").concat(r);return d.setNetworkType(t._groupModule.getNetworkType()).setMessage("".concat(f)).end(),r||g?!r&&g?(Ve.l("".concat(n," start to get community list")),c=0,t._pagingGetGroupList({limit:a,offset:c,groupBaseInfoFilter:u,groupList:l,isCommunityRelay:!0})):r&&!g?(c=h,t._pagingGetGroupList({limit:a,offset:c,groupBaseInfoFilter:u,groupList:l,isCommunityRelay:!0})):(Ve.l("".concat(n," ok. totalCount:").concat(l.length)),zi({groupList:l})):(c=h,t._pagingGetGroupList({limit:a,offset:c,groupBaseInfoFilter:u,groupList:l}))})).catch((function(e){return 11e3!==e.code&&t._groupModule.probeNetwork().then((function(t){var n=v(t,2),o=n[0],i=n[1];d.setMessage("isCommunityRelay:".concat(r)).setError(e,o,i).end()})),r?(11e3===e.code&&(d=null,Ve.l("".concat(n," ok. community unavailable"))),Ji({groupList:l})):Xi(e)}))}},{key:"_pagingGetGroupListWithTopic",value:function(e){var t=this,n="".concat(this._n,"._pagingGetGroupListWithTopic"),o=e.limit,r=e.offset,i=e.groupBaseInfoFilter,s=e.groupList,a=new Ai("pagingGetGroupListWithTopic");return this._groupModule.request({protocolName:Wo,requestData:{type:S.GRP_COMMUNITY,memberAccount:this._groupModule.getMyUserID(),limit:o,offset:r,responseFilter:{groupBaseInfoFilter:i,selfInfoFilter:["Role","JoinTime","MsgFlag","MsgSeq"]},isSupportTopic:1}}).then((function(e){var c=e.data,u=c.groups,l=void 0===u?[]:u,d=c.totalCount;s.push.apply(s,y(l));var p=r+o,h=!(d>p),g="offset:".concat(r," totalCount:").concat(d," isCompleted:").concat(h," ")+"currentCount:".concat(s.length);return a.setNetworkType(t._groupModule.getNetworkType()).setMessage("".concat(g)).end(),h?(Ve.l("".concat(n," ok. totalCount:").concat(s.length)),zi({groupList:s})):(r=p,t._pagingGetGroupListWithTopic({limit:o,offset:r,groupBaseInfoFilter:i,groupList:s}))})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];a.setError(e,o,r).end()})),Xi(e)}))}},{key:"_cacheGroupMessage",value:function(e,t){this._cachedGroupMessageMap.has(e)||this._cachedGroupMessageMap.set(e,[]),this._cachedGroupMessageMap.get(e).push(t)}},{key:"_deleteCachedGroupMessage",value:function(e){this._cachedGroupMessageMap.has(e)&&this._cachedGroupMessageMap.delete(e)}},{key:"_notifyCachedGroupMessage",value:function(e){var t=this,n=this._cachedGroupMessageMap.get(e)||[];n.forEach((function(e){t.onNewGroupMessage(e)})),this._deleteCachedGroupMessage(e),Ve.l("".concat(this._n,"._notifyCachedGroupMessage groupID:").concat(e," count:").concat(n.length))}},{key:"_cacheGroupMessageAndProbe",value:function(e){var t=this,n=e.groupID,o=e.event,r=e.item;this._cacheGroupMessage(n,{event:o,dataList:[r]}),this._groupModule.getGroupSimplifiedInfo(n).then((function(e){e.type===S.GRP_AVCHATROOM?t._groupModule.hasLocalGroup(n)?t._notifyCachedGroupMessage(n):t._groupModule.setUnjoinedAVChatRoom(n):(t._groupModule.updateGroupMap([e]),t._notifyCachedGroupMessage(n))})),this._checkCountMap.has(n)||this._checkCountMap.set(n,0),Ve.l("".concat(this._n,"._cacheGroupMessageAndProbe groupID:").concat(n))}},{key:"_handleGroupAtInfoWithoutTopic",value:function(e,t){var o=this;e&&0!==t.length&&t.forEach((function(e){var t=e.groupID,r=e.groupAtInfoList,i=[];at(r)||(r.forEach((function(e){i.push(n(n({},e),{},{groupID:t}))})),o._groupModule.getModule(qn).onNewGroupAtTips({dataList:i}))}))}},{key:"reset",value:function(){this._cachedGroupMessageMap.clear(),this._checkCountMap.clear(),this._getTopicPendingMap.clear(),this._isPagingGetCompleted=!1,this._groupModule.getInnerEmitterInstance().once(es,this._initGroupList,this)}}]),e}(),Ts=1,Es=2,ks=3,Ds=4,Ss=5,Ls=function(){function e(t){r(this,e),this._groupModule=t,this._n="GroupAttributesHandler",this._groupAttributesMap=new Map,this._groupAttributesCopy={},this.CACHE_EXPIRE_TIME=3e4,this._groupModule.getInnerEmitterInstance().on(ns,this._onCloudConfigUpdated,this)}return s(e,[{key:"_onCloudConfigUpdated",value:function(){var e=this._groupModule.getCloudConfig("grp_attr_cache_time");at(e)||(this.CACHE_EXPIRE_TIME=Number(e))}},{key:"updateLocalMainSequenceOnReconnected",value:function(){this._groupAttributesMap.forEach((function(e){e.localMainSequence=0}))}},{key:"isGroupAttributesUpdatedNotice",value:function(e){var t=e.to,n=e.elements.newGroupProfile,o=!at(n)&&!$t(n.groupAttributeOption);return o&&this._onGroupAttributesUpdated({groupID:t,groupAttributeOption:n.groupAttributeOption}),o}},{key:"_onGroupAttributesUpdated",value:function(e){var t=this,n=e.groupID,o=e.groupAttributeOption,r=o.mainSequence,i=o.isWithChangedAttributeInfo,s=o.groupAttributeList,a=void 0===s?[]:s,c=o.operationType;if(Ve.l("".concat(this._n,".onGroupAttributesUpdated. ")+"groupID:".concat(n," isWithChangedAttributeInfo:").concat(i," operationType:").concat(c)),!at(c)){this._groupAttributesCopy=this._getCachedAttributes({groupID:n});var u=r-this._getLocalGroupAttributes(n).localMainSequence;if(0!==u){if(1===i&&1===u)return this._refreshCachedGroupAttributes({groupID:n,remoteMainSequence:r,groupAttributeList:a,operationType:c}),void this._emitGroupAttributesUpdated(n);if(this._hasLocalGroupAttributes(n)){var l=this._getLocalGroupAttributes(n).avChatRoomKey;this._getGroupAttributes({groupID:n,avChatRoomKey:l}).then((function(){t._emitGroupAttributesUpdated(n)}))}}}}},{key:"initGroupAttributesCache",value:function(e){var t=e.groupID,n=e.avChatRoomKey,o=void 0===n?void 0:n;this._groupAttributesMap.set(t,{lastUpdateTime:0,localMainSequence:0,remoteMainSequence:0,attributes:new Map,avChatRoomKey:o}),Ve.l("".concat(this._n,".initGroupAttributesCache groupID:").concat(t," avChatRoomKey:").concat(o))}},{key:"initGroupAttributes",value:function(e){var t=this,n=e.groupID,o=e.groupAttributes,r=this._getLocalGroupAttributes(n),i=r.remoteMainSequence,s=r.avChatRoomKey,a=new Ai("initGroupAttributes");return a.setMessage("groupID:".concat(n," avChatRoomKey:").concat(s," mainSequence:").concat(i)),this._groupModule.request({protocolName:Ir,requestData:{groupID:n,avChatRoomKey:s,mainSequence:i,groupAttributeList:this._transformGroupAttributes(o)}}).then((function(e){Ve.l("".concat(t._n,".").concat("initGroupAttributes"," ok. groupID:").concat(n));var r=e.data,i=r.mainSequence,s=y(r.groupAttributeList);return s.forEach((function(e){e.value=o[e.key]})),t._groupAttributesCopy=t._getCachedAttributes({groupID:n}),t._refreshCachedGroupAttributes({groupID:n,remoteMainSequence:i,groupAttributeList:s,operationType:Ts}),t._emitGroupAttributesUpdated(n),a.setNetworkType(t._groupModule.getNetworkType()).end(),zi({groupAttributes:o})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];a.setError(e,o,r).end()})),Xi(e)}))}},{key:"setGroupAttributes",value:function(e){var t=this,n="".concat(this._n,".").concat("setGroupAttributes"),o=e.groupID,r=e.groupAttributes,i=this._getLocalGroupAttributes(o),s=i.remoteMainSequence,a=i.avChatRoomKey,c=i.attributes,u=this._transformGroupAttributes(r);u.forEach((function(e){var t=e.key;e.sequence=0,c.has(t)&&(e.sequence=c.get(t).sequence)}));var l=new Ai("setGroupAttributes");return l.setMessage("groupID:".concat(o," groupAttributes:").concat(JSON.stringify(r))),Ve.l("".concat(n,". groupID:").concat(o," mainSequence:").concat(s)),this._groupModule.request({protocolName:Cr,requestData:{groupID:o,avChatRoomKey:a,mainSequence:s,groupAttributeList:u}}).then((function(e){Ve.l("".concat(n," ok."));var i=e.data,s=i.mainSequence,a=y(i.groupAttributeList);return a.forEach((function(e){e.value=r[e.key]})),t._groupAttributesCopy=t._getCachedAttributes({groupID:o}),t._refreshCachedGroupAttributes({groupID:o,remoteMainSequence:s,groupAttributeList:a,operationType:Es}),t._emitGroupAttributesUpdated(o),l.setNetworkType(t._groupModule.getNetworkType()).end(),zi({groupAttributes:r})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];l.setError(e,o,r).end()})),Xi(e)}))}},{key:"deleteGroupAttributes",value:function(e){var t=this,n=e.groupID,o=e.keyList,r=void 0===o?[]:o,i=this._getLocalGroupAttributes(n),s=i.remoteMainSequence,a=i.avChatRoomKey,c=i.attributes,u=y(c.keys()),l=Er,d=ks,p={groupID:n,avChatRoomKey:a,mainSequence:s},h=[];r.length>0&&(u=[],l=Tr,d=Ds,r.forEach((function(e){var t=0;c.has(e)&&(t=c.get(e).sequence,u.push(e)),h.push({key:e,sequence:t})})),p.groupAttributeList=h);var g=new Ai("deleteGroupAttributes");return g.setMessage("groupID:".concat(n," mainSequence:").concat(s," keyList:").concat(r," protocolName:").concat(l)),this._groupModule.request({protocolName:l,requestData:p}).then((function(e){Ve.l("".concat(t._n,".").concat("deleteGroupAttributes"," ok. groupID:").concat(n));var o=e.data.mainSequence;return t._groupAttributesCopy=t._getCachedAttributes({groupID:n}),t._refreshCachedGroupAttributes({groupID:n,remoteMainSequence:o,groupAttributeList:h,operationType:d}),t._emitGroupAttributesUpdated(n),g.setNetworkType(t._groupModule.getNetworkType()).end(),zi({keyList:u})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];g.setError(e,o,r).end()})),Xi(e)}))}},{key:"getGroupAttributes",value:function(e){var t=this,n="".concat(this._n,".").concat("getGroupAttributes"),o=e.groupID,r=this._getLocalGroupAttributes(o),i=r.avChatRoomKey,s=r.lastUpdateTime,a=r.localMainSequence,c=r.remoteMainSequence,u=new Ai("getGroupAttributes");if(u.setMessage("groupID:".concat(o," localMainSequence:").concat(a," remoteMainSequence:").concat(c," keyList:").concat(e.keyList)),Date.now()-s>=this.CACHE_EXPIRE_TIME||a<c)return this._getGroupAttributes({groupID:o,avChatRoomKey:i}).then((function(r){u.setMoreMessage("get attributes from remote. count:".concat(r.length)).setNetworkType(t._groupModule.getNetworkType()).end(),Ve.l("".concat(n," from remote. groupID:").concat(o));var i=t._getCachedAttributes(e);return zi({groupAttributes:i})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];u.setError(e,o,r).end()})),Xi(e)}));u.setMoreMessage("get attributes from cache").setNetworkType(this._groupModule.getNetworkType()).end(),Ve.l("".concat(n," from cache. groupID:").concat(o));var l=this._getCachedAttributes(e);return Ji({groupAttributes:l})}},{key:"_getGroupAttributes",value:function(e){var t=this,o=0;return at(e.avChatRoomKey)||(o=1),this._groupModule.request({protocolName:kr,requestData:n(n({},e),{},{groupType:o})}).then((function(n){Ve.l("".concat(t._n,"._getGroupAttributes ok. groupID:").concat(e.groupID));var o=n.data,r=o.mainSequence,i=o.groupAttributeList,s=y(i);return at(r)||t._refreshCachedGroupAttributes({groupID:e.groupID,remoteMainSequence:r,groupAttributeList:s,operationType:Ss}),i})).catch((function(e){return Xi(e)}))}},{key:"_refreshCachedGroupAttributes",value:function(e){var t=e.groupID,n=e.remoteMainSequence,o=e.groupAttributeList,r=e.operationType;if(this._hasLocalGroupAttributes(t)){var i=this._getLocalGroupAttributes(t),s=i.localMainSequence;if(r===Ss||n-s==1)i.remoteMainSequence=n,i.localMainSequence=n,i.lastUpdateTime=Date.now(),this._updateCachedAttributes({groupAttributes:i,groupAttributeList:o,operationType:r});else{if(s===n)return;i.remoteMainSequence=n}this._groupAttributesMap.set(t,i);var a="operationType:".concat(r," localMainSequence:").concat(s," remoteMainSequence:").concat(n);Ve.l("".concat(this._n,"._refreshCachedGroupAttributes. ").concat(a))}}},{key:"_getCachedAttributes",value:function(e){var t=e.groupID,n=e.keyList,o=void 0===n?[]:n,r={};if(this._hasLocalGroupAttributes(t)){var i=this._getLocalGroupAttributes(t).attributes;if(o.length>0)o.forEach((function(e){i.has(e)&&(r[e]=i.get(e).value)}));else{var s,a=k(i.keys());try{for(a.s();!(s=a.n()).done;){var c=s.value;r[c]=i.get(c).value}}catch(u){a.e(u)}finally{a.f()}}}return r}},{key:"_updateCachedAttributes",value:function(e){var t=e.groupAttributes,n=e.groupAttributeList,o=e.operationType;o!==ks?o!==Ds?(o===Ts&&t.attributes.clear(),n.forEach((function(e){var n=e.key,o=e.value,r=e.sequence;t.attributes.set(n,{value:o,sequence:r})}))):n.forEach((function(e){t.attributes.delete(e.key)})):t.attributes.clear()}},{key:"_hasLocalGroupAttributes",value:function(e){return this._groupAttributesMap.has(e)}},{key:"_getLocalGroupAttributes",value:function(e){return this._hasLocalGroupAttributes(e)||this.initGroupAttributesCache({groupID:e}),this._groupAttributesMap.get(e)}},{key:"_transformGroupAttributes",value:function(e){var t=[];return Object.keys(e).forEach((function(n){t.push({key:n,value:e[n]})})),t}},{key:"_emitGroupAttributesUpdated",value:function(e){var t=this._getCachedAttributes({groupID:e}),n=this._computeAttrChangedInfo(t),o=n.updatedKeyList,r=n.deletedKeyList;Ve.l("".concat(this._n,"._emitGroupAttributesUpdated update:").concat(o.length,", delete:").concat(r.length)),0===o.length&&0===r.length||this._groupModule.emitOuterEvent(D.GROUP_ATTRIBUTES_UPDATED,{groupID:e,groupAttributes:t,updatedKeyList:o,deletedKeyList:r})}},{key:"_computeAttrChangedInfo",value:function(e){var t=this,n=[],o=[];return Object.keys(e).forEach((function(o){e[o]!==t._groupAttributesCopy[o]&&n.push(o)})),Object.keys(this._groupAttributesCopy).forEach((function(t){at(e[t])&&o.push(t)})),this._groupAttributesCopy={},{updatedKeyList:n,deletedKeyList:o}}},{key:"deleteLocalGroupAttributes",value:function(e){this._hasLocalGroupAttributes(e)&&this._groupAttributesMap.delete(e)}},{key:"reset",value:function(){this._groupAttributesMap.clear(),this._groupAttributesCopy={},this.CACHE_EXPIRE_TIME=3e4}}]),e}(),As="Set",Rs="Increase",Os="Decrease",Ns=function(){function e(t){r(this,e),this._groupModule=t,this._n="GroupCountersHandler",this._groupCountersMap=new Map,this.EXPIRE_TIME=3e4,this._groupModule.getInnerEmitterInstance().on(ns,this._onCloudConfigUpdated,this)}return s(e,[{key:"_onCloudConfigUpdated",value:function(){var e=this._groupModule.getCloudConfig("grp_counter_expire_time");at(e)||(this.EXPIRE_TIME=Number(e))}},{key:"isGroupCountersNotice",value:function(e){var t=e.to,n=e.elements.groupCounterInfo,o=!1;return $t(n)||(this._onGroupCountersUpdated({groupID:t,groupCounterInfo:n}),o=!0),o}},{key:"_onGroupCountersUpdated",value:function(e){var t=this,n=e.groupID;e.groupCounterInfo.forEach((function(e){var o=e.type,r=e.groupCounterSeq,i=e.counterList,s=void 0===i?[]:i;0!==o&&2!==o||(t._updateLocalGroupCounters({groupID:n,groupCounterSeq:r,counterList:s}),s.forEach((function(e){t._groupModule.emitOuterEvent(D.GROUP_COUNTER_UPDATED,{groupID:n,key:e.key,value:e.value})}))),1===o&&t._deleteLocalGroupCounters({groupID:n,groupCounterSeq:r,counterList:s})})),Ve.l("".concat(this._n,"._onGroupCountersUpdated groupID:").concat(n))}},{key:"initGroupCountersCache",value:function(e){var t=e.groupID,n=e.avChatRoomKey;this._groupCountersMap.set(t,{lastUpdateTime:0,groupCounterSeq:0,counters:new Map,avChatRoomKey:n}),Ve.l("".concat(this._n,".initGroupCountersCache groupID:").concat(t," avChatRoomKey:").concat(n))}},{key:"setGroupCounters",value:function(e){var t=this;if(!this._groupModule.canIUse(K.GRP_COUNTER))return Xi({code:gi.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".setGroupCounters"),o=e.groupID,r=e.counters,i=this._convertObjectToList(r),s=this._getLocalGroupCounters(o).avChatRoomKey,a="groupID:".concat(o," count:").concat(i.length),c=new Ai("setGroupCounters");return c.setMessage("".concat(a)),Ve.l("".concat(n,". ").concat(a)),this._updateGroupCounters({groupID:o,counterList:i,avChatRoomKey:s,mode:As}).then((function(e){return c.end(),Ve.l("".concat(n," ok.")),zi({counters:e})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];c.setError(e,o,r).end()})),Ve.e("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"increaseGroupCounter",value:function(e){var t=this;if(!this._groupModule.canIUse(K.GRP_COUNTER))return Xi({code:gi.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".increaseGroupCounters"),o=e.groupID,r=e.key,i=e.value,s=this._getLocalGroupCounters(o).avChatRoomKey,a="groupID:".concat(o," key:").concat(r," value:").concat(i),c=new Ai("increaseGroupCounter");c.setMessage("".concat(a)),Ve.l("".concat(n,". ").concat(a));var u=[{key:r,value:i}];return this._updateGroupCounters({groupID:o,counterList:u,avChatRoomKey:s,mode:Rs}).then((function(e){return c.end(),Ve.l("".concat(n," ok.")),zi({counters:e})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];c.setError(e,o,r).end()})),Ve.e("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"decreaseGroupCounter",value:function(e){var t=this;if(!this._groupModule.canIUse(K.GRP_COUNTER))return Xi({code:gi.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".decreaseGroupCounter"),o=e.groupID,r=e.key,i=e.value,s=this._getLocalGroupCounters(o).avChatRoomKey,a="groupID:".concat(o," key:").concat(r," value:").concat(i),c=new Ai("decreaseGroupCounter");c.setMessage("".concat(a)),Ve.l("".concat(n,". ").concat(a));var u=[{key:r,value:i}];return this._updateGroupCounters({groupID:o,counterList:u,avChatRoomKey:s,mode:Os}).then((function(e){return c.end(),Ve.l("".concat(n," ok.")),zi({counters:e})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];c.setError(e,o,r).end()})),Ve.e("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"getGroupCounters",value:function(e){var t=this;if(!this._groupModule.canIUse(K.GRP_COUNTER))return Xi({code:gi.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".getGroupCounters"),o=e.groupID,r=e.keyList,i=void 0===r?[]:r,s=this._getLocalGroupCounters(o),a=s.avChatRoomKey,c=s.lastUpdateTime,u=new Ai("getGroupCounters");if(u.setMessage("groupID:".concat(o)),Date.now()-c>=this.EXPIRE_TIME)return this._getRemoteGroupCounters({groupID:o,avChatRoomKey:a}).then((function(e){u.setMoreMessage("from remote. count:".concat(e.length)).end(),Ve.l("".concat(n," from remote. groupID:").concat(o));var r=t._getLocalCounters(o,i);return zi({counters:r})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];u.setError(e,o,r).end()})),Xi(e)}));u.setMoreMessage("from cache").end(),Ve.l("".concat(n," from cache. groupID:").concat(o));var l=this._getLocalCounters(o,i);return Ji({counters:l})}},{key:"_getRemoteGroupCounters",value:function(e){var t=this;return this._groupModule.request({protocolName:Rr,requestData:n({},e)}).then((function(n){var o=n.data,r=o.counterList,i=void 0===r?[]:r,s=o.groupCounterSeq;return t._updateLocalGroupCounters({groupID:e.groupID,counterList:i,groupCounterSeq:s}),Ve.l("".concat(t._n,"._getRemoteGroupCounters ok. groupID:").concat(e.groupID)),i})).catch((function(e){return Xi(e)}))}},{key:"_convertObjectToList",value:function(e){var t=[];return Object.keys(e).forEach((function(n){t.push({key:n,value:e[n]})})),t}},{key:"_updateGroupCounters",value:function(e){var t="".concat(this._n,"._updateGroupCounters"),o=e.groupID,r=e.avChatRoomKey,i=e.mode;return Ve.l("".concat(t,". groupID:").concat(o," avChatRoomKey:").concat(r," mode:").concat(i)),this._groupModule.request({protocolName:Ar,requestData:n({},e)}).then((function(e){Ve.l("".concat(t," ok."));var n=e.data.counterList,o={};return(void 0===n?[]:n).forEach((function(e){var t=e.key,n=e.value;o[t]=n})),o})).catch((function(e){return Xi(e)}))}},{key:"_hasLocalGroupCounters",value:function(e){return this._groupCountersMap.has(e)}},{key:"_getLocalGroupCounters",value:function(e){return this._hasLocalGroupCounters(e)||this.initGroupCountersCache({groupID:e}),this._groupCountersMap.get(e)}},{key:"_updateLocalGroupCounters",value:function(e){var t=e.groupID,n=e.counterList,o=void 0===n?[]:n,r=e.groupCounterSeq;if(this._hasLocalGroupCounters(t)){var i=this._getLocalGroupCounters(t),s=i.counters,a=i.avChatRoomKey,c=i.groupCounterSeq;if(r>0&&r<c)return;o.forEach((function(e){var t=e.key,n=e.value;s.set(t,n)})),this._groupCountersMap.set(t,{lastUpdateTime:Date.now(),groupCounterSeq:r,counters:s,avChatRoomKey:a})}}},{key:"_deleteLocalGroupCounters",value:function(e){var t=e.groupID,n=e.counterList,o=void 0===n?[]:n,r=e.groupCounterSeq;if(this._hasLocalGroupCounters(t)){var i=this._getLocalGroupCounters(t),s=i.counters,a=i.avChatRoomKey;o.forEach((function(e){s.delete(e.key)})),this._groupCountersMap.set(t,{lastUpdateTime:Date.now(),groupCounterSeq:r,counters:s,avChatRoomKey:a})}}},{key:"_getLocalCounters",value:function(e,t){var n={};if(!this._hasLocalGroupCounters(e))return n;var o=this._getLocalGroupCounters(e).counters;if(t.length>0)t.forEach((function(e){o.has(e)&&(n[e]=o.get(e))}));else{var r,i=k(o.keys());try{for(i.s();!(r=i.n()).done;){var s=r.value;n[s]=o.get(s)}}catch(a){i.e(a)}finally{i.f()}}return n}},{key:"reset",value:function(){this._groupCountersMap.clear(),this.EXPIRE_TIME=3e4}}]),e}(),ws=function(){function e(t){r(this,e);var n=t.manager,o=t.groupID,i=t.onInit,s=t.onSuccess,a=t.onFail;this._n="Polling",this._manager=n,this._groupModule=n._groupModule,this._onInit=i,this._onSuccess=s,this._onFail=a,this._groupID=o,this._timeoutID=-1,this._isRunning=!1,this._protocolName=_r}return s(e,[{key:"start",value:function(){var e=this._groupModule.isLoggedIn();e||(this._protocolName=mr),Ve.l("".concat(this._n,".start pollingInterval:").concat(this._manager.getPollingInterval()," isLoggedIn:").concat(e)),this._isRunning=!0,this._request()}},{key:"isRunning",value:function(){return this._isRunning}},{key:"_request",value:function(){var e=this,t=this._onInit(this._groupID);this._groupModule.request({protocolName:this._protocolName,requestData:t}).then((function(t){e._onSuccess(e._groupID,t),e.isRunning()&&(clearTimeout(e._timeoutID),e._timeoutID=setTimeout(e._request.bind(e),e._manager.getPollingInterval()))})).catch((function(t){e._onFail(e._groupID,t),e.isRunning()&&(clearTimeout(e._timeoutID),e._timeoutID=setTimeout(e._request.bind(e),e._manager.MAX_POLLING_INTERVAL))}))}},{key:"stop",value:function(){Ve.l("".concat(this._n,".stop")),this._timeoutID>0&&(clearTimeout(this._timeoutID),this._timeoutID=-1),this._isRunning=!1}},{key:"getPollingTimerID",value:function(){return this._timeoutID}}]),e}(),bs={3:!0,4:!0,5:!0,6:!0,17:!0},Us=function(){function e(t){r(this,e),this._groupModule=t,this._n="AVChatRoomHandler",this._joinedGroupMap=new Map,this._pollingRequestInfoMap=new Map,this._pollingInstanceMap=new Map,this.sequencesLinkedList=new hs(200),this.messageIDLinkedList=new hs(100),this.receivedMessageCount=0,this._reportMessageStackedCount=0,this._onlineMemberCountMap=new Map,this.DEFAULT_EXPIRE_TIME=60,this.DEFAULT_POLLING_INTERVAL=300,this.MAX_POLLING_INTERVAL=2e3,this._pollingInterval=this.DEFAULT_POLLING_INTERVAL,this.DEFAULT_POLLING_NO_MESSAGE_COUNT=20,this.DEFAULT_POLLING_INTERVAL_PLUS=2e3,this._pollingNoMessageCount=0,this._startBroadcastSeq=1,this._broadcastMessageIDMap=new Map,this.DEFAULT_POLLING_SIMPLIFIED_MSG=0}return s(e,[{key:"hasJoinedAVChatRoom",value:function(){return this._joinedGroupMap.size>0}},{key:"checkJoinedAVChatRoomByID",value:function(e){return this._joinedGroupMap.has(e)}},{key:"getJoinedAVChatRoom",value:function(){return this._joinedGroupMap.size>0?y(this._joinedGroupMap.keys()):null}},{key:"_updateRequestData",value:function(e){var t=this._pollingRequestInfoMap.get(e);return e===y(this._pollingInstanceMap.keys())[0]?n(n({},t),{},{startBroadcastSeq:this._startBroadcastSeq,simplifiedMessage:this.DEFAULT_POLLING_SIMPLIFIED_MSG}):n(n({},t),{},{simplifiedMessage:this.DEFAULT_POLLING_SIMPLIFIED_MSG})}},{key:"_handleSuccess",value:function(e,t){var n=t.data,o=n.key,r=n.nextSeq,i=n.rspMsgList,s=n.errorCode,a=n.nextBroadcastSeq,c=n.broadcastMessageList;if(0!==s){var u=this._pollingRequestInfoMap.get(e),l=new Ai("longPollingAVError"),d=u?"".concat(u.key,"-").concat(u.startSeq):"requestInfo is undefined";l.setMessage("".concat(e,"-").concat(d,"-").concat(t.errorInfo)).setCode(t.errorCode).setNetworkType(this._groupModule.getNetworkType()).end(!0)}else{if(!this.checkJoinedAVChatRoomByID(e))return;ot(o)&&nt(r)&&this._pollingRequestInfoMap.set(e,{key:o,startSeq:r}),nt(a)&&a>this._startBroadcastSeq&&(this._startBroadcastSeq=a),st(i)&&i.length>0?(i.forEach((function(e){e.to=e.groupID})),this.onMessage(i)):(this._pollingNoMessageCount+=1,this._pollingNoMessageCount===this.DEFAULT_POLLING_NO_MESSAGE_COUNT&&(this._pollingInterval=this.DEFAULT_POLLING_INTERVAL+this.DEFAULT_POLLING_INTERVAL_PLUS)),this._onBroadcastMessage(c)}}},{key:"_handleFailure",value:function(e,t){}},{key:"onMessage",value:function(e){if(st(e)&&0!==e.length){0!==this._pollingNoMessageCount&&(this._pollingNoMessageCount=0,this._pollingInterval=this.DEFAULT_POLLING_INTERVAL);var t=null,n=[],o=this._getModule(qn),r=this._getModule(to),i=e.length;i>1&&e.sort((function(e,t){return e.sequence-t.sequence}));for(var s=this._getModule(Bn),a=0;a<i;a++){var c=this.restoreMessageFromSimplified(e[a]);if(bs[c.event]){if(6===c.event){if(this._groupModule.isGroupAttributesUpdatedNotice(c))continue;if(this._groupModule.isGroupCountersNotice(c))continue}this.receivedMessageCount+=1,t=this.packMessage(c,c.event);var u=1===c.isModified,l=1===c.isHistoryMessage;if((s.isUnlimitedAVChatRoom()||!this.sequencesLinkedList.has(t.sequence))&&!this.messageIDLinkedList.has(t.ID)){var d=t.conversationID;if(this.receivedMessageCount%50==0?this._getModule(Xn).detectFirstRound(d,this.sequencesLinkedList.data()):this.receivedMessageCount%80==0&&this._getModule(Xn).detectSecondRound(d,this.sequencesLinkedList.data()),null!==this.sequencesLinkedList.tail()){var p=this.sequencesLinkedList.tail().value,h=t.sequence-p;h>1&&h<=20?this._getModule(Xn).onMessageMaybeLost(d,p+1,h-1):h<-1&&h>=-20&&this._getModule(Xn).onMessageMaybeLost(d,t.sequence+1,Math.abs(h)-1)}this.sequencesLinkedList.set(t.sequence),this.messageIDLinkedList.set(t.ID);var g=!1;if(this._isMessageSentByCurrentInstance(t)?u&&(g=!0,t.isModified=u,o.updateMessageIsModifiedProperty(t)):g=!0,g){if(t.conversationType===S.CONV_SYSTEM&&5===t.payload.operationType&&this._onGroupDismissed(t.payload.groupProfile.groupID),!l&&t.conversationType!==S.CONV_SYSTEM){var f=t.conversationID.replace(S.CONV_GROUP,"");this._pollingInstanceMap.has(f)?this._groupModule.isLoggedIn()&&r.addMessageSequence({key:Ei,message:t}):(t.type!==S.MSG_GRP_TIP&&t.clientTime>0&&r.addMessageDelay(t.clientTime),r.addMessageSequence({key:Ti,message:t}))}n.push(t)}}}else Ve.w("".concat(this._n,".onMessage unknown event:").concat(c.event))}if(0!==n.length){this._groupModule.filterModifiedMessage(n);var _=this.packConversationOption(n);_.length>0&&this._getModule(qn).onNewMessage({conversationOptionsList:_,isInstantMessage:!0}),Ve.d("".concat(this._n,".onMessage count:").concat(n.length)),this._checkMessageStacked(n);var m=this._groupModule.filterUnmodifiedMessage(n);m.length>0&&this._groupModule.emitOuterEvent(D.MESSAGE_RECEIVED,m),n.length=0}}}},{key:"isBroadcastOrNormal",value:function(e){return 3===e||17===e}},{key:"isGroupTip",value:function(e){return 4===e||6===e}},{key:"isGroupSystemNotice",value:function(e){return 5===e}},{key:"restoreGroupTipElements",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.groupJoinType||(e.groupJoinType=1);var t=e.operatorInfo,n=void 0===t?{}:t,o=e.operatorID,r=e.userIDList,i=void 0===r?[]:r,s=n.userID,a=void 0===s?o:s,c=n.avatar,u=void 0===c?"":c,l=n.nick,d=void 0===l?"":l;e.operatorInfo={userID:a,avatar:u,nick:d};var p=i.map((function(e){return{userID:e}}));return e.memberInfoList=e.memberInfoList||p,e}},{key:"restoreMessageFromSimplified",value:function(e){var t=e.event;if(this.isBroadcastOrNormal(t)&&(e.cloudCustomData=e.cloudCustomData||"",e.elements=e.elements.map((function(e){if(e.type===S.MSG_CUSTOM){var t=e.content,o=void 0===t?{}:t;e.content=n({data:"",description:"",extension:""},o)}return e}))),(this.isGroupTip(t)||this.isGroupSystemNotice(t))&&(e.from=e.from||"@TIM#SYSTEM"),this.isGroupTip(t)){e.elements=this.restoreGroupTipElements(e.elements);var o=e.elements,r=void 0===o?{}:o,i=r.operationType,s=r.operatorInfo;if(1===i){var c=[{userID:(void 0===s?{}:s).userID}];r.memberInfoList=r.memberInfoList||c}}if(this.isGroupSystemNotice(t)){var u=e.elements,l=u.memberInfoList,d=u.operatorInfo;l||(l=void 0===d?{}:d),e.elements.memberInfoList=n({userID:e.elements.operatorID,avatar:"",nick:""},l),e.elements=n({authentication:"",remarkInfo:"",messageKey:1e3*e.time},e.elements);var p=Object.keys(e.elements).filter((function(e){return"operatorInfo"!==e})).reduce((function(t,o){return n(n({},t),{},a({},o,e.elements[o]))}),{});e.elements=p}return e}},{key:"_onGroupDismissed",value:function(e){Ve.l("".concat(this._n,"._onGroupDismissed groupID:").concat(e)),this._groupModule.deleteLocalGroupAndConversation(e),this.reset(e)}},{key:"_checkMessageStacked",value:function(e){var t="MessageStacked",n=e.length;n>=100&&(this._groupModule.outputWarning(t,n),this._reportMessageStackedCount<5&&(new Ai(t).setNetworkType(this._groupModule.getNetworkType()).setMessage("count:".concat(n," groupID:").concat(y(this._joinedGroupMap.keys()))).setLevel("warning").end(),this._reportMessageStackedCount+=1))}},{key:"_isMessageSentByCurrentInstance",value:function(e){return!!this._getModule(qn).isMessageSentByCurrentInstance(e)}},{key:"packMessage",value:function(e,t){e.currentUser=this._groupModule.getMyUserID(),e.conversationType=5===t?S.CONV_SYSTEM:S.CONV_GROUP,e.isSystemMessage=!!e.isSystemMessage;var n=new ji(e),o=this.packElements(e,t);return n.setElement(o,this._groupModule.getFileDownloadProxy()),n}},{key:"packElements",value:function(e,t){return 4===t||6===t?(this._updateMemberCountByGroupTips(e),{type:S.MSG_GRP_TIP,content:n(n({},e.elements),{},{groupProfile:e.groupProfile})}):5===t?{type:S.MSG_GRP_SYS_NOTICE,content:n(n({},e.elements),{},{groupProfile:n(n({},e.groupProfile),{},{groupID:e.groupID})})}:this._getModule(jn).parseElements(e.elements,e.from)}},{key:"packConversationOption",value:function(e){for(var t=new Map,n=0;n<e.length;n++){var o=e[n],r=o.conversationID;if(t.has(r)){var i=t.get(r);i.lastMessage=o,"in"===o.flow&&i.unreadCount++}else t.set(r,{conversationID:o.conversationID,unreadCount:"out"===o.flow?0:1,type:o.conversationType,subType:o.conversationSubType,lastMessage:o})}return y(t.values())}},{key:"_updateMemberCountByGroupTips",value:function(e){var t=e.groupProfile.groupID,n=e.elements.onlineMemberInfo,o=void 0===n?void 0:n;if(!$t(o)){var r=o.onlineMemberNum,i=void 0===r?0:r,s=o.expireTime,a=void 0===s?this.DEFAULT_EXPIRE_TIME:s,c=this._onlineMemberCountMap.get(t)||{},u=Date.now();$t(c)?Object.assign(c,{lastReqTime:0,lastSyncTime:0,latestUpdateTime:u,memberCount:i,expireTime:a}):(c.latestUpdateTime=u,c.memberCount=i),Ve.d("".concat(this._n,"._updateMemberCountByGroupTips info:"),c),this._onlineMemberCountMap.set(t,c)}}},{key:"_onBroadcastMessage",value:function(e){if(!$t(e)){for(var t=[],n=e.length,o=null,r=0;r<n;r++){var i=this.restoreMessageFromSimplified(e[r]);bs[i.event]?((o=this.packMessage(i,i.event)).isBroadcastMessage=!0,this._broadcastMessageIDMap.has(o.ID)||(t.push(o),this._broadcastMessageIDMap.set(o.ID,1))):Ve.w("".concat(this._n,"._onBroadcastMessage unknown event:").concat(i.event))}t.length>0&&this._groupModule.emitOuterEvent(D.MESSAGE_RECEIVED,t)}}},{key:"start",value:function(e){if(this._pollingInstanceMap.has(e)){var t=this._pollingInstanceMap.get(e);t.isRunning()||t.start()}else{var n=new ws({manager:this,groupID:e,onInit:this._updateRequestData.bind(this),onSuccess:this._handleSuccess.bind(this),onFail:this._handleFailure.bind(this)});n.start(),this._pollingInstanceMap.set(e,n),Ve.l("".concat(this._n,".start groupID:").concat(e))}}},{key:"handleJoinResult",value:function(e){var t=this;return this._preCheck().then((function(){var n=e.longPollingKey,o=e.group,r=o.groupID;return t._joinedGroupMap.set(r,o),t._groupModule.updateGroupMap([o]),t._groupModule.deleteUnjoinedAVChatRoom(r),t._groupModule.emitGroupListUpdate(!0,!1),at(n)?Ji({status:Ye,group:o}):Promise.resolve()}))}},{key:"startRunLoop",value:function(e){var t=this;return this.handleJoinResult(e).then((function(){var n=e.longPollingKey,o=e.group,r=e.startSeq,i=void 0===r?0:r,s=o.groupID;return t._pollingRequestInfoMap.set(s,{key:n,startSeq:i}),t.start(s),t._groupModule.isLoggedIn()?Ji({status:Ye,group:o}):Ji({status:Ye})}))}},{key:"_preCheck",value:function(){if(this._getModule(Bn).isUnlimitedAVChatRoom())return Promise.resolve();if(!this.hasJoinedAVChatRoom())return Promise.resolve();var e=v(this._joinedGroupMap.entries().next().value,2),t=e[0],n=e[1];if(this._groupModule.isLoggedIn()){if(n.selfInfo.role!==S.GRP_MBR_ROLE_OWNER&&n.ownerID!==this._groupModule.getMyUserID())return this._groupModule.quitGroup(t);this._groupModule.deleteLocalGroupAndConversation(t)}else this._groupModule.deleteLocalGroupAndConversation(t);return this.reset(t),Promise.resolve()}},{key:"joinWithoutAuth",value:function(e){var t=this,n=e.groupID,o="".concat(this._n,".").concat("joinWithoutAuth"),r=new Ai("joinWithoutAuth");return this._groupModule.request({protocolName:Qo,requestData:e}).then((function(e){var i=e.data.longPollingKey;if(t._groupModule.probeNetwork().then((function(e){var t=v(e,2);t[0];var o=t[1];r.setNetworkType(o).setMessage("groupID:".concat(n," longPollingKey:").concat(i)).end(!0)})),at(i))return Xi({code:gi.CANNOT_JOIN_NON_AVCHATROOM_WITHOUT_LOGIN});Ve.l("".concat(o," ok. groupID:").concat(n)),t._getModule(qn).setCompleted("".concat(S.CONV_GROUP).concat(n));var s=new fs({groupID:n});return t.startRunLoop({group:s,longPollingKey:i}),zi({status:Ye})})).catch((function(e){return Ve.e("".concat(o," failed. groupID:").concat(n," error:"),e),t._groupModule.probeNetwork().then((function(t){var o=v(t,2),i=o[0],s=o[1];r.setError(e,i,s).setMessage("groupID:".concat(n)).end(!0)})),Xi(e)})).finally((function(){t._groupModule.getModule(Kn).reportAtOnce()}))}},{key:"getGroupOnlineMemberCount",value:function(e){var t=this._onlineMemberCountMap.get(e)||{},n=Date.now();return $t(t)||n-t.lastSyncTime>1e3*t.expireTime&&n-t.latestUpdateTime>1e4&&n-t.lastReqTime>3e3?(t.lastReqTime=n,this._onlineMemberCountMap.set(e,t),this._getGroupOnlineMemberCount(e).then((function(e){return zi({memberCount:e.memberCount})})).catch((function(e){return Xi(e)}))):Ji({memberCount:t.memberCount})}},{key:"_getGroupOnlineMemberCount",value:function(e){var t=this,n="".concat(this._n,".").concat("_getGroupOnlineMemberCount");return this._groupModule.request({protocolName:vr,requestData:{groupID:e}}).then((function(o){var r=t._onlineMemberCountMap.get(e)||{},i=o.data,s=i.onlineMemberNum,a=void 0===s?0:s,c=i.expireTime,u=void 0===c?t.DEFAULT_EXPIRE_TIME:c;Ve.l("".concat(n," ok. groupID:").concat(e," memberCount:").concat(a," expireTime:").concat(u));var l=Date.now();return $t(r)&&(r.lastReqTime=l),t._onlineMemberCountMap.set(e,Object.assign(r,{lastSyncTime:l,latestUpdateTime:l,memberCount:a,expireTime:u})),{memberCount:a}})).catch((function(o){return Ve.w("".concat(n," failed. error:"),o),new Ai("_getGroupOnlineMemberCount").setCode(o.code).setMessage("groupID:".concat(e," error:").concat(JSON.stringify(o))).setNetworkType(t._groupModule.getNetworkType()).end(),Promise.reject(o)}))}},{key:"_getModule",value:function(e){return this._groupModule.getModule(e)}},{key:"setPollingInterval",value:function(e){at(e)||(nt(e)?this._pollingInterval=this.DEFAULT_POLLING_INTERVAL=e:this._pollingInterval=this.DEFAULT_POLLING_INTERVAL=parseInt(e,10))}},{key:"setPollingIntervalPlus",value:function(e){at(e)||(nt(e)?this.DEFAULT_POLLING_INTERVAL_PLUS=e:this.DEFAULT_POLLING_INTERVAL_PLUS=parseInt(e,10))}},{key:"setPollingNoMessageCount",value:function(e){at(e)||(nt(e)?this.DEFAULT_POLLING_NO_MESSAGE_COUNT=e:this.DEFAULT_POLLING_NO_MESSAGE_COUNT=parseInt(e,10))}},{key:"setPollingSimplifiedMessage",value:function(e){at(e)||"0"!==e&&"1"!==e||(this.DEFAULT_POLLING_SIMPLIFIED_MSG=parseInt(e,10))}},{key:"getPollingInterval",value:function(){return this._pollingInterval}},{key:"onAVChatRoomMemberBanned",value:function(e){var t=e.payload.groupProfile.groupID;Ve.l("".concat(this._n,".onAVChatRoomMemberBanned groupID:").concat(t)),this._groupModule.deleteLocalGroupAndConversation(t),this.reset(t)}},{key:"restartPolling",value:function(){Ve.l("".concat(this._n,".restartPolling count:").concat(this._pollingInstanceMap.size));var e,t=k(this._pollingInstanceMap.values());try{for(t.s();!(e=t.n()).done;){var n=e.value;n.stop(),n.start()}}catch(o){t.e(o)}finally{t.f()}}},{key:"getPollingTimerID",value:function(e){if(!this._pollingInstanceMap.has(e))return-1;var t=this._pollingInstanceMap.get(e).getPollingTimerID();return Ve.l("".concat(this._n,".getPollingTimerID groupID:").concat(e," timerID:").concat(t)),t}},{key:"reset",value:function(e){if(e){Ve.l("".concat(this._n,".reset groupID:").concat(e));var t=this._pollingInstanceMap.get(e);t&&t.stop(),this._pollingInstanceMap.delete(e),this._joinedGroupMap.delete(e),this._pollingRequestInfoMap.delete(e),this._onlineMemberCountMap.delete(e)}else{Ve.l("".concat(this._n,".reset all"));var n,o=k(this._pollingInstanceMap.values());try{for(o.s();!(n=o.n()).done;)n.value.stop()}catch(r){o.e(r)}finally{o.f()}this._pollingInstanceMap.clear(),this._joinedGroupMap.clear(),this._pollingRequestInfoMap.clear(),this._onlineMemberCountMap.clear(),this._broadcastMessageIDMap.clear()}this.sequencesLinkedList.reset(),this.messageIDLinkedList.reset(),this.receivedMessageCount=0,this._reportMessageStackedCount=0,this._pollingInterval=this.DEFAULT_POLLING_INTERVAL=300,this.DEFAULT_POLLING_NO_MESSAGE_COUNT=20,this.DEFAULT_POLLING_INTERVAL_PLUS=2e3,this._pollingNoMessageCount=0}}]),e}(),Ps=1,Gs=15,xs=function(){function e(t){r(this,e),this._groupModule=t,this._n="GroupSystemNoticeHandler",this.pendencyMap=new Map}return s(e,[{key:"onNewGroupSystemNotice",value:function(e){var t=e.dataList,n=e.isSyncingEnded,o=e.isInstantMessage;Ve.d("".concat(this._n,".onReceiveSystemNotice count:").concat(t.length));var r=this.newSystemNoticeStoredAndSummary({notifiesList:t,isInstantMessage:o}),i=r.eventDataList,s=r.result;i.length>0&&(this._groupModule.getModule(qn).onNewMessage({conversationOptionsList:i,isInstantMessage:o}),this._onReceivedGroupSystemNotice({result:s,isInstantMessage:o})),o?s.length>0&&this._groupModule.emitOuterEvent(D.MESSAGE_RECEIVED,s):!0===n&&this._clearGroupSystemNotice()}},{key:"newSystemNoticeStoredAndSummary",value:function(e){var t=e.notifiesList,o=e.isInstantMessage,r=null,i=t.length,s=0,a=[],c={conversationID:S.CONV_SYSTEM,unreadCount:0,type:S.CONV_SYSTEM,subType:null,lastMessage:null};for(s=0;s<i;s++){var u=t[s],l=u.groupProfile,d=l.communityType,p=void 0===d?0:d,h=l.topicID,g=void 0===h?void 0:h,f=u.elements,_=f.topicIDList,m=void 0===_?void 0:_,v=f.operationType;if(!(2!==p||$t(g)&&$t(m))){if([17,18,20].includes(v)){this._handleTopicSystemNotice(u);continue}$t(g)||(u.to=g)}u.elements.operationType!==Gs&&(u.currentUser=this._groupModule.getMyUserID(),u.conversationType=S.CONV_SYSTEM,u.conversationID=S.CONV_SYSTEM,(r=new ji(u)).setElement({type:S.MSG_GRP_SYS_NOTICE,content:n(n({},u.elements),{},{groupProfile:n({},u.groupProfile)})}),r.isSystemMessage=!0,(1===r.sequence&&1===r.random||2===r.sequence&&2===r.random)&&(r.sequence=_t(),r.random=_t(),r.generateMessageID(),Ve.l("".concat(this._n,".newSystemNoticeStoredAndSummary sequence and random maybe duplicated, regenerate. ID:").concat(r.ID))),this._groupModule.getModule(qn).pushIntoNoticeResult(a,r)&&(o?c.unreadCount++:r.setIsRead(!0),c.subType=r.conversationSubType))}return c.lastMessage=a[a.length-1],{eventDataList:a.length>0?[c]:[],result:a}}},{key:"_clearGroupSystemNotice",value:function(){var e=this;this._getPendencyList().then((function(t){t.forEach((function(t){e.pendencyMap.set("".concat(t.from,"_").concat(t.groupID,"_").concat(t.to),t)}));var n=e._groupModule.getModule(qn).getLocalMessageList(S.CONV_SYSTEM),o=[];n.forEach((function(t){var n=t.payload,r=n.operatorID,i=n.operationType,s=n.groupProfile;if(i===Ps){var a="".concat(r,"_").concat(s.groupID,"_").concat(s.to),c=e.pendencyMap.get(a);c&&nt(c.handled)&&0!==c.handled&&o.push(t)}})),e.deleteGroupSystemNotice({messageList:o})}))}},{key:"deleteGroupSystemNotice",value:function(e){var t=this,n="".concat(this._n,".deleteGroupSystemNotice");return st(e.messageList)&&0!==e.messageList.length?(Ve.l("".concat(n," ")+e.messageList.map((function(e){return e.ID}))),this._groupModule.request({protocolName:fr,requestData:{messageListToDelete:e.messageList.map((function(e){return{from:S.CONV_SYSTEM,messageSeq:e.clientSequence,messageRandom:e.random}}))}}).then((function(){Ve.l("".concat(n," ok"));var o=t._groupModule.getModule(qn);return e.messageList.forEach((function(e){o.deleteLocalMessage(e)})),zi()})).catch((function(e){return Ve.e("".concat(n," error:"),e),Xi(e)}))):Ji()}},{key:"_getPendencyList",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.type,o=void 0===n?void 0:n,r=t.startTime,i=void 0===r?0:r,s=t.limit,a=void 0===s?20:s;return this._groupModule.request({protocolName:gr,requestData:{type:o,startTime:i,limit:a,handleAccount:this._groupModule.getMyUserID()}}).then((function(t){var n=t.data.pendencyList;return 0!==t.data.nextStartTime?e._getPendencyList({startTime:t.data.nextStartTime}).then((function(e){return[].concat(y(n),y(e))})):n}))}},{key:"getGroupApplicationList",value:function(){var e=this;return this._getPendencyList().then((function(t){return e._getPendencyList({type:S.GRP_COMMUNITY}).then((function(n){return t.push.apply(t,y(n)),e._handlePendencyResult(t)})).catch((function(n){return e._handlePendencyResult(t)}))}))}},{key:"_handlePendencyResult",value:function(e){var t=this,n=[];return e.forEach((function(e){t.pendencyMap.set("".concat(e.from,"_").concat(e.groupID,"_").concat(e.to),e),0===e.handled&&n.push({applicant:e.from,applicantNick:e.fromUserNickName,groupName:e.groupName,groupID:e.groupID,authentication:e.authentication,messageKey:e.time,applicationType:e.applicationType,userID:e.userID})})),Ji({applicationList:n})}},{key:"_onReceivedGroupSystemNotice",value:function(e){var t=this,n=e.result;e.isInstantMessage&&n.forEach((function(e){switch(e.payload.operationType){case 1:case 3:case 6:case 11:case 12:case 15:break;case 2:t._onApplyGroupRequestAgreed(e);break;case 4:t._onMemberKicked(e);break;case 5:t._onGroupDismissed(e);break;case 7:t._onInviteGroup(e);break;case 8:t._onQuitGroup(e);break;case 9:t._onSetManager(e);break;case 10:t._onDeleteManager(e);break;case 20:t._onMessageRemindTypeSynced(e);break;case 21:t._groupModule.onAVChatRoomMemberBanned(e)}}))}},{key:"_onApplyGroupRequestAgreed",value:function(e){var t=this,n=e.payload.groupProfile.groupID;this._groupModule.hasLocalGroup(n)||this._groupModule.getGroupProfile({groupID:n}).then((function(e){var n=e.data.group;if(n){t._groupModule.updateGroupMap([n]);var o=!n.isSupportTopic;t._groupModule.emitGroupListUpdate(!0,o)}}))}},{key:"_onMemberKicked",value:function(e){var t=e.payload.groupProfile.groupID;this._groupModule.hasLocalGroup(t)&&this._groupModule.deleteLocalGroupAndConversation(t)}},{key:"_onGroupDismissed",value:function(e){var t=e.payload.groupProfile.groupID;this._groupModule.hasLocalGroup(t)&&this._groupModule.deleteLocalGroupAndConversation(t);var n=this._groupModule._AVChatRoomHandler;n&&n.checkJoinedAVChatRoomByID(t)&&n.reset(t)}},{key:"_onInviteGroup",value:function(e){var t=this,n=e.payload.groupProfile.groupID;this._groupModule.hasLocalGroup(n)||this._groupModule.getGroupProfile({groupID:n}).then((function(e){var n=e.data.group;n&&(t._groupModule.updateGroupMap([n]),t._groupModule.emitGroupListUpdate())}))}},{key:"_onQuitGroup",value:function(e){var t=e.payload.groupProfile.groupID;this._groupModule.hasLocalGroup(t)&&this._groupModule.deleteLocalGroupAndConversation(t)}},{key:"_onSetManager",value:function(e){var t=e.payload.groupProfile,n=t.to,o=t.groupID,r=this._groupModule.getModule(xn).getLocalGroupMemberInfo(o,n);r&&r.updateRole(S.GRP_MBR_ROLE_ADMIN)}},{key:"_onDeleteManager",value:function(e){var t=e.payload.groupProfile,n=t.to,o=t.groupID,r=this._groupModule.getModule(xn).getLocalGroupMemberInfo(o,n);r&&r.updateRole(S.GRP_MBR_ROLE_MEMBER)}},{key:"_onMessageRemindTypeSynced",value:function(e){var t=e.payload.groupProfile.groupID,n=e.payload.messageRemindType;this._groupModule.getModule(qn).onGroupMessageRemindTypeSynced({groupID:t,messageRemindType:n})}},{key:"_handleTopicSystemNotice",value:function(e){var t=e.groupProfile,n=t.groupID,o=t.topicID,r=e.elements,i=r.operationType,s=r.topicIDList,a=r.messageRemindType,c=this._groupModule.getModule(Fn);17===i?c.onTopicCreated({groupID:n,topicID:o}):18===i?c.onTopicDeleted({groupID:n,topicIDList:s}):20===i&&c.onTopicMessageRemindTypeUpdated({groupID:n,topicID:o,messageRemindType:a})}},{key:"reset",value:function(){this.pendencyMap.clear()}}]),e}(),Fs=["relayFlag"],qs=function(e){c(o,e);var t=m(o);function o(e){var n;return r(this,o),(n=t.call(this,e))._n="GroupModule",n._commonGroupHandler=null,n._AVChatRoomHandler=null,n._groupSystemNoticeHandler=null,n._commonGroupHandler=new Cs(f(n)),n._groupAttributesHandler=new Ls(f(n)),n._groupCountersHandler=new Ns(f(n)),n._AVChatRoomHandler=new Us(f(n)),n._groupTipsHandler=new Is(f(n)),n._groupSystemNoticeHandler=new xs(f(n)),n.groupMap=new Map,n._unjoinedAVChatRoomList=new Map,n._receiptDetailCompleteMap=new Map,n.getInnerEmitterInstance().on(ns,n._onCloudConfigUpdated,f(n)),n}return s(o,[{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("polling_interval"),t=this.getCloudConfig("polling_interval_plus"),n=this.getCloudConfig("polling_no_msg_count"),o=this.getCloudConfig("polling_simplified_msg");this._AVChatRoomHandler&&(Ve.l("".concat(this._n,"._onCloudConfigUpdated pollingInterval:").concat(e)+" pollingIntervalPlus:".concat(t," pollingNoMessageCount:").concat(n)+" pollingSimplifiedMessage:".concat(o)),this._AVChatRoomHandler.setPollingInterval(e),this._AVChatRoomHandler.setPollingIntervalPlus(t),this._AVChatRoomHandler.setPollingNoMessageCount(n),this._AVChatRoomHandler.setPollingSimplifiedMessage(o))}},{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&(this._commonGroupHandler.onCheckTimer(e),this._groupTipsHandler.onCheckTimer(e))}},{key:"guardForAVChatRoom",value:function(e){var t=this;if(e.conversationType===S.CONV_GROUP){var n=Dt(e.to)?Bt(e.to):e.to;return this.hasLocalGroup(n)?Ji():this.getGroupProfile({groupID:n}).then((function(o){var r=o.data.group.type;if(Ve.l("".concat(t._n,".guardForAVChatRoom. groupID:").concat(n," type:").concat(r)),r===S.GRP_AVCHATROOM){var i=gi.MESSAGE_SEND_FAIL_NOT_IN_AVCHATROOM;return Xi(new Wi({code:i,message:t.getErrorMessage(i,e.from,n),data:{message:e}}))}return Ji()}))}return Ji()}},{key:"checkJoinedAVChatRoomByID",value:function(e){return!!this._AVChatRoomHandler&&this._AVChatRoomHandler.checkJoinedAVChatRoomByID(e)}},{key:"onNewGroupMessage",value:function(e){this._commonGroupHandler&&this._commonGroupHandler.onNewGroupMessage(e)}},{key:"updateNextMessageSeq",value:function(e){var t=this;if(st(e)){var n=this.getModule(Fn);e.forEach((function(e){var o=e.conversationID.replace(S.CONV_GROUP,"");Dt(o)&&n.updateLastMessage(o,e.lastMessage),t.groupMap.has(o)&&(t.groupMap.get(o).nextMessageSeq=e.lastMessage.sequence+1)}))}}},{key:"onNewGroupTips",value:function(e){this._groupTipsHandler&&this._groupTipsHandler.onNewGroupTips(e)}},{key:"onGroupMessageRevoked",value:function(e){this._commonGroupHandler&&this._commonGroupHandler.onGroupMessageRevoked(e)}},{key:"onNewGroupSystemNotice",value:function(e){this._groupSystemNoticeHandler&&this._groupSystemNoticeHandler.onNewGroupSystemNotice(e)}},{key:"onGroupMessageReadNotice",value:function(e){var t=this;e.dataList.forEach((function(e){var n=e.elements.groupMessageReadNotice;if(!at(n)){var o=t.getModule(qn);n.forEach((function(e){var n=e.groupID,r=e.topicID,i=void 0===r?void 0:r,s=e.lastMessageSeq;Ve.d("".concat(t._n,".onGroupMessageReadNotice groupID:").concat(n," lastMessageSeq:").concat(s));var a="".concat(S.CONV_GROUP).concat(n),c=!0;$t(i)||(a="".concat(S.CONV_GROUP).concat(i),c=!1),o.updateIsReadAfterReadReport({conversationID:a,lastMessageSeq:s}),o.updateUnreadCount(a,c),o.clearGroupAtInfoList(a,c)}))}}))}},{key:"onReadReceiptList",value:function(e){var t=this;Ve.d("".concat(this._n,".onReadReceiptList options:"),JSON.stringify(e)),e.dataList.forEach((function(e){var n=e.groupProfile,o=e.elements,r=n.groupID,i=t.getModule(qn),s=o.readReceiptList;i.updateReadReceiptInfo({groupID:r,readReceiptList:s})}))}},{key:"onGroupMessageModified",value:function(e){Ve.d("".concat(this._n,".onGroupMessageModified options:"),JSON.stringify(e));var t=this.getModule(qn);e.dataList.forEach((function(e){t.onMessageModified(n(n({},e),{},{conversationType:S.CONV_GROUP,to:e.topicID?e.topicID:e.groupID}))}))}},{key:"deleteGroupSystemNotice",value:function(e){this._groupSystemNoticeHandler&&this._groupSystemNoticeHandler.deleteGroupSystemNotice(e)}},{key:"initGroupMap",value:function(e){this.groupMap.set(e.groupID,new fs(e))}},{key:"deleteGroup",value:function(e){this.groupMap.delete(e)}},{key:"updateGroupMap",value:function(e){var t,n=this,o=this.getModule(qn);e.forEach((function(e){t=e.groupID,n.groupMap.has(t)?n.groupMap.get(t).updateGroup(e):(n.groupMap.set(t,new fs(e)),o.deleteGroupRomaingMessageInfo(t))}));var r,i=this.getMyUserID(),s=k(this.groupMap);try{for(s.s();!(r=s.n()).done;){var a=v(r.value,2)[1];a.selfInfo.userID=i,"Owner"===a.selfInfo.role&&(a.ownerID=i)}}catch(c){s.e(c)}finally{s.f()}this._setStorageGroupList()}},{key:"getStorageGroupList",value:function(){return this.getModule(Vn).getItem("groupMap")}},{key:"_setStorageGroupList",value:function(){var e=this.getLocalGroupList().filter((function(e){var t=e.type;return!Et(t)})).filter((function(e){return!e.isSupportTopic})).slice(0,20).map((function(e){return{groupID:e.groupID,name:e.name,avatar:e.avatar,type:e.type}}));this.getModule(Vn).setItem("groupMap",e)}},{key:"getGroupMap",value:function(){return this.groupMap}},{key:"getLocalGroupList",value:function(){return y(this.groupMap.values())}},{key:"getLocalGroupProfile",value:function(e){return this.groupMap.get(e)}},{key:"sortLocalGroupList",value:function(){var e=y(this.groupMap).filter((function(e){var t=v(e,2);return t[0],!$t(t[1].lastMessage)}));e.sort((function(e,t){return t[1].lastMessage.lastTime-e[1].lastMessage.lastTime})),this.groupMap=new Map(y(e))}},{key:"updateGroupLastMessage",value:function(e){this._commonGroupHandler&&this._commonGroupHandler.handleUpdateGroupLastMessage(e)}},{key:"emitGroupListUpdate",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.getLocalGroupList();if(e&&this.emitOuterEvent(D.GROUP_LIST_UPDATED),t){var o=JSON.parse(JSON.stringify(n));this.getModule(qn).updateConversationGroupProfile(o)}}},{key:"patchGroupMessageRemindType",value:function(){var e=this.getLocalGroupList(),t=this.getModule(qn),n=0;e.forEach((function(e){!0===t.patchMessageRemindType({ID:e.groupID,isC2CConversation:!1,messageRemindType:e.selfInfo.messageRemindType})&&(n+=1)})),Ve.l("".concat(this._n,".patchGroupMessageRemindType count:").concat(n))}},{key:"recomputeUnreadCount",value:function(){var e=this.getLocalGroupList(),t=this.getModule(qn);e.forEach((function(e){var n=e.groupID,o=e.selfInfo,r=o.excludedUnreadSequenceList,i=o.readedSequence;if(st(r)){var s=0;r.forEach((function(t){t>=i&&t<=e.nextMessageSeq-1&&(s+=1)})),s>=1&&t.recomputeGroupUnreadCount({conversationID:"".concat(S.CONV_GROUP).concat(n),count:s})}}))}},{key:"getMyNameCardByGroupID",value:function(e){var t=this.getLocalGroupProfile(e);return t?t.selfInfo.nameCard:""}},{key:"isPagingGetCompleted",value:function(){return!!this._commonGroupHandler&&this._commonGroupHandler.isPagingGetCompleted()}},{key:"getGroupList",value:function(e){return this._commonGroupHandler?this._commonGroupHandler.getGroupList(e):Ji()}},{key:"getGroupProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("getGroupProfile"),o=new Ai("getGroupProfile"),r=e.groupID,i=e.groupCustomFieldFilter;Ve.l("".concat(n," groupID:").concat(r));var s={groupIDList:[r],responseFilter:{groupBaseInfoFilter:["Type","Name","Introduction","Notification","FaceUrl","Owner_Account","CreateTime","InfoSeq","LastInfoTime","LastMsgTime","MemberNum","MaxMemberNum","ApplyJoinOption","NextMsgSeq","ShutUpAllMember","InviteJoinOption"],groupCustomFieldFilter:i,memberInfoFilter:["Role","JoinTime","MsgSeq","MsgFlag","NameCard"]}};return this.getGroupProfileAdvance(s).then((function(e){var i,s=e.data,a=s.successGroupList,c=s.failureGroupList;return Ve.l("".concat(n," ok")),c.length>0?Xi(c[0]):(Et(a[0].type)&&!t.hasLocalGroup(r)?i=new fs(a[0]):(t.updateGroupMap(a),i=t.getLocalGroupProfile(r)),i.isSupportTopic||t.getModule(qn).updateConversationGroupProfile([i]),o.setNetworkType(t.getNetworkType()).setMessage("groupID:".concat(r," type:").concat(i.type," muteAllMembers:").concat(i.muteAllMembers," ownerID:").concat(i.ownerID)).end(),zi({group:i}))})).catch((function(r){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],s=n[1];o.setError(r,i,s).setMessage("groupID:".concat(e.groupID)).end()})),Ve.e("".concat(n," failed. error:"),r),Xi(r)}))}},{key:"getGroupProfileAdvance",value:function(e){var t="".concat(this._n,".getGroupProfileAdvance"),o=e.groupIDList;st(o)&&o.length>50&&(this.outputWarning("GetGroupProfileLimit"),o.length=50);var r=[],i=[];o.forEach((function(e){kt({groupID:e})?i.push(e):r.push(e)}));var s=[];if(r.length>0){var a=this._getGroupProfileAdvance(n(n({},e),{},{groupIDList:r}));s.push(a)}if(i.length>0){var c=this._getGroupProfileAdvance(n(n({},e),{},{groupIDList:i,relayFlag:r.length>0}));s.push(c)}return Promise.all(s).then((function(e){var t=[],n=[];return e.forEach((function(e){t.push.apply(t,y(e.successGroupList)),n.push.apply(n,y(e.failureGroupList))})),zi({successGroupList:t,failureGroupList:n})})).catch((function(e){return Ve.e("".concat(t," failed. error:"),e),Xi(e)}))}},{key:"_getGroupProfileAdvance",value:function(e){var t=this,n=e.relayFlag,o=void 0!==n&&n,r=g(e,Fs);return this.request({protocolName:Yo,requestData:r}).then((function(e){Ve.l("".concat(t._n,"._getGroupProfileAdvance ok."));var n=e.data.groups;return{successGroupList:n.filter((function(e){return at(e.errorCode)||0===e.errorCode})),failureGroupList:n.filter((function(e){return e.errorCode&&0!==e.errorCode})).map((function(e){return new Wi({code:e.errorCode,message:e.errorInfo,data:{groupID:e.groupID}})}))}})).catch((function(t){return o&&kt({groupID:e.groupIDList[0]})?{successGroupList:[],failureGroupList:[]}:Xi(t)}))}},{key:"createGroup",value:function(e){var t=this,o="".concat(this._n,".").concat("createGroup"),r=e.type,i=e.groupID;if(e.name&&!1===this._filterProfanity("name",e))return Xi({code:gi.PROFANITY_FOUND});if(e.introduction&&!1===this._filterProfanity("introduction",e))return Xi({code:gi.PROFANITY_FOUND});if(e.notification&&!1===this._filterProfanity("notification",e))return Xi({code:gi.PROFANITY_FOUND});if(!["Public","Private","ChatRoom","AVChatRoom","Community"].includes(r))return Xi({code:gi.ILLEGAL_GROUP_TYPE});if(!kt({type:r})){if(!$t(i)&&kt({groupID:i}))return Xi({code:gi.ILLEGAL_GROUP_ID});e.isSupportTopic=void 0}if(Et(r)&&!at(e.memberList)&&e.memberList.length>0&&(e.memberList=void 0),this._canIUseJoinOption(r)||at(e.joinOption)||(e.joinOption=void 0),kt({type:r})){if(!$t(i)&&!kt({groupID:i}))return Xi({code:gi.ILLEGAL_GROUP_ID});e.isSupportTopic=!0===e.isSupportTopic?1:0}var s=new Ai("createGroup");Ve.l("".concat(o," options:"),e);var a=null,c=[];return this.request({protocolName:$o,requestData:n(n({},e),{},{ownerID:this.getMyUserID(),webPushFlag:1})}).then((function(r){var i=r.data,u=i.groupID,l=i.overLimitUserIDList,d=void 0===l?[]:l;if(a=u,c=d,s.setNetworkType(t.getNetworkType()).setMessage("groupType:".concat(e.type," groupID:").concat(u," overLimitUserIDList=").concat(d)).end(),Ve.l("".concat(o," ok groupID:").concat(u," overLimitUserIDList:"),d),e.type===S.GRP_AVCHATROOM)return t.getGroupProfile({groupID:u});if(e.type===S.GRP_COMMUNITY&&1===e.isSupportTopic)return t.getGroupProfile({groupID:u});$t(e.memberList)||$t(d)||(e.memberList=e.memberList.filter((function(e){return-1===d.indexOf(e.userID)}))),t.updateGroupMap([n(n({},e),{},{groupID:u})]);var p=t.getModule(Nn),h=p.createCustomMessage({to:u,conversationType:S.CONV_GROUP,payload:{data:"group_create",extension:t.isIntl()?"".concat(t.getMyUserID()," created a group"):"".concat(t.getMyUserID(),"创建群组")}});return p.sendMessageInstance(h),t.emitGroupListUpdate(),t.getGroupProfile({groupID:u})})).then((function(e){var t=e.data.group,n=t.selfInfo,o=n.nameCard,r=n.joinTime;return t.updateSelfInfo({nameCard:o,joinTime:r,messageRemindType:S.MSG_REMIND_ACPT_AND_NOTE,role:S.GRP_MBR_ROLE_OWNER}),zi({group:t,overLimitUserIDList:c})})).catch((function(r){if(s.setMessage("groupType:".concat(e.type)),t.probeNetwork().then((function(e){var t=v(e,2),n=t[0],o=t[1];s.setError(r,n,o).end()})),10010===r.code||10007===r.code){t.updateGroupMap([n(n({},e),{},{groupID:a})]);var i=t.getLocalGroupProfile(a);return Ve.l("".concat(o," success, but failed to get group profile.")),zi({group:i,overLimitUserIDList:c})}return Ve.e("".concat(o," failed. error:"),r),Xi(r)}))}},{key:"dismissGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("dismissGroup");if(this.hasLocalGroup(e)&&this.getLocalGroupProfile(e).type===S.GRP_WORK)return Xi(new Wi({code:gi.CANNOT_DISMISS_WORK}));var o=new Ai("dismissGroup");return o.setMessage("groupID:".concat(e)),Ve.l("".concat(n," groupID:").concat(e)),this.request({protocolName:Jo,requestData:{groupID:e}}).then((function(){return o.setNetworkType(t.getNetworkType()).end(),Ve.l("".concat(n," ok")),t.deleteLocalGroupAndConversation(e),t.checkJoinedAVChatRoomByID(e)&&t._AVChatRoomHandler.reset(e),t._groupAttributesHandler.deleteLocalGroupAttributes(e),zi({groupID:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),r=n[0],i=n[1];o.setError(e,r,i).end()})),Ve.e("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"updateGroupProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("updateGroupProfile");if(this.hasLocalGroup(e.groupID)){var o=this.getLocalGroupProfile(e.groupID).type;this._canIUseJoinOption(o)||at(e.joinOption)||(Ve.w("".concat(n," joinOption is unavailable for Work/Meeting/AVChatRoom")),e.joinOption=void 0)}if(at(e.muteAllMembers)||(e.muteAllMembers?e.muteAllMembers="On":e.muteAllMembers="Off"),e.name&&!1===this._filterProfanity("name",e))return Xi({code:gi.PROFANITY_FOUND});if(e.introduction&&!1===this._filterProfanity("introduction",e))return Xi({code:gi.PROFANITY_FOUND});if(e.notification&&!1===this._filterProfanity("notification",e))return Xi({code:gi.PROFANITY_FOUND});var r=new Ai("updateGroupProfile");return r.setMessage(JSON.stringify(e)),Ve.l("".concat(n," groupID:").concat(e.groupID)),this.request({protocolName:Xo,requestData:e}).then((function(){return r.setNetworkType(t.getNetworkType()).end(),Ve.l("".concat(n," ok")),t.hasLocalGroup(e.groupID)&&(t.groupMap.get(e.groupID).updateGroup(e),t._setStorageGroupList()),zi({group:t.groupMap.get(e.groupID)})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),o=n[0],i=n[1];r.setError(e,o,i).end()})),Ve.l("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"_filterProfanity",value:function(e,t){var n=this.getModule(ro);if(!n)return!0;var o=n.filterText(t[e],$),r=o.isAllowedToSend,i=o.modifiedText;return!0===r&&(t[e]=i,!0)}},{key:"joinGroup",value:function(e){var t=this,n=e.groupID,o=e.type,r="".concat(this._n,".joinGroup");if(o===S.GRP_WORK)return Xi({code:gi.CANNOT_JOIN_WORK});if(this.deleteUnjoinedAVChatRoom(n),this.hasLocalGroup(n)){if(!this.isLoggedIn())return Ji({status:S.JOIN_STATUS_ALREADY_IN_GROUP});var i=new Ai("applyJoinGroup");return this.getGroupProfile({groupID:n}).then((function(){return i.setNetworkType(t.getNetworkType()).setMessage("groupID:".concat(n," joinedStatus:").concat(S.JOIN_STATUS_ALREADY_IN_GROUP)).end(),Ji({status:S.JOIN_STATUS_ALREADY_IN_GROUP})})).catch((function(o){return i.setNetworkType(t.getNetworkType()).setMessage("groupID:".concat(n," unjoined")).end(),Ve.w("".concat(r," ").concat(n," was unjoined, now join!")),t.groupMap.delete(n),t.applyJoinGroup(e)}))}return Ve.l("".concat(r," groupID:").concat(n)),this.isLoggedIn()?this.applyJoinGroup(e):this._AVChatRoomHandler.joinWithoutAuth(e)}},{key:"applyJoinGroup",value:function(e){var t=this,o="".concat(this._n,".").concat("applyJoinGroup"),r=e.groupID;if(!$t(e.applyMessage)&&!1===this._filterProfanity("applyMessage",e))return Xi({code:gi.PROFANITY_FOUND});var i=new Ai("applyJoinGroup"),s=n({},e),a=this.canIUse(K.AVCHATROOM_HISTORY_MSG);return a&&(s.historyMessageFlag=1),this.getModule(qn).deleteTopicRoamingMessageInfo(r),this.request({protocolName:Zo,requestData:s}).then((function(e){var n=e.data,s=n.joinedStatus,c=n.longPollingKey,u=n.startSeq,l=n.avChatRoomFlag,d=n.avChatRoomKey,p=n.messageList,h="groupID:".concat(r," joinedStatus:").concat(s," longPollingKey:").concat(c," startSeq:").concat(u)+" avChatRoomFlag:".concat(l," canGetAVChatRoomHistoryMessage:").concat(a,",")+" history message count:".concat($t(p)?0:p.length);switch(i.setNetworkType(t.getNetworkType()).setMessage("".concat(h)).end(),Ve.l("".concat(o," ok. ").concat(h)),s){case $e:return zi({status:$e});case Ye:return t.getGroupProfile({groupID:r}).then((function(e){var n=e.data.group;return t._handleJoinResult({group:n,avChatRoomFlag:l,longPollingKey:c,startSeq:u,avChatRoomKey:d,messageList:p})})).catch((function(){var e=new fs({groupID:r});return t._handleJoinResult({group:e,avChatRoomFlag:l,longPollingKey:c,startSeq:u,avChatRoomKey:d,messageList:p})}));default:var g=new Wi({code:gi.JOIN_GROUP_FAIL});return Ve.e("".concat(o," failed. error:"),g),Xi(g)}})).catch((function(e){return i.setMessage("groupID:".concat(r)),t.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];i.setError(e,o,r).end()})),Ve.e("".concat(o," failed. error:"),e),Xi(e)}))}},{key:"_handleJoinResult",value:function(e){var t,n=this,o=e.group,r=e.avChatRoomFlag,i=e.longPollingKey,s=e.startSeq,a=e.avChatRoomKey,c=e.messageList,u=o.groupID;return 1===r?(this.getModule(qn).setCompleted("".concat(S.CONV_GROUP).concat(u)),this._groupAttributesHandler.initGroupAttributesCache({groupID:u,avChatRoomKey:a}),this._groupCountersHandler.initGroupCountersCache({groupID:u,avChatRoomKey:a}),(t=at(i)?this._AVChatRoomHandler.handleJoinResult({group:o}):this._AVChatRoomHandler.startRunLoop({group:o,longPollingKey:i,startSeq:s})).then((function(){n._onAVChatRoomHistoryMessage(c)})),t):(this.emitGroupListUpdate(!0,!1),zi({status:Ye,group:o}))}},{key:"quitGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("quitGroup");Ve.l("".concat(n," groupID:").concat(e));var o=this.checkJoinedAVChatRoomByID(e);if(!o&&!this.hasLocalGroup(e))return Xi({code:gi.MEMBER_NOT_IN_GROUP});if(o&&!this.isLoggedIn())return Ve.l("".concat(n," anonymously ok. groupID:").concat(e)),this.deleteLocalGroupAndConversation(e),this._AVChatRoomHandler.reset(e),Ji({groupID:e});var r=new Ai("quitGroup");return r.setMessage("groupID:".concat(e)),this.request({protocolName:er,requestData:{groupID:e}}).then((function(){return r.setNetworkType(t.getNetworkType()).end(),Ve.l("".concat(n," ok")),t.deleteLocalGroupAndConversation(e),o&&t._AVChatRoomHandler.reset(e),t._groupAttributesHandler.deleteLocalGroupAttributes(e),zi({groupID:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),o=n[0],i=n[1];r.setError(e,o,i).end()})),Ve.e("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"searchGroupByID",value:function(e){var t=this,n="".concat(this._n,".").concat("searchGroupByID"),o={groupIDList:[e]},r=new Ai("searchGroupByID");return r.setMessage("groupID:".concat(e)),Ve.l("".concat(n," groupID:").concat(e)),this.request({protocolName:tr,requestData:o}).then((function(e){var o=e.data.groupProfile;if(0!==o[0].errorCode)throw new Wi({code:o[0].errorCode,message:o[0].errorInfo});return r.setNetworkType(t.getNetworkType()).end(),Ve.l("".concat(n," ok")),zi({group:new fs(o[0])})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),o=n[0],i=n[1];r.setError(e,o,i).end()})),Ve.w("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"changeGroupOwner",value:function(e){var t=this,n="".concat(this._n,".").concat("changeGroupOwner");if(this.hasLocalGroup(e.groupID)&&this.getLocalGroupProfile(e.groupID).type===S.GRP_AVCHATROOM)return Xi({code:gi.CANNOT_CHANGE_OWNER_IN_AVCHATROOM});if(e.newOwnerID===this.getMyUserID())return Xi({code:gi.CANNOT_CHANGE_OWNER_TO_SELF});var o=new Ai("changeGroupOwner");return o.setMessage("groupID:".concat(e.groupID," newOwnerID:").concat(e.newOwnerID)),Ve.l("".concat(n," groupID:").concat(e.groupID)),this.request({protocolName:nr,requestData:e}).then((function(){o.setNetworkType(t.getNetworkType()).end(),Ve.l("".concat(n," ok"));var r=e.groupID,i=e.newOwnerID;t.groupMap.get(r).ownerID=i;var s=t.getModule(xn).getLocalGroupMemberList(r);if(s instanceof Map){var a=s.get(t.getMyUserID());at(a)||(a.updateRole("Member"),t.groupMap.get(r).selfInfo.role="Member");var c=s.get(i);at(c)||c.updateRole("Owner")}return t.emitGroupListUpdate(!0,!1),zi({group:t.groupMap.get(r)})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),r=n[0],i=n[1];o.setError(e,r,i).end()})),Ve.e("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"getGroupApplicationList",value:function(){return this._groupSystemNoticeHandler.getGroupApplicationList()}},{key:"handleGroupApplication",value:function(e){var t,n,o,r,i,s=this,a="".concat(this._n,".").concat("handleGroupApplication"),c=e.handleAction,u=e.handleMessage,l=e.message,d=e.application;l?(t=l.payload.operatorID,n=l.payload.groupProfile.groupID,o=l.payload.authentication,r=l.payload.messageKey):d&&(t=d.applicant,n=d.groupID,o=d.authentication,r=d.messageKey);var p=or;d&&2===d.applicationType&&(p=rr,i=d.userID);var h=new Ai("handleGroupApplication");return h.setMessage("groupID:".concat(n)),Ve.l("".concat(a," groupID:").concat(n)),this.request({protocolName:p,requestData:{handleAction:c,handleMessage:u,applicant:t,invitee:i,groupID:n,authentication:o,messageKey:r}}).then((function(){return h.setNetworkType(s.getNetworkType()).end(),Ve.l("".concat(a," ok")),l&&s._groupSystemNoticeHandler.deleteGroupSystemNotice({messageList:[e.message]}),zi({group:s.getLocalGroupProfile(n)})})).catch((function(e){return s.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];h.setError(e,o,r).end()})),Ve.e("".concat(a," failed. error"),e),Xi(e)}))}},{key:"handleGroupInvitation",value:function(e){var t=this,o="".concat(this._n,".").concat("handleGroupInvitation"),r=e.message.payload,i=r.groupProfile.groupID,s=r.authentication,a=r.messageKey,c=r.operatorID,u=e.handleAction,l=new Ai("handleGroupInvitation");return l.setMessage("groupID:".concat(i," inviter:").concat(c," handleAction:").concat(u)),Ve.l("".concat(o," groupID:").concat(i," inviter:").concat(c," handleAction:").concat(u)),this.request({protocolName:ir,requestData:n(n({},e),{},{inviter:c,groupID:i,authentication:s,messageKey:a})}).then((function(){return l.setNetworkType(t.getNetworkType()).end(),Ve.l("".concat(o," ok")),t._groupSystemNoticeHandler.deleteGroupSystemNotice({messageList:[e.message]}),zi({group:t.getLocalGroupProfile(i)})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];l.setError(e,o,r).end()})),Ve.e("".concat(o," failed. error"),e),Xi(e)}))}},{key:"getGroupOnlineMemberCount",value:function(e){return this._AVChatRoomHandler?this._AVChatRoomHandler.checkJoinedAVChatRoomByID(e)?this._AVChatRoomHandler.getGroupOnlineMemberCount(e):Ji({memberCount:0}):Xi({code:gi.CANNOT_FIND_MODULE})}},{key:"hasLocalGroup",value:function(e){return this.groupMap.has(e)}},{key:"deleteLocalGroupAndConversation",value:function(e){var t=this.checkJoinedAVChatRoomByID(e);if(Ve.l("".concat(this._n,".deleteLocalGroupAndConversation isJoinedAVChatRoom:").concat(t)),t&&this.getModule(qn).deleteLocalConversation("".concat(S.CONV_GROUP).concat(e)),kt({groupID:e})){var n=this.getLocalGroupProfile(e);n&&!0===n.isSupportTopic&&this.getModule(Fn).deleteTopicListInCommunity(e)}this._deleteLocalGroup(e),this.emitGroupListUpdate(!0,!1)}},{key:"_deleteLocalGroup",value:function(e){this.groupMap.delete(e),this.getModule(xn).deleteGroupMemberList(e),this._setStorageGroupList()}},{key:"sendMessage",value:function(e,t){if(st(e._receiverList)&&e._receiverList.length>0&&!this.canIUse(K.MSG_TO_SPECIFIED_GRP_MBR))return Xi({code:gi.CANNOT_USE_COMMERCIAL_ABILITY});var n=this.createGroupMessagePack(e,t);return this.request(n)}},{key:"createGroupMessagePack",value:function(e,t){var n=null;t&&t.offlinePushInfo&&(n=t.offlinePushInfo);var o="";ot(e.cloudCustomData)&&e.cloudCustomData.length>0&&(o=e.cloudCustomData);var r=[];if(it(t)&&it(t.messageControlInfo)){var i=t.messageControlInfo,s=i.excludedFromUnreadCount,a=i.excludedFromLastMessage,c=i.excludedFromContentModeration;!0===s&&r.push("NoUnread"),!0===a&&r.push("NoLastMsg"),!0===c&&r.push("NoMsgCheck")}var u=void 0;st(e._receiverList)&&e._receiverList.length>0&&(u=e._receiverList,e._receiverList.length>50&&(u=e._receiverList.slice(0,50),this.outputWarning("ReceiverListLimit")));var l=this.isOnlineMessage(e,t)?1:0,d=e.getGroupAtInfoList(),p={fromAccount:this.getMyUserID(),groupID:e.to,msgBody:e.getElements(),cloudCustomData:o,random:e.random,priority:e.priority,clientSequence:e.clientSequence,groupAtInfo:e.type!==S.MSG_TEXT||$t(d)?void 0:d,onlineOnlyFlag:l,clientTime:e.clientTime,offlinePushInfo:n?{pushFlag:!0===n.disablePush?1:0,title:n.title||"",desc:n.description||"",ext:n.extension||"",apnsInfo:{badgeMode:!0===n.ignoreIOSBadge?1:0,isVoipPush:this._isVoipPush(n)},androidInfo:{OPPOChannelID:n.androidOPPOChannelID||""}}:void 0,messageControlInfo:0===l?r:void 0,needReadReceipt:!0!==e.needReadReceipt||this.isMessageFromOrToAVChatroom(e.to)?0:1,receiverList:u,isSupportExtension:!0===e.isSupportExtension?1:0};return Dt(e.to)&&(p.groupID=Bt(e.to),p.topicID=e.to),{protocolName:mo,tjgID:this.generateTjgID(e),requestData:p}}},{key:"_isVoipPush",value:function(e){var t=void 0;return at(e.disableVoipPush)||(t=!1===e.disableVoipPush?1:0),t}},{key:"revokeMessage",value:function(e){var t={groupID:e.to,msgSeqList:[{msgSeq:e.sequence}]};return Dt(e.to)&&(t.groupID=Bt(e.to),t.topicID=e.to),this.request({protocolName:sr,requestData:t})}},{key:"deleteMessage",value:function(e){var t=e.to,n=e.keyList;Ve.l("".concat(this._n,".deleteMessage groupID:").concat(t," count:").concat(n.length));var o={groupID:t,deleter:this.getMyUserID(),keyList:n};return Dt(t)&&(o.groupID=Bt(t),o.topicID=t),this.request({protocolName:yr,requestData:o})}},{key:"modifyRemoteMessage",value:function(e){var t=e.to,n=e.sequence,o=e.payload,r=e.type,i=e.version,s=void 0===i?0:i,a=e.cloudCustomData,c=t,u=void 0;Dt(t)&&(c=Bt(t),u=t);var l=void 0;return Kt(r)&&(l=[]).push({type:r,content:o}),this.request({protocolName:Mr,requestData:{groupID:c,topicID:u,sequence:n,version:s,elements:l,cloudCustomData:a}})}},{key:"getRoamingMessage",value:function(e){var t=this,n="".concat(this._n,".getRoamingMessage"),o=e.conversationID,r=e.groupID,i=e.sequence,s=new Ai("getGroupRoamingMessages"),a=0,c=void 0;return Dt(r)&&(r=Bt(c=r)),this._computeLastSequence({groupID:r,topicID:c,sequence:i}).then((function(e){return a=e,Ve.l("".concat(n," groupID:").concat(r," startSequence:").concat(a)),t.request({protocolName:ur,requestData:{groupID:r,count:21,sequence:a,topicID:c}})})).then((function(e){var i=e.data,u=i.messageList,l=i.complete,d=i.invisibleSequenceList,p=void 0===d?[]:d;at(u)?Ve.l("".concat(n," ok. complete:").concat(l," but messageList is undefined!")):Ve.l("".concat(n," ok. complete:").concat(l," count:").concat(u.length));var h=t._getMinSequence(p,u)-1;s.setNetworkType(t.getNetworkType()).setMessage("groupID:".concat(r," topicID:").concat(c," startSequence:").concat(a," complete:").concat(l," nextSequence:").concat(h)).end();var g=t.getModule(qn),f=[];return $t(u)||(g.updateRoamingMessageSequence(o,h),f=g.onRoamingMessage(u,o),g.updateIsRead(o),g.patchConversationLastMessage(o)),(2===l||h<=1)&&(g.setCompleted(o),h=""),Ve.l("".concat(n," nextReqID:").concat(h,", stored message count:").concat(f.length,", invisible sequence count:").concat(p.length)),{nextReqID:h+"",storedMessageList:f}})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),o=n[0],i=n[1];s.setError(e,o,i).setMessage("groupID:".concat(r," topicID:").concat(c," startSequence:").concat(a)).end()})),Ve.w("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"_getGroupIDOfMessage",value:function(e){return e.conversationID.replace(S.CONV_GROUP,"")}},{key:"_getMinSequence",value:function(e,t){var n=0;$t(t)||(n=t[t.length-1].sequence);var o=0;return $t(e)||(o=e[e.length-1]),Ve.l("".concat(this._n,"._getMinSequence minVisibleSequence:").concat(n," minInvisibleSequence:").concat(o)),o>0&&o<n?o:n}},{key:"getReadReceiptList",value:function(e){var t=this,n="".concat(this._n,".").concat("getReadReceiptList"),o=this._getGroupIDOfMessage(e[0]),r=this.getMyUserID(),i=e.filter((function(e){return e.from===r&&!0===e.needReadReceipt})).map((function(e){return{sequence:e.sequence}}));if(Ve.l("".concat(n," groupID:").concat(o," sequenceList:").concat(JSON.stringify(i))),0===i.length)return Ji({messageList:e});var s=new Ai("getReadReceiptList");return s.setMessage("groupID:".concat(o)),this.request({protocolName:lr,requestData:{groupID:o,sequenceList:i}}).then((function(t){s.end(),Ve.l("".concat(n," ok"));var o=t.data.readReceiptList;return st(o)&&o.forEach((function(t){e.forEach((function(e){0===t.code&&t.sequence===e.sequence&&(e.readReceiptInfo.readCount=t.readCount,e.readReceiptInfo.unreadCount=t.unreadCount)}))})),zi({messageList:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];s.setError(e,o,r).end()})),Ve.w("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"sendReadReceipt",value:function(e){var t=this,n="".concat(this._n,".").concat("sendReadReceipt"),o=this._getGroupIDOfMessage(e[0]),r=new Ai("sendReadReceipt");r.setMessage("groupID:".concat(o));var i=this.getMyUserID(),s=e.filter((function(e){return e.from!==i&&!0===e.needReadReceipt})).map((function(e){return{sequence:e.sequence}}));return 0===s.length?Xi({code:gi.READ_RECEIPT_MESSAGE_LIST_EMPTY}):(Ve.l("".concat(n,". sequenceList:").concat(JSON.stringify(s))),this.request({protocolName:dr,requestData:{groupID:o,sequenceList:s}}).then((function(e){return r.end(),Ve.l("".concat(n," ok")),zi()})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),o=n[0],i=n[1];r.setError(e,o,i).end()})),Ve.w("".concat(n," failed. error:"),e),Xi(e)})))}},{key:"getReadReceiptDetail",value:function(e){var t=this,n=e.message,o=e.filter,r=e.cursor,i=e.count,s=this._getGroupIDOfMessage(n),a=n.ID,c=n.sequence,u="".concat(this._n,".").concat("getReadReceiptDetail"),l=this._receiptDetailCompleteMap.get(a)||!1,d=0!==o&&1!==o?0:o,p=ot(r)?r:"",h=!nt(i)||i<=0||i>=100?100:i,g="groupID:".concat(s," sequence:").concat(c," cursor:").concat(p," filter:").concat(d," completeFlag:").concat(l);Ve.l("".concat(u," ").concat(g));var f={cursor:"",isCompleted:!1,messageID:a,unreadUserIDList:[],readUserIDList:[]},_=new Ai("getReadReceiptDetail");return _.setMessage(g),this.request({protocolName:hr,requestData:{groupID:s,sequence:c,flag:d,cursor:p,count:h}}).then((function(e){_.end();var n=e.data,o=n.cursor,r=n.isCompleted,i=n.unreadUserIDList,s=n.readUserIDList;return f.cursor=o,1===r&&(f.isCompleted=!0,t._receiptDetailCompleteMap.set(a,!0)),0===d?f.readUserIDList=s.map((function(e){return e.userID})):1===d&&(f.unreadUserIDList=i.map((function(e){return e.userID}))),Ve.l("".concat(u," ok")),zi(f)})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];_.setError(e,o,r).end()})),Ve.w("".concat(u," failed. error:"),e),Xi(e)}))}},{key:"getRoamingMessagesHopping",value:function(e){var t=this,n="".concat(this._n,".getRoamingMessagesHopping"),o=new Ai("getGroupRoamingMessagesHopping"),r=e.groupID,i=e.count,s=e.sequence,a=e.direction,c=s;1===a&&(c=s+i-1);var u=void 0;Dt(r)&&(r=Bt(u=r));var l="".concat(u?"topicID:".concat(u):"groupID:".concat(r)," sequence:").concat(s," direction:").concat(a);return Ve.l("".concat(n," ").concat(l)),this.request({protocolName:ur,requestData:{groupID:r,topicID:u,count:i,sequence:c}}).then((function(r){var i=r.data,c=i.messageList,u=i.complete,d="complete:".concat(u," count:").concat(c?c.length:0);if(Ve.l("".concat(n," ok. ").concat(d)),o.setNetworkType(t.getNetworkType()).setMessage("".concat(l," ").concat(d)).end(),2===u||$t(c)){var p=t._computeResult();return zi(p)}var h="".concat(S.CONV_GROUP).concat(e.groupID),g=t.getModule(qn).onRoamingMessage(c,h,!1),f=t._computeResult({direction:a,sequence:s,remoteMessageList:c,processedMessageList:g});return zi(f)})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),a=n[0],c=n[1];o.setError(e,a,c).setMessage("groupID:".concat(r," sequence:").concat(s," count:").concat(i)).end()})),Ve.w("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"_computeResult",value:function(e){var t={messageList:[],isCompleted:!1,nextMessageSeq:""};if(at(e))return t.isCompleted=!0,t;var n=e.direction,o=e.sequence,r=e.remoteMessageList,i=void 0===r?[]:r,s=e.processedMessageList,a=void 0===s?[]:s,c=i.length;return 1===n?(t.nextMessageSeq=i[0].sequence+1,a.forEach((function(e){e.sequence>=o&&t.messageList.push(e)})),0===t.messageList.length&&i[0].sequence<o&&(t.isCompleted=!0,t.nextMessageSeq=""),t):(t.nextMessageSeq=i[c-1].sequence-1,t.messageList=y(a),0===t.nextMessageSeq&&(t.isCompleted=!0,t.nextMessageSeq=""),t)}},{key:"setMessageRead",value:function(e){var t=this,n=e.conversationID,o=e.lastMessageSeq,r="".concat(this._n,".setMessageRead");Ve.l("".concat(r," conversationID:").concat(n," lastMessageSeq:").concat(o)),nt(o)||this.outputWarning("DoNotModifyLastSeq");var i=new Ai("setGroupMessageRead");i.setMessage("".concat(n,"-").concat(o));var s=n.replace(S.CONV_GROUP,""),a=void 0;return Dt(s)&&(s=Bt(a=s)),this.request({protocolName:ar,requestData:{groupID:s,topicID:a,messageReadSeq:o}}).then((function(){i.setNetworkType(t.getNetworkType()).end(),Ve.l("".concat(r," ok."));var e=t.getModule(qn);e.updateIsReadAfterReadReport({conversationID:n,lastMessageSeq:o});var c=!0;if(!at(a)){c=!1;var u=t.getModule(Fn).getLocalTopic(s,a);u&&u.updateSelfInfo({readedSequence:o})}return e.updateUnreadCount(n,c),zi()})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];i.setError(e,o,r).end()})),Ve.l("".concat(r," failed. error:"),e),Xi(e)}))}},{key:"_computeLastSequence",value:function(e){var t=e.groupID,n=e.topicID,o=void 0===n?void 0:n,r=e.sequence;return r>0?Promise.resolve(r):at(o)||this.hasLocalGroup(t)?at(o)?this.getGroupLastSequence(t):this.getTopicLastSequence({groupID:t,topicID:o}):Promise.resolve(0)}},{key:"getGroupLastSequence",value:function(e){var t=this,n="".concat(this._n,".").concat("getGroupLastSequence"),o=new Ai("getGroupLastSequence"),r=0,i="";if(this.hasLocalGroup(e)){var s=this.getLocalGroupProfile(e),a=s.lastMessage;if(a.lastSequence>0&&!1===a.onlineOnlyFlag)return r=a.lastSequence,i="got lastSequence:".concat(r," from local group profile[lastMessage.lastSequence]. groupID:").concat(e),Ve.l("".concat(n," ").concat(i)),o.setNetworkType(this.getNetworkType()).setMessage("".concat(i)).end(),Promise.resolve(r);if(s.nextMessageSeq>1)return r=s.nextMessageSeq-1,i="got lastSequence:".concat(r," from local group profile[nextMessageSeq]. groupID:").concat(e),Ve.l("".concat(n," ").concat(i)),o.setNetworkType(this.getNetworkType()).setMessage("".concat(i)).end(),Promise.resolve(r)}var c="GROUP".concat(e),u=this.getModule(qn).getLocalConversation(c);if(u&&u.lastMessage.lastSequence&&!1===u.lastMessage.onlineOnlyFlag)return r=u.lastMessage.lastSequence,i="got lastSequence:".concat(r," from local conversation profile[lastMessage.lastSequence]. groupID:").concat(e),Ve.l("".concat(n," ").concat(i)),o.setNetworkType(this.getNetworkType()).setMessage("".concat(i)).end(),Promise.resolve(r);var l={groupIDList:[e],responseFilter:{groupBaseInfoFilter:["NextMsgSeq"]}};return this.getGroupProfileAdvance(l).then((function(s){var a=s.data.successGroupList;return $t(a)?Ve.l("".concat(n," successGroupList is empty. groupID:").concat(e)):(r=a[0].nextMessageSeq-1,i="got lastSequence:".concat(r," from getGroupProfileAdvance. groupID:").concat(e),Ve.l("".concat(n," ").concat(i))),o.setNetworkType(t.getNetworkType()).setMessage("".concat(i)).end(),r})).catch((function(r){return t.probeNetwork().then((function(t){var n=v(t,2),i=n[0],s=n[1];o.setError(r,i,s).setMessage("get lastSequence failed from getGroupProfileAdvance. groupID:".concat(e)).end()})),Ve.w("".concat(n," failed. error:"),r),Xi(r)}))}},{key:"getTopicLastSequence",value:function(e){var t=this,n=e.groupID,o=e.topicID,r="".concat(this._n,".").concat("getTopicLastSequence"),i=new Ai("getTopicLastSequence"),s=0,a="",c=this.getModule(Fn);return c.hasLocalTopic(n,o)?(s=c.getLocalTopic(n,o).nextMessageSeq-1,a="get lastSequence:".concat(s," from local topic info[nextMessageSeq]. topicID:").concat(o),Ve.l("".concat(r," ").concat(a)),i.setNetworkType(this.getNetworkType()).setMessage("".concat(a)).end(),Promise.resolve(s)):c.getTopicList({groupID:n,topicIDList:[o]}).then((function(e){var n=e.data.successTopicList;return $t(n)?Ve.l("".concat(r," successTopicList is empty. topicID:").concat(o)):(s=n[0].nextMessageSeq-1,a="get lastSequence:".concat(s," from getTopicList. topicID:").concat(o),Ve.l("".concat(r," ").concat(a))),i.setNetworkType(t.getNetworkType()).setMessage("".concat(a)).end(),s})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),r=n[0],s=n[1];i.setError(e,r,s).setMessage("get lastSequence failed from getTopicList. topicID:".concat(o)).end()})),Ve.w("".concat(r," failed. error:"),e),Xi(e)}))}},{key:"isMessageFromOrToAVChatroom",value:function(e){return!!this._AVChatRoomHandler&&this._AVChatRoomHandler.checkJoinedAVChatRoomByID(e)}},{key:"hasJoinedAVChatRoom",value:function(){return this._AVChatRoomHandler?this._AVChatRoomHandler.hasJoinedAVChatRoom():0}},{key:"getJoinedAVChatRoom",value:function(){return this._AVChatRoomHandler?this._AVChatRoomHandler.getJoinedAVChatRoom():[]}},{key:"isOnlineMessage",value:function(e,t){return!(!this._canIUseOnlineOnlyFlag(e)||!t||!0!==t.onlineUserOnly)}},{key:"_canIUseOnlineOnlyFlag",value:function(e){var t=this.getJoinedAVChatRoom();return!t||!t.includes(e.to)||e.conversationType!==S.CONV_GROUP}},{key:"_onAVChatRoomHistoryMessage",value:function(e){if(!$t(e)){Ve.l("".concat(this._n,"._onAVChatRoomHistoryMessage count:").concat(e.length));var t=[];e.forEach((function(e){t.push(n(n({},e),{},{isHistoryMessage:1}))})),this.onAVChatRoomMessage(t)}}},{key:"onAVChatRoomMessage",value:function(e){this._AVChatRoomHandler&&this._AVChatRoomHandler.onMessage(e)}},{key:"onAVChatRoomMemberBanned",value:function(e){this._AVChatRoomHandler&&this._AVChatRoomHandler.onAVChatRoomMemberBanned(e)}},{key:"getGroupSimplifiedInfo",value:function(e){var t=this,n=new Ai("getGroupSimplifiedInfo"),o={groupIDList:[e],responseFilter:{groupBaseInfoFilter:["Type","Name"]}};return this.getGroupProfileAdvance(o).then((function(o){var r=o.data.successGroupList;return n.setNetworkType(t.getNetworkType()).setMessage("groupID:".concat(e," type:").concat(r[0].type)).end(),r[0]})).catch((function(o){t.probeNetwork().then((function(t){var r=v(t,2),i=r[0],s=r[1];n.setError(o,i,s).setMessage("groupID:".concat(e)).end()}))}))}},{key:"setUnjoinedAVChatRoom",value:function(e){this._unjoinedAVChatRoomList.set(e,1)}},{key:"deleteUnjoinedAVChatRoom",value:function(e){this._unjoinedAVChatRoomList.has(e)&&this._unjoinedAVChatRoomList.delete(e)}},{key:"isUnjoinedAVChatRoom",value:function(e){return this._unjoinedAVChatRoomList.has(e)}},{key:"isGroupAttributesUpdatedNotice",value:function(e){return this._groupAttributesHandler.isGroupAttributesUpdatedNotice(e)}},{key:"updateLocalMainSequenceOnReconnected",value:function(){this._groupAttributesHandler.updateLocalMainSequenceOnReconnected()}},{key:"initGroupAttributes",value:function(e){return this._groupAttributesHandler.initGroupAttributes(e)}},{key:"setGroupAttributes",value:function(e){return this._groupAttributesHandler.setGroupAttributes(e)}},{key:"deleteGroupAttributes",value:function(e){return this._groupAttributesHandler.deleteGroupAttributes(e)}},{key:"getGroupAttributes",value:function(e){return this._groupAttributesHandler.getGroupAttributes(e)}},{key:"isMessageFromTopic",value:function(e,t){return 2===e&&!$t(t)}},{key:"isMessageFromCommunityOfTopic",value:function(e,t){return 2===e&&$t(t)}},{key:"getMessageExtensions",value:function(e,t){return Ve.l("".concat(this._n,".getMessageExtensions startSequence:").concat(t)),this.request({protocolName:Sr,requestData:{groupID:e.to,messageSequence:e.sequence,startSequence:t}})}},{key:"modifyMessageExtensions",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Ve.l("".concat(this._n,".modifyMessageExtensions operateType:").concat(n)),this.request({protocolName:Dr,requestData:{groupID:e.to,messageSequence:e.sequence,extensionList:t,operateType:n}})}},{key:"getGroupNotify",value:function(e){var t=this;if(this.hasLocalGroup(e)){var o=this.getLocalGroupProfile(e),r=o.type,i=o.isSupportTopic;if(!Et(r)&&!i){var s="".concat(this._n,".getGroupNotify"),a=this._getGroupLastRevokedTime(e),c=1e3*Pe();Ve.l("".concat(s," groupID:").concat(e," type:").concat(r," beginTime:").concat(a," endTime:").concat(c)),this.request({protocolName:Lr,requestData:{type:kt({type:r,groupID:e})?S.GRP_COMMUNITY:void 0,groupID:e,beginTime:a,endTime:c}}).then((function(o){var r=o.data,i=r.nextRevokedTime,a=r.notifyList;Ve.l("".concat(s," ok. groupID:").concat(e," nextRevokedTime:").concat(i));var c={dataList:[{elements:{revokedInfos:[]}}]};st(a)&&a.forEach((function(t){c.dataList[0].elements.revokedInfos.push({groupID:e,sequence:t.sequence,random:t.random,revokerInfo:n({},t.revokerInfo)})})),t.onGroupMessageRevoked(c),0!==i?(t._setGroupLastRevokedTime(e,i),t.getGroupNotify(e)):t._setGroupLastRevokedTime(e,1e3*Pe())})).catch((function(e){Ve.e("".concat(s," failed. error:"),e)}))}}}},{key:"_getGroupLastRevokedTime",value:function(e){return this.hasLocalGroup(e)?this.getLocalGroupProfile(e)._lastRevokedTime:0}},{key:"_setGroupLastRevokedTime",value:function(e,t){this.hasLocalGroup(e)&&(this.getLocalGroupProfile(e)._lastRevokedTime=t)}},{key:"isGroupCountersNotice",value:function(e){return this._groupCountersHandler.isGroupCountersNotice(e)}},{key:"setGroupCounters",value:function(e){return this._groupCountersHandler.setGroupCounters(e)}},{key:"increaseGroupCounter",value:function(e){return this._groupCountersHandler.increaseGroupCounter(e)}},{key:"decreaseGroupCounter",value:function(e){return this._groupCountersHandler.decreaseGroupCounter(e)}},{key:"getGroupCounters",value:function(e){return this._groupCountersHandler.getGroupCounters(e)}},{key:"restartPolling",value:function(){this._AVChatRoomHandler&&this._AVChatRoomHandler.restartPolling()}},{key:"getPollingTimerID",value:function(e){if(!e)return-1;var t=this.getLocalGroupProfile(e);return t&&Et(t.type)?this._AVChatRoomHandler.getPollingTimerID(e):-1}},{key:"_canIUseJoinOption",value:function(e){return e===S.GRP_PUBLIC||kt({type:e})}},{key:"reset",value:function(){this.groupMap.clear(),this._unjoinedAVChatRoomList.clear(),this._receiptDetailCompleteMap.clear(),this._commonGroupHandler.reset(),this._groupSystemNoticeHandler.reset(),this._groupTipsHandler.reset(),this._groupAttributesHandler.reset(),this._groupCountersHandler.reset(),this._AVChatRoomHandler&&this._AVChatRoomHandler.reset()}}]),o}(co),Bs=function(){function e(t){r(this,e),this.userID="",this.avatar="",this.nick="",this.role="",this.joinTime="",this.lastSendMsgTime="",this.nameCard="",this.muteUntil=0,this.memberCustomField=[],this._initMember(t)}return s(e,[{key:"_initMember",value:function(e){this.updateMember(e)}},{key:"updateMember",value:function(e){var t=[null,void 0,"",0,NaN];e.memberCustomField&&Tt(this.memberCustomField,e.memberCustomField),ht(this,e,["memberCustomField","marks"],t)}},{key:"updateRole",value:function(e){["Owner","Admin","Member"].indexOf(e)<0||(this.role=e)}},{key:"updateMuteUntil",value:function(e){at(e)||(this.muteUntil=Math.floor((Date.now()+1e3*e)/1e3))}},{key:"updateNameCard",value:function(e){at(e)||(this.nameCard=e)}},{key:"updateMemberCustomField",value:function(e){e&&Tt(this.memberCustomField,e)}}]),e}(),Vs=function(e){c(o,e);var t=m(o);function o(e){var n;return r(this,o),(n=t.call(this,e))._n="GroupMemberModule",n.groupMemberListMap=new Map,n.getInnerEmitterInstance().on(os,n._onProfileUpdated,f(n)),n}return s(o,[{key:"_onProfileUpdated",value:function(e){for(var t=this,n=e.data,o=function(e){var o=n[e];t.groupMemberListMap.forEach((function(e){e.has(o.userID)&&e.get(o.userID).updateMember({nick:o.nick,avatar:o.avatar})}))},r=0;r<n.length;r++)o(r)}},{key:"deleteGroupMemberList",value:function(e){this.groupMemberListMap.delete(e)}},{key:"getGroupMemberList",value:function(e){var t=this,n=e.groupID,o=e.offset,r=void 0===o?0:o,i=e.count,s=void 0===i?15:i,a=e.filter,c=void 0===a?void 0:a,u="".concat(this._n,".").concat("getGroupMemberList"),l=this.getModule(Pn),d=l.hasLocalGroup(n);if(Ve.l("".concat(u," groupID:").concat(n," offset:").concat(r," count:").concat(s," hasLocalGroup:").concat(d)),!d)return Ji({memberList:[],offset:0});if(l.getLocalGroupProfile(n).type===S.GRP_AVCHATROOM){if(this.canIUse(K.AVCHATROOM_MBR_LIST))return this._getAVChatRoomMemberList({groupID:n,offset:r,filter:c});this.outputWarning("LiveOnlineMember")}var p=new Ai("getGroupMemberList"),h=0,g={groupID:n,limit:s>100?100:s};kt({groupID:n})?g.next="".concat(r):(g.offset=r,h=r+s);var f=[];return this.request({protocolName:Or,requestData:g}).then((function(e){var o=e.data,r=o.members,i=o.memberNum,s=o.next,a=void 0===s?void 0:s;if(at(a)||(h=$t(a)?0:a),!st(r)||0===r.length)return h=0,Promise.resolve([]);var c=t.getModule(Pn);return c.hasLocalGroup(n)&&(c.getLocalGroupProfile(n).memberNum=i),f=t._updateLocalGroupMemberMap(n,r),t.getModule(bn).getUserProfile({userIDList:r.map((function(e){return e.userID})),tagList:[He.NICK,He.AVATAR]})})).then((function(e){var o=e.data;if(!st(o)||0===o.length)return Ji({memberList:[],offset:h});var i=o.map((function(e){return{userID:e.userID,nick:e.nick,avatar:e.avatar}}));return t._updateLocalGroupMemberMap(n,i),f.length<s&&(h=0),p.setNetworkType(t.getNetworkType()).setMessage("groupID:".concat(n," offset:").concat(r," count:").concat(s)).end(),Ve.l("".concat(u," ok.")),zi({memberList:f,offset:h})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];p.setError(e,o,r).end()})),Ve.e("".concat(u," failed. error:"),e),Xi(e)}))}},{key:"_getAVChatRoomMemberList",value:function(e){var t=this,n=e.groupID,o=e.offset,r=e.filter,i="".concat(this._n,".").concat("_getAVChatRoomMemberList"),s=new Ai("_getAVChatRoomMemberList");return s.setMessage("groupID:".concat(n," offset:").concat(o," filter:").concat(r)),this.request({protocolName:Nr,requestData:{groupID:n,offset:o,filter:r}}).then((function(e){var o=e.data,r=o.memberList,a=void 0===r?[]:r,c=o.offset,u=void 0===c?0:c;s.setNetworkType(t.getNetworkType()).end(),Ve.l("".concat(i," ok. member count:").concat(a.length,", next request timestamp:").concat(u));var l=t._updateLocalGroupMemberMap(n,a);return zi({memberList:l,offset:u})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];s.setError(e,o,r).end()})),Ve.e("".concat(i," failed. error:"),e),Xi(e)}))}},{key:"getGroupMemberProfile",value:function(e){var t=this,o="".concat(this._n,".").concat("getGroupMemberProfile"),r=new Ai("getGroupMemberProfile");r.setMessage(e.userIDList.length>5?"userIDList.length:".concat(e.userIDList.length):"userIDList:".concat(e.userIDList)),Ve.l("".concat(o," groupID:").concat(e.groupID," userIDList:").concat(e.userIDList.join(","))),e.userIDList.length>50&&(e.userIDList=e.userIDList.slice(0,50));var i=e.groupID,s=e.userIDList;return this._getGroupMemberProfileAdvance(n(n({},e),{},{userIDList:s})).then((function(e){var n=e.data.members;return st(n)&&0!==n.length?(t._updateLocalGroupMemberMap(i,n),t.getModule(bn).getUserProfile({userIDList:n.map((function(e){return e.userID})),tagList:[He.NICK,He.AVATAR]})):Ji([])})).then((function(e){var n=e.data.map((function(e){return{userID:e.userID,nick:e.nick,avatar:e.avatar}}));t._updateLocalGroupMemberMap(i,n);var o=s.filter((function(e){return t.hasLocalGroupMember(i,e)})).map((function(e){return t.getLocalGroupMemberInfo(i,e)}));return r.setNetworkType(t.getNetworkType()).end(),zi({memberList:o})}))}},{key:"addGroupMember",value:function(e){var t=this,n="".concat(this._n,".").concat("addGroupMember"),o=e.groupID,r=this.getModule(Pn).getLocalGroupProfile(o),i=r.type,s=new Ai("addGroupMember");if(s.setMessage("groupID:".concat(o," groupType:").concat(i)),Et(i)){var a=new Wi({code:gi.CANNOT_ADD_MEMBER_IN_AVCHATROOM});return s.setError(a,!0,this.getNetworkType()).end(),Xi(a)}return e.userIDList=e.userIDList.map((function(e){return{userID:e}})),Ve.l("".concat(n," groupID:").concat(o)),this.request({protocolName:br,requestData:e}).then((function(o){var i=o.data.members;Ve.l("".concat(n," ok"));var a=i.filter((function(e){return 1===e.result})).map((function(e){return e.userID})),c=i.filter((function(e){return 0===e.result})).map((function(e){return e.userID})),u=i.filter((function(e){return 2===e.result})).map((function(e){return e.userID})),l=i.filter((function(e){return 4===e.result})).map((function(e){return e.userID})),d="groupID:".concat(e.groupID,", ")+"successUserIDList:".concat(a,", ")+"failureUserIDList:".concat(c,", ")+"existedUserIDList:".concat(u,", ")+"overLimitUserIDList:".concat(l);return s.setNetworkType(t.getNetworkType()).setMoreMessage(d).end(),0===a.length?zi({successUserIDList:a,failureUserIDList:c,existedUserIDList:u,overLimitUserIDList:l}):(r.memberCount+=a.length,t._updateConversationGroupProfile(r),zi({successUserIDList:a,failureUserIDList:c,existedUserIDList:u,overLimitUserIDList:l,group:r}))})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];s.setError(e,o,r).end()})),Ve.e("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"deleteGroupMember",value:function(e){var t=this,n="".concat(this._n,".").concat("deleteGroupMember"),o=e.groupID,r=e.userIDList,i=this.getModule(Pn).getLocalGroupProfile(o);if(at(i))return Xi({code:gi.CANNOT_FIND_GROUP});if(Et(i.type))return this.canIUse(K.AVCHATROOM_BAN_MBR)?this._banAVChatRoomMember(e):Xi({code:gi.CANNOT_USE_COMMERCIAL_ABILITY});var s=new Ai("deleteGroupMember"),a="groupID:".concat(o," ").concat(r.length>5?"userIDList.length:".concat(r.length):"userIDList:".concat(r));return s.setMessage(a),Ve.l("".concat(n," groupID:").concat(o," userIDList:"),r),this.request({protocolName:Ur,requestData:e}).then((function(){return s.setNetworkType(t.getNetworkType()).end(),Ve.l("".concat(n," ok")),i.memberCount-=1,t._updateConversationGroupProfile(i),t.deleteLocalGroupMembers(o,r),zi({group:i,userIDList:r})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];s.setError(e,o,r).end()})),Ve.e("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"_updateConversationGroupProfile",value:function(e){this.getModule(qn).updateConversationGroupProfile([e])}},{key:"_banAVChatRoomMember",value:function(e){var t=this,n="".concat(this._n,".").concat("deleteGroupMember"),o=e.groupID,r=e.userIDList,i="groupID:".concat(o," ").concat(r.length>5?"userIDList.length:".concat(r.length):"userIDList:".concat(r)),s=new Ai("deleteGroupMember");s.setMessage(i),Ve.l("".concat(n," groupID:").concat(o," userIDList:"),r);var a=this.getModule(Pn).getLocalGroupProfile(o);return at(e.duration)||0===e.duration?Xi({code:gi.BAN_DURATION_INVALID}):this.request({protocolName:Pr,requestData:e}).then((function(){return s.setNetworkType(t.getNetworkType()).end(),Ve.l("".concat(n," ok")),t.deleteLocalGroupMembers(o,r),zi({group:a,userIDList:r})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];s.setError(e,o,r).end()})),Ve.e("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"setGroupMemberMuteTime",value:function(e){var t=this,n=e.groupID,o=e.userID,r=e.muteTime,i="".concat(this._n,".").concat("setGroupMemberMuteTime");if(o===this.getMyUserID())return Xi(new Wi({code:gi.CANNOT_MUTE_SELF}));Ve.l("".concat(i," groupID:").concat(n," userID:").concat(o));var s=new Ai("setGroupMemberMuteTime");return s.setMessage("groupID:".concat(n," userID:").concat(o," muteTime:").concat(r)),this.modifyGroupMemberInfo({groupID:n,userID:o,muteTime:r}).then((function(e){s.setNetworkType(t.getNetworkType()).end(),Ve.l("".concat(i," ok"));var o=t.getModule(Pn);return zi({group:o.getLocalGroupProfile(n),member:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];s.setError(e,o,r).end()})),Ve.e("".concat(i," failed. error:"),e),Xi(e)}))}},{key:"setGroupMemberRole",value:function(e){var t=this,n="".concat(this._n,".").concat("setGroupMemberRole"),o=e.groupID,r=e.userID,i=e.role,s=this.getModule(Pn).getLocalGroupProfile(o);if(s.selfInfo.role!==S.GRP_MBR_ROLE_OWNER)return Xi({code:gi.NOT_OWNER});if([S.GRP_WORK,S.GRP_AVCHATROOM].includes(s.type))return Xi({code:gi.CANNOT_SET_MEMBER_ROLE_IN_WORK_AND_AVCHATROOM});var a=[S.GRP_MBR_ROLE_ADMIN,S.GRP_MBR_ROLE_MEMBER];if(kt({groupID:o})&&a.push(S.GRP_MBR_ROLE_CUSTOM),a.indexOf(i)<0)return Xi({code:gi.INVALID_MEMBER_ROLE});if(r===this.getMyUserID())return Xi({code:gi.CANNOT_SET_SELF_MEMBER_ROLE});var c=new Ai("setGroupMemberRole");return c.setMessage("groupID:".concat(o," userID:").concat(r," role:").concat(i)),Ve.l("".concat(n," groupID:").concat(o," userID:").concat(r)),this.modifyGroupMemberInfo({groupID:o,userID:r,role:i}).then((function(e){return c.setNetworkType(t.getNetworkType()).end(),Ve.l("".concat(n," ok")),zi({group:s,member:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];c.setError(e,o,r).end()})),Ve.e("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"_filterProfanity",value:function(e,t){var n=this.getModule(ro);if(!n)return!0;var o=n.filterText(t[e],J),r=o.isAllowedToSend,i=o.modifiedText;return!0===r&&(t[e]=i,!0)}},{key:"setGroupMemberNameCard",value:function(e){var t=this,n="".concat(this._n,".").concat("setGroupMemberNameCard");if(e.nameCard&&!1===this._filterProfanity("nameCard",e))return Xi({code:gi.PROFANITY_FOUND});var o=e.groupID,r=e.userID,i=void 0===r?this.getMyUserID():r,s=e.nameCard;Ve.l("".concat(n," groupID:").concat(o," userID:").concat(i));var a=new Ai("setGroupMemberNameCard");return a.setMessage("groupID:".concat(o," userID:").concat(i," nameCard:").concat(s)),this.modifyGroupMemberInfo({groupID:o,userID:i,nameCard:s}).then((function(e){Ve.l("".concat(n," ok")),a.setNetworkType(t.getNetworkType()).end();var r=t.getModule(Pn).getLocalGroupProfile(o);return i===t.getMyUserID()&&r&&r.setSelfNameCard(s),zi({group:r,member:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];a.setError(e,o,r).end()})),Ve.e("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"setGroupMemberCustomField",value:function(e){var t=this,n="".concat(this._n,".").concat("setGroupMemberCustomField"),o=e.groupID,r=e.userID,i=void 0===r?this.getMyUserID():r,s=e.memberCustomField;Ve.l("".concat(n," groupID:").concat(o," userID:").concat(i));var a=new Ai("setGroupMemberCustomField");return a.setMessage("groupID:".concat(o," userID:").concat(i," memberCustomField:").concat(JSON.stringify(s))),this.modifyGroupMemberInfo({groupID:o,userID:i,memberCustomField:s}).then((function(e){a.setNetworkType(t.getNetworkType()).end(),Ve.l("".concat(n," ok"));var r=t.getModule(Pn).getLocalGroupProfile(o);return zi({group:r,member:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];a.setError(e,o,r).end()})),Ve.e("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"modifyGroupMemberInfo",value:function(e){var t=this,o=e.groupID,r=e.userID,i=void 0;return Dt(o)&&(o=Bt(i=o)),this.request({protocolName:Gr,requestData:n(n({},e),{},{groupID:o,topicID:i})}).then((function(){if(t.hasLocalGroupMember(o,r)){var n=t.getLocalGroupMemberInfo(o,r);return at(e.muteTime)||n.updateMuteUntil(e.muteTime),at(e.role)||n.updateRole(e.role),at(e.nameCard)||n.updateNameCard(e.nameCard),at(e.memberCustomField)||n.updateMemberCustomField(e.memberCustomField),n}return t.getGroupMemberProfile({groupID:o,userIDList:[r]}).then((function(e){return v(e.data.memberList,1)[0]}))}))}},{key:"markGroupMemberList",value:function(e){var t=this,n="".concat(this._n,".").concat("markGroupMemberList"),o=e.groupID,r=e.markType,i=e.enableMark,s=e.userIDList,a=void 0===s?[]:s,c="groupID:".concat(o," markType:").concat(r," enableMark:").concat(i," userIDList count: ").concat(a.length);Ve.l("".concat(n," ").concat(c));var u=2,l=[];!0===i&&(u=1);var d=y(a);a.length>500&&(d=a.slice(0,500),Ve.w("".concat(n," ").concat(zt(500)))),d.forEach((function(e){l.push({userID:e,markType:[r]})})),d=null;var p=new Ai("markGroupMemberList");return p.setMessage("".concat(c)),this.request({protocolName:xr,requestData:{groupID:o,operationType:u,memberList:l}}).then((function(e){var o=e.data.memberList,r=void 0===o?[]:o,i=[],s=[];r.length===a.length?i.push.apply(i,y(a)):(r.forEach((function(e){i.push(e.userID)})),a.forEach((function(e){i.includes(e)||s.push(e)})));var c="success count:".concat(i.length," fail count:").concat(s.length);return p.setNetworkType(t.getNetworkType()).setMessage(c).end(),Ve.l("".concat(n," ok. ").concat(c)),zi({successUserIDList:i,failureUserIDList:s})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];p.setError(e,o,r).end()})),Ve.e("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"_getGroupMemberProfileAdvance",value:function(e){return this.request({protocolName:wr,requestData:n(n({},e),{},{memberInfoFilter:e.memberInfoFilter?e.memberInfoFilter:["Role","JoinTime","NameCard","ShutUpUntil"]})})}},{key:"_updateLocalGroupMemberMap",value:function(e,t){var n=this;return st(t)&&0!==t.length?t.map((function(t){return n.hasLocalGroupMember(e,t.userID)?n.getLocalGroupMemberInfo(e,t.userID).updateMember(t):n.setLocalGroupMember(e,new Bs(t)),n.getLocalGroupMemberInfo(e,t.userID)})):[]}},{key:"deleteLocalGroupMembers",value:function(e,t){var n=this.groupMemberListMap.get(e);n&&t.forEach((function(e){n.delete(e)}))}},{key:"getLocalGroupMemberInfo",value:function(e,t){return this.groupMemberListMap.has(e)?this.groupMemberListMap.get(e).get(t):null}},{key:"setLocalGroupMember",value:function(e,t){if(this.groupMemberListMap.has(e))this.groupMemberListMap.get(e).set(t.userID,t);else{var n=(new Map).set(t.userID,t);this.groupMemberListMap.set(e,n)}}},{key:"getLocalGroupMemberList",value:function(e){return this.groupMemberListMap.get(e)}},{key:"hasLocalGroupMember",value:function(e,t){return this.groupMemberListMap.has(e)&&this.groupMemberListMap.get(e).has(t)}},{key:"hasLocalGroupMemberMap",value:function(e){return this.groupMemberListMap.has(e)}},{key:"reset",value:function(){this.groupMemberListMap.clear()}}]),o}(co),Ks=["topicID","topicName","avatar","introduction","notification","unreadCount","muteAllMembers","customData","groupAtInfoList","nextMessageSeq","selfInfo"],Hs=function(e,t){return $t(e)?{lastTime:0,lastSequence:0,fromAccount:"",payload:null,type:"",messageForShow:"",nick:"",version:0,cloudCustomData:"",isRevoked:!1,revoker:null}:{lastTime:e.time||0,lastSequence:e.sequence||0,fromAccount:e.from||"",payload:e.payload||null,type:e.type||"",messageForShow:Vt(e.type,e.payload,t),nick:e.nick||"",version:e.version||0,cloudCustomData:e.cloudCustomData||"",isRevoked:e.isRevoked||!1,revoker:e.revoker||null}},js=function(){function e(t,n){r(this,e),this.topicID="",this.topicName="",this.avatar="",this.introduction="",this.notification="",this.unreadCount=0,this.muteAllMembers=!1,this.customData="",this.groupAtInfoList=[],this.nextMessageSeq=0,this.lastMessage=Hs(t.lastMessage,n),this.selfInfo={muteTime:0,readedSequence:0,messageRemindType:"",excludedUnreadSequenceList:void 0},this._initTopic(t)}return s(e,[{key:"_initTopic",value:function(e){for(var t in e)Ks.indexOf(t)<0||("selfInfo"===t?this.updateSelfInfo(e[t]):this[t]="muteAllMembers"===t?1===e[t]:e[t])}},{key:"updateUnreadCount",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.unreadCount=e}},{key:"updateNextMessageSeq",value:function(e){this.nextMessageSeq=e}},{key:"updateLastMessage",value:function(e){this.lastMessage=Hs(e)}},{key:"updateGroupAtInfoList",value:function(e){this.groupAtInfoList=JSON.parse(JSON.stringify(e))}},{key:"updateTopic",value:function(e){at(e.selfInfo)||this.updateSelfInfo(e.selfInfo),at(e.muteAllMembers)||(this.muteAllMembers=1===e.muteAllMembers),ht(this,e,["groupID","lastMessageTime","selfInfo","muteAllMembers","lastMsg"])}},{key:"updateSelfInfo",value:function(e){return 0!==ht(this.selfInfo,e,[],[""])}},{key:"reduceUnreadCount",value:function(){return this.unreadCount>=1&&(this.unreadCount-=1,!0)}},{key:"isLastMessageRevoked",value:function(e){return e.sequence===this.lastMessage.lastSequence}},{key:"setLastMessageRevoked",value:function(e){this.lastMessage.isRevoked=e}},{key:"setLastMessageRevoker",value:function(e){this.lastMessage.revoker=e}}]),e}(),zs=function(e){c(o,e);var t=m(o);function o(e){var n;return r(this,o),(n=t.call(this,e))._n="TopicModule",n._topicMap=new Map,n._getTopicTimeMap=new Map,n.TOPIC_CACHE_TIME=300,n.TOPIC_LAST_ACTIVE_TIME=3600,n.getInnerEmitterInstance().on(ns,n._onCloudConfigUpdated,f(n)),n}return s(o,[{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("topic_cache_time"),t=this.getCloudConfig("topic_last_active_time");at(e)||(this.TOPIC_CACHE_TIME=Number(e)),at(t)||(this.TOPIC_LAST_ACTIVE_TIME=Number(t))}},{key:"onTopicCreated",value:function(e){var t=e.groupID;this.resetGetTopicTime(t),this.emitOuterEvent(D.TOPIC_CREATED,e)}},{key:"onTopicDeleted",value:function(e){var t=this,n=e.groupID,o=e.topicIDList;(void 0===o?[]:o).forEach((function(e){t._deleteLocalTopic(n,e)})),this.emitOuterEvent(D.TOPIC_DELETED,e)}},{key:"onTopicMessageRemindTypeUpdated",value:function(e){var t=e.groupID,n=e.topicID,o=e.messageRemindType,r=this.getLocalTopic(t,n);if(r){var i=r.updateSelfInfo({messageRemindType:o});i&&this.emitOuterEvent(D.TOPIC_UPDATED,{groupID:t,topic:r}),Ve.d("".concat(this._n,".onTopicMessageRemindTypeUpdated topicID:").concat(n)+" messageRemindType:".concat(o," isTopicUpdated:").concat(i))}}},{key:"onTopicProfileUpdated",value:function(e){var t=e.groupID,n=e.topicID,o=this.getLocalTopic(t,n);o&&(o.updateTopic(e),this.emitOuterEvent(D.TOPIC_UPDATED,{groupID:t,topic:o}))}},{key:"onConversationProxy",value:function(e){var t=e.topicID,n=e.unreadCount,o=e.groupAtInfoList,r=Bt(t),i=this.getLocalTopic(r,t),s=!1;i&&(at(n)||i.unreadCount===n||(i.updateUnreadCount(n),s=!0),at(o)||(i.updateGroupAtInfoList(o),s=!0)),s&&this.emitOuterEvent(D.TOPIC_UPDATED,{groupID:r,topic:i})}},{key:"onMessageSent",value:function(e){var t=e.groupID,n=e.topicID,o=e.lastMessage,r=this.getLocalTopic(t,n);r&&(r.nextMessageSeq+=1,r.updateLastMessage(o),this.emitOuterEvent(D.TOPIC_UPDATED,{groupID:t,topic:r}))}},{key:"onMessageModified",value:function(e){var t=e.to,n=e.time,o=e.sequence,r=e.elements,i=e.cloudCustomData,s=e.messageVersion,a=Bt(t),c=this.getLocalTopic(a,t);if(c){var u=c.lastMessage;Ve.d("".concat(this._n,".onMessageModified topicID:").concat(t," lastMessage:"),JSON.stringify(u),"options:",JSON.stringify(e)),u&&(null===u.payload||u.lastTime===n&&u.lastSequence===o&&u.version!==s)&&(u.type=r[0].type,u.payload=r[0].content,u.messageForShow=Vt(u.type,u.payload,this.isIntl()),u.cloudCustomData=i,u.version=s,u.lastSequence=o,u.lastTime=n,this.emitOuterEvent(D.TOPIC_UPDATED,{groupID:a,topic:c}))}}},{key:"onMessageRevoked",value:function(e){var t=this;if(0!==e.length){var n=null,o=null,r=!1;e.forEach((function(e){var i=e.to;o=Bt(i),(n=t.getLocalTopic(o,i))&&(n.reduceUnreadCount()&&(r=!0),n.isLastMessageRevoked(e)&&(n.setLastMessageRevoked(!0),n.setLastMessageRevoker(e.revoker),r=!0))})),r&&this.emitOuterEvent(D.TOPIC_UPDATED,{groupID:o,topic:n})}}},{key:"isLastMessageRevoked",value:function(e){var t=e.topicID,n=e.sequence,o=Bt(t),r=this.getLocalTopic(o,t),i=!1;return r&&(i=r.isLastMessageRevoked({sequence:n})),i}},{key:"getJoinedCommunityList",value:function(){return this.getModule(Pn).getGroupList({isGroupWithTopicOnly:!0}).then((function(e){var t=e.data.groupList;return zi({groupList:void 0===t?[]:t})})).catch((function(e){return Xi(e)}))}},{key:"createTopicInCommunity",value:function(e){var t=this,o="".concat(this._n,".").concat("createTopicInCommunity"),r=e.topicID;if(!at(r)&&!Dt(r))return Xi({code:gi.ILLEGAL_TOPIC_ID});if(e.topicName&&!1===this._filterProfanity("topicName",e))return Xi({code:gi.PROFANITY_FOUND});if(e.introduction&&!1===this._filterProfanity("introduction",e))return Xi({code:gi.PROFANITY_FOUND});if(e.notification&&!1===this._filterProfanity("notification",e))return Xi({code:gi.PROFANITY_FOUND});var i=new Ai("createTopicInCommunity");return this.request({protocolName:ti,requestData:n({},e)}).then((function(r){var s=r.data.topicID;return i.setMessage("topicID:".concat(s)).setNetworkType(t.getNetworkType()).end(),Ve.l("".concat(o," ok")),t._updateTopicMap([n(n({},e),{},{topicID:s})]),zi({topicID:s})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];i.setError(e,o,r).end()})),Ve.e("".concat(o," failed. error:"),e),Xi(e)}))}},{key:"deleteTopicFromCommunity",value:function(e){var t=this,n="".concat(this._n,".").concat("deleteTopicFromCommunity"),o=e.groupID,r=e.topicIDList,i=void 0===r?[]:r,s=new Ai("deleteTopicFromCommunity");return s.setMessage("groupID:".concat(o," topicIDList:").concat(i)),this.request({protocolName:ni,requestData:{groupID:o,topicIDList:i}}).then((function(e){var n=e.data.resultList,r=[],i=[];(void 0===n?[]:n).forEach((function(e){var t=e.topicID,n=e.errorCode,o=e.errorInfo;0===n?r.push({topicID:t}):i.push({topicID:t,code:n,message:o})}));var a="success count:".concat(r.length,", fail count:").concat(i.length);return s.setMoreMessage("".concat(a)).setNetworkType(t.getNetworkType()).end(),Ve.l("".concat(a)),r.forEach((function(e){t._deleteLocalTopic(o,e.topicID)})),zi({successTopicList:r,failureTopicList:i})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];s.setError(e,o,r).end()})),Ve.e("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"updateTopicProfile",value:function(e){var t=this,o="".concat(this._n,".").concat("updateTopicProfile");if(Ve.l("".concat(o," options:"),e),e.topicName&&!1===this._filterProfanity("topicName",e))return Xi({code:gi.PROFANITY_FOUND});if(e.introduction&&!1===this._filterProfanity("introduction",e))return Xi({code:gi.PROFANITY_FOUND});if(e.notification&&!1===this._filterProfanity("notification",e))return Xi({code:gi.PROFANITY_FOUND});var r=new Ai("updateTopicProfile");return r.setMessage("groupID:".concat(e.groupID," topicID:").concat(e.topicID)),at(e.muteAllMembers)||(e.muteAllMembers=!0===e.muteAllMembers?"On":"Off"),this.request({protocolName:oi,requestData:n({},e)}).then((function(){return r.setNetworkType(t.getNetworkType()).end(),Ve.l("".concat(o," ok")),t._updateTopicMap([e]),zi({topic:t.getLocalTopic(e.groupID,e.topicID)})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),o=n[0],i=n[1];r.setError(e,o,i).end()})),Ve.e("".concat(o," failed. error:"),e),Xi(e)}))}},{key:"getTopicList",value:function(e){var t=this,o="".concat(this._n,".").concat("getTopicList"),r=e.groupID,i=e.topicIDList,s=void 0===i?[]:i,a=0===s.length,c=new Ai("getTopicList");if(c.setMessage("groupID:".concat(r)),this._getTopicTimeMap.has(r)){var u=this._getTopicTimeMap.get(r),l=u.isGetAll,d=u.time;if((l||!l&&!a)&&Date.now()-d<1e3*this.TOPIC_CACHE_TIME){var p=this._getLocalTopicList(r,s);if(a||p.length===s.length)return c.setNetworkType(this.getNetworkType()).setMoreMessage("from cache, topic count:".concat(p.length)).end(),Ve.l("".concat(o," groupID:").concat(r," from cache, topic count:").concat(p.length)),Ji({successTopicList:p,failureTopicList:[]})}}return this.request({protocolName:ri,requestData:{groupID:r,topicIDList:s}}).then((function(e){var i=e.data.topicInfoList,s=[],u=[],l=[];(void 0===i?[]:i).forEach((function(e){var t=e.topic,o=e.selfInfo,r=e.errorCode,i=e.errorInfo,a=t.topicID;0===r?(s.push(n(n({},t),{},{selfInfo:o})),u.push(a)):l.push({topicID:a,code:r,message:i})})),t._updateTopicMap(s),t._handleTopicAtInfo(s);var d="success count:".concat(u.length,", fail count:").concat(l.length);c.setNetworkType(t.getNetworkType()).setMoreMessage("".concat(d)).end(),Ve.l("".concat(o," groupID:").concat(r," from remote, ").concat(d));var p=[];return $t(u)||(t._getTopicTimeMap.set(r,{time:Date.now(),isGetAll:a}),p=t._getLocalTopicList(r,u)),zi({successTopicList:p,failureTopicList:l})})).catch((function(e){return t.probeNetwork(e).then((function(t){var n=v(t,2),o=n[0],r=n[1];c.setError(e,o,r).end()})),Ve.e("".concat(o," failed. error:"),e),Xi(e)}))}},{key:"hasLocalTopic",value:function(e,t){return!!this._topicMap.has(e)&&this._topicMap.get(e).has(t)}},{key:"getLocalTopic",value:function(e,t){var n=null;return this._topicMap.has(e)&&(n=this._topicMap.get(e).get(t)),n}},{key:"_getLocalTopicList",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=this._topicMap.get(e),o=[];return n&&(o=y(n.values())),0===t.length?o:o.filter((function(e){return t.includes(e.topicID)}))}},{key:"_deleteLocalTopic",value:function(e,t){this._topicMap.has(e)&&(this._topicMap.get(e).delete(t),Ve.l("".concat(this._n,"._deleteLocalTopic groupID:").concat(e," topicID:").concat(t)))}},{key:"_updateTopicMap",value:function(e){var t=this,n=[];e.forEach((function(e){var o=e.groupID,r=e.topicID,i=null;t._topicMap.has(o)||t._topicMap.set(o,new Map),t._topicMap.get(o).has(r)?(i=t._topicMap.get(o).get(r)).updateTopic(e):(t._getTopicLastMessage(e),i=new js(e,t.isIntl()),t._topicMap.get(o).set(r,i));var s=t._computeUnreadCount(i);i.updateUnreadCount(s),n.push({conversationID:"".concat(S.CONV_GROUP).concat(r),type:S.CONV_TOPIC,unreadCount:s})})),n.length>0&&this.getModule(qn).updateTopicConversation(n)}},{key:"resetGetTopicTime",value:function(e){var t=this;at(e)?y(this._getTopicTimeMap.keys()).forEach((function(e){t._getTopicTimeMap.set(e,0)})):this._getTopicTimeMap.set(e,0)}},{key:"getTopicListOnReconnected",value:function(){var e=this,t=y(this._topicMap.keys()),n=[];t.forEach((function(t){var o=[];e._getLocalTopicList(t).forEach((function(t){var n=t.lastMessage.lastTime,r=void 0===n?0:n;Date.now()-1e3*r<1e3*e.TOPIC_LAST_ACTIVE_TIME&&o.push(t.topicID)})),o.length>0&&n.push({groupID:t,topicIDList:o})})),Ve.l("".concat(this._n,".getTopicListOnReconnected. active community count:").concat(n.length)),this._relayGetTopicList(n)}},{key:"_relayGetTopicList",value:function(e){var t=this;if(0!==e.length){var n=e.shift(),o=n.topicIDList.length>5?"topicIDList.length:".concat(n.topicIDList.length):"topicIDList:".concat(n.topicIDList),r=new Ai("relayGetTopicList");r.setMessage(o),Ve.l("".concat(this._n,"._relayGetTopicList. ").concat(o)),this.getTopicList(n).then((function(){r.setNetworkType(t.getNetworkType()).end(),t._relayGetTopicList(e)})).catch((function(n){t.probeNetwork().then((function(e){var t=v(e,2),o=t[0],i=t[1];r.setError(n,o,i).end()})),t._relayGetTopicList(e)}))}}},{key:"_handleTopicAtInfo",value:function(e){var t=this;0!==e.length&&e.forEach((function(e){var o=e.groupID,r=e.topicID,i=e.groupAtInfoList,s=[];at(i)||(i.forEach((function(e){s.push(n(n({},e),{},{groupID:o,topicID:r}))})),t.getModule(qn).onNewGroupAtTips({dataList:s}))}))}},{key:"_getTopicLastMessage",value:function(e){if(!at(e.lastMsg)){var t={time:e.lastMsg.time,sequence:e.lastMsg.sequence,from:e.lastMsg.from,payload:e.lastMsg.elements[0]?e.lastMsg.elements[0].content:null,type:e.lastMsg.elements[0]?e.lastMsg.elements[0].type:"",nick:e.lastMsg.nick,version:e.lastMsg.messageVersion,cloudCustomData:e.lastMsg.cloudCustomData,isRevoked:2===e.lastMsg.isPlaceMessage,revoker:$t(e.lastMsg.revokerInfo)?null:e.lastMsg.revokerInfo.revoker};e.lastMessage=t}}},{key:"deleteTopicListInCommunity",value:function(e){var t=this,n=this._getLocalTopicList(e),o=this.getModule(qn);n.forEach((function(n){var r=n.topicID;t._deleteLocalTopic(e,r),t._getTopicTimeMap.delete(e),o.deleteLocalConversation("".concat(S.CONV_GROUP).concat(r))}))}},{key:"_computeUnreadCount",value:function(e){var t=e.selfInfo,n=t.excludedUnreadSequenceList,o=t.readedSequence,r=e.nextMessageSeq-e.selfInfo.readedSequence-1;if(st(n)){var i=0;n.forEach((function(t){t>=o&&t<=e.nextMessageSeq-1&&(i+=1)})),i>=1&&(r-=i)}return r<0?0:r}},{key:"_filterProfanity",value:function(e,t){var n=this.getModule(ro);if(!n)return!0;var o=n.filterText(t[e],$),r=o.isAllowedToSend,i=o.modifiedText;return!0===r&&(t[e]=i,!0)}},{key:"updateLastMessage",value:function(e,t){var n=Bt(e),o=this.getLocalTopic(n,e);if(o){var r=t.sequence+1;o.updateNextMessageSeq(r),o.updateLastMessage(t),this.emitOuterEvent(D.TOPIC_UPDATED,{groupID:n,topic:o})}}},{key:"getMessageExtensions",value:function(e,t){Ve.l("".concat(this._n,".getMessageExtensions startSequence:").concat(t));var n=Bt(e.to);return this.request({protocolName:Sr,requestData:{groupID:n,topicID:e.to,messageSequence:e.sequence,startSequence:t}})}},{key:"modifyMessageExtensions",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;Ve.l("".concat(this._n,".modifyMessageExtensions operateType:").concat(n));var o=Bt(e.to);return this.request({protocolName:Dr,requestData:{groupID:o,topicID:e.to,messageSequence:e.sequence,extensionList:t,operateType:n}})}},{key:"reset",value:function(){Ve.l("".concat(this._n,".reset")),this._topicMap.clear(),this._getTopicTimeMap.clear(),this.TOPIC_CACHE_TIME=300,this.TOPIC_LAST_ACTIVE_TIME=3600}}]),o}(co),Ws=function(){function e(t){r(this,e),this._userModule=t,this._n="ProfileHandler",this.TAG="profile",this.accountProfileMap=new Map,this.expirationTime=864e5}return s(e,[{key:"setExpirationTime",value:function(e){this.expirationTime=e}},{key:"getUserProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("getUserProfile"),o=e.userIDList;e.fromAccount=this._userModule.getMyAccount(),o.length>100&&(Ve.w("".concat(n," ").concat(zt(100))),o.length=100);for(var r,i=[],s=[],a=0,c=o.length;a<c;a++)r=o[a],this._userModule.isMyFriend(r)&&this._contains(r)?s.push(this._getProfileFromMap(r)):i.push(r);if(0===i.length)return Ji(s);e.toAccount=i;var u=e.bFromGetMyProfile||!1,l=[];e.toAccount.forEach((function(e){l.push({toAccount:e,standardSequence:0,customSequence:0})})),e.userItem=l;var d=new Ai("getUserProfile");return d.setMessage(o.length>5?"userIDList.length:".concat(o.length):"userIDList:".concat(o)),this._userModule.request({protocolName:vo,requestData:e}).then((function(e){d.setNetworkType(t._userModule.getNetworkType()).end(),Ve.i("".concat(n," ok"));var o=t._handleResponse(e).concat(s);return zi(u?o[0]:o)})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];d.setError(e,o,r).end()})),Ve.e("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"getMyProfile",value:function(){var e=this._userModule.getMyAccount(),t="".concat(this._n,".getMyProfile");if(Ve.l("".concat(t," myAccount:").concat(e)),this._fill(),this._contains(e)){var n=this._getProfileFromMap(e);return Ve.d("".concat(t," from cache, myProfile:").concat(JSON.stringify(n))),Ji(n)}return this.getUserProfile({fromAccount:e,userIDList:[e],bFromGetMyProfile:!0})}},{key:"_handleResponse",value:function(e){var t=e.data.userProfileItem;if(!st(t))return[];for(var n=[],o=Date.now(),r=0,i=t.length;r<i;r++){var s=t[r],a=s.to,c=s.profileItem;if("@TLS#NOT_FOUND"!==a&&""!==a){var u=this._update(a,this._getLatestProfileFromResponse(a,c)).latestProfile;n.push(u)}}return Ve.l("".concat(this._n,"._handleResponse cost ").concat(Date.now()-o," ms")),n}},{key:"_getLatestProfileFromResponse",value:function(e,t){var n={userID:e,profileCustomField:[]};if(!$t(t))for(var o=0,r=t.length;o<r;o++)if(t[o].tag.indexOf("Tag_Profile_Custom")>-1)n.profileCustomField.push({key:t[o].tag,value:t[o].value});else switch(t[o].tag){case He.NICK:n.nick=t[o].value;break;case He.GENDER:n.gender=t[o].value;break;case He.BIRTHDAY:n.birthday=t[o].value;break;case He.LOCATION:n.location=t[o].value;break;case He.SELFSIGNATURE:n.selfSignature=t[o].value;break;case He.ALLOWTYPE:n.allowType=t[o].value;break;case He.LANGUAGE:n.language=t[o].value;break;case He.AVATAR:n.avatar=t[o].value;break;case He.MESSAGESETTINGS:n.messageSettings=t[o].value;break;case He.ADMINFORBIDTYPE:n.adminForbidType=t[o].value;break;case He.LEVEL:n.level=t[o].value;break;case He.ROLE:n.role=t[o].value;break;default:Ve.w("".concat(this._n,"._getLatestProfileFromResponse unknown tag:"),t[o].tag,t[o].value)}return n}},{key:"updateMyProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("updateMyProfile");if(e.nick&&!1===this._userModule.filterProfanity("nick",e))return Xi({code:gi.PROFANITY_FOUND});if(e.selfSignature&&!1===this._userModule.filterProfanity("selfSignature",e))return Xi({code:gi.PROFANITY_FOUND});var o=new Ai("updateMyProfile");o.setMessage(JSON.stringify(e));var r=(new ds).validate(e);if(!r.valid)return o.setCode(gi.UPDATE_PROFILE_INVALID_PARAM).setMoreMessage("info:".concat(r.tips)).setNetworkType(this._userModule.getNetworkType()).end(),Ve.e("".concat(n," info:").concat(r.tips)),Xi({code:gi.UPDATE_PROFILE_INVALID_PARAM});var i=[];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&("profileCustomField"===s?e.profileCustomField.forEach((function(e){i.push({tag:e.key,value:e.value})})):i.push({tag:He[s.toUpperCase()],value:e[s]}));if(0===i.length){var a=new Wi({code:gi.UPDATE_PROFILE_NO_KEY});return o.setError(a,!0,this._userModule.getNetworkType()).end(),Ve.e("".concat(n," failed. error:"),a),Xi(a)}var c=this._userModule.getMyAccount();return this._userModule.request({protocolName:yo,requestData:{fromAccount:c,profileItem:i}}).then((function(r){o.setNetworkType(t._userModule.getNetworkType()).end(),Ve.i("".concat(n," ok"));var i=t._update(c,e),s=i.isProfileUpdated,a=i.latestProfile;return!0===s&&t._userModule.emitOuterEvent(D.PROFILE_UPDATED,[a]),Ji(a)})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var n=v(t,2),r=n[0],i=n[1];o.setError(e,r,i).end()})),Ve.e("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"onProfileModified",value:function(e){var t=e.dataList;if(!$t(t)){var n,o=t.length;Ve.d("".concat(this._n,".onProfileModified count:").concat(o," dataList:"),e.dataList);for(var r=[],i=0;i<o;i++){n=t[i].userID;var s=this._update(n,this._getLatestProfileFromResponse(n,t[i].profileList)),a=s.isProfileUpdated,c=s.latestProfile;!0===a&&r.push(c)}r.length>0&&(this._userModule.emitInnerEvent(os,r),this._userModule.emitOuterEvent(D.PROFILE_UPDATED,r))}}},{key:"_fill",value:function(){if(0===this.accountProfileMap.size){for(var e=this._getCachedProfiles(),t=Date.now(),n=0,o=e.length;n<o;n++)t-e[n].lastUpdatedTime<this.expirationTime&&this.accountProfileMap.set(e[n].userID,e[n]);Ve.l("".concat(this._n,"._fill from cache, size:").concat(this.accountProfileMap.size))}}},{key:"_update",value:function(e,t){var n,o=!1,r=Date.now();return this._contains(e)?(n=this._getProfileFromMap(e),t.profileCustomField&&!0===Tt(n.profileCustomField,t.profileCustomField)&&(n.lastUpdatedTime=r,o=!0),ht(n,t,["profileCustomField"])>0&&(n.lastUpdatedTime=r,o=!0)):(n=new ds(t),(this._userModule.isMyFriend(e)||e===this._userModule.getMyAccount())&&(n.lastUpdatedTime=r,o=!0,this.accountProfileMap.set(e,n))),this._flush(e===this._userModule.getMyAccount()),Ve.l("".concat(this._n,"._update account:").concat(e," isProfileUpdated:").concat(o)),{isProfileUpdated:o,latestProfile:n}}},{key:"_flush",value:function(e){var t=y(this.accountProfileMap.values()),n=this._userModule.getStorageModule();Ve.d("".concat(this._n,"._flush length:").concat(t.length," flushAtOnce:").concat(e)),n.setItem(this.TAG,t,e)}},{key:"_contains",value:function(e){return this.accountProfileMap.has(e)}},{key:"_getProfileFromMap",value:function(e){return this.accountProfileMap.get(e)}},{key:"_getCachedProfiles",value:function(){var e=this._userModule.getStorageModule().getItem(this.TAG);return $t(e)?[]:e}},{key:"onConversationsProfileUpdated",value:function(e){for(var t,n,o,r=[],i=0,s=e.length;i<s;i++)n=(t=e[i]).userID,this._userModule.isMyFriend(n)&&(this._contains(n)?(o=this._getProfileFromMap(n),ht(o,t)>0&&r.push(n)):r.push(t.userID));0!==r.length&&(Ve.i("".concat(this._n,".onConversationsProfileUpdated toAccountList:").concat(r)),this.getUserProfile({userIDList:r}))}},{key:"getNickAndAvatarByUserID",value:function(e){if(this._contains(e)){var t=this._getProfileFromMap(e);return{nick:t.nick,avatar:t.avatar}}return{nick:"",avatar:""}}},{key:"reset",value:function(){this._flush(!0),this.accountProfileMap.clear()}}]),e}(),Ys=s((function e(t){r(this,e),$t||(this.userID=t.userID||"",this.timeStamp=t.timeStamp||0)})),$s=function(){function e(t){r(this,e),this._userModule=t,this._n="BlacklistHandler",this._blacklistMap=new Map,this.startIndex=0,this.maxLimited=100,this.currentSequence=0}return s(e,[{key:"getLocalBlacklist",value:function(){return y(this._blacklistMap.keys())}},{key:"getBlacklist",value:function(){var e=this,t="".concat(this._n,".getBlacklist"),n={fromAccount:this._userModule.getMyAccount(),maxLimited:this.maxLimited,startIndex:0,lastSequence:this.currentSequence},o=new Ai("getBlacklist");return this._userModule.request({protocolName:Mo,requestData:n}).then((function(n){var r=n.data,i=r.blackListItem,s=r.currentSequence,a=$t(i)?0:i.length;o.setNetworkType(e._userModule.getNetworkType()).setMessage("count:".concat(a)).end(),Ve.i("".concat(t," ok")),e.currentSequence=s,e._handleResponse(i,!0),e._userModule.emitOuterEvent(D.BLACKLIST_UPDATED,y(e._blacklistMap.keys()))})).catch((function(n){return e._userModule.probeNetwork().then((function(e){var t=v(e,2),r=t[0],i=t[1];o.setError(n,r,i).end()})),Ve.e("".concat(t," failed. error:"),n),Xi(n)}))}},{key:"addBlacklist",value:function(e){var t=this,n=new Ai("addToBlacklist"),o="".concat(this._n,".addBlacklist"),r=this._userModule.getMyAccount();if(1===e.userIDList.length&&e.userIDList[0]===r){var i=gi.CANNOT_ADD_SELF_TO_BLACKLIST,s=this._userModule.getErrorMessage(i);n.setCode(i).setMessage(s).setNetworkType(this._userModule.getNetworkType()).end();var a=new Wi({code:i});return Ve.e("".concat(o," failed. error:"),a),Xi(a)}return e.userIDList.includes(r)&&(e.userIDList=e.userIDList.filter((function(e){return e!==r}))),e.fromAccount=this._userModule.getMyAccount(),e.toAccount=e.userIDList,this._userModule.request({protocolName:Io,requestData:e}).then((function(r){return n.setNetworkType(t._userModule.getNetworkType()).setMessage(e.userIDList.length>5?"userIDList.length:".concat(e.userIDList.length):"userIDList:".concat(e.userIDList)).end(),Ve.i("".concat(o," ok")),t._handleResponse(r.resultItem,!0),zi(y(t._blacklistMap.keys()))})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var o=v(t,2),r=o[0],i=o[1];n.setError(e,r,i).end()})),Ve.e("".concat(o," failed. error:"),e),Xi(e)}))}},{key:"_handleResponse",value:function(e,t){if(!$t(e))for(var n,o,r,i=0,s=e.length;i<s;i++)o=e[i].to,r=e[i].resultCode,(at(r)||0===r)&&(t?((n=this._blacklistMap.has(o)?this._blacklistMap.get(o):new Ys).userID=o,!$t(e[i].addBlackTimeStamp)&&(n.timeStamp=e[i].addBlackTimeStamp),this._blacklistMap.set(o,n)):this._blacklistMap.has(o)&&(n=this._blacklistMap.get(o),this._blacklistMap.delete(o)));Ve.l("".concat(this._n,"._handleResponse total:").concat(this._blacklistMap.size," bAdd:").concat(t))}},{key:"deleteBlacklist",value:function(e){var t=this,n="".concat(this._n,".deleteBlacklist"),o=new Ai("removeFromBlacklist");return e.fromAccount=this._userModule.getMyAccount(),e.toAccount=e.userIDList,this._userModule.request({protocolName:Co,requestData:e}).then((function(r){return o.setNetworkType(t._userModule.getNetworkType()).setMessage(e.userIDList.length>5?"userIDList.length:".concat(e.userIDList.length):"userIDList:".concat(e.userIDList)).end(),Ve.i("".concat(n," ok")),t._handleResponse(r.data.resultItem,!1),zi(y(t._blacklistMap.keys()))})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var n=v(t,2),r=n[0],i=n[1];o.setError(e,r,i).end()})),Ve.e("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"onAccountDeleted",value:function(e){for(var t,n=[],o=0,r=e.length;o<r;o++)t=e[o],this._blacklistMap.has(t)&&(this._blacklistMap.delete(t),n.push(t));n.length>0&&(Ve.l("".concat(this._n,".onAccountDeleted count:").concat(n.length," userIDList:"),n),this._userModule.emitOuterEvent(D.BLACKLIST_UPDATED,y(this._blacklistMap.keys())))}},{key:"onAccountAdded",value:function(e){for(var t,n=[],o=0,r=e.length;o<r;o++)t=e[o],this._blacklistMap.has(t)||(this._blacklistMap.set(t,new Ys({userID:t})),n.push(t));n.length>0&&(Ve.l("".concat(this._n,".onAccountAdded count:").concat(n.length," userIDList:"),n),this._userModule.emitOuterEvent(D.BLACKLIST_UPDATED,y(this._blacklistMap.keys())))}},{key:"reset",value:function(){this._blacklistMap.clear(),this.startIndex=0,this.maxLimited=100,this.currentSequence=0}}]),e}(),Js=function(e){var t=String(e).replace(/[=]+$/,""),n="";if(t.length%4==1)return"";for(var o,r,i=0,s=0;r=t.charAt(s++);~r&&(o=i%4?64*o+r:r,i++%4)?n+=String.fromCharCode(255&o>>(-2*i&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);try{return decodeURIComponent(escape(n))}catch(a){return""}},Xs=function(){function e(t){r(this,e),this._userModule=t,this._n="UserStatusHandler",this.MAX_QUERY_USER_COUNT=500,this.MAX_SUBSCRIBE_USER_COUNT=100,this.MAX_UNSUBSCRIBE_USER_COUNT=100,this._userModule.getInnerEmitterInstance().on(ns,this._onCloudConfigUpdated,this)}return s(e,[{key:"_onCloudConfigUpdated",value:function(){var e=this._userModule.getCloudConfig("status_query_count"),t=this._userModule.getCloudConfig("status_sub_count"),n=this._userModule.getCloudConfig("status_unsub_count");Ve.l("".concat(this._n,"._onCloudConfigUpdated statusQueryCount:").concat(e," statusSubscribeCount:").concat(t)+" statusUnsubscribeCount:".concat(n)),at(e)||(this.MAX_QUERY_USER_COUNT=parseInt(e,10)),at(e)||(this.MAX_SUBSCRIBE_USER_COUNT=parseInt(t,10)),at(e)||(this.MAX_UNSUBSCRIBE_USER_COUNT=parseInt(n,10))}},{key:"onUserStatusUpdated",value:function(e){var t=e.dataList,n=this._userModule.getMyUserID(),o=this._userModule.getModule(Bn),r=t.map((function(e){var t=e.to,r=e.statusType,i=e.customStatus,s=Js(i);return t===n&&o.setCustomStatus(s),{userID:t,statusType:r,customStatus:s}}));this._userModule.emitOuterEvent(D.USER_STATUS_UPDATED,r)}},{key:"setSelfStatus",value:function(e){var t=this,n="".concat(this._n,".setSelfStatus");if(!1===this._userModule.filterProfanity("customStatus",e))return Xi({code:gi.PROFANITY_FOUND});var o=new Ai("setSelfStatus"),r=e.customStatus;return this._userModule.request({protocolName:ii,requestData:{customStatus:r}}).then((function(e){return o.setNetworkType(t._userModule.getNetworkType()).setMessage("customStatus:".concat(r)).end(),Ve.l("".concat(n," ok. customStatus:").concat(r)),t._userModule.getModule(Bn).setCustomStatus(r),zi({userID:t._userModule.getMyUserID(),statusType:1,customStatus:r})})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var n=v(t,2),r=n[0],i=n[1];o.setError(e,r,i).end()})),Ve.e("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"getUserStatus",value:function(e){var t=this,n="".concat(this._n,".getUserStatus"),o=e.userIDList,r=void 0===o?[]:o,i=this._userModule.getMyUserID(),s=y(r),a=void 0,c=s.indexOf(i);if(c>-1){s.splice(c,1);var u=this._userModule.getModule(Bn).getCustomStatus();a={userID:i,statusType:1,customStatus:u}}if(0===s.length)return Ji({successUserList:[a],failureUserList:[]});if(!this._userModule.canIUse(K.USER_STATUS))return Xi({code:gi.CANNOT_USE_COMMERCIAL_ABILITY});s.length>this.MAX_QUERY_USER_COUNT&&(Ve.w("".concat(n," ").concat(zt(this.MAX_QUERY_USER_COUNT))),s=r.slice(0,this.MAX_QUERY_USER_COUNT));var l=new Ai("getUserStatus");return this._userModule.request({protocolName:si,requestData:{userIDList:s}}).then((function(e){var o=e.data,i=o.successUserList,s=void 0===i?[]:i,c=o.failureUserList,u=void 0===c?[]:c,d=s.map((function(e){var t=e.userID,n=e.statusType,o=e.customStatus;return{userID:t,statusType:n,customStatus:Js(o)}})),p=u.map((function(e){var t=e.userID,n=e.invalidUserID,o=e.errorCode,r=e.errorInfo;return{userID:$t(n)?t:n,code:o,message:r}}));at(a)||d.unshift(a);var h="userID count:".concat(r.length,", success count:").concat(d.length,", fail count:").concat(p.length);return l.setNetworkType(t._userModule.getNetworkType()).setMessage("".concat(h)).end(),Ve.l("".concat(n," ok. ").concat(h,".")),zi({successUserList:d,failureUserList:p})})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var n=v(t,2),o=n[0],i=n[1];l.setMessage("userID count:".concat(r.length)).setError(e,o,i).end()})),Ve.e("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"subscribeUserStatus",value:function(e){var t=this;if(!this._userModule.canIUse(K.USER_STATUS))return Xi({code:gi.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".subscribeUserStatus"),o=e.userIDList,r=void 0===o?[]:o,i=y(r);i.length>this.MAX_SUBSCRIBE_USER_COUNT&&(Ve.w("".concat(n," ").concat(zt(this.MAX_SUBSCRIBE_USER_COUNT))),i=r.slice(0,this.MAX_SUBSCRIBE_USER_COUNT));var s=new Ai("subscribeUserStatus"),a="userID count:".concat(r.length);return Ve.l("".concat(n," ").concat(a)),this._userModule.request({protocolName:ai,requestData:{userIDList:i}}).then((function(e){var o=e.data.failureUserList,r=(void 0===o?[]:o).map((function(e){var t=e.userID,n=e.invalidUserID,o=e.errorCode,r=e.errorInfo;return{userID:$t(n)?t:n,code:o,message:r}}));return s.setNetworkType(t._userModule.getNetworkType()).setMessage("".concat(a," fail count:").concat(r.length)).end(),Ve.l("".concat(n," ok. fail count:").concat(r.length,".")),zi({failureUserList:r})})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];s.setMessage("".concat(a)).setError(e,o,r).end()})),Ve.e("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"unsubscribeUserStatus",value:function(e){var t=this;if(!this._userModule.canIUse(K.USER_STATUS))return Xi({code:gi.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".unsubscribeUserStatus"),o=(e||{}).userIDList,r=void 0===o?[]:o,i=y(r);r.length>this.MAX_UNSUBSCRIBE_USER_COUNT&&(Ve.w("".concat(n," ").concat(zt(this.MAX_UNSUBSCRIBE_USER_COUNT))),i=r.slice(0,this.MAX_UNSUBSCRIBE_USER_COUNT));var s=new Ai("unsubscribeUserStatus"),a="userID count:".concat(r.length);Ve.l("".concat(n," ").concat(a));var c={userIDList:i};return 0===i.length&&(c.userIDList=void 0,c.unsubscribeAll=1),this._userModule.request({protocolName:ci,requestData:c}).then((function(e){var o=e.data.failureUserList,r=(void 0===o?[]:o).map((function(e){var t=e.userID,n=e.invalidUserID,o=e.errorCode,r=e.errorInfo;return{userID:$t(n)?t:n,code:o,message:r}}));return s.setNetworkType(t._userModule.getNetworkType()).setMessage("".concat(a," fail count:").concat(r.length)).end(),Ve.l("".concat(n," ok. fail count:").concat(r.length,".")),zi({failureUserList:r})})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];s.setMessage("".concat(a)).setError(e,o,r).end()})),Ve.e("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"reset",value:function(){this.MAX_QUERY_USER_COUNT=500,this.MAX_SUBSCRIBE_USER_COUNT=100,this.MAX_UNSUBSCRIBE_USER_COUNT=100}}]),e}(),Zs=function(e){c(n,e);var t=m(n);function n(e){var o;return r(this,n),(o=t.call(this,e))._n="UserModule",o._profileHandler=new Ws(f(o)),o._blacklistHandler=new $s(f(o)),o._userStatusHandler=new Xs(f(o)),o.getInnerEmitterInstance().on(es,o.onContextUpdated,f(o)),o}return s(n,[{key:"onContextUpdated",value:function(e){this._profileHandler.getMyProfile(),this._blacklistHandler.getBlacklist()}},{key:"onProfileModified",value:function(e){this._profileHandler.onProfileModified(e)}},{key:"onRelationChainModified",value:function(e){var t=e.dataList;if(!$t(t)){var n=[];t.forEach((function(e){e.blackListDelAccount&&n.push.apply(n,y(e.blackListDelAccount))})),n.length>0&&this._blacklistHandler.onAccountDeleted(n);var o=[];t.forEach((function(e){e.blackListAddAccount&&o.push.apply(o,y(e.blackListAddAccount))})),o.length>0&&this._blacklistHandler.onAccountAdded(o)}}},{key:"onConversationsProfileUpdated",value:function(e){this._profileHandler.onConversationsProfileUpdated(e)}},{key:"getMyAccount",value:function(){return this.getMyUserID()}},{key:"getMyProfile",value:function(){return this._profileHandler.getMyProfile()}},{key:"getStorageModule",value:function(){return this.getModule(Vn)}},{key:"filterProfanity",value:function(e,t){var n=this.getModule(ro);if(!n)return!0;var o=n.filterText(t[e],Y),r=o.isAllowedToSend,i=o.modifiedText;return!0===r&&(t[e]=i,!0)}},{key:"isMyFriend",value:function(e){var t=this.getModule(Gn);return!!t&&t.isMyFriend(e)}},{key:"getUserProfile",value:function(e){return this._profileHandler.getUserProfile(e)}},{key:"updateMyProfile",value:function(e){return this._profileHandler.updateMyProfile(e)}},{key:"getNickAndAvatarByUserID",value:function(e){return this._profileHandler.getNickAndAvatarByUserID(e)}},{key:"getLocalBlacklist",value:function(){var e=this._blacklistHandler.getLocalBlacklist();return Ji(e)}},{key:"addBlacklist",value:function(e){return this._blacklistHandler.addBlacklist(e)}},{key:"deleteBlacklist",value:function(e){return this._blacklistHandler.deleteBlacklist(e)}},{key:"onUserStatusUpdated",value:function(e){this._userStatusHandler.onUserStatusUpdated(e)}},{key:"setSelfStatus",value:function(e){return this._userStatusHandler.setSelfStatus(e)}},{key:"getUserStatus",value:function(e){return this._userStatusHandler.getUserStatus(e)}},{key:"subscribeUserStatus",value:function(e){return this._userStatusHandler.subscribeUserStatus(e)}},{key:"unsubscribeUserStatus",value:function(e){return this._userStatusHandler.unsubscribeUserStatus(e)}},{key:"reset",value:function(){Ve.l("".concat(this._n,".reset")),this._profileHandler.reset(),this._blacklistHandler.reset(),this._userStatusHandler.reset()}}]),n}(co),Qs=function(){function e(t,n){r(this,e),this._m=t,this._isLoggedIn=!1,this._SDKAppID=n.SDKAppID,this._userID=n.userID||"",this._userSig=n.userSig||"",this._version="2.27.5",this._a2Key="",this._tinyID="",this._customStatus="",this._contentType="json",this._unlimitedAVChatRoom=n.unlimitedAVChatRoom,this._scene=n.scene||"",this._oversea=n.oversea,this._instanceID=n.instanceID,this._statusInstanceID=0,this._isDevMode=n.devMode,this._proxyServer=n.proxyServer,this._fileUploadProxy=n.fileUploadProxy,this._fileDownloadProxy=n.fileDownloadProxy}return s(e,[{key:"isLoggedIn",value:function(){return this._isLoggedIn}},{key:"isOversea",value:function(){return this._oversea}},{key:"isPrivateNetWork",value:function(){return this._proxyServer}},{key:"isDevMode",value:function(){return this._isDevMode}},{key:"isSingaporeSite",value:function(){return this._SDKAppID>=2e7&&this._SDKAppID<3e7||this._SDKAppID>=172e7&&this._SDKAppID<173e7}},{key:"isKoreaSite",value:function(){return this._SDKAppID>=3e7&&this._SDKAppID<4e7||this._SDKAppID>=173e7&&this._SDKAppID<174e7}},{key:"isGermanySite",value:function(){return this._SDKAppID>=4e7&&this._SDKAppID<5e7||this._SDKAppID>=174e7&&this._SDKAppID<175e7}},{key:"isIndiaSite",value:function(){return this._SDKAppID>=5e7&&this._SDKAppID<6e7||this._SDKAppID>=175e7&&this._SDKAppID<176e7}},{key:"isJapanSite",value:function(){return this._SDKAppID>=6e7&&this._SDKAppID<7e7||this._SDKAppID>=176e7&&this._SDKAppID<177e7}},{key:"isUSASite",value:function(){return this._SDKAppID>=7e7&&this._SDKAppID<8e7||this._SDKAppID>=177e7&&this._SDKAppID<178e7}},{key:"isIntl",value:function(){return 0===(e=this._SDKAppID)||e>=2e7&&e<8e7||e>=172e7&&e<178e7;var e}},{key:"isUnlimitedAVChatRoom",value:function(){return this._unlimitedAVChatRoom}},{key:"setUserID",value:function(e){this._userID=e}},{key:"getUserID",value:function(){return this._userID}},{key:"setUserSig",value:function(e){this._userSig=e}},{key:"getUserSig",value:function(){return this._userSig}},{key:"getSDKAppID",value:function(){return this._SDKAppID}},{key:"setTinyID",value:function(e){this._tinyID=e,this._isLoggedIn=!0}},{key:"getTinyID",value:function(){return this._tinyID}},{key:"setCustomStatus",value:function(e){this._customStatus=e}},{key:"getCustomStatus",value:function(){return this._customStatus}},{key:"getScene",value:function(){return Re?window.tencent_cloud_im_csig_flutter_for_web_25F_cy:this._isTUIKit()?"tuikit":this._scene}},{key:"getInstanceID",value:function(){return this._instanceID}},{key:"getStatusInstanceID",value:function(){return this._statusInstanceID}},{key:"setStatusInstanceID",value:function(e){this._statusInstanceID=e}},{key:"getVersion",value:function(){return this._version}},{key:"getA2Key",value:function(){return this._a2Key}},{key:"setA2Key",value:function(e){this._a2Key=e}},{key:"getContentType",value:function(){return this._contentType}},{key:"getProxyServer",value:function(){return this._proxyServer}},{key:"getFileUploadProxy",value:function(){return this._fileUploadProxy}},{key:"getFileDownloadProxy",value:function(){return this._fileDownloadProxy}},{key:"_isTUIKit",value:function(){var e=!1,t=!1,n=!1,o=!1,r=[];ie&&(r=Object.keys(ae)),se&&(r=re?Object.keys(uni):Object.keys(window));for(var i=0,s=r.length;i<s;i++)if(r[i].toLowerCase().includes("uikit")){e=!0;break}if(r=null,ie&&!ut(ae.createGamePortal)&&ut(getApp)&&!at(getApp())){var a=getApp().globalData;it(a)&&!0===a.isTUIKit&&(t=!0)}!0===this._m.getModule(Vn).getStorageSync("TIM_".concat(this._SDKAppID,"_isTUIKit"))&&(n=!0);var c=null;if(X&&!Q&&"undefined"==typeof uni&&__wxConfig&&(c=__wxConfig.pages),Z&&"undefined"==typeof uni&&__qqConfig&&(c=__qqConfig.pages),st(c)&&c.length>0){for(var u=0,l=c.length;u<l;u++)if(c[u].toLowerCase().includes("tui")){o=!0;break}c=null}return e||t||n||o}},{key:"reset",value:function(){this._isLoggedIn=!1,this._userSig="",this._a2Key="",this._tinyID="",this._customStatus="",this._statusInstanceID=0}}]),e}(),ea=function(e){c(n,e);var t=m(n);function n(e){var o;return r(this,n),(o=t.call(this,e))._n="SignModule",o._helloInterval=120,o._lastLoginTs=0,o._lastWsHelloTs=0,o._isWebUniapp=0,rs.mixin(f(o)),o}return s(n,[{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&e%this._helloInterval==0&&this._hello()}},{key:"login",value:function(e){var t="";if(this.isLoggedIn()){var n=this.getMyUserID();return(t=this.getErrorMessage("RepeatLogin",n))&&Ve.w(t),Ji({actionStatus:"OK",errorCode:0,errorInfo:t,repeatLogin:!0})}if(Date.now()-this._lastLoginTs<=15e3)return this.outputWarning("LoggingIn",e.userID),Xi({code:gi.REPEAT_LOGIN});Ve.l("".concat(this._n,".login userID:").concat(e.userID));var o=this._checkLoginInfo(e);if(0!==o.code)return Xi(o);var r=this.getModule(Bn),i=e.userID,s=e.userSig;return r.setUserID(i),r.setUserSig(s),this.getModule($n).updateProtocolConfig(),this._login()}},{key:"_login",value:function(){var e=this,t=this.getModule(Bn),n=t.getScene(),o=0,r=new Ai("login");r.setMessage("".concat(n)).setMoreMessage("identifier:".concat(this.getMyUserID())),re?"tuikit"===n?r.setUIPlatform(4):r.setUIPlatform(3):ie?"tuikit"===n?r.setUIPlatform(12):r.setUIPlatform(11):se&&(Re?"flutter_web_uikit"===n?r.setUIPlatform(21):r.setUIPlatform(20):this._isReactUIKit()?Ae?r.setUIPlatform(25):r.setUIPlatform(24):Ae?"tuikit"===n?r.setUIPlatform(17):r.setUIPlatform(16):"tuikit"===n?r.setUIPlatform(14):r.setUIPlatform(13));var i=this.getModule(oo);if(i.canIUseOfflinePush()){this._isWebUniapp=i.getUniAppPlatform();var s=this._getStatusInstanceID();t.setStatusInstanceID(s),this.getModule($n).updateProtocolConfig(),o=i.getDeviceBrand()}var a="".concat(this._n,"._login");return this._lastLoginTs=Date.now(),this.request({protocolName:uo,requestData:{deviceBrand:o,isWebUniapp:this._isWebUniapp}}).then((function(o){e._lastLoginTs=0;var i=Date.now(),s=null,c=o.data,u=c.a2Key,l=c.tinyID,d=c.helloInterval,p=c.instanceID,h=c.timeStamp,g=c.customStatus,f=void 0===g?"":g,_=c.purchaseBits;Ve.l("".concat(a," ok. scene:").concat(n," helloInterval:").concat(d," instanceID:").concat(p," timeStamp:").concat(h));var m=1e3*h,v=i-r.getStartTs(),y=m+parseInt(v/2)-i,M=r.getStartTs()+y;if(r.start(M),function(e,t){Ue=t;var n=new Date;n.setTime(e),Ve.i("baseTime from server:".concat(n," offset:").concat(Ue))}(m,y),!l)throw s=new Wi({code:gi.NO_TINYID}),r.setError(s,!0,e.getNetworkType()).end(),s;if(!u)throw s=new Wi({code:gi.NO_A2KEY}),r.setError(s,!0,e.getNetworkType()).end(),s;var I=Js(f);r.setNetworkType(e.getNetworkType()).setMoreMessage("helloInterval:".concat(d," instanceID:").concat(p," offset:").concat(y," customStatus:").concat(I)).end(),t.setA2Key(u),t.setTinyID(l),t.setStatusInstanceID(p),t.setCustomStatus(I),_&&e.getModule(no).onPushedConfig({errorCode:0,expiredTime:0,purchaseBits:_}),e.getModule($n).updateProtocolConfig(),e.emitInnerEvent(es),e._helloInterval=d,e.triggerReady();var C=e.getModule(oo);return C.canIUseOfflinePush()&&(uni.setStorageSync("timUniAppInstanceID",p),C.init()),e._fetchCloudControlConfig(),e.getModule(ro).init(),o})).catch((function(t){return e.probeNetwork().then((function(e){var n=v(e,2),o=n[0],i=n[1];r.setError(t,o,i).end(!0)})),e._m.setNotReadyReason(gi.LOGIN_FAILED),Ve.e("".concat(a," failed. error:"),t),e._lastLoginTs=0,e._m.onLoginFailed(),Xi(t)}))}},{key:"logout",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!this.isLoggedIn())return Xi({code:gi.USER_NOT_LOGGED_IN});new Ai("logout").setNetworkType(this.getNetworkType()).setMessage("identifier:".concat(this.getMyUserID())).end(!0);var n="".concat(this._n,".logout");return Ve.i("".concat(n," type:").concat(t)),0===t&&this._m.setNotReadyReason(gi.LOGGED_OUT),this.request({protocolName:lo,requestData:{type:t}}).then((function(){return e.resetReady(),Ji({})})).catch((function(t){return Ve.e("".concat(n," error:"),t),e.resetReady(),Ji({})}))}},{key:"_fetchCloudControlConfig",value:function(){this.getModule(Zn).fetchConfig()}},{key:"_getStatusInstanceID",value:function(){return uni.getStorageSync("timUniAppInstanceID")}},{key:"_hello",value:function(){var e=this;this._lastWsHelloTs=Date.now(),this.request({protocolName:po,requestData:{isWebUniapp:this._isWebUniapp}}).catch((function(t){Ve.w("".concat(e._n,"._hello error:"),t)}))}},{key:"getLastWsHelloTs",value:function(){return this._lastWsHelloTs}},{key:"_checkLoginInfo",value:function(e){var t=0;return $t(this.getModule(Bn).getSDKAppID())?t=gi.NO_SDKAPPID:$t(e.userID)?t=gi.NO_IDENTIFIER:$t(e.userSig)&&(t=gi.NO_USERSIG),{code:t}}},{key:"_isReactUIKit",value:function(){return se&&void 0!==window.tencent_cloud_im_csig_react_uikit_23F_xa}},{key:"onMultipleAccountKickedOut",value:function(e){var t=this;new Ai("kickedOut").setNetworkType(this.getNetworkType()).setMessage("type:".concat(S.KICKED_OUT_MULT_ACCOUNT," newInstanceInfo:").concat(JSON.stringify(e))).end(!0),Ve.w("".concat(this._n,".onMultipleAccountKickedOut userID:").concat(this.getMyUserID()," newInstanceInfo:"),e),this.logout(1).then((function(){t.emitOuterEvent(D.KICKED_OUT,{type:S.KICKED_OUT_MULT_ACCOUNT}),t._m.setNotReadyReason(gi.KICKED_OUT_MULT_ACCOUNT),t._m.reset()}))}},{key:"onMultipleDeviceKickedOut",value:function(e){var t=this;new Ai("kickedOut").setNetworkType(this.getNetworkType()).setMessage("type:".concat(S.KICKED_OUT_MULT_DEVICE," newInstanceInfo:").concat(JSON.stringify(e))).end(!0),Ve.w("".concat(this._n,".onMultipleDeviceKickedOut userID:").concat(this.getMyUserID()," newInstanceInfo:"),e),this.logout(1).then((function(){t.emitOuterEvent(D.KICKED_OUT,{type:S.KICKED_OUT_MULT_DEVICE}),t._m.setNotReadyReason(gi.KICKED_OUT_MULT_DEVICE),t._m.reset()}))}},{key:"onUserSigExpired",value:function(){new Ai("kickedOut").setNetworkType(this.getNetworkType()).setMessage(S.KICKED_OUT_USERSIG_EXPIRED).end(!0),Ve.w("".concat(this._n,".onUserSigExpired: userSig expired")),0!==this.getModule(Bn).getStatusInstanceID()&&(this.emitOuterEvent(D.KICKED_OUT,{type:S.KICKED_OUT_USERSIG_EXPIRED}),this._m.setNotReadyReason(gi.KICKED_OUT_USERSIG_EXPIRED),this._m.reset())}},{key:"onRestApiKickedOut",value:function(e){new Ai("kickedOut").setNetworkType(this.getNetworkType()).setMessage("type:".concat(S.KICKED_OUT_REST_API," newInstanceInfo:").concat(JSON.stringify(e))).end(!0),Ve.w("".concat(this._n,".onRestApiKickedOut userID:").concat(this.getMyUserID()," newInstanceInfo:"),e),0!==this.getModule(Bn).getStatusInstanceID()&&(this.emitOuterEvent(D.KICKED_OUT,{type:S.KICKED_OUT_REST_API}),this._m.setNotReadyReason(gi.KICKED_OUT_REST_API),this._m.reset(),this.getModule(Jn).onRestApiKickedOut())}},{key:"reset",value:function(){Ve.l("".concat(this._n,".reset")),this.resetReady(),this._helloInterval=120,this._lastLoginTs=0,this._lastWsHelloTs=0,this._isWebUniapp=0}}]),n}(co);function ta(){return null}var na=function(){function e(t){r(this,e),this._m=t,this._n="StorageModule",this._storageQueue=new Map,this._errorTolerantHandle()}return s(e,[{key:"_errorTolerantHandle",value:function(){ie||!at(window)&&this._canIUseCookies()||(this.getItem=ta,this.setItem=ta,this.removeItem=ta,this.clear=ta)}},{key:"onCheckTimer",value:function(e){if(e%20==0){if(0===this._storageQueue.size)return;this._doFlush()}}},{key:"_doFlush",value:function(){try{var e,t=k(this._storageQueue);try{for(t.s();!(e=t.n()).done;){var n=v(e.value,2),o=n[0],r=n[1];this._setStorageSync(this._getKey(o),r)}}catch(i){t.e(i)}finally{t.f()}this._storageQueue.clear()}catch(s){Ve.w("".concat(this._n,"._doFlush error:"),s)}}},{key:"_getPrefix",value:function(){var e=this._m.getModule(Bn);return"TIM_".concat(e.getSDKAppID(),"_").concat(e.getUserID(),"_")}},{key:"_getKey",value:function(e){return"".concat(this._getPrefix()).concat(e)}},{key:"getItem",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{var n=t?this._getKey(e):e;return this.getStorageSync(n)}catch(o){return Ve.w("".concat(this._n,".getItem error:"),o),{}}}},{key:"setItem",value:function(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2]){var n=arguments.length>3&&void 0!==arguments[3]&&!arguments[3]?e:this._getKey(e);this._setStorageSync(n,t)}else this._storageQueue.set(e,t)}},{key:"clear",value:function(){try{ie?ae.clearStorageSync():this._canIUseCookies()&&localStorage.clear()}catch(e){Ve.w("".concat(this._n,".clear error:"),e)}}},{key:"removeItem",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{var n=t?this._getKey(e):e;this._removeStorageSync(n)}catch(o){Ve.w("".concat(this._n,".removeItem error:"),o)}}},{key:"getSize",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"b";try{var o={size:0,limitSize:5242880,unit:n};if(Object.defineProperty(o,"leftSize",{enumerable:!0,get:function(){return o.limitSize-o.size}}),ie&&(o.limitSize=1024*ae.getStorageInfoSync().limitSize),e)o.size=JSON.stringify(this.getItem(e)).length+this._getKey(e).length;else if(ie)ae.getStorageInfoSync().keys.forEach((function(e){o.size+=JSON.stringify(t.getStorageSync(e)).length+t._getKey(e).length}));else if(this._canIUseCookies())for(var r in localStorage)localStorage.hasOwnProperty(r)&&(o.size+=localStorage.getItem(r).length+r.length);return this._convertUnit(o)}catch(i){Ve.w("".concat(this._n," error:"),i)}}},{key:"_convertUnit",value:function(e){var t={},n=e.unit;for(var o in t.unit=n,e)"number"==typeof e[o]&&("kb"===n.toLowerCase()?t[o]=Math.round(e[o]/1024):"mb"===n.toLowerCase()?t[o]=Math.round(e[o]/1024/1024):t[o]=e[o]);return t}},{key:"_setStorageSync",value:function(e,t){ie?te?my.setStorageSync({key:e,data:t}):ae.setStorageSync(e,t):this._canIUseCookies()&&localStorage.setItem(e,JSON.stringify(t))}},{key:"getStorageSync",value:function(e){return ie?te?my.getStorageSync({key:e}).data:ae.getStorageSync(e):this._canIUseCookies()?JSON.parse(localStorage.getItem(e)):{}}},{key:"_removeStorageSync",value:function(e){ie?te?my.removeStorageSync({key:e}):ae.removeStorageSync(e):this._canIUseCookies()&&localStorage.removeItem(e)}},{key:"_canIUseCookies",value:function(){return navigator&&navigator.cookieEnabled&&localStorage}},{key:"reset",value:function(){Ve.l("".concat(this._n,".reset")),this._doFlush()}}]),e}(),oa=function(){function e(t){r(this,e),this._n="SSOLogBody",this._report=[]}return s(e,[{key:"pushIn",value:function(e){Ve.d("".concat(this._n,".pushIn"),this._report.length,e),this._report.push(e)}},{key:"backfill",value:function(e){var t;st(e)&&0!==e.length&&(Ve.d("".concat(this._n,".backfill"),this._report.length,e.length),(t=this._report).unshift.apply(t,y(e)))}},{key:"getLogsNumInMemory",value:function(){return this._report.length}},{key:"isEmpty",value:function(){return 0===this._report.length}},{key:"_reset",value:function(){this._report.length=0,this._report=[]}},{key:"getLogsInMemory",value:function(){var e=this._report.slice();return this._reset(),e}}]),e}(),ra=function(e){var t=e.getModule(Bn);return{SDKType:10,SDKAppID:t.getSDKAppID(),SDKVersion:t.getVersion(),tinyID:Number(t.getTinyID()),userID:t.getUserID(),platform:e.getPlatform(),instanceID:t.getInstanceID(),traceID:Pe()}},ia=function(e){c(o,e);var t=m(o);function o(e){var n;r(this,o),(n=t.call(this,e))._n="EventStatModule",n.TAG="im-ssolog-event",n._reportBody=new oa,n.MIN_THRESHOLD=20,n.MAX_THRESHOLD=100,n.WAITING_TIME=6e4,n.REPORT_LEVEL=[4,5,6],n.REPORT_SDKAPPID_BLACKLIST=[],n.REPORT_TINYID_WHITELIST=[],n._lastReportTime=Date.now();var i=n.getInnerEmitterInstance();return i.on(es,n._onLoginSuccess,f(n)),i.on(ns,n._onCloudConfigUpdated,f(n)),n}return s(o,[{key:"reportAtOnce",value:function(){Ve.d("".concat(this._n,".reportAtOnce")),this._report()}},{key:"_onLoginSuccess",value:function(){var e=this,t=this.getModule(Vn),n=t.getItem(this.TAG,!1);!$t(n)&&ut(n.forEach)&&(Ve.l("".concat(this._n,"._onLoginSuccess get ssolog in storage, count:").concat(n.length)),n.forEach((function(t){e._reportBody.pushIn(t)})),t.removeItem(this.TAG,!1))}},{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("evt_rpt_threshold"),t=this.getCloudConfig("evt_rpt_waiting"),n=this.getCloudConfig("evt_rpt_level"),o=this.getCloudConfig("evt_rpt_sdkappid_bl"),r=this.getCloudConfig("evt_rpt_tinyid_wl");at(e)||(this.MIN_THRESHOLD=Number(e)),at(t)||(this.WAITING_TIME=Number(t)),at(n)||(this.REPORT_LEVEL=n.split(",").map((function(e){return Number(e)}))),at(o)||(this.REPORT_SDKAPPID_BLACKLIST=o.split(",").map((function(e){return Number(e)}))),at(r)||(this.REPORT_TINYID_WHITELIST=r.split(","))}},{key:"pushIn",value:function(e){e instanceof Ai&&(e.updateTimeStamp(),this._reportBody.pushIn(e),this._reportBody.getLogsNumInMemory()>=this.MIN_THRESHOLD&&this._report())}},{key:"onCheckTimer",value:function(){Date.now()<this._lastReportTime+this.WAITING_TIME||this._reportBody.isEmpty()||this._report()}},{key:"_filterLogs",value:function(e){var t=this,n=this.getModule(Bn),o=n.getSDKAppID(),r=n.getTinyID();return Ft(this.REPORT_SDKAPPID_BLACKLIST,o)&&!qt(this.REPORT_TINYID_WHITELIST,r)?[]:e.filter((function(e){return t.REPORT_LEVEL.includes(e.level)}))}},{key:"_report",value:function(){var e=this;if(!this._reportBody.isEmpty()){var t=this._reportBody.getLogsInMemory(),o=this._filterLogs(t);if(0!==o.length){var r={header:ra(this),event:o};this.request({protocolName:Vr,requestData:n({},r)}).then((function(){e._lastReportTime=Date.now()})).catch((function(n){Ve.w("".concat(e._n,".report failed. networkType:").concat(e.getNetworkType()," error:"),n),e._reportBody.backfill(t),e._reportBody.getLogsNumInMemory()>e.MAX_THRESHOLD&&e._flushAtOnce()}))}else this._lastReportTime=Date.now()}}},{key:"_flushAtOnce",value:function(){var e=this.getModule(Vn),t=e.getItem(this.TAG,!1),n=this._reportBody.getLogsInMemory(),o="".concat(this._n,"._flushAtOnce");if($t(t))Ve.l("".concat(o," count:").concat(n.length)),e.setItem(this.TAG,n,!0,!1);else{var r=n.concat(t);r.length>this.MAX_THRESHOLD&&(r=r.slice(0,this.MAX_THRESHOLD)),Ve.l("".concat(o," count:").concat(r.length)),e.setItem(this.TAG,r,!0,!1)}}},{key:"reset",value:function(){Ve.l("".concat(this._n,".reset")),this._lastReportTime=0,this._report(),this.REPORT_SDKAPPID_BLACKLIST=[],this.REPORT_TINYID_WHITELIST=[]}}]),o}(co),sa="none",aa="online",ca=[gi.OVER_FREQUENCY_LIMIT,gi.OPEN_SERVICE_OVERLOAD_ERROR],ua=function(){function e(t){r(this,e),this._m=t,this._networkType="",this._n="NetMonitorModule",this.MAX_WAIT_TIME=3e3,this._mpNetworkStatusCallback=null,this._webOnlineCallback=null,this._webOfflineCallback=null}return s(e,[{key:"start",value:function(){var e=this;ie?(ae.getNetworkType({success:function(t){e._networkType=t.networkType||t.subtype||"",t.networkType===sa?Ve.w("".concat(e._n,".start no network, please check!")):Ve.i("".concat(e._n,".start networkType:").concat(t.networkType))}}),this._mpNetworkStatusCallback=this._onNetworkStatusChange.bind(this),ae.onNetworkStatusChange(this._mpNetworkStatusCallback)):(this._networkType=aa,this._webOnlineCallback=this._onWebOnline.bind(this),this._webOfflineCallback=this._onWebOffline.bind(this),window&&(window.addEventListener("online",this._webOnlineCallback),window.addEventListener("offline",this._webOfflineCallback)))}},{key:"_onWebOnline",value:function(){this._onNetworkStatusChange({isConnected:!0,networkType:aa})}},{key:"_onWebOffline",value:function(){this._onNetworkStatusChange({isConnected:!1,networkType:sa})}},{key:"_onNetworkStatusChange",value:function(e){var t=e.isConnected,n=e.networkType,o="".concat(this._n,"._onNetworkStatusChange"),r=!1;t?(Ve.i("".concat(o," previous:").concat(this._networkType," current:").concat(n)),this._networkType!==n&&(r=!0,this._m.getModule(Jn).reConnect(!0))):this._networkType!==n&&(r=!0,Ve.w("".concat(o," no network, please check!")),this._m.getModule(Jn).offline()),r&&(new Ai("networkChange").setMessage("isConnected:".concat(t," previousNetworkType:").concat(this._networkType," networkType:").concat(n)).end(),this._networkType=n)}},{key:"probe",value:function(e){var t=this;if(!at(e)&&ca.includes(e.code))return Promise.resolve([!0,this._networkType]);var n="".concat(this._n,".probe");return new Promise((function(e,o){ie?ae.getNetworkType({success:function(o){t._networkType=o.networkType,o.networkType===sa?(Ve.w("".concat(n," no network, please check!")),e([!1,o.networkType])):(Ve.i("".concat(n," networkType:").concat(o.networkType)),e([!0,o.networkType]))}}):t._networkType===sa?e([!1,sa]):e([!0,aa])}))}},{key:"getNetworkType",value:function(){return this._networkType}},{key:"reset",value:function(){Ve.l("".concat(this._n,".reset")),ie?null!==this._mpNetworkStatusCallback&&(ae.offNetworkStatusChange&&(oe||Q?ae.offNetworkStatusChange(this._mpNetworkStatusCallback):ae.offNetworkStatusChange()),this._mpNetworkStatusCallback=null):window&&(null!==this._webOnlineCallback&&(window.removeEventListener("online",this._webOnlineCallback),this._webOnlineCallback=null),null!==this._onWebOffline&&(window.removeEventListener("offline",this._webOfflineCallback),this._webOfflineCallback=null))}}]),e}(),la=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e){var t=Object.prototype.hasOwnProperty,n="~";function o(){}function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function i(e,t,o,i,s){if("function"!=typeof o)throw new TypeError("The listener must be a function");var a=new r(o,i||e,s),c=n?n+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new o:delete e._events[t]}function a(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(n=!1)),a.prototype.eventNames=function(){var e,o,r=[];if(0===this._eventsCount)return r;for(o in e=this._events)t.call(e,o)&&r.push(n?o.slice(1):o);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},a.prototype.listeners=function(e){var t=n?n+e:e,o=this._events[t];if(!o)return[];if(o.fn)return[o.fn];for(var r=0,i=o.length,s=new Array(i);r<i;r++)s[r]=o[r].fn;return s},a.prototype.listenerCount=function(e){var t=n?n+e:e,o=this._events[t];return o?o.fn?1:o.length:0},a.prototype.emit=function(e,t,o,r,i,s){var a=n?n+e:e;if(!this._events[a])return!1;var c,u,l=this._events[a],d=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),d){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,o),!0;case 4:return l.fn.call(l.context,t,o,r),!0;case 5:return l.fn.call(l.context,t,o,r,i),!0;case 6:return l.fn.call(l.context,t,o,r,i,s),!0}for(u=1,c=new Array(d-1);u<d;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var p,h=l.length;for(u=0;u<h;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),d){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,o);break;case 4:l[u].fn.call(l[u].context,t,o,r);break;default:if(!c)for(p=1,c=new Array(d-1);p<d;p++)c[p-1]=arguments[p];l[u].fn.apply(l[u].context,c)}}return!0},a.prototype.on=function(e,t,n){return i(this,e,t,n,!1)},a.prototype.once=function(e,t,n){return i(this,e,t,n,!0)},a.prototype.removeListener=function(e,t,o,r){var i=n?n+e:e;if(!this._events[i])return this;if(!t)return s(this,i),this;var a=this._events[i];if(a.fn)a.fn!==t||r&&!a.once||o&&a.context!==o||s(this,i);else{for(var c=0,u=[],l=a.length;c<l;c++)(a[c].fn!==t||r&&!a[c].once||o&&a[c].context!==o)&&u.push(a[c]);u.length?this._events[i]=1===u.length?u[0]:u:s(this,i)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&s(this,t)):(this._events=new o,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,e.exports=a})),da=function(e){c(n,e);var t=m(n);function n(e){var o;return r(this,n),(o=t.call(this,e))._n="BigDataChannelModule",o.FILETYPE={SOUND:2106,FILE:2107,VIDEO:2113},o._bdh_download_server="grouptalk.c2c.qq.com",o._BDHBizID=10001,o._authKey="",o._expireTime=0,o.getInnerEmitterInstance().on(es,o._getAuthKey,f(o)),o}return s(n,[{key:"_getAuthKey",value:function(){var e=this;this.isIntl()||this.request({protocolName:fo}).then((function(t){t.data.authKey&&(e._authKey=t.data.authKey,e._expireTime=parseInt(t.data.expireTime))}))}},{key:"_isFromOlderVersion",value:function(e){return!(!e.content||2===e.content.downloadFlag)}},{key:"parseElements",value:function(e,t){if(!st(e)||!t)return[];for(var n=[],o=null,r=0;r<e.length;r++)o=e[r],this._needParse(o)?n.push(this._parseElement(o,t)):n.push(e[r]);return n}},{key:"_needParse",value:function(e){return!e.cloudCustomData&&!(!this._isFromOlderVersion(e)||e.type!==S.MSG_AUDIO&&e.type!==S.MSG_FILE&&e.type!==S.MSG_VIDEO)}},{key:"_parseElement",value:function(e,t){switch(e.type){case S.MSG_AUDIO:return this._parseAudioElement(e,t);case S.MSG_FILE:return this._parseFileElement(e,t);case S.MSG_VIDEO:return this._parseVideoElement(e,t)}}},{key:"_parseAudioElement",value:function(e,t){return e.content.url=this._genAudioUrl(e.content.uuid,t),e}},{key:"_parseFileElement",value:function(e,t){return e.content.url=this._genFileUrl(e.content.uuid,t,e.content.fileName),e}},{key:"_parseVideoElement",value:function(e,t){return e.content.url=this._genVideoUrl(e.content.uuid,t),e}},{key:"_genAudioUrl",value:function(e,t){if(""===this._authKey)return"";var n=this.getModule(Bn).getSDKAppID();return"https://".concat(this._bdh_download_server,"/asn.com/stddownload_common_file?authkey=").concat(this._authKey,"&bid=").concat(this._BDHBizID,"&subbid=").concat(n,"&fileid=").concat(e,"&filetype=").concat(this.FILETYPE.SOUND,"&openid=").concat(t,"&ver=0")}},{key:"_genFileUrl",value:function(e,t,n){if(""===this._authKey)return"";n||(n="".concat(Math.floor(1e5*Math.random()),"-").concat(Date.now()));var o=this.getModule(Bn).getSDKAppID();return"https://".concat(this._bdh_download_server,"/asn.com/stddownload_common_file?authkey=").concat(this._authKey,"&bid=").concat(this._BDHBizID,"&subbid=").concat(o,"&fileid=").concat(e,"&filetype=").concat(this.FILETYPE.FILE,"&openid=").concat(t,"&ver=0&filename=").concat(encodeURIComponent(n))}},{key:"_genVideoUrl",value:function(e,t){if(""===this._authKey)return"";var n=this.getModule(Bn).getSDKAppID();return"https://".concat(this._bdh_download_server,"/asn.com/stddownload_common_file?authkey=").concat(this._authKey,"&bid=").concat(this._BDHBizID,"&subbid=").concat(n,"&fileid=").concat(e,"&filetype=").concat(this.FILETYPE.VIDEO,"&openid=").concat(t,"&ver=0")}},{key:"reset",value:function(){this._authKey="",this.expireTime=0}}]),n}(co),pa=["requestSnapshotUrl"],ha=function(e){c(o,e);var t=m(o);function o(e){var n;r(this,o),(n=t.call(this,e))._n="UploadModule",n.TIMUploadPlugin=null,n.timUploadPlugin=null,n.COSSDK=null,n._cosUploadMethod=null,n.expiredTimeLimit=600,n.appid=0,n.bucketName="",n.ciUrl="",n.directory="",n.downloadUrl="",n.uploadUrl="",n.region="ap-shanghai",n.cos=null,n.cosOptions={secretId:"",secretKey:"",sessionToken:"",expiredTime:0},n.uploadFileType="",n.duration=900,n.tryCount=0,n.UPLOAD_SIZE_LIMIT={AUDIO:20971520,FILE:104857600,IMAGE:20971520,VIDEO:104857600};var i=n.getInnerEmitterInstance();return i.on(es,n._init,f(n)),i.on(ns,n._onCloudConfigUpdated,f(n)),n}return s(o,[{key:"_init",value:function(){var e=this.getModule(Wn);if(this.TIMUploadPlugin=e.getPlugin("tim-upload-plugin"),this.TIMUploadPlugin)this._initUploaderMethod();else{var t=ie?"cos-wx-sdk":"cos-js-sdk";this.COSSDK=e.getPlugin(t),this.COSSDK?(this._getAuthorizationKey(),this.outputWarning("CosReplacement",t)):this.outputWarning("PluginUndetected")}}},{key:"_onCloudConfigUpdated",value:function(){var e="".concat(this._n,"._onCloudConfigUpdated"),t=this.getCloudConfig("upload_size_limit");if(Ve.l("".concat(e," uploadSizeLimit:").concat(t)),!at(t))try{var n=JSON.parse(t);this.UPLOAD_SIZE_LIMIT={AUDIO:n.a?1048576*parseInt(n.a):this.UPLOAD_SIZE_LIMIT.AUDIO,FILE:n.f?1048576*parseInt(n.f):this.UPLOAD_SIZE_LIMIT.FILE,IMAGE:n.i?1048576*parseInt(n.i):this.UPLOAD_SIZE_LIMIT.IMAGE,VIDEO:n.v?1048576*parseInt(n.v):this.UPLOAD_SIZE_LIMIT.VIDEO}}catch(o){Ve.e("".concat(e," JSON parse error. uploadSizeLimit:"),t)}}},{key:"_getAuthorizationKey",value:function(){var e=this,t="".concat(this._n,".").concat("_getAuthorizationKey"),n=new Ai("_getAuthorizationKey"),o=Math.ceil(Date.now()/1e3);this.request({protocolName:Fr,requestData:{duration:this.expiredTimeLimit}}).then((function(r){var i=r.data;Ve.l("".concat(t," ok. data:"),i);var s=i.expiredTime-o;n.setMessage("requestId:".concat(i.requestId," requestTime:").concat(o," expiredTime:").concat(i.expiredTime," diff:").concat(s,"s")).setNetworkType(e.getNetworkType()).end(),!ie&&i.region&&(e.region=i.region),e.appid=i.appid,e.bucketName=i.bucketName,e.ciUrl=i.ciUrl,e.directory=i.directory,e.downloadUrl=i.downloadUrl,e.uploadUrl=i.uploadUrl,e.cosOptions={secretId:i.secretId,secretKey:i.secretKey,sessionToken:i.sessionToken,expiredTime:i.expiredTime},Ve.l("".concat(t," ok. region:").concat(e.region," bucketName:").concat(e.bucketName)),e._initUploaderMethod()})).catch((function(o){e.probeNetwork().then((function(e){var t=v(e,2),r=t[0],i=t[1];n.setError(o,r,i).end()})),Ve.w("".concat(t," failed. error:"),o)}))}},{key:"_getCosPreSigUrl",value:function(e){var t=this,n="".concat(this._n,".").concat("_getCosPreSigUrl"),o=Math.ceil(Date.now()/1e3),r=new Ai("_getCosPreSigUrl");return this.request({protocolName:qr,requestData:{fileType:e.fileType,fileName:e.fileName,uploadMethod:e.uploadMethod,duration:e.duration}}).then((function(e){t.tryCount=0;var i=e.data||{},s=i.expiredTime-o;return Ve.l("".concat(n," ok. data:"),i),r.setMessage("requestId:".concat(i.requestId," expiredTime:").concat(i.expiredTime," diff:").concat(s,"s")).setNetworkType(t.getNetworkType()).end(),i})).catch((function(o){return-1===o.code&&(o.code=gi.COS_GET_SIG_FAIL),t.probeNetwork().then((function(e){var t=v(e,2),n=t[0],i=t[1];r.setError(o,n,i).end()})),Ve.w("".concat(n," failed. error:"),o),t.tryCount<1?(t.tryCount++,t._getCosPreSigUrl(e)):(t.tryCount=0,Xi({code:gi.COS_GET_SIG_FAIL}))}))}},{key:"_initUploaderMethod",value:function(){var e=this;if(this.TIMUploadPlugin)return this.timUploadPlugin=new this.TIMUploadPlugin,void(this._cosUploadMethod=function(t,n){e.timUploadPlugin.uploadFile(t,n)});this.appid&&(this.cos=ie?new this.COSSDK({ForcePathStyle:!0,getAuthorization:this._getAuthorization.bind(this)}):new this.COSSDK({getAuthorization:this._getAuthorization.bind(this)}),this._cosUploadMethod=ie?function(t,n){e.cos.postObject(t,n)}:function(t,n){e.cos.uploadFiles(t,n)})}},{key:"onCheckTimer",value:function(e){this.COSSDK&&(this.TIMUploadPlugin||this.isLoggedIn()&&e%60==0&&Math.ceil(Date.now()/1e3)>=this.cosOptions.expiredTime-120&&this._getAuthorizationKey())}},{key:"_getAuthorization",value:function(e,t){t({TmpSecretId:this.cosOptions.secretId,TmpSecretKey:this.cosOptions.secretKey,XCosSecurityToken:this.cosOptions.sessionToken,ExpiredTime:this.cosOptions.expiredTime})}},{key:"upload",value:function(e){if(!0===e.getRelayFlag())return Promise.resolve();var t=this.getModule(to);switch(e.type){case S.MSG_IMAGE:return t.addTotalCount(Ii),this._uploadImage(e);case S.MSG_FILE:return t.addTotalCount(Ii),this._uploadFile(e);case S.MSG_AUDIO:return t.addTotalCount(Ii),this._uploadAudio(e);case S.MSG_VIDEO:return t.addTotalCount(Ii),this._uploadVideo(e);default:return Promise.resolve()}}},{key:"_uploadImage",value:function(e){var t=this,o=this.getModule(Nn),r=e.getElements()[0],i=o.getMessageOption(e.clientSequence);return this.doUploadImage({file:i.payload.file,to:i.to,onProgress:function(e){if(r.updatePercent(e),ut(i.onProgress))try{i.onProgress(e)}catch(t){return Xi({code:gi.MESSAGE_ONPROGRESS_FUNCTION_ERROR})}}}).then((function(o){var i,s,a=o.location,c=o.fileType,u=o.fileSize,l=o.width,d=o.height,p=o.smallImageUrl,h=o.smallImageWidth,g=o.smallImageHeight,f=o.largeImageUrl,_=o.largeImageWidth,m=o.largeImageHeight,v=t.isPrivateNetWork()?a:It(a);return r.updateImageFormat(c),p&&f?(i={url:p,width:h,height:g},s={url:f,width:_,height:m}):(i=Ut({originUrl:v,originWidth:l,originHeight:d,min:198}),s=Ut({originUrl:v,originWidth:l,originHeight:d,min:720})),r.updateImageInfoArray([{size:u,url:v,width:l,height:d},n({},s),n({},i)]),e}))}},{key:"_uploadFile",value:function(e){var t=this,n=this.getModule(Nn),o=e.getElements()[0],r=n.getMessageOption(e.clientSequence);return this.doUploadFile({file:r.payload.file,to:r.to,onProgress:function(e){if(o.updatePercent(e),ut(r.onProgress))try{r.onProgress(e)}catch(t){return Xi({code:gi.MESSAGE_ONPROGRESS_FUNCTION_ERROR})}}}).then((function(n){var r=n.location,i=t.isPrivateNetWork()?r:It(r);return o.updateFileUrl(i),e}))}},{key:"_uploadAudio",value:function(e){var t=this,n=this.getModule(Nn),o=e.getElements()[0],r=n.getMessageOption(e.clientSequence);return this.doUploadAudio({file:r.payload.file,to:r.to,onProgress:function(e){if(o.updatePercent(e),ut(r.onProgress))try{r.onProgress(e)}catch(t){return Xi({code:gi.MESSAGE_ONPROGRESS_FUNCTION_ERROR})}}}).then((function(n){var r=n.location,i=t.isPrivateNetWork()?r:It(r);return o.updateAudioUrl(i),e}))}},{key:"_uploadVideo",value:function(e){var t=this,n=this.getModule(Nn),o=e.getElements()[0],r=n.getMessageOption(e.clientSequence);return this.doUploadVideo({file:r.payload.file,to:r.to,onProgress:function(e){if(o.updatePercent(e),ut(r.onProgress))try{r.onProgress(e)}catch(t){return Xi({code:gi.MESSAGE_ONPROGRESS_FUNCTION_ERROR})}}}).then((function(n){var r=n.location,i=n.snapshotInfo,s=t.isPrivateNetWork()?r:It(r);return o.updateVideoUrl(s),$t(i)||o.updateSnapshotInfo(i),e}))}},{key:"_checkSizeError",value:function(e){return Xi({code:gi["MESSAGE_".concat(e,"_SIZE_LIMIT")],message:this.getErrorMessage("UploadSizeLimit",e.toLowerCase(),"".concat(this.UPLOAD_SIZE_LIMIT[e]/1048576," MB"))})}},{key:"doUploadImage",value:function(e){var t=this;if(!e.file)return Xi({code:gi.MESSAGE_IMAGE_SELECT_FILE_FIRST});var n=this._checkImageType(e.file);if(!0!==n)return n;var o=this._checkImageSize(e.file);if(!0!==o)return o;var r=null;return this._setUploadFileType(as),this.uploadByCOS(e).then((function(e){return r=e,t.isPrivateNetWork()?Ot(e.location):Ot("https://".concat(e.location))})).then((function(e){return r.width=e.width,r.height=e.height,Promise.resolve(r)}))}},{key:"_checkImageType",value:function(e){var t="";return t=ie?e.url.slice(e.url.lastIndexOf(".")+1):e.files[0].name.slice(e.files[0].name.lastIndexOf(".")+1),is.indexOf(t.toLowerCase())>=0||Xi({code:gi.MESSAGE_IMAGE_TYPES_LIMIT})}},{key:"_checkImageSize",value:function(e){var t=0;return 0===(t=ie?e.size:e.files[0].size)?Xi({code:gi.MESSAGE_FILE_IS_EMPTY}):t<this.UPLOAD_SIZE_LIMIT.IMAGE||this._checkSizeError("IMAGE")}},{key:"doUploadFile",value:function(e){return e.file?e.file.files[0].size>this.UPLOAD_SIZE_LIMIT.FILE?this._checkSizeError("FILE"):0===e.file.files[0].size?Xi({code:gi.MESSAGE_FILE_IS_EMPTY}):(this._setUploadFileType(ls),this.uploadByCOS(e)):Xi({code:gi.MESSAGE_FILE_SELECT_FILE_FIRST})}},{key:"doUploadVideo",value:function(e){return e.file.videoFile.size>this.UPLOAD_SIZE_LIMIT.VIDEO?this._checkSizeError("VIDEO"):0===e.file.videoFile.size?Xi({code:gi.MESSAGE_FILE_IS_EMPTY}):-1===ss.indexOf(e.file.videoFile.type)?Xi({code:gi.MESSAGE_VIDEO_TYPES_LIMIT}):(this._setUploadFileType(cs),ie?this.handleVideoUpload({file:e.file.videoFile,onProgress:e.onProgress}):se?this.handleVideoUpload(e):void 0)}},{key:"handleVideoUpload",value:function(e){var t=this;return new Promise((function(n,o){t.uploadByCOS(e).then((function(e){n(e)})).catch((function(){t.uploadByCOS(e).then((function(e){n(e)})).catch((function(){o(new Wi({code:gi.MESSAGE_VIDEO_UPLOAD_FAIL}))}))}))}))}},{key:"doUploadAudio",value:function(e){return e.file?e.file.size>this.UPLOAD_SIZE_LIMIT.AUDIO?this._checkSizeError("AUDIO"):0===e.file.size?Xi({code:gi.MESSAGE_FILE_IS_EMPTY}):(this._setUploadFileType(us),this.uploadByCOS(e)):Xi({code:gi.MESSAGE_AUDIO_UPLOAD_FAIL})}},{key:"uploadByCOS",value:function(e){var t=this;if(!ut(this._cosUploadMethod))return this.outputWarning("PluginUndetected"),Xi({code:gi.COS_UNDETECTED});if(this.timUploadPlugin)return this._uploadWithPreSigUrl(e);var n=new Ai("upload"),o="".concat(this._n,".uploadByCOS"),r=Date.now(),i=this._getFile(e);return new Promise((function(s,a){var c=ie?t._createCosOptionsWXMiniApp(e):t._createCosOptionsWeb(e),u=t;t._cosUploadMethod(c,(function(e,c){var l=Object.create(null);if(c){if(e||st(c.files)&&c.files[0].error){var d=new Wi({code:gi.MESSAGE_FILE_UPLOAD_FAIL});return n.setError(d,!0,t.getNetworkType()).end(),Ve.l("".concat(o," failed. error:"),c.files[0].error),403===c.files[0].error.statusCode&&(Ve.w("".concat(o," failed. cos AccessKeyId was invalid, regain auth key!")),t._getAuthorizationKey()),void a(d)}l.fileName=i.name,l.fileSize=i.size,l.fileType=i.type.slice(i.type.indexOf("/")+1).toLowerCase(),l.location=ie?c.Location:c.files[0].data.Location;var p=Date.now()-r,h=u._formatFileSize(i.size),g=u._formatSpeed(1e3*i.size/p),f="size:".concat(h," time:").concat(p,"ms speed:").concat(g);Ve.l("".concat(o," success. name:").concat(i.name," ").concat(f)),s(l);var _=t.getModule(to);return _.addCost(Ii,p),_.addFileSize(Ii,i.size),void n.setNetworkType(t.getNetworkType()).setMessage(f).end()}var m=new Wi({code:gi.MESSAGE_FILE_UPLOAD_FAIL});n.setError(m,!0,u.getNetworkType()).end(),Ve.w("".concat(o," failed. error:"),e),403===e.statusCode&&(Ve.w("".concat(o," failed. cos AccessKeyId was invalid, regain auth key!")),t._getAuthorizationKey()),a(m)}))}))}},{key:"_uploadWithPreSigUrl",value:function(e){var t=this,n="".concat(this._n,"._uploadWithPreSigUrl"),o=this._getFile(e);return this._createCosOptionsPreSigUrl(e).then((function(e){return new Promise((function(r,i){var s=new Ai("upload"),a=e.requestSnapshotUrl,c=void 0===a?void 0:a,u=g(e,pa),l=Date.now();t._cosUploadMethod(u,(function(e,a){if(e||403===a.statusCode)return s.setError(new Wi(e),!0,t.getNetworkType()).end(),Ve.l("".concat(n," failed, error:"),e),void i(new Wi({code:gi.MESSAGE_FILE_UPLOAD_FAIL}));var d=Object.create(null),p=a.data.location||"";t.isPrivateNetWork()||0!==p.indexOf("https://")&&0!==p.indexOf("http://")||(p=p.split("//")[1]),d.fileName=o.name,d.fileSize=o.size,d.fileType=o.type.slice(o.type.indexOf("/")+1).toLowerCase(),d.location=p;var h=Date.now()-l,g=t._formatFileSize(o.size),f=t._formatSpeed(1e3*o.size/h),_="size:".concat(g,",time:").concat(h,"ms,speed:").concat(f," res:").concat(JSON.stringify(a.data));Ve.l("".concat(n," success name:").concat(o.name,",").concat(_)),s.setNetworkType(t.getNetworkType()).setMessage(_).end();var m=t.getModule(to);m.addCost(Ii,h),m.addFileSize(Ii,o.size);var v=[];if(u.thumbUrl&&u.largeUrl&&(v=[t._getSmallImageInfoByUrl(u.thumbUrl,d),t._getLargeImageInfoByUrl(u.largeUrl,d)]),c&&v.push(t._getSnapshotInfoByUrl(c,d)),v.length>0)return Promise.all(v).then((function(){r(d)}));r(d)}))}))}))}},{key:"_getRawOrUploadProxyUrl",value:function(e){var t=this.getModule(Bn).getFileUploadProxy(),n=e;return t&&(n=e.replace(/^https:\/\/[^/]+/,t)),n}},{key:"_getFile",value:function(e){var t;return st(e.file.files)||(t=e.file.files,"filelist"===dt(t))?e.file.files[0]:e.file}},{key:"_formatFileSize",value:function(e){return e<1024?e+"B":e<1048576?Math.floor(e/1024)+"KB":Math.floor(e/1048576)+"MB"}},{key:"_formatSpeed",value:function(e){return e<=1048576?xt(e/1024,1)+"KB/s":xt(e/1048576,1)+"MB/s"}},{key:"_createCosOptionsWeb",value:function(e){var t=this._getFile(e),n=t.name,o=n.slice(n.lastIndexOf(".")),r=this._genFileName("".concat(_t(999999)).concat(o));return{files:[{Bucket:"".concat(this.bucketName,"-").concat(this.appid),Region:this.region,Key:"".concat(this.directory,"/").concat(r),Body:t}],SliceSize:1048576,onProgress:function(t){if("function"==typeof e.onProgress)try{e.onProgress(t.percent)}catch(n){Ve.w("onProgress callback error:",n)}},onFileFinish:function(e,t,n){}}}},{key:"_createCosOptionsWXMiniApp",value:function(e){var t=this._getFile(e),n=this._genFileName(t.name),o=t.url;return{Bucket:"".concat(this.bucketName,"-").concat(this.appid),Region:this.region,Key:"".concat(this.directory,"/").concat(n),FilePath:o,onProgress:function(t){if(Ve.l(JSON.stringify(t)),"function"==typeof e.onProgress)try{e.onProgress(t.percent)}catch(n){Ve.w("onProgress callback error:",n)}}}}},{key:"_createCosOptionsPreSigUrl",value:function(e){var t=this,n="",o="",r=0,i=this._getFile(e);if(ie)n=this._genFileName(i.name),o=i.url,r=1;else{var s=i.name,a=s.slice(s.lastIndexOf("."));n=this._genFileName("".concat(_t(999999)).concat(a)),o=i,r=0}return this._getCosPreSigUrl({fileType:this.uploadFileType,fileName:n,uploadMethod:r,duration:this.duration}).then((function(r){var i=r.uploadUrl,s=r.downloadUrl,a=r.requestSnapshotUrl,c=void 0===a?void 0:a,u=r.thumbUrl,l=r.largeUrl;return{url:t._getRawOrUploadProxyUrl(i),fileType:t.uploadFileType,fileName:n,resources:o,downloadUrl:s,requestSnapshotUrl:c,thumbUrl:u,largeUrl:l,onProgress:function(t){if("function"==typeof e.onProgress)try{e.onProgress(t.percent)}catch(n){Ve.w("onProgress callback error:",n),Ve.e(n)}}}}))}},{key:"_genFileName",value:function(e){return"".concat(Nt(),"-").concat(e)}},{key:"_setUploadFileType",value:function(e){this.uploadFileType=e}},{key:"_getSnapshotInfoByUrl",value:function(e,t){var n=this,o=new Ai("getSnapshotInfo");return this.request({protocolName:Br,requestData:{platform:this.getPlatform(),coverName:this._genFileName(_t(99999)),requestSnapshotUrl:e}}).then((function(e){var n=(e.data||{}).snapshotUrl;return o.setMessage("snapshotUrl:".concat(n)).end(),$t(n)?{}:Ot(n).then((function(e){t.snapshotInfo={snapshotUrl:n,snapshotWidth:e.width,snapshotHeight:e.height}}))})).catch((function(e){return Ve.w("".concat(n._n,"._getSnapshotInfoByUrl failed. error:"),e),o.setCode(e.errorCode).setMessage(e.errorInfo).end(),{}}))}},{key:"_getSmallImageInfoByUrl",value:function(e,t){return Ot(e).then((function(n){t.smallImageUrl=e,t.smallImageWidth=n.width,t.smallImageHeight=n.height}))}},{key:"_getLargeImageInfoByUrl",value:function(e,t){return Ot(e).then((function(n){t.largeImageUrl=e,t.largeImageWidth=n.width,t.largeImageHeight=n.height}))}},{key:"reset",value:function(){Ve.l("".concat(this._n,".reset"))}}]),o}(co),ga=["downloadKey","pbDownloadKey","messageList"],fa=function(){function e(t){r(this,e),this._n="MergerMessageHandler",this._messageModule=t}return s(e,[{key:"uploadMergerMessage",value:function(e,t){var n=this,o="".concat(this._n,".").concat("uploadMergerMessage");Ve.d("".concat(o," message:"),e,"messageBytes:".concat(t));var r=e.payload.messageList,i=r.length,s=new Ai("uploadMergerMessage");return this._messageModule.request({protocolName:Yr,requestData:{messageList:r}}).then((function(e){Ve.d("".concat(o," ok. response:"),e.data);var r=e.data,a=r.pbDownloadKey,c=r.downloadKey,u={pbDownloadKey:a,downloadKey:c,messageNumber:i};return s.setNetworkType(n._messageModule.getNetworkType()).setMessage("".concat(i,"-").concat(t,"-").concat(c)).end(),u})).catch((function(e){throw Ve.w("".concat(o," failed. error:"),e),n._messageModule.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];s.setError(e,o,r).end()})),e}))}},{key:"downloadMergerMessage",value:function(e){var t=this,o="".concat(this._n,".").concat("downloadMergerMessage");Ve.d("".concat(o," message:"),e);var r=e.payload.downloadKey,i=this._messageModule.getFileDownloadProxy(),s=new Ai("downloadMergerMessage");return s.setMessage("downloadKey:".concat(r)),this._messageModule.request({protocolName:$r,requestData:{downloadKey:r}}).then((function(r){if(Ve.d("".concat(o," ok. response:"),r.data),ut(e.clearElement)){var a=e.payload;a.downloadKey,a.pbDownloadKey,a.messageList;var c=g(a,ga);e.clearElement(),e.setElement({type:e.type,content:n({messageList:r.data.messageList},c)},i)}else{var u=[];r.data.messageList.forEach((function(e){if(!$t(e)){var t=new Vi(e,i);u.push(t)}})),e.payload.messageList=u,e.payload.downloadKey="",e.payload.pbDownloadKey=""}return s.setNetworkType(t._messageModule.getNetworkType()).end(),e})).catch((function(e){throw Ve.w("".concat(o," failed. key:").concat(r," error:"),e),t._messageModule.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];s.setError(e,o,r).end()})),e}))}},{key:"createMergerMessagePack",value:function(e,t,n){return e.conversationType===S.CONV_C2C?this._createC2CMergerMessagePack(e,t,n):this._createGroupMergerMessagePack(e,t,n)}},{key:"_createC2CMergerMessagePack",value:function(e,t,n){var o=null;t&&(t.offlinePushInfo&&(o=t.offlinePushInfo),!0===t.onlineUserOnly&&(o?o.disablePush=!0:o={disablePush:!0}));var r=[];if(it(t)&&it(t.messageControlInfo)){var i=t.messageControlInfo,s=i.excludedFromUnreadCount,a=i.excludedFromLastMessage,c=i.excludedFromContentModeration;!0===s&&r.push("NoUnread"),!0===a&&r.push("NoLastMsg"),!0===c&&r.push("NoMsgCheck")}var u="";ot(e.cloudCustomData)&&e.cloudCustomData.length>0&&(u=e.cloudCustomData);var l=n.pbDownloadKey,d=n.downloadKey,p=n.messageNumber,h=e.payload,g=h.title,f=h.abstractList,_=h.compatibleText,m=this._messageModule.getModule(Un),v=m&&m.isOnlineMessage(e,t)?0:void 0;return{protocolName:_o,tjgID:this._messageModule.generateTjgID(e),requestData:{fromAccount:this._messageModule.getMyUserID(),toAccount:e.to,msgBody:[{msgType:e.type,msgContent:{pbDownloadKey:l,downloadKey:d,title:g,abstractList:f,compatibleText:_,messageNumber:p}}],cloudCustomData:u,clientTime:e.clientTime,msgSeq:e.sequence,msgRandom:e.random,msgLifeTime:v,offlinePushInfo:o?{pushFlag:!0===o.disablePush?1:0,title:o.title||"",desc:o.description||"",ext:o.extension||"",apnsInfo:{badgeMode:!0===o.ignoreIOSBadge?1:0},androidInfo:{OPPOChannelID:o.androidOPPOChannelID||""}}:void 0,messageControlInfo:0!==v?r:void 0,isSupportExtension:!0===e.isSupportExtension?1:0}}}},{key:"_createGroupMergerMessagePack",value:function(e,t,n){var o=null;t&&t.offlinePushInfo&&(o=t.offlinePushInfo);var r=[];if(it(t)&&it(t.messageControlInfo)){var i=t.messageControlInfo,s=i.excludedFromUnreadCount,a=i.excludedFromLastMessage,c=i.excludedFromContentModeration;!0===s&&r.push("NoUnread"),!0===a&&r.push("NoLastMsg"),!0===c&&r.push("NoMsgCheck")}var u="";ot(e.cloudCustomData)&&e.cloudCustomData.length>0&&(u=e.cloudCustomData);var l=n.pbDownloadKey,d=n.downloadKey,p=n.messageNumber,h=e.payload,g=h.title,f=h.abstractList,_=h.compatibleText,m=this._messageModule.getModule(Pn),v=m&&m.isOnlineMessage(e,t)?1:0;return{protocolName:mo,tjgID:this._messageModule.generateTjgID(e),requestData:{fromAccount:this._messageModule.getMyUserID(),groupID:e.to,msgBody:[{msgType:e.type,msgContent:{pbDownloadKey:l,downloadKey:d,title:g,abstractList:f,compatibleText:_,messageNumber:p}}],random:e.random,priority:e.priority,clientSequence:e.clientSequence,groupAtInfo:void 0,cloudCustomData:u,onlineOnlyFlag:v,offlinePushInfo:o?{pushFlag:!0===o.disablePush?1:0,title:o.title||"",desc:o.description||"",ext:o.extension||"",apnsInfo:{badgeMode:!0===o.ignoreIOSBadge?1:0},androidInfo:{OPPOChannelID:o.androidOPPOChannelID||""}}:void 0,clientTime:e.clientTime,needReadReceipt:!0!==e.needReadReceipt||m.isMessageFromOrToAVChatroom(e.to)?0:1,messageControlInfo:0===v?r:void 0,isSupportExtension:!0===e.isSupportExtension?1:0}}}}]),e}(),_a={ERR_SVR_COMM_SENSITIVE_TEXT:80001,ERR_SVR_COMM_BODY_SIZE_LIMIT:80002,OPEN_SERVICE_OVERLOAD_ERROR:60022,ERR_SVR_MSG_PKG_PARSE_FAILED:20001,ERR_SVR_MSG_INTERNAL_AUTH_FAILED:20002,ERR_SVR_MSG_INVALID_ID:20003,ERR_SVR_MSG_PUSH_DENY:20006,ERR_SVR_MSG_IN_PEER_BLACKLIST:20007,ERR_SVR_MSG_BOTH_NOT_FRIEND:20009,ERR_SVR_MSG_NOT_PEER_FRIEND:20010,ERR_SVR_MSG_NOT_SELF_FRIEND:20011,ERR_SVR_MSG_SHUTUP_DENY:20012,ERR_SVR_GROUP_INVALID_PARAMETERS:10004,ERR_SVR_GROUP_PERMISSION_DENY:10007,ERR_SVR_GROUP_NOT_FOUND:10010,ERR_SVR_GROUP_INVALID_GROUPID:10015,ERR_SVR_GROUP_REJECT_FROM_THIRDPARTY:10016,ERR_SVR_GROUP_SHUTUP_DENY:10017,MESSAGE_SEND_FAIL:2100,OVER_FREQUENCY_LIMIT:2996},ma=[gi.MESSAGE_ONPROGRESS_FUNCTION_ERROR,gi.MESSAGE_IMAGE_SELECT_FILE_FIRST,gi.MESSAGE_IMAGE_TYPES_LIMIT,gi.MESSAGE_FILE_IS_EMPTY,gi.MESSAGE_IMAGE_SIZE_LIMIT,gi.MESSAGE_FILE_SELECT_FILE_FIRST,gi.MESSAGE_FILE_SIZE_LIMIT,gi.MESSAGE_VIDEO_SIZE_LIMIT,gi.MESSAGE_VIDEO_TYPES_LIMIT,gi.MESSAGE_AUDIO_UPLOAD_FAIL,gi.MESSAGE_AUDIO_SIZE_LIMIT,gi.COS_UNDETECTED];function va(e){var t=!1;return Object.values(_a).includes(e)&&(t=!0),(e>=120001&&e<=13e4||e>=10100&&e<=10200)&&(t=!0),t}var ya=function(e){c(o,e);var t=m(o);function o(e){var n;return r(this,o),(n=t.call(this,e))._n="MessageModule",n._messageOptionsMap=new Map,n._mergerMessageHandler=new fa(f(n)),n}return s(o,[{key:"createTextMessage",value:function(e){var t=this.getMyUserID();e.currentUser=t,e.senderTinyID=this.getMyTinyID();var n=new ji(e),o="string"==typeof e.payload?e.payload:e.payload.text,r=new Ri({text:o}),i=this._getNickAndAvatarByUserID(t);return n.setElement(r),n.setNickAndAvatar(i),n.setNameCard(this._getNameCardByGroupID(n)),n}},{key:"createImageMessage",value:function(e){var t=this.getMyUserID();e.currentUser=t,e.senderTinyID=this.getMyTinyID();var n=new ji(e);if(ie){var o=e.payload.file;if(et(o))return void this.outputWarning("FileUnsupportedInMP","createImageMessage");var r=o.tempFiles[0].path||o.tempFiles[0].tempFilePath,i={url:r,name:r.slice(r.lastIndexOf("/")+1),size:o.tempFiles&&o.tempFiles[0].size||1,type:r.slice(r.lastIndexOf(".")+1).toLowerCase()};e.payload.file=i}else if(se)if(et(e.payload.file)){var s=e.payload.file;e.payload.file={files:[s]}}else if(it(e.payload.file)&&"undefined"!=typeof uni){var a=e.payload.file.tempFiles[0];e.payload.file={files:[a]}}var c=new Oi({imageFormat:Ke.UNKNOWN,uuid:this._generateUUID(e.payload.file),file:e.payload.file}),u=this._getNickAndAvatarByUserID(t);return n.setElement(c),n.setNickAndAvatar(u),n.setNameCard(this._getNameCardByGroupID(n)),this._messageOptionsMap.set(n.clientSequence,e),n}},{key:"createAudioMessage",value:function(e){var t=e.payload.file;if(ie){var n={url:t.tempFilePath,name:t.tempFilePath.slice(t.tempFilePath.lastIndexOf("/")+1),size:t.fileSize,second:parseInt(t.duration)/1e3,type:t.tempFilePath.slice(t.tempFilePath.lastIndexOf(".")+1).toLowerCase()};e.payload.file=n}var o=this.getMyUserID();e.currentUser=o,e.senderTinyID=this.getMyTinyID();var r=new ji(e),i=new wi({second:Math.floor(t.duration/1e3),size:t.fileSize||t.size,url:t.tempFilePath,uuid:this._generateUUID(e.payload.file)}),s=this._getNickAndAvatarByUserID(o);return r.setElement(i),r.setNickAndAvatar(s),r.setNameCard(this._getNameCardByGroupID(r)),this._messageOptionsMap.set(r.clientSequence,e),r}},{key:"createVideoMessage",value:function(e){var t=this.getMyUserID();e.currentUser=t,e.senderTinyID=this.getMyTinyID(),e.payload.file.thumbUrl="",e.payload.file.thumbSize=0;var n={};if(ie){if(te)return void this.outputWarning("VideoUnsupportedInAlipay");if(et(e.payload.file))return void this.outputWarning("FileUnsupportedInMP","createVideoMessage");var o=e.payload.file;st(o.tempFiles)&&(o=o.tempFiles[0]),n.url=o.tempFilePath,n.name=o.tempFilePath.slice(o.tempFilePath.lastIndexOf("/")+1),n.size=o.size||1,n.second=o.duration||0,n.type=o.tempFilePath.slice(o.tempFilePath.lastIndexOf(".")+1).toLowerCase()}else if(se){if(et(e.payload.file)){var r=e.payload.file;e.payload.file.files=[r]}else if(it(e.payload.file)&&"undefined"!=typeof uni){var i=e.payload.file.tempFile;e.payload.file.files=[i]}var s=e.payload.file;n.url=window.URL.createObjectURL(s.files[0]),n.name=s.files[0].name,n.size=s.files[0].size||1,n.second=s.files[0].duration||0,n.type=s.files[0].type.split("/")[1]}e.payload.file.videoFile=n;var a=new ji(e),c=new qi({videoFormat:n.type,videoSecond:xt(n.second,0),videoSize:n.size,remoteVideoUrl:"",videoUrl:n.url,videoUUID:this._generateUUID(e.payload.file.videoFile),thumbUUID:this._generateUUID(e.payload.file.videoFile),thumbWidth:e.payload.file.width||200,thumbHeight:e.payload.file.height||200,thumbUrl:e.payload.file.thumbUrl,thumbSize:e.payload.file.thumbSize,thumbFormat:e.payload.file.thumbUrl.slice(e.payload.file.thumbUrl.lastIndexOf(".")+1).toLowerCase()}),u=this._getNickAndAvatarByUserID(t);return a.setElement(c),a.setNickAndAvatar(u),a.setNameCard(this._getNameCardByGroupID(a)),this._messageOptionsMap.set(a.clientSequence,e),a}},{key:"createCustomMessage",value:function(e){var t=this.getMyUserID();e.currentUser=t,e.senderTinyID=this.getMyTinyID();var n=new ji(e),o=new Fi({data:e.payload.data,description:e.payload.description,extension:e.payload.extension}),r=this._getNickAndAvatarByUserID(t);return n.setElement(o),n.setNickAndAvatar(r),n.setNameCard(this._getNameCardByGroupID(n)),n}},{key:"createFaceMessage",value:function(e){var t=this.getMyUserID();e.currentUser=t,e.senderTinyID=this.getMyTinyID();var n=new ji(e),o=new Ni(e.payload),r=this._getNickAndAvatarByUserID(t);return n.setElement(o),n.setNickAndAvatar(r),n.setNameCard(this._getNameCardByGroupID(n)),n}},{key:"createMergerMessage",value:function(e){var t=this.getMyUserID();e.currentUser=t,e.senderTinyID=this.getMyTinyID();var n=this._getNickAndAvatarByUserID(t),o=new ji(e),r=new Ki(e.payload);return o.setElement(r),o.setNickAndAvatar(n),o.setNameCard(this._getNameCardByGroupID(o)),o.setRelayFlag(!0),o}},{key:"createForwardMessage",value:function(e){var t=e.to,n=e.conversationType,o=e.priority,r=e.payload,i=e.needReadReceipt,s=e.receiverList,a=this.getMyUserID(),c=this._getNickAndAvatarByUserID(a);if(r.type===S.MSG_GRP_TIP)return Xi({code:gi.MESSAGE_FORWARD_TYPE_INVALID});var u={to:t,conversationType:n,conversationID:"".concat(n).concat(t),priority:o,isPlaceMessage:0,status:Qt.UNSEND,currentUser:a,senderTinyID:this.getMyTinyID(),cloudCustomData:e.cloudCustomData||r.cloudCustomData||"",needReadReceipt:i,receiverList:s,isSupportExtension:e.isSupportExtension||!1},l=new ji(u);return l.setElement(r.getElements()[0]),l.setNickAndAvatar(c),l.setNameCard(this._getNameCardByGroupID(r)),l.setRelayFlag(!0),l}},{key:"downloadMergerMessage",value:function(e){return this._mergerMessageHandler.downloadMergerMessage(e)}},{key:"createFileMessage",value:function(e){if(ie){if(!X&&!Z&&!oe)return;var t=ae.getSystemInfoSync().SDKVersion;if(X&&bt(t,"2.5.0")<0)return void this.outputWarning("WXChooseMessageFile");if(Z&&bt(t,"1.18.0")<0)return void this.outputWarning("QQChooseMessageFile")}if(se||oe){if(et(e.payload.file)){var o=e.payload.file;e.payload.file={files:[o]}}else if(it(e.payload.file)&&"undefined"!=typeof uni){var r=e.payload.file,i=r.tempFiles,s=r.files,a=null;st(i)?a=i[0]:st(s)&&(a=s[0]),e.payload.file={files:[a]}}}else if(X||Z){var c=e.payload.file.tempFiles,u=n(n({},c[0]),{},{url:c[0].path});e.payload.file={files:[u]}}var l=this.getMyUserID();e.currentUser=l,e.senderTinyID=this.getMyTinyID();var d=new ji(e),p=new xi({uuid:this._generateUUID(e.payload.file),file:e.payload.file}),h=this._getNickAndAvatarByUserID(l);return d.setElement(p),d.setNickAndAvatar(h),d.setNameCard(this._getNameCardByGroupID(d)),this._messageOptionsMap.set(d.clientSequence,e),d}},{key:"createLocationMessage",value:function(e){var t=this.getMyUserID();e.currentUser=t,e.senderTinyID=this.getMyTinyID();var n=new ji(e),o=new Bi(e.payload),r=this._getNickAndAvatarByUserID(t);return n.setElement(o),n.setNickAndAvatar(r),n.setNameCard(this._getNameCardByGroupID(n)),n}},{key:"_onCannotFindModule",value:function(){return Xi({code:gi.CANNOT_FIND_MODULE})}},{key:"sendMessageInstance",value:function(e,t){var n=this;if(!1===this.getModule(ro).filterMessage(e,t))return this._onSendMessageFailed(e,new Wi({code:gi.PROFANITY_FOUND}));var o,r=null;switch(e.conversationType){case S.CONV_C2C:if(!(r=this.getModule(Un)))return this._onCannotFindModule();break;case S.CONV_GROUP:if(!(r=this.getModule(Pn)))return this._onCannotFindModule();if(kt({groupID:e.to})){var i=r.getLocalGroupProfile(e.to);if(i&&i.isSupportTopic)return Xi({code:gi.MESSAGE_SEND_GROUP_WITH_TOPIC_FAIL})}break;default:return Xi({code:gi.MESSAGE_SEND_INVALID_CONVERSATION_TYPE})}var s=this.getModule(zn),a=this.getModule(Pn);return s.upload(e).then((function(){return n._getSendMessageSpecifiedKey(e)===Mi&&n.getModule(to).addSuccessCount(Ii),a.guardForAVChatRoom(e).then((function(){if(!e.isSendable())return Xi({code:gi.MESSAGE_FILE_URL_IS_EMPTY});n._addSendMessageTotalCount(e),o=Date.now();var i=function(e){var t="utf-8";se&&document&&(t=document.charset.toLowerCase());var n,o,r=0;if(o=e.length,"utf-8"===t||"utf8"===t)for(var i=0;i<o;i++)(n=e.codePointAt(i))<=127?r+=1:n<=2047?r+=2:n<=65535?r+=3:(r+=4,i++);else if("utf-16"===t||"utf16"===t)for(var s=0;s<o;s++)(n=e.codePointAt(s))<=65535?r+=2:(r+=4,s++);else r=e.replace(/[^\x00-\xff]/g,"aa").length;return r}(JSON.stringify(e));return e.type===S.MSG_MERGER&&i>11264?n._mergerMessageHandler.uploadMergerMessage(e,i).then((function(o){var r=n._mergerMessageHandler.createMergerMessagePack(e,t,o);return n.request(r)})):(n.getModule(qn).setMessageRandom(e),e.conversationType===S.CONV_C2C||e.conversationType===S.CONV_GROUP?r.sendMessage(e,t):void 0)})).then((function(i){var s=i.data,a=s.time,c=s.sequence,u=s.readReceiptCode;nt(u)&&0!==u&&(new Ai("sendMessageWithReceipt").setMessage("from:".concat(e.from," to:").concat(e.to," sequence:").concat(c," readReceiptCode:").concat(u)).end(),Ve.w("".concat(n._n,".sendMessageInstance readReceiptCode:").concat(u," message:").concat(n.getErrorMessage(u)))),n._addSendMessageSuccessCount(e,o),n._messageOptionsMap.delete(e.clientSequence);var l=n.getModule(qn);e.status=Qt.SUCCESS,e.time=a;var d=!1;if(e.conversationType===S.CONV_GROUP)e.sequence=c;else if(e.conversationType===S.CONV_C2C){var p=l.getLatestMessageSentByMe(e.conversationID);if(p){var h=p.nick,g=p.avatar;h===e.nick&&g===e.avatar||(d=!0)}}if(d&&l.modifyMessageSentByMe({conversationID:e.conversationID,latestNick:e.nick,latestAvatar:e.avatar}),r.isOnlineMessage(e,t))e._onlineOnlyFlag=!0;else{l.appendToMessageList(e);var f=e;it(t)&&it(t.messageControlInfo)&&(!0===t.messageControlInfo.excludedFromLastMessage&&(e._isExcludedFromLastMessage=!0,f=""),!0===t.messageControlInfo.excludedFromUnreadCount&&(e._isExcludedFromUnreadCount=!0));var _=e.conversationType;Dt(e.to)&&(_=S.CONV_TOPIC,n.getModule(Fn).onMessageSent({groupID:Bt(e.to),topicID:e.to,lastMessage:f})),l.onMessageSent({conversationOptionsList:[{conversationID:e.conversationID,unreadCount:0,type:_,subType:e.conversationSubType,lastMessage:f}]})}return e.getRelayFlag()||"TIMImageElem"!==e.type||Pt(e.payload.imageInfoArray),zi({message:e})}))})).catch((function(t){return n._onSendMessageFailed(e,t)}))}},{key:"_onSendMessageFailed",value:function(e,t){e.status=Qt.FAIL,this.getModule(qn).deleteMessageRandom(e),this._addSendMessageFailCountOnUser(e,t);var n=new Ai("sendMessage");return n.setMessage("tjg_id:".concat(this.generateTjgID(e)," type:").concat(e.type," from:").concat(e.from," to:").concat(e.to)),this.probeNetwork().then((function(e){var o=v(e,2),r=o[0],i=o[1];n.setError(t,r,i).end()})),Ve.e("".concat(this._n,"._onSendMessageFailed error:"),t),Xi(new Wi({code:t&&t.code?t.code:gi.MESSAGE_SEND_FAIL,message:t&&t.message?t.message:void 0,data:{message:e}}))}},{key:"_getSendMessageSpecifiedKey",value:function(e){if([S.MSG_IMAGE,S.MSG_AUDIO,S.MSG_VIDEO,S.MSG_FILE].includes(e.type))return Mi;if(e.conversationType===S.CONV_C2C)return mi;if(e.conversationType===S.CONV_GROUP){var t=this.getModule(Pn).getLocalGroupProfile(e.to);if(!t)return;var n=t.type;return Et(n)?yi:vi}}},{key:"_addSendMessageTotalCount",value:function(e){var t=this._getSendMessageSpecifiedKey(e);t&&this.getModule(to).addTotalCount(t)}},{key:"_addSendMessageSuccessCount",value:function(e,t){var n=Math.abs(Date.now()-t),o=this._getSendMessageSpecifiedKey(e);if(o){var r=this.getModule(to);r.addSuccessCount(o),r.addCost(o,n)}}},{key:"_addSendMessageFailCountOnUser",value:function(e,t){var n,o,r=t.code,i=void 0===r?-1:r,s=this.getModule(to),a=this._getSendMessageSpecifiedKey(e);a===Mi&&(n=i,o=!1,ma.includes(n)&&(o=!0),o)?s.addFailedCountOfUserSide(Ii):va(i)&&a&&s.addFailedCountOfUserSide(a)}},{key:"resendMessage",value:function(e){return e.isResend=!0,e.status=Qt.UNSEND,this.sendMessageInstance(e)}},{key:"revokeMessage",value:function(e){var t=this,n=null;if(e.conversationType===S.CONV_C2C?n=this.getModule(Un):e.conversationType===S.CONV_GROUP&&(n=this.getModule(Pn)),!n)return this._onCannotFindModule();var o=new Ai("revokeMessage");o.setMessage("tjg_id:".concat(this.generateTjgID(e)," type:").concat(e.type," from:").concat(e.from," to:").concat(e.to));var r="".concat(this._n,".").concat("revokeMessage");return n.revokeMessage(e).then((function(n){var i=n.data.recallRetList;if(!$t(i)&&0!==i[0].retCode){var s=new Wi({code:i[0].retCode,data:{message:e}});return o.setCode(s.code).setMoreMessage(s.message).end(),Xi(s)}return Ve.i("".concat(r," ok. ID:").concat(e.ID)),e.isRevoked=!0,o.end(),t.getModule(qn).onMessageRevoked([e]),zi({message:e})})).catch((function(n){t.probeNetwork().then((function(e){var t=v(e,2),r=t[0],i=t[1];o.setError(n,r,i).end()}));var i=new Wi({code:n&&n.code?n.code:gi.MESSAGE_REVOKE_FAIL,message:n&&n.message?n.message:void 0,data:{message:e}});return Ve.w("".concat(r," failed. error:"),n),Xi(i)}))}},{key:"deleteMessage",value:function(e){var t=this,n=null,o=e[0],r=o.conversationID,i="",s=[],a=[];if(o.conversationType===S.CONV_C2C)n=this.getModule(Un),i=r.replace(S.CONV_C2C,""),e.forEach((function(e){e&&e.status===Qt.SUCCESS&&e.conversationID===r&&(e._onlineOnlyFlag||s.push("".concat(e.sequence,"_").concat(e.random,"_").concat(e.time)),a.push(e))}));else if(o.conversationType===S.CONV_GROUP)n=this.getModule(Pn),i=r.replace(S.CONV_GROUP,""),e.forEach((function(e){e&&e.status===Qt.SUCCESS&&e.conversationID===r&&(e._onlineOnlyFlag||s.push("".concat(e.sequence)),a.push(e))}));else if(o.conversationType===S.CONV_SYSTEM)return Xi({code:gi.CANNOT_DELETE_GROUP_SYSTEM_NOTICE});if(!n)return this._onCannotFindModule();if(0===s.length)return this._onMessageDeleted(a);s.length>30&&(s=s.slice(0,30),a=a.slice(0,30));var c=new Ai("deleteMessage");c.setMessage("to:".concat(i," count:").concat(s.length));var u="".concat(this._n,".").concat("deleteMessage");return n.deleteMessage({to:i,keyList:s}).then((function(e){return c.end(),Ve.i("".concat(u," ok")),t._onMessageDeleted(a)})).catch((function(e){t.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];c.setError(e,o,r).end()})),Ve.w("".concat(u," failed. error:"),e);var n=new Wi({code:e&&e.code?e.code:gi.MESSAGE_DELETE_FAIL,message:e&&e.message?e.message:void 0});return Xi(n)}))}},{key:"_onMessageDeleted",value:function(e){return this.getModule(qn).onMessageDeleted(e),Ji({messageList:e})}},{key:"translateText",value:function(e){var t="".concat(this._n,".").concat("translateText"),o=e.sourceTextList,r=e.sourceLanguage,i=e.targetLanguage,s=new Ai("translateText");return s.setMessage("sourceLanguage:".concat(r," targetLanguage:").concat(i)),this.request({protocolName:hi,requestData:{sourceTextList:o,source:r||"auto",target:i,from:this.getMyTinyID(),SDKAppID:this.getSDKAppID()}}).then((function(e){var o=e.data,r=o.error,i=o.requestID,a=o.translatedTextList;if(0===r.code)return s.end(),Ve.i("".concat(t," ok. requestID:").concat(i)),zi({translatedTextList:a});throw n(n({},r),{},{requestID:i})})).catch((function(e){return s.setCode(e.code).setMoreMessage(e.requestID).end(),Ve.w("".concat(t," failed. error:"),e),Xi({code:gi.TRANSLATE_TEXT_FAIL})}))}},{key:"modifyRemoteMessage",value:function(e){var t=this,n=null,o=e.conversationType,r=e.to;if(this.getModule(Pn).isMessageFromOrToAVChatroom(r))return Xi({code:gi.MESSAGE_MODIFY_DISABLED_IN_AVCHATROOM,data:{message:e}});if(!1===this.getModule(ro).filterMessage(e))return Xi({code:gi.PROFANITY_FOUND,data:{message:e}});o===S.CONV_C2C?n=this.getModule(Un):o===S.CONV_GROUP&&(n=this.getModule(Pn));var i=new Ai("modifyMessage");i.setMessage("to:".concat(r));var s="".concat(this._n,".modifyRemoteMessage");return n.modifyRemoteMessage(e).then((function(n){i.end(),Ve.i("".concat(s," ok"));var o=t._onModifyRemoteMessageResp(e,n.data);return zi({message:o})})).catch((function(n){if(i.setCode(n.code).setMoreMessage(n.message).end(),Ve.w("".concat(s," failed. error:"),n),20027===n.code){var o=t._onModifyRemoteMessageResp(e,n.data);return Xi({code:gi.MESSAGE_MODIFY_CONFLICT,data:{message:o}})}return Xi({code:n.code,message:n.message,data:{message:e}})}))}},{key:"_onModifyRemoteMessageResp",value:function(e,t){Ve.d("".concat(this._n,"._onModifyRemoteMessageResp options:"),t);var n=e.conversationType,o=e.from,r=e.to,i=e.random,s=e.sequence,a=e.time,c=t.elements,u=t.messageVersion,l=t.cloudCustomData,d=void 0===l?"":l;return this.getModule(qn).onMessageModified({conversationType:n,from:o,to:r,time:a,random:i,sequence:s,elements:c,cloudCustomData:d,messageVersion:u})}},{key:"_generateUUID",value:function(e){var t=this.getModule(Bn),n="".concat(t.getSDKAppID(),"-").concat(t.getUserID(),"-").concat(function(){for(var e="",t=32;t>0;--t)e+=mt[Math.floor(Math.random()*vt)];return e}()),o=e.name||e.value||e.url||e.tempFilePath,r=o&&o.slice(o.lastIndexOf(".")+1);return r&&(n="".concat(n,".").concat(r)),n}},{key:"getMessageOption",value:function(e){return this._messageOptionsMap.get(e)}},{key:"_getNickAndAvatarByUserID",value:function(e){return this.getModule(bn).getNickAndAvatarByUserID(e)}},{key:"_getNameCardByGroupID",value:function(e){if(e.conversationType===S.CONV_GROUP){var t=this.getModule(Pn);if(t)return t.getMyNameCardByGroupID(e.to)}return""}},{key:"reset",value:function(){Ve.l("".concat(this._n,".reset")),this._messageOptionsMap.clear()}}]),o}(co),Ma=function(e){c(n,e);var t=m(n);function n(e){var o;return r(this,n),(o=t.call(this,e))._n="MessageExtensionModule",o.messageExtensionMap=new Map,o.globalSeqMap=new Map,o.getMessageExtensionsMap=new Map,o}return s(n,[{key:"onMessageExtensionNotify",value:function(e){var t=this,n=e.dataList,o=n.messageInfo,r=n.operateType,i=n.operateResultList,s=n.tinyID,a=n.globalSequence,c=o.clientTime,u=o.random,l="".concat(s,"-").concat(c,"-").concat(u),d=[],p=[];Ve.l("".concat(this._n,".onMessageExtensionNotify messageID:").concat(l," operateType:").concat(r," globalSequence:").concat(a)),this._updateGlobalSequence(l,a);var h=!1,g=!1;i.forEach((function(e){var n=e.extensions,o=void 0===n?[]:n,i=e.clearSequence;1===r?(h=!0,o.forEach((function(e){d.push({key:e.key,value:e.value})})),t._updateLocalExtension(l,o)):2===r?(g=!0,o.forEach((function(e){p.push(e.key)})),t._updateLocalExtension(l,o)):3===r&&(g=!0,t._hasLocalExtension(l)&&t._getLocalExtension(l).forEach((function(e,t){e.seq<=i&&!$t(e.value)&&p.push(t)})),t._clearLocalExtension(l,i))})),h&&this.emitOuterEvent(D.MESSAGE_EXTENSIONS_UPDATED,{messageID:l,extensions:d}),g&&this.emitOuterEvent(D.MESSAGE_EXTENSIONS_DELETED,{messageID:l,keyList:p})}},{key:"setMessageExtensions",value:function(e,t){var n=this;if(!this.canIUse(K.MSG_EXT))return Xi({code:gi.CANNOT_USE_COMMERCIAL_ABILITY});var o="".concat(this._n,".").concat("setMessageExtensions"),r=e.ID,i=e.conversationID,s=e.sequence,a=e.time,c=y(t);t.length>20&&(c=t.slice(0,20),Ve.w("".concat(o,". the length of extensions cannot exceed 20.")));var u="conversationID:".concat(i," messageID:").concat(r," sequence:").concat(s," time:").concat(a," count:").concat(c.length),l=new Ai("setMessageExtensions");return l.setMessage(u),Ve.l("".concat(o," ").concat(u)),this._modifyMessageExtensions(e,c).then((function(e){var t=e.resultList,n=e.successCount,r=e.failureCount,i="success count:".concat(n," fail count:").concat(r);return l.setMoreMessage(i).end(),Ve.l("".concat(o," ok. ").concat(i)),zi({extensions:t})})).catch((function(e){return n.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];l.setError(e,o,r).end()})),Ve.e("".concat(o," failed. error:"),e),Xi(e)}))}},{key:"getMessageExtensions",value:function(e){var t=this;if(!this.canIUse(K.MSG_EXT))return Xi({code:gi.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".").concat("getMessageExtensions"),o=e.ID,r=e.conversationID,i=e.sequence,s=e.time,a="conversationID:".concat(r," messageID:").concat(o," sequence:").concat(i," time:").concat(s),c=new Ai("getMessageExtensions");c.setMessage(a),Ve.l("".concat(n," ").concat(a));var u=void 0;return this.getMessageExtensionsMap.has(o)&&(u=this._getGlobalSequence(o)),this._getMessageExtensions(e,u).then((function(e){return c.end(),Ve.l("".concat(n," ok. total count:").concat(e.length)),at(u)&&e.length>0&&t.getMessageExtensionsMap.set(o,1),zi({extensions:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];c.setError(e,o,r).end()})),Ve.e("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"deleteMessageExtensions",value:function(e,t){var n=this;if(!this.canIUse(K.MSG_EXT))return Xi({code:gi.CANNOT_USE_COMMERCIAL_ABILITY});var o="".concat(this._n,".").concat("deleteMessageExtensions"),r=[],i=3;$t(t)||(i=2,t.forEach((function(e){r.push({key:e,value:"",seq:0})})));var s=e.ID,a=e.conversationID,c=e.sequence,u=e.time,l="conversationID:".concat(a," messageID:").concat(s," sequence:").concat(c," time:").concat(u," operateType:").concat(i),d=new Ai("deleteMessageExtensions");return d.setMessage(l),Ve.l("".concat(o," ").concat(l)),this._modifyMessageExtensions(e,r,i).then((function(e){var t=e.resultList,n=e.successCount,r=e.failureCount,s="";return 2===i&&(s="success count:".concat(n," fail count:").concat(r)),d.setMoreMessage("".concat(s)).end(),Ve.l("".concat(o," ok. ").concat(s)),zi({extensions:t})})).catch((function(e){return n.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];d.setError(e,o,r).end()})),Ve.e("".concat(o," failed. error:"),e),Xi(e)}))}},{key:"_modifyMessageExtensions",value:function(e,t){var n=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=Dt(e.to)?S.CONV_TOPIC:e.conversationType,i=void 0;3!==o&&(i=this._getRequestExtensions(e,t));var s=null;switch(r){case S.CONV_C2C:s=this.getModule(Un);break;case S.CONV_GROUP:s=this.getModule(Pn);break;case S.CONV_TOPIC:s=this.getModule(Fn);break;default:return Xi({code:gi.CANNOT_FIND_MODULE})}return s.modifyMessageExtensions(e,i,o).then((function(t){var o=t.data,r=o.extensions,i=o.seq,s=[],a=0,c=0,u=[];return(r=$t(r)?[]:r).forEach((function(e){var t=e.errorCode,n=e.extension,o=n.key,r=n.value,i=n.seq;s.push({code:t,key:o,value:r}),0===t?a++:c++,u.push({key:o,value:r,seq:i})})),n._updateGlobalSequence(e.ID,i),u.length>0&&(n._updateLocalExtension(e.ID,u),u=null),{resultList:s,successCount:a,failureCount:c}})).catch((function(e){return Xi(e)}))}},{key:"_getRequestExtensions",value:function(e,t){var n=[];if(this._hasLocalExtension(e.ID)){var o=this._getLocalExtension(e.ID);return t.forEach((function(e){var t=e.key,r=e.value,i=0;o.has(t)&&(i=o.get(t).seq),n.push({key:t,value:r,seq:i})})),n}return t.forEach((function(e){var t=e.key,o=e.value;n.push({key:t,value:o,seq:0})})),n}},{key:"_getMessageExtensions",value:function(e,t){var n=this,o="".concat(this._n,"._getMessageExtensions"),r=e.ID,i=e.to,s=null;switch(Dt(i)?S.CONV_TOPIC:e.conversationType){case S.CONV_C2C:s=this.getModule(Un);break;case S.CONV_GROUP:s=this.getModule(Pn);break;case S.CONV_TOPIC:s=this.getModule(Fn);break;default:return Xi({code:gi.CANNOT_FIND_MODULE})}return s.getMessageExtensions(e,t).then((function(t){var i=t.data,s=i.extensions,a=i.completeFlag,c=i.globalSequence,u=i.clearSequence;if(s=$t(s)?[]:s,Ve.l("".concat(o," ok. completeFlag:").concat(a," globalSequence:").concat(c," clearSequence:").concat(u," count:").concat(s.length)),n._updateLocalExtension(r,s),n._clearLocalExtension(r,u),n._updateGlobalSequence(r,c),1!==a){var l=s.slice(-1)[0].seq+1;return n._getMessageExtensions(e,l)}return n._getLocalExtensions(r)})).catch((function(e){return Xi(e)}))}},{key:"_hasLocalExtension",value:function(e){return this.messageExtensionMap.has(e)}},{key:"_getLocalExtension",value:function(e){return this.messageExtensionMap.get(e)}},{key:"_updateLocalExtension",value:function(e,t){this._hasLocalExtension(e)||this.messageExtensionMap.set(e,new Map);var n=this._getLocalExtension(e);t.forEach((function(e){var t=e.key,o=e.value,r=void 0===o?"":o,i=e.seq;n.set(t,{value:r,seq:i})}))}},{key:"_clearLocalExtension",value:function(e,t){if(!(t<=0)&&this._hasLocalExtension(e)){var n=this._getLocalExtension(e);n.forEach((function(e,o){e.seq<=t&&n.delete(o)}))}}},{key:"_getLocalExtensions",value:function(e){var t=[];return this._hasLocalExtension(e)&&this._getLocalExtension(e).forEach((function(e,n){var o=e.value;$t(o)||t.push({key:n,value:o})})),t}},{key:"_getGlobalSequence",value:function(e){return this.globalSeqMap.get(e)}},{key:"_updateGlobalSequence",value:function(e,t){this.globalSeqMap.set(e,t)}},{key:"reset",value:function(){Ve.l("".concat(this._n,".reset")),this.messageExtensionMap.clear(),this.globalSeqMap.clear(),this.getMessageExtensionsMap.clear()}}]),n}(co),Ia=function(e){c(n,e);var t=m(n);function n(e){var o;return r(this,n),(o=t.call(this,e))._n="ComboMessageModule",o}return s(n,[{key:"sendMessage",value:function(e){var t=this,n=this._constructMessageInstance(e);if(null===n)return Xi({code:gi.MESSAGE_SEND_FAIL});this._addSendMessageTotalCount(n);var o=Date.now();return this.getModule(qn).setMessageRandom(n),this._sendComboMessage(n,e).then((function(e){var r=e.data,i=r.time,s=r.sequence,a=r.readReceiptCode;nt(a)&&0!==a&&(new Ai("sendMessageWithReceipt").setMessage("from:".concat(n.from," to:").concat(n.to," sequence:").concat(s," readReceiptCode:").concat(a)).end(),Ve.w("".concat(t._n,".sendMessage readReceiptCode:").concat(a," message:").concat(t.getErrorMessage(a)))),t._addSendMessageSuccessCount(n,o);var c=t.getModule(qn);n.status=Qt.SUCCESS,n.time=i,n.conversationType===S.CONV_GROUP&&(n.sequence=s),c.appendToMessageList(n);var u=n;return!0===n._isExcludedFromLastMessage&&(u=""),c.onMessageSent({conversationOptionsList:[{conversationID:n.conversationID,unreadCount:0,type:n.conversationType,subType:n.conversationSubType,lastMessage:u}]}),zi({message:n})})).catch((function(e){return t._onSendMessageFailed(n,e)}))}},{key:"_sendComboMessage",value:function(e,t){var n=this._m.getModule($n),o="";return e.conversationType===S.CONV_C2C&&(o="".concat(V.NAME.OPEN_IM,".").concat(V.CMD.SEND_MESSAGE)),e.conversationType===S.CONV_GROUP&&(o="".concat(V.NAME.GROUP,".").concat(V.CMD.SEND_GROUP_MESSAGE)),n.sendComboMessage({servcmd:o,data:t})}},{key:"_constructMessageInstance",value:function(e){var t="".concat(this._n,"._constructMessageInstance"),n=null;try{var o=this.getMyUserID(),r={};if(r.senderTinyID=this.getMyTinyID(),r.currentUser=o,r.from=e.From_Account||o,e.GroupId?(r.conversationID="".concat(S.CONV_GROUP).concat(e.GroupId),r.conversationType=S.CONV_GROUP,r.to=e.GroupId):e.To_Account&&(r.conversationID="".concat(S.CONV_C2C).concat(e.To_Account),r.conversationType=S.CONV_C2C,r.to=e.To_Account),r.time=e.MsgTimeStamp||0,r.random=e.Random||e.MsgRandom||0,r.priority=e.MsgPriority,ot(e.CloudCustomData)&&e.CloudCustomData.length>0&&(r.cloudCustomData=e.CloudCustomData),st(e.SendMsgControl)&&(r.messageControlInfo={},e.SendMsgControl.includes("NoUnread")&&(r.messageControlInfo.excludedFromUnreadCount=1),e.SendMsgControl.includes("NoLastMsg")&&(r.messageControlInfo.excludedFromLastMessage=1)),r.conversationType===S.CONV_GROUP&&st(e.To_Account)&&e.To_Account.length>0){var i=e.To_Account;e.To_Account.length>50&&(i=e.To_Account.slice(0,50),Ve.w("".concat(t," To_Account must be less than or equal to 50."))),r.receiverList=y(i),e.To_Account=y(i)}1!==e.IsNeedReadReceipt&&1!==e.NeedReadReceipt||(r.needReadReceipt=!0),1===e.SupportMessageExtension&&(r.isSupportExtension=!0),(n=new ji(r)).status=Qt.UNSEND,e.MsgClientTime=n.clientTime,n.conversationType===S.CONV_C2C&&(e.MsgSeq=n.sequence);for(var s,a=e.MsgBody.length,c=0;c<a;c++)"TIMTextElem"===(s=e.MsgBody[c]).MsgType?n.setTextElement(s.MsgContent.Text):"TIMCustomElem"===s.MsgType?n.setCustomElement({data:s.MsgContent.Data||"",description:s.MsgContent.Desc||"",extension:s.MsgContent.Ext||""}):"TIMFaceElem"===s.MsgType&&n.setFaceElement({index:s.MsgContent.Index,data:s.MsgContent.Data});var u=n.getElements();n.payload=u[0].content,n.type=u[0].type}catch(l){n=null,Ve.e("".concat(t," failed. error:"),l)}return n}},{key:"_onSendMessageFailed",value:function(e,t){e.status=Qt.FAIL,this.getModule(qn).deleteMessageRandom(e),this._addSendMessageFailCountOnUser(e,t);var n=new Ai("sendMessage");return n.setMessage("tjg_id:".concat(this.generateTjgID(e)," type:").concat(e.type," from:").concat(e.from," to:").concat(e.to)),this.probeNetwork().then((function(e){var o=v(e,2),r=o[0],i=o[1];n.setError(t,r,i).end()})),Ve.e("".concat(this._n,"._onSendMessageFailed error:"),t),Xi(new Wi({code:t&&t.code?t.code:gi.MESSAGE_SEND_FAIL,message:t&&t.message?t.message:void 0,data:{message:e}}))}},{key:"_getSendMessageSpecifiedKey",value:function(e){if(e.conversationType===S.CONV_C2C)return mi;if(e.conversationType===S.CONV_GROUP){var t=this.getModule(Pn).getLocalGroupProfile(e.to);if(!t)return;var n=t.type;return Et(n)?yi:vi}}},{key:"_addSendMessageTotalCount",value:function(e){var t=this._getSendMessageSpecifiedKey(e);t&&this.getModule(to).addTotalCount(t)}},{key:"_addSendMessageSuccessCount",value:function(e,t){var n=Math.abs(Date.now()-t),o=this._getSendMessageSpecifiedKey(e);if(o){var r=this.getModule(to);r.addSuccessCount(o),r.addCost(o,n)}}},{key:"_addSendMessageFailCountOnUser",value:function(e,t){var n=t.code,o=void 0===n?-1:n,r=this.getModule(to),i=this._getSendMessageSpecifiedKey(e);va(o)&&i&&r.addFailedCountOfUserSide(i)}}]),n}(co),Ca=function(e){c(n,e);var t=m(n);function n(e){var o;return r(this,n),(o=t.call(this,e))._n="PluginModule",o.plugins={},o}return s(n,[{key:"registerPlugin",value:function(e){var t=this;Object.keys(e).forEach((function(n){t.plugins[n]=e[n]})),new Ai("registerPlugin").setMessage("".concat(Object.keys(e))).end()}},{key:"getPlugin",value:function(e){return this.plugins[e]}},{key:"reset",value:function(){}}]),n}(co),Ta=function(e){c(o,e);var t=m(o);function o(e){var n;return r(this,o),(n=t.call(this,e))._n="SyncUnreadMessageModule",n._cookie="",n._onlineSyncFlag=!1,n.getInnerEmitterInstance().on(es,n._onLoginSuccess,f(n)),n}return s(o,[{key:"_onLoginSuccess",value:function(e){this._startSync({cookie:this._cookie,syncFlag:0,isOnlineSync:0})}},{key:"_startSync",value:function(e){var t=this,o=e.cookie,r=e.syncFlag,i=e.isOnlineSync,s="".concat(this._n,"._startSync");Ve.l("".concat(s," cookie:").concat(o," syncFlag:").concat(r," isOnlineSync:").concat(i)),this.request({protocolName:go,requestData:{cookie:o,syncFlag:r,isOnlineSync:i}}).then((function(e){var o=e.data,r=o.cookie,i=o.syncFlag;t._cookie=r,$t(r)||(0===i||1===i?(t._dispatchUnreadMessage(n(n({},e.data),{},{isSyncingEnded:!1})),t._startSync({cookie:r,syncFlag:i,isOnlineSync:0})):2===i&&t._dispatchUnreadMessage(n(n({},e.data),{},{isSyncingEnded:!0})))})).catch((function(e){Ve.e("".concat(s," failed. error:"),e)}))}},{key:"_dispatchUnreadMessage",value:function(e){e.eventArray&&this.getModule($n).onMessage({head:{},body:{eventArray:e.eventArray,isInstantMessage:this._onlineSyncFlag,isSyncingEnded:e.isSyncingEnded}}),this.getModule(Un).onNewC2CMessage({dataList:e.messageList,isInstantMessage:!!e.isSyncingEnded&&this._onlineSyncFlag,C2CRemainingUnreadList:e.C2CRemainingUnreadList,C2CPairUnreadList:e.C2CPairUnreadList})}},{key:"startOnlineSync",value:function(){Ve.l("".concat(this._n,".startOnlineSync")),this._onlineSyncFlag=!0,this._startSync({cookie:this._cookie,syncFlag:0,isOnlineSync:1})}},{key:"startSyncOnReconnected",value:function(){Ve.l("".concat(this._n,".startSyncOnReconnected.")),this._onlineSyncFlag=!0,this._startSync({cookie:this._cookie,syncFlag:0,isOnlineSync:0})}},{key:"reset",value:function(){Ve.l("".concat(this._n,".reset")),this._onlineSyncFlag=!1,this._cookie=""}}]),o}(co),Ea={request:{toAccount:"To_Account",fromAccount:"From_Account",to:"To_Account",from:"From_Account",groupID:"GroupId",groupAtUserID:"GroupAt_Account",extension:"Ext",data:"Data",description:"Desc",elements:"MsgBody",sizeType:"Type",downloadFlag:"Download_Flag",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",videoUrl:"",imageUrl:"URL",fileUrl:"Url",uuid:"UUID",priority:"MsgPriority",receiverUserID:"To_Account",receiverGroupID:"GroupId",messageSender:"SenderId",messageReceiver:"ReceiverId",nick:"From_AccountNick",avatar:"From_AccountHeadurl",messageNumber:"MsgNum",pbDownloadKey:"PbMsgKey",downloadKey:"JsonMsgKey",applicationType:"PendencyType",userIDList:"To_Account",groupNameList:"GroupName",userID:"To_Account",groupAttributeList:"GroupAttr",mainSequence:"AttrMainSeq",avChatRoomKey:"BytesKey",attributeControl:"AttrControl",sequence:"seq",messageControlInfo:"SendMsgControl",updateSequence:"UpdateSeq",clientTime:"MsgClientTime",sequenceList:"MsgSeqList",topicID:"TopicId",customData:"CustomString",isSupportTopic:"SupportTopic",isWebUniapp:"is_web_uniapp",isSupportExtension:"SupportMessageExtension",messageSequence:"MsgSeq",messageKey:"MsgKey",startSequence:"startSeq",simplifiedMessage:"DownsizeFlag"},response:{MsgPriority:"priority",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID",Download_Flag:"downloadFlag",GroupId:"groupID",Member_Account:"userID",MsgList:"messageList",SyncFlag:"syncFlag",To_Account:"to",From_Account:"from",MsgSeq:"sequence",MsgRandom:"random",MsgTime:"time",MsgTimeStamp:"time",MsgContent:"content",MsgBody:"elements",From_AccountNick:"nick",From_AccountHeadurl:"avatar",GroupWithdrawInfoArray:"revokedInfos",GroupReadInfoArray:"groupMessageReadNotice",LastReadMsgSeq:"lastMessageSeq",WithdrawC2cMsgNotify:"c2cMessageRevokedNotify",C2cWithdrawInfoArray:"revokedInfos",C2cReadedReceipt:"c2cMessageReadReceipt",ReadC2cMsgNotify:"c2cMessageReadNotice",LastReadTime:"peerReadTime",MsgRand:"random",MsgType:"type",MsgShow:"messageShow",NextMsgSeq:"nextMessageSeq",FaceUrl:"avatar",ProfileDataMod:"profileModify",Profile_Account:"userID",ValueBytes:"value",ValueNum:"value",NoticeSeq:"noticeSequence",NotifySeq:"notifySequence",MsgFrom_AccountExtraInfo:"messageFromAccountExtraInformation",Operator_Account:"operatorID",OpType:"operationType",ReportType:"operationType",UserId:"userID",User_Account:"userID",List_Account:"userIDList",MsgOperatorMemberExtraInfo:"operatorInfo",MsgMemberExtraInfo:"memberInfoList",ImageUrl:"avatar",NickName:"nick",MsgGroupNewInfo:"newGroupProfile",MsgAppDefinedData:"groupCustomField",Owner_Account:"ownerID",GroupFaceUrl:"avatar",GroupIntroduction:"introduction",GroupNotification:"notification",GroupApplyJoinOption:"joinOption",MsgKey:"messageKey",GroupInfo:"groupProfile",ShutupTime:"muteTime",Desc:"description",Ext:"extension",GroupAt_Account:"groupAtUserID",MsgNum:"messageNumber",PbMsgKey:"pbDownloadKey",JsonMsgKey:"downloadKey",MsgModifiedFlag:"isModified",PendencyItem:"applicationItem",PendencyType:"applicationType",AddTime:"time",AddSource:"source",AddWording:"wording",ProfileImImage:"avatar",PendencyAdd:"friendApplicationAdded",FrienPencydDel_Account:"friendApplicationDeletedUserIDList",Peer_Account:"userID",GroupAttr:"groupAttributeList",GroupAttrAry:"groupAttributeList",AttrMainSeq:"mainSequence",seq:"sequence",GroupAttrOption:"groupAttributeOption",BytesChangedKeys:"changedKeyList",GroupAttrInfo:"groupAttributeList",GroupAttrSeq:"mainSequence",PushChangedAttrValFlag:"isWithChangedAttributeInfo",SubKeySeq:"sequence",Val:"value",MsgGroupFromCardName:"senderNameCard",MsgGroupFromNickName:"senderNick",C2cNick:"peerNick",C2cImage:"peerAvatar",SendMsgControl:"messageControlInfo",NoLastMsg:"excludedFromLastMessage",NoUnread:"excludedFromUnreadCount",UpdateSeq:"updateSequence",MuteNotifications:"muteFlag",MsgClientTime:"clientTime",TinyId:"tinyID",GroupMsgReceiptList:"readReceiptList",ReadNum:"readCount",UnreadNum:"unreadCount",TopicId:"topicID",MillionGroupFlag:"communityType",SupportTopic:"isSupportTopic",MsgTopicNewInfo:"newTopicInfo",ShutupAll:"muteAllMembers",CustomString:"customData",TopicFaceUrl:"avatar",TopicIntroduction:"introduction",TopicNotification:"notification",TopicIdArray:"topicIDList",MsgVersion:"messageVersion",C2cMsgModNotifys:"c2cMessageModified",GroupMsgModNotifys:"groupMessageModified",ApplyJoinOption:"joinOption",MsgFlag:"messageRemindType",AtInfoList:"groupAtInfoList",AtFlagList:"groupAtType",AtMsgSeq:"sequence",BanDuration:"duration",BanDescription:"reason",NotVisible:"invisible",BytesTag:"tag",BytesValue:"value",RptBytesValue:"value",LatestSeq:"globalSequence",ClearSeq:"clearSequence",SupportMessageExtension:"isSupportExtension",ExtensionList:"extensions",GroupCounter:"counterList",Revoker_Account:"revoker",MsgExtensionNotify:"messageExtensionNotify",ExtensionC2cMsgInfo:"messageInfo",ExtensionGroupMsgInfo:"messageInfo",MsgOptType:"operateType",SetKVInfo:"operateResultList",DeleteKVInfo:"operateResultList",ClearKVInfo:"operateResultList",MsgKeyValue:"extensions",ClearMsgSeq:"clearSequence",MsgLastSeq:"globalSequence",InviteJoinOption:"inviteOption",MemberList_Account:"inviteeList",MsgMemberExtraInfoList:"inviteeInfoList",E:"event",GInf:"groupProfile",MCT:"clientTime",MR:"random",MP:"priority",MTS:"time",GId:"groupID",MS:"sequence",CCD:"cloudCustomData",F_Account:"from",F_Hd:"avatar",F_NN:"nick",GN:"groupName",GT:"groupType",IsSys:"isSystemMessage",OpInf:"operatorInfo",Img:"avatar",NN:"nick",OnlineInf:"onlineMemberInfo",ET:"expireTime",Num:"onlineMemberNum",Opt:"operationType",O_Account:"operatorID",RT:"operationType",UDF:"userDefinedField",L_Account:"userIDList"},ignoreKeyWord:["C2C","ID","USP"]};function ka(e,t){if("string"!=typeof e&&!Array.isArray(e))throw new TypeError("Expected the input to be `string | string[]`");var n;return t=Object.assign({pascalCase:!1},t),0===(e=Array.isArray(e)?e.map((function(e){return e.trim()})).filter((function(e){return e.length})).join("-"):e.trim()).length?"":1===e.length?t.pascalCase?e.toUpperCase():e.toLowerCase():(e!==e.toLowerCase()&&(e=Da(e)),n=e=e.replace(/^[_.\- ]+/,"").toLowerCase().replace(/[_.\- ]+(\w|$)/g,(function(e,t){return t.toUpperCase()})).replace(/\d+(\w|$)/g,(function(e){return e.toUpperCase()})),t.pascalCase?n.charAt(0).toUpperCase()+n.slice(1):n)}var Da=function(e){for(var t=!1,n=!1,o=!1,r=0;r<e.length;r++){var i=e[r];t&&/[a-zA-Z]/.test(i)&&i.toUpperCase()===i?(e=e.slice(0,r)+"-"+e.slice(r),t=!1,o=n,n=!0,r++):n&&o&&/[a-zA-Z]/.test(i)&&i.toLowerCase()===i?(e=e.slice(0,r-1)+"-"+e.slice(r-1),o=n,n=!1,t=!0):(t=i.toLowerCase()===i&&i.toUpperCase()!==i,o=n,n=i.toUpperCase()===i&&i.toLowerCase()!==i)}return e};function Sa(e,t){var n=0;return function e(t,o){if(++n>100)return n--,t;if(st(t)){var r=t.map((function(t){return rt(t)?e(t,o):t}));return n--,r}if(rt(t)){var i=(s=t,a=function(e,t){if(!pt(t))return!1;if((r=t)!==ka(r))for(var n=0;n<Ea.ignoreKeyWord.length&&!t.includes(Ea.ignoreKeyWord[n]);n++);var r,i;return at(o[t])?"OPPOChannelID"===(i=t)?i:i[0].toUpperCase()+ka(i).slice(1):o[t]},c=Object.create(null),Object.keys(s).forEach((function(e){var t=a(s[e],e);t&&(c[t]=s[e])})),c);return i=Rt(i,(function(t,n){return st(t)||rt(t)?e(t,o):t})),n--,i}var s,a,c}(e,t)}function La(e,t){if(st(e))return e.map((function(e){return rt(e)?La(e,t):e}));if(rt(e)){var n=(o=e,r=function(e,n){return at(t[n])?ka(n):t[n]},i={},Object.keys(o).forEach((function(e){i[r(o[e],e)]=o[e]})),i);return Rt(n,(function(e){return st(e)||rt(e)?La(e,t):e}))}var o,r,i}var Aa=String.fromCharCode,Ra=function(e){var t=0|e.charCodeAt(0);if(55296<=t)if(t<56320){var n=0|e.charCodeAt(1);if(56320<=n&&n<=57343){if((t=(t<<10)+n-56613888|0)>65535)return Aa(240|t>>>18,128|t>>>12&63,128|t>>>6&63,128|63&t)}else t=65533}else t<=57343&&(t=65533);return t<=2047?Aa(192|t>>>6,128|63&t):Aa(224|t>>>12,128|t>>>6&63,128|63&t)},Oa=function(e){for(var t=void 0===e?"":(""+e).replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,Ra),n=0|t.length,o=new Uint8Array(n),r=0;r<n;r=r+1|0)o[r]=0|t.charCodeAt(r);return o},Na=function(e){for(var t=new Uint8Array(e),n="",o=0,r=t.length;o<r;){var i=t[o],s=0,a=0;if(i<=127?(s=0,a=255&i):i<=223?(s=1,a=31&i):i<=239?(s=2,a=15&i):i<=244&&(s=3,a=7&i),r-o-s>0)for(var c=0;c<s;)a=a<<6|63&(i=t[o+c+1]),c+=1;else a=65533,s=r-o;n+=String.fromCodePoint(a),o+=s+1}return n},wa=function(){function e(t){r(this,e),this._handler=t;var n=t.getURL();if(this._socket=null,this._workerSocket=null,this._id=_t(),this._handler.getIsWorkerEnabled()){var o=URL.createObjectURL(new Blob([';let _socket = null;onmessage = function(event) {  if (event.data.cmd === "start") {    const url = event.data.url;    _socket = new WebSocket(url);    _socket.binaryType = "arraybuffer";    _socket.onopen = function() {      postMessage({ callback: "onOpen" });    };    _socket.onclose = function(e) {      postMessage({ callback: "onOpen", e: { code: e.code, reason: e.reason } });    };    _socket.onmessage = function(e) {      postMessage({ callback: "onMessage", data: e.data });    };    _socket.onerror = function(e) {      postMessage({ callback: "onError", e: { isTrusted: "true" } });    };  } else if (event.data.cmd === "sendMessage") {    if (_socket !== null) {      _socket.send(event.data.data);    }  } else if (event.data.cmd === "stop") {    if (_socket !== null) {      _socket.close(event.data.code);      _socket = null;    }  }};'],{type:"application/javascript; charset=utf-8"}));this._workerSocket=new Worker(o);var i=this;this._workerSocket.onmessage=function(e){var t=e.data,n=t.callback,o=t.e;"onOpen"===n?i._onOpen():"onClose"===n?i._onClose(o):"onError"===n?i._onError(o):"onMessage"===n&&i._onMessage(e.data)},this._workerSocket.postMessage({cmd:"start",id:this._id,url:n})}else ie?te?(ae.connectSocket({url:n,header:{"content-type":"application/json"}}),ae.onSocketClose(this._onClose.bind(this)),ae.onSocketOpen(this._onOpen.bind(this)),ae.onSocketMessage(this._onMessage.bind(this)),ae.onSocketError(this._onError.bind(this))):(this._socket=ae.connectSocket({url:n,header:{"content-type":"application/json"},complete:function(){}}),this._socket.onClose(this._onClose.bind(this)),this._socket.onOpen(this._onOpen.bind(this)),this._socket.onMessage(this._onMessage.bind(this)),this._socket.onError(this._onError.bind(this))):se&&(this._socket=new WebSocket(n),this._socket.binaryType="arraybuffer",this._socket.onopen=this._onOpen.bind(this),this._socket.onmessage=this._onMessage.bind(this),this._socket.onclose=this._onClose.bind(this),this._socket.onerror=this._onError.bind(this));this._canIUseBinaryFrame=t.canIUseBinaryFrame()}return s(e,[{key:"getID",value:function(){return this._id}},{key:"_onOpen",value:function(){this._handler.onOpen({id:this._id})}},{key:"_onClose",value:function(e){this._handler.onClose({id:this._id,e:e})}},{key:"_onMessage",value:function(e){this._handler.onMessage({data:this._canIUseBinaryFrame?Na(e.data):e.data})}},{key:"_onError",value:function(e){this._handler.onError({id:this._id,e:e})}},{key:"setIsWorkerEnabled",value:function(e){this._isWorkerEnabled=!0}},{key:"close",value:function(e){if(this._workerSocket&&(this._workerSocket.postMessage({cmd:"stop",code:e}),this._workerSocket.terminate(),this._workerSocket=null),te)return ae.offSocketClose(),ae.offSocketMessage(),ae.offSocketOpen(),ae.offSocketError(),void ae.closeSocket();this._socket&&(ie?(this._socket.onClose((function(){})),this._socket.onOpen((function(){})),this._socket.onMessage((function(){})),this._socket.onError((function(){}))):se&&(this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null),ee?this._socket.close({code:e}):this._socket.close(e),this._socket=null)}},{key:"send",value:function(e){if(this._workerSocket)this._workerSocket.postMessage({cmd:"sendMessage",data:this._canIUseBinaryFrame?Oa(e.data).buffer:e.data});else{if(te)return void ae.sendSocketMessage({data:e.data,fail:function(){e.fail&&e.requestID&&e.fail(e.requestID)}});this._socket&&(ie?this._socket.send({data:this._canIUseBinaryFrame?Oa(e.data).buffer:e.data,fail:function(){e.fail&&e.requestID&&e.fail(e.requestID)}}):se&&this._socket.send(this._canIUseBinaryFrame?Oa(e.data).buffer:e.data))}}}]),e}(),ba=4e3,Ua=4001,Pa=["keyMap"],Ga=["keyMap"],xa="connected",Fa="connecting",qa="disconnected",Ba=function(){function e(t){r(this,e),this._channelModule=t,this._n="SocketHandler",this._promiseMap=new Map,this._readyState=qa,this._simpleRequestMap=new Map,this.MAX_SIZE=100,this._startSequence=_t(),this._startTs=0,this._reConnectFlag=!1,this._nextPingTs=0,this._reConnectCount=0,this.MAX_RECONNECT_COUNT=3,this._socketID=-1,this._random=0,this._socket=null,this._url="",this._onOpenTs=0,this._canIUseBinaryFrame=!0,this._isWorkerEnabled=!0,this._setWebsocketHost(),this._initConnection()}return s(e,[{key:"_setWebsocketHost",value:function(){var e=this._channelModule.getModule(Bn),t=b;this._channelModule.isOversea()&&(t=U),e.isSingaporeSite()?t=P:e.isKoreaSite()?t=G:e.isGermanySite()?t=x:e.isIndiaSite()?t=F:e.isJapanSite()?t=q:e.isUSASite()&&(t=B),V.HOST.setCurrent(t)}},{key:"_initConnection",value:function(){at(V.HOST.CURRENT.BACKUP)||""===this._url?this._url=V.HOST.CURRENT.DEFAULT:this._url===V.HOST.CURRENT.DEFAULT?this._url=V.HOST.CURRENT.BACKUP:this._url===V.HOST.CURRENT.BACKUP?this._url=this._canIUseAnyCast()?V.HOST.CURRENT.ANYCAST:V.HOST.CURRENT.DEFAULT:this._url===V.HOST.CURRENT.ANYCAST&&(V.HOST.CURRENT.ANYCAST="",this._url=V.HOST.CURRENT.DEFAULT);var e=this._channelModule.getModule(Bn).getProxyServer();$t(e)||(this._url=e),this._connect(),this._nextPingTs=0}},{key:"_canIUseAnyCast",value:function(){return se&&V.HOST.CURRENT.ANYCAST}},{key:"onCheckTimer",value:function(e){e%1==0&&this._checkPromiseMap()}},{key:"_checkPromiseMap",value:function(){var e=this;0!==this._promiseMap.size&&this._promiseMap.forEach((function(t,n){var o=t.reject,r=t.timestamp,i=15e3;-1!==n.indexOf(uo)&&(i=9e4),Date.now()-r>=i&&(Ve.l("".concat(e._n,"._checkPromiseMap request timeout, delete requestID:").concat(n)),e._promiseMap.delete(n),o(new Wi({code:gi.NETWORK_TIMEOUT})),e._channelModule.onRequestTimeout(n))}))}},{key:"onOpen",value:function(e){if(""!==this._readyState){this._onOpenTs=Date.now();var t=e.id;this._socketID=t;var n=Date.now()-this._startTs;Ve.l("".concat(this._n,"._onOpen cost ").concat(n," ms. socketID:").concat(t)),new Ai("wsOnOpen").setMessage(n).setCostTime(n).setMoreMessage("socketID:".concat(t)).end(),e.id===this._socketID&&(this._readyState=xa,this._reConnectCount=0,this._resend(),!0===this._reConnectFlag&&(this._channelModule.onReconnected(),this._reConnectFlag=!1),this._channelModule.onOpen())}}},{key:"onClose",value:function(e){var t=new Ai("wsOnClose"),n=e.id,o=e.e,r="sourceSocketID:".concat(n," currentSocketID:").concat(this._socketID," code:").concat(o.code," reason:").concat(o.reason),i=0;0!==this._onOpenTs&&(i=Date.now()-this._onOpenTs),t.setMessage(i).setCostTime(i).setMoreMessage(r).setCode(o.code).end(),Ve.l("".concat(this._n,"._onClose ").concat(r," onlineTime:").concat(i)),n===this._socketID&&(this._readyState=qa,i<1e3?this._channelModule.onReconnectFailed():this._channelModule.onClose())}},{key:"onError",value:function(e){var t=e.id,n=e.e,o="sourceSocketID:".concat(t," currentSocketID:").concat(this._socketID);new Ai("wsOnError").setMessage(n.errMsg||gt(n)).setMoreMessage(o).setLevel("error").end(),Ve.w("".concat(this._n,"._onError"),n,o),t===this._socketID&&(this._readyState="",this._channelModule.onError())}},{key:"onMessage",value:function(e){var t;try{t=JSON.parse(e.data)}catch(u){new Ai("jsonParseError").setMessage(e.data).end()}if(t&&t.head){var n=this._getRequestIDFromHead(t.head),o=t.body;if(!this._isTRTCCommand(n)){var r=Gt(t.head);o=La(t.body,this._getResponseKeyMap(r))}if(Ve.d("".concat(this._n,".onMessage ret:").concat(JSON.stringify(o)," requestID:").concat(n," has:").concat(this._promiseMap.has(n))),this._setNextPingTs(),this._promiseMap.has(n)){var i=this._promiseMap.get(n),s=i.resolve,a=i.reject,c=i.timestamp;return this._promiseMap.delete(n),this._calcRTT(c),void(o.errorCode&&0!==o.errorCode?(this._channelModule.onErrorCodeNotZero(o),a(new Wi({code:o.errorCode,message:o.errorInfo||"",data:n.includes(Ro)||n.includes(Mr)?{elements:o.elements,messageVersion:o.messageVersion,cloudCustomData:o.cloudCustomData}:void 0}))):s(zi(o)))}this._channelModule.onMessage({head:t.head,body:o})}}},{key:"_isTRTCCommand",value:function(e){for(var t=this._channelModule.getModule(io).getCommandList(),n=!1,o=0;o<t.length;o++)if(e.startsWith(t[o])){n=!0;break}return n}},{key:"_calcRTT",value:function(e){var t=Date.now()-e;this._channelModule.getModule(to).addRTT(t)}},{key:"_connect",value:function(){this._startTs=Date.now(),this._onOpenTs=0,this._socket=new wa(this),this._socketID=this._socket.getID(),this._readyState=Fa,Ve.l("".concat(this._n,"._connect isWorkerEnabled:").concat(this.getIsWorkerEnabled()," socketID:").concat(this._socketID," url:").concat(this.getURL())),new Ai("wsConnect").setMessage("socketID:".concat(this._socketID," url:").concat(this.getURL())).end()}},{key:"getURL",value:function(){this._channelModule.isDevMode()&&(this._canIUseBinaryFrame=!1);var e=wt();(te||X&&"windows"===e||oe)&&(this._canIUseBinaryFrame=!1);var t=-1;"ios"===e?t=ye||-1:"android"===e&&(t=Ie||-1);var n=this._channelModule.getModule(Bn),o=this._channelModule.getPlatform(),r=n.getSDKAppID(),i=n.getInstanceID(),s="sdkappid=".concat(r,"&instanceid=").concat(i,"&random=").concat(this._getRandom(),"&platform=").concat(o,"&host=").concat(e,"&version=").concat(t);return this._canIUseBinaryFrame?"".concat(this._url,"/binfo?").concat(s):"".concat(this._url,"/info?").concat(s)}},{key:"_closeConnection",value:function(e){Ve.l("".concat(this._n,"._closeConnection socketID:").concat(this._socketID)),this._socket&&(this._socket.close(e),this._socketID=-1,this._socket=null,this._readyState=qa)}},{key:"_resend",value:function(){var e=this;if(Ve.l("".concat(this._n,"._resend reConnectFlag:").concat(this._reConnectFlag),"promiseMap.size:".concat(this._promiseMap.size," simpleRequestMap.size:").concat(this._simpleRequestMap.size)),this._promiseMap.size>0&&this._promiseMap.forEach((function(t,n){var o=t.uplinkData,r=t.resolve,i=t.reject;e._promiseMap.set(n,{resolve:r,reject:i,timestamp:Date.now(),uplinkData:o}),e._execute(n,o)})),this._simpleRequestMap.size>0){var t,n=k(this._simpleRequestMap);try{for(n.s();!(t=n.n()).done;){var o=v(t.value,2),r=o[0],i=o[1];this._execute(r,i)}}catch(s){n.e(s)}finally{n.f()}this._simpleRequestMap.clear()}}},{key:"send",value:function(e){var t=this;e.head.seq=this._getSequence(),e.head.reqtime=Math.floor(Date.now()/1e3),e.keyMap;var n=g(e,Pa),o=this._getRequestIDFromHead(e.head),r=JSON.stringify(n);return new Promise((function(e,i){t._promiseMap.set(o,{resolve:e,reject:i,timestamp:Date.now(),uplinkData:r}),Ve.d("".concat(t._n,".send uplinkData:").concat(JSON.stringify(n)," requestID:").concat(o," readyState:").concat(t._readyState)),t._readyState!==xa?t._reConnect():(t._execute(o,r),t._channelModule.getModule(to).addRequestCount())}))}},{key:"simplySend",value:function(e){e.head.seq=this._getSequence(),e.head.reqtime=Math.floor(Date.now()/1e3),e.keyMap;var t=g(e,Ga),n=this._getRequestIDFromHead(e.head),o=JSON.stringify(t);this._readyState!==xa?(this._simpleRequestMap.size<this.MAX_SIZE?this._simpleRequestMap.set(n,o):Ve.l("".concat(this._n,".simplySend. simpleRequestMap is full, drop request!")),this._reConnect()):this._execute(n,o)}},{key:"_execute",value:function(e,t){this._socket.send({data:t,fail:ie?this._onSendFail.bind(this):void 0,requestID:e})}},{key:"_onSendFail",value:function(e){Ve.l("".concat(this._n,"._onSendFail requestID:").concat(e))}},{key:"_getSequence",value:function(){var e;if(this._startSequence<2415919103)return e=this._startSequence,this._startSequence+=1,2415919103===this._startSequence&&(this._startSequence=_t()),e}},{key:"_getRequestIDFromHead",value:function(e){return e.servcmd+e.seq}},{key:"_getResponseKeyMap",value:function(e){var t=this._channelModule.getKeyMap(e);return n(n({},Ea.response),t.response)}},{key:"_reConnect",value:function(){this._readyState!==xa&&this._readyState!==Fa&&this.forcedReconnect()}},{key:"forcedReconnect",value:function(){var e=this,t="".concat(this._n,".forcedReconnect");Ve.l("".concat(t," count:").concat(this._reConnectCount," readyState:").concat(this._readyState)),this._reConnectFlag=!0,this._resetRandom(),this._reConnectCount<this.MAX_RECONNECT_COUNT?(this._reConnectCount+=1,this._closeConnection(Ua),this._initConnection()):(this._reConnectCount=0,this._channelModule.probeNetwork().then((function(n){var o=v(n,2),r=o[0];o[1],r?(Ve.w("".concat(t," disconnected from wsserver but network is ok, continue...")),e._closeConnection(Ua),e._initConnection()):e._channelModule.onReconnectFailed()})))}},{key:"getReconnectFlag",value:function(){return this._reConnectFlag}},{key:"_setNextPingTs",value:function(){this._nextPingTs=Date.now()+1e4}},{key:"getNextPingTs",value:function(){return this._nextPingTs}},{key:"isConnected",value:function(){return this._readyState===xa}},{key:"canIUseBinaryFrame",value:function(){return this._canIUseBinaryFrame}},{key:"setIsWorkerEnabled",value:function(e){Ve.l("".concat(this._n,".setIsWorkerEnabled flag:").concat(e)),this._isWorkerEnabled=e}},{key:"getIsWorkerEnabled",value:function(){return this._isWorkerEnabled&&Le}},{key:"_getRandom",value:function(){return 0===this._random&&(this._random=Math.random()),this._random}},{key:"_resetRandom",value:function(){this._random=0}},{key:"close",value:function(){Ve.l("".concat(this._n,".close")),this._closeConnection(ba),this._promiseMap.clear(),this._startSequence=_t(),this._readyState=qa,this._simpleRequestMap.clear(),this._reConnectFlag=!1,this._reConnectCount=0,this._onOpenTs=0,this._url="",this._random=0,this._canIUseBinaryFrame=!0,this._isWorkerEnabled=!0}}]),e}(),Va=function(e){c(n,e);var t=m(n);function n(e){var o;if(r(this,n),(o=t.call(this,e))._n="ChannelModule",o._socketHandler=new Ba(f(o)),o._probing=!1,o._isAppShowing=!0,o._previousState=S.NET_STATE_CONNECTED,ie&&"function"==typeof ae.onAppShow&&"function"==typeof ae.onAppHide){var i=o._onAppHide.bind(f(o)),s=o._onAppShow.bind(f(o));"function"==typeof ae.offAppHide&&ae.offAppHide(i),"function"==typeof ae.offAppShow&&ae.offAppShow(s),ae.onAppHide(i),ae.onAppShow(s)}return o._timerForNotLoggedIn=-1,o._timerForNotLoggedIn=setInterval(o.onCheckTimer.bind(f(o)),1e3),o._fatalErrorFlag=!1,o}return s(n,[{key:"onCheckTimer",value:function(e){this._socketHandler&&(this.isLoggedIn()?(this._timerForNotLoggedIn>0&&(clearInterval(this._timerForNotLoggedIn),this._timerForNotLoggedIn=-1),this._socketHandler.onCheckTimer(e)):this._socketHandler.onCheckTimer(1),this._checkNextPing())}},{key:"onErrorCodeNotZero",value:function(e){this.getModule($n).onErrorCodeNotZero(e)}},{key:"onMessage",value:function(e){this.getModule($n).onMessage(e)}},{key:"send",value:function(e){return this._socketHandler?this._previousState!==S.NET_STATE_CONNECTED&&e.head.servcmd.includes(Vr)?(this.reConnect(),this._sendLogViaHTTP(e)):this._socketHandler.send(e):Promise.reject()}},{key:"_sendLogViaHTTP",value:function(e){var t=V.HOST.CURRENT.STAT;return new Promise((function(n,o){var r="".concat(t,"/v4/imopenstat/tim_web_report_v2?sdkappid=").concat(e.head.sdkappid,"&reqtime=").concat(Date.now()),i=JSON.stringify(e.body),s="application/x-www-form-urlencoded;charset=UTF-8";if(ie)ae.request({url:r,data:i,method:"POST",timeout:3e3,header:{"content-type":s},success:function(){n()},fail:function(){o(new Wi({code:gi.NETWORK_ERROR}))}});else{var a=new XMLHttpRequest,c=setTimeout((function(){a.abort(),o(new Wi({code:gi.NETWORK_TIMEOUT}))}),3e3);a.onreadystatechange=function(){4===a.readyState&&(clearTimeout(c),200===a.status||304===a.status?n():o(new Wi({code:gi.NETWORK_ERROR})))},a.open("POST",r,!0),a.setRequestHeader("Content-type",s),a.send(i)}}))}},{key:"simplySend",value:function(e){return this._socketHandler?this._socketHandler.simplySend(e):Promise.reject()}},{key:"onOpen",value:function(){this._ping()}},{key:"onClose",value:function(){this._socketHandler&&this._socketHandler.getReconnectFlag()&&this._emitNetStateChangeEvent(S.NET_STATE_DISCONNECTED),this.reConnect()}},{key:"onError",value:function(){ie&&!oe&&this.outputWarning("DomainNameInMP"),this._emitNetStateChangeEvent(S.NET_STATE_DISCONNECTED)}},{key:"getKeyMap",value:function(e){return this.getModule($n).getKeyMap(e)}},{key:"_onAppHide",value:function(){this._isAppShowing=!1}},{key:"_onAppShow",value:function(){this._isAppShowing=!0}},{key:"onRequestTimeout",value:function(e){}},{key:"onReconnected",value:function(){Ve.l("".concat(this._n,".onReconnected")),this._m.restartTimer(),this.getModule($n).onReconnected(),this._emitNetStateChangeEvent(S.NET_STATE_CONNECTED)}},{key:"onReconnectFailed",value:function(){Ve.l("".concat(this._n,".onReconnectFailed")),this._emitNetStateChangeEvent(S.NET_STATE_DISCONNECTED)}},{key:"setIsWorkerEnabled",value:function(e){this._socketHandler&&this._socketHandler.setIsWorkerEnabled(!1)}},{key:"offline",value:function(){this._emitNetStateChangeEvent(S.NET_STATE_DISCONNECTED)}},{key:"reConnect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!1;this._socketHandler&&(t=this._socketHandler.getReconnectFlag());var n="forcedFlag:".concat(e," fatalErrorFlag:").concat(this._fatalErrorFlag," previousState:").concat(this._previousState," reconnectFlag:").concat(t);if(Ve.l("".concat(this._n,".reConnect ").concat(n)),!this._fatalErrorFlag&&this._socketHandler){if(!0===e)this._socketHandler.forcedReconnect();else{if(this._previousState===S.NET_STATE_CONNECTING&&t)return;this._socketHandler.forcedReconnect()}this._emitNetStateChangeEvent(S.NET_STATE_CONNECTING)}}},{key:"_emitNetStateChangeEvent",value:function(e){this._previousState!==e&&(Ve.l("".concat(this._n,"._emitNetStateChangeEvent from ").concat(this._previousState," to ").concat(e)),this._previousState=e,this.emitOuterEvent(D.NET_STATE_CHANGE,{state:e}))}},{key:"_ping",value:function(){var e=this;if(!0!==this._probing){this._probing=!0;var t=this.getModule($n).getProtocolData({protocolName:Kr});this.send(t).then((function(){e._probing=!1})).catch((function(t){if(Ve.w("".concat(e._n,"._ping failed. error:"),t),e._probing=!1,t&&60002===t.code)return new Ai("error").setMessage("code:".concat(t.code," message:").concat(t.message)).setNetworkType(e.getModule(Hn).getNetworkType()).end(),e._fatalErrorFlag=!0,void e._emitNetStateChangeEvent(S.NET_STATE_DISCONNECTED);e.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];Ve.l("".concat(e._n,"._ping failed. probe network, isAppShowing:").concat(e._isAppShowing," online:").concat(o," networkType:").concat(r)),o?e.reConnect():e._emitNetStateChangeEvent(S.NET_STATE_DISCONNECTED)}))}))}}},{key:"_checkNextPing",value:function(){this._socketHandler&&this._socketHandler.isConnected()&&Date.now()>=this._socketHandler.getNextPingTs()&&this._ping()}},{key:"dealloc",value:function(){this._socketHandler&&(this._socketHandler.close(),this._socketHandler=null),this._timerForNotLoggedIn>-1&&clearInterval(this._timerForNotLoggedIn)}},{key:"onRestApiKickedOut",value:function(){this._socketHandler&&(this._socketHandler.close(),this.reConnect(!0))}},{key:"reset",value:function(){Ve.l("".concat(this._n,".reset")),this._previousState=S.NET_STATE_CONNECTED,this._probing=!1,this._fatalErrorFlag=!1,this._timerForNotLoggedIn=setInterval(this.onCheckTimer.bind(this),1e3)}}]),n}(co),Ka=["a2","tinyid"],Ha=["a2","tinyid"],ja=function(){function e(t){r(this,e),this._n="ProtocolHandler",this._sessionModule=t,this._configMap=new Map,this._fillConfigMap()}return s(e,[{key:"_fillConfigMap",value:function(){this._configMap.clear();var e=this._sessionModule.genCommonHead(),t=this._sessionModule.genCosSpecifiedHead(),o=this._sessionModule.genSSOReportHead(),r=this._sessionModule.isIntl();this._configMap.set(uo,{head:n(n({},e),{},{servcmd:"".concat(V.NAME.IM_OPEN_STATUS,".").concat(V.CMD.LOGIN)}),body:{state:"Online",isWebUniapp:0,deviceBrand:0},keyMap:{request:{deviceBrand:"InstType"},response:{InstId:"instanceID",HelloInterval:"helloInterval"}}}),this._configMap.set(lo,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.IM_OPEN_STATUS,".").concat(V.CMD.LOGOUT)}),body:{type:0},keyMap:{request:{type:"wslogout_type"}}}}(e)),this._configMap.set(po,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.IM_OPEN_STATUS,".").concat(V.CMD.HELLO)}),body:{isWebUniapp:0},keyMap:{response:{NewInstInfo:"newInstanceInfo"}}}}(e)),this._configMap.set(ho,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.STAT_SERVICE,".").concat(V.CMD.KICK_OTHER)}),body:{}}}(e)),this._configMap.set(Fr,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.IM_COS_SIGN,".").concat(V.CMD.COS_SIGN)}),body:{cmd:"open_im_cos_svc",subCmd:"get_cos_token",duration:300,version:2},keyMap:{request:{userSig:"usersig",subCmd:"sub_cmd",cmd:"cmd",duration:"duration",version:"version"},response:{expired_time:"expiredTime",bucket_name:"bucketName",session_token:"sessionToken",tmp_secret_id:"secretId",tmp_secret_key:"secretKey"}}}}(t)),this._configMap.set(qr,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.CUSTOM_UPLOAD,".").concat(V.CMD.COS_PRE_SIG)}),body:{fileType:void 0,fileName:void 0,uploadMethod:0,duration:900},keyMap:{request:{userSig:"usersig",fileType:"file_type",fileName:"file_name",uploadMethod:"upload_method"},response:{expired_time:"expiredTime",request_id:"requestId",head_url:"headUrl",upload_url:"uploadUrl",download_url:"downloadUrl",ci_url:"ciUrl",snapshot_url:"requestSnapshotUrl"}}}}(t)),this._configMap.set(Br,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.CUSTOM_UPLOAD,".").concat(V.CMD.VIDEO_COVER)}),body:{version:1,platform:void 0,coverName:void 0,requestSnapshotUrl:void 0},keyMap:{request:{version:"version",platform:"platform",coverName:"cover_name",requestSnapshotUrl:"snapshot_url"},response:{error_code:"errorCode",error_msg:"errorInfo",download_url:"snapshotUrl"}}}}(t)),this._configMap.set(Zr,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.IM_CONFIG_MANAGER,".").concat(V.CMD.FETCH_COMMERCIAL_CONFIG)}),body:{SDKAppID:0},keyMap:{request:{SDKAppID:"uint32_sdkappid"},response:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_purchase_bits:"purchaseBits",uint32_expired_time:"expiredTime"}}}}(e)),this._configMap.set(Qr,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.IM_CONFIG_MANAGER,".").concat(V.CMD.PUSHED_COMMERCIAL_CONFIG)}),body:{},keyMap:{response:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_purchase_bits:"purchaseBits",uint32_expired_time:"expiredTime"}}}}(e)),this._configMap.set(Jr,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.IM_CONFIG_MANAGER,".").concat(V.CMD.FETCH_CLOUD_CONTROL_CONFIG)}),body:{SDKAppID:0,version:0},keyMap:{request:{SDKAppID:"uint32_sdkappid",version:"uint64_version"},response:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_json_config:"cloudControlConfig",uint32_expired_time:"expiredTime",uint32_sdkappid:"SDKAppID",uint64_version:"version"}}}}(e)),this._configMap.set(Xr,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.IM_CONFIG_MANAGER,".").concat(V.CMD.PUSHED_CLOUD_CONTROL_CONFIG)}),body:{},keyMap:{response:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_json_config:"cloudControlConfig",uint32_expired_time:"expiredTime",uint32_sdkappid:"SDKAppID",uint64_version:"version"}}}}(e)),this._configMap.set(ei,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.OVERLOAD_PUSH,".").concat(V.CMD.OVERLOAD_NOTIFY)}),body:{},keyMap:{response:{OverLoadServCmd:"overloadCommand",DelaySecs:"waitingTime"}}}}(e)),this._configMap.set(go,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.OPEN_IM,".").concat(V.CMD.GET_MESSAGES)}),body:{cookie:"",syncFlag:0,needAbstract:1,isOnlineSync:0,needSignaling:1},keyMap:{request:{fromAccount:"From_Account",toAccount:"To_Account",from:"From_Account",to:"To_Account",time:"MsgTimeStamp",sequence:"MsgSeq",random:"MsgRandom",elements:"MsgBody"},response:{MsgList:"messageList",SyncFlag:"syncFlag",To_Account:"to",From_Account:"from",ClientSeq:"clientSequence",MsgSeq:"sequence",NoticeSeq:"noticeSequence",NotifySeq:"notifySequence",MsgRandom:"random",MsgTimeStamp:"time",MsgContent:"content",ToGroupId:"to",MsgKey:"messageKey",GroupTips:"groupTips",MsgBody:"elements",MsgType:"type",C2CRemainingUnreadCount:"C2CRemainingUnreadList",C2CPairUnreadCount:"C2CPairUnreadList"}}}}(e)),r||(this._configMap.set(fo,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.OPEN_IM,".").concat(V.CMD.BIG_DATA_HALLWAY_AUTH_KEY)}),body:{}}}(e)),this._configMap.set(pi,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.IM_MSG_AUDIT_MGR,".").concat(V.CMD.GET_RPOFANITY_LIST)}),body:{version:0,deviceID:"",startIndex:void 0},keyMap:{request:{version:"uint64_version",deviceID:"str_device_id",startIndex:"uint64_start_index"},response:{msg_cmd_error_code:"errorInfo",str_err_msg:"errorMessage",uint32_code:"errorCode",msg_scene_ctl_config:"filterConfig",uint64_c2c_custom_msg_flag:"c2c_custom_message",uint64_c2c_text_msg_flag:"c2c_text_message",uint64_group_custom_msg_flag:"group_custom_message",uint64_group_text_msg_flag:"group_text_message",uint64_group_info_flag:"group_profile",uint64_group_member_info_flag:"group_member_profile",uint64_relation_chain_flag:"sns",uint64_user_info_flag:"user_profile",rpt_msg_dirty_word:"lexicon",str_dirty_word:"profanity",str_replaced_content:"replacement",uint64_filter_type:"filterType",uint64_id:"id",uint64_word_type:"profanityType",uint64_complete_flag:"completeFlag",uint64_next_start_index:"nextStartIndex",uint64_version:"version",uint64_expired_time:"expiredTime"}}}}(e))),this._configMap.set(_o,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.OPEN_IM,".").concat(V.CMD.SEND_MESSAGE)}),body:{fromAccount:"",toAccount:"",msgSeq:0,msgRandom:0,msgBody:[],cloudCustomData:void 0,nick:"",avatar:"",msgLifeTime:void 0,offlinePushInfo:{pushFlag:0,title:"",desc:"",ext:"",apnsInfo:{badgeMode:0,isVoipPush:void 0},androidInfo:{OPPOChannelID:""}},messageControlInfo:void 0,clientTime:void 0,needReadReceipt:0,isSupportExtension:0},keyMap:{request:{fromAccount:"From_Account",toAccount:"To_Account",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom",msgBody:"MsgBody",count:"MaxCnt",lastMessageTime:"LastMsgTime",messageKey:"MsgKey",peerAccount:"Peer_Account",data:"Data",description:"Desc",extension:"Ext",type:"MsgType",content:"MsgContent",sizeType:"Type",uuid:"UUID",url:"",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",nick:"From_AccountNick",avatar:"From_AccountHeadurl",from:"From_Account",time:"MsgTimeStamp",messageRandom:"MsgRandom",messageSequence:"MsgSeq",elements:"MsgBody",clientSequence:"ClientSeq",payload:"MsgContent",messageList:"MsgList",messageNumber:"MsgNum",abstractList:"AbstractList",messageBody:"MsgBody",needReadReceipt:"IsNeedReadReceipt"}}}}(e)),this._configMap.set(mo,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP,".").concat(V.CMD.SEND_GROUP_MESSAGE)}),body:{fromAccount:"",groupID:"",random:0,clientSequence:0,priority:"",msgBody:[],cloudCustomData:void 0,onlineOnlyFlag:0,offlinePushInfo:{pushFlag:0,title:"",desc:"",ext:"",apnsInfo:{badgeMode:0,isVoipPush:void 0},androidInfo:{OPPOChannelID:""}},groupAtInfo:[],messageControlInfo:void 0,clientTime:void 0,needReadReceipt:0,topicID:void 0,receiverList:void 0,isSupportExtension:0},keyMap:{request:{to:"GroupId",extension:"Ext",data:"Data",description:"Desc",random:"Random",sequence:"ReqMsgSeq",count:"ReqMsgNumber",type:"MsgType",priority:"MsgPriority",content:"MsgContent",elements:"MsgBody",sizeType:"Type",uuid:"UUID",url:"",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",clientSequence:"ClientSeq",from:"From_Account",time:"MsgTimeStamp",messageRandom:"MsgRandom",messageSequence:"MsgSeq",payload:"MsgContent",messageList:"MsgList",messageNumber:"MsgNum",abstractList:"AbstractList",messageBody:"MsgBody",needReadReceipt:"NeedReadReceipt",receiverList:"To_Account"},response:{MsgTime:"time",MsgSeq:"sequence"}}}}(e)),this._configMap.set(To,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.OPEN_IM,".").concat(V.CMD.REVOKE_C2C_MESSAGE)}),body:{msgInfo:{fromAccount:"",toAccount:"",msgTimeStamp:0,msgSeq:0,msgRandom:0}},keyMap:{request:{msgInfo:"MsgInfo",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom"}}}}(e)),this._configMap.set(sr,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP,".").concat(V.CMD.REVOKE_GROUP_MESSAGE)}),body:{groupID:"",msgSeqList:void 0,topicID:""},keyMap:{request:{msgSeqList:"MsgSeqList",msgSeq:"MsgSeq"}}}}(e)),this._configMap.set(So,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.OPEN_IM,".").concat(V.CMD.GET_C2C_ROAM_MESSAGES)}),body:{peerAccount:"",count:15,lastMessageTime:0,messageKey:"",withRecalledMessage:1,direction:0},keyMap:{request:{messageKey:"MsgKey",peerAccount:"Peer_Account",count:"MaxCnt",lastMessageTime:"LastMsgTime",withRecalledMessage:"WithRecalledMsg",direction:"GetDirection"},response:{LastMsgTime:"lastMessageTime",IsNeedReadReceipt:"needReadReceipt",IsPeerRead:"readReceiptSentByPeer"}}}}(e)),this._configMap.set(Ro,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.OPEN_IM,".").concat(V.CMD.MODIFY_C2C_MESSAGE)}),body:{from:"",to:"",sequence:0,random:0,time:0,version:0,elements:void 0,cloudCustomData:void 0},keyMap:{request:{sequence:"MsgSeq",random:"MsgRandom",time:"MsgTime",version:"MsgVersion",type:"MsgType",content:"MsgContent"}}}}(e)),this._configMap.set(ur,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP,".").concat(V.CMD.GET_GROUP_ROAM_MESSAGES)}),body:{withRecalledMsg:1,groupID:"",count:15,sequence:"",topicID:void 0},keyMap:{request:{sequence:"ReqMsgSeq",count:"ReqMsgNumber",withRecalledMessage:"WithRecalledMsg"},response:{Random:"random",MsgTime:"time",MsgSeq:"sequence",ReqMsgSeq:"sequence",RspMsgList:"messageList",IsPlaceMsg:"isPlaceMessage",IsSystemMsg:"isSystemMessage",ToGroupId:"to",EnumFrom_AccountType:"fromAccountType",EnumTo_AccountType:"toAccountType",GroupCode:"groupCode",MsgPriority:"priority",MsgBody:"elements",MsgType:"type",MsgContent:"content",IsFinished:"complete",Download_Flag:"downloadFlag",ClientSeq:"clientSequence",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID",ToTopicId:"topicID",InvisibleMsgSeq:"invisibleSequenceList"}}}}(e)),this._configMap.set(Eo,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.OPEN_IM,".").concat(V.CMD.SET_C2C_MESSAGE_READ)}),body:{C2CMsgReaded:void 0},keyMap:{request:{lastMessageTime:"LastedMsgTime"}}}}(e)),this._configMap.set(ko,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.OPEN_IM,".").concat(V.CMD.SET_C2C_PEER_MUTE_NOTIFICATIONS)}),body:{userIDList:void 0,muteFlag:0},keyMap:{request:{userIDList:"Peer_Account",muteFlag:"Mute_Notifications"}}}}(e)),this._configMap.set(Do,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.OPEN_IM,".").concat(V.CMD.GET_C2C_PEER_MUTE_NOTIFICATIONS)}),body:{updateSequence:0},keyMap:{response:{MuteNotificationsList:"muteFlagList"}}}}(e)),this._configMap.set(ar,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP,".").concat(V.CMD.SET_GROUP_MESSAGE_READ)}),body:{groupID:void 0,messageReadSeq:void 0,topicID:void 0},keyMap:{request:{messageReadSeq:"MsgReadedSeq"}}}}(e)),this._configMap.set(cr,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.OPEN_IM,".").concat(V.CMD.SET_ALL_MESSAGE_READ)}),body:{readAllC2CMessage:0,groupMessageReadInfoList:[]},keyMap:{request:{readAllC2CMessage:"C2CReadAllMsg",groupMessageReadInfoList:"GroupReadInfo",messageSequence:"MsgSeq"},response:{C2CReadAllMsg:"readAllC2CMessage",GroupReadInfoArray:"groupMessageReadInfoList"}}}}(e)),this._configMap.set(Ao,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.OPEN_IM,".").concat(V.CMD.DELETE_C2C_MESSAGE)}),body:{fromAccount:"",to:"",keyList:void 0},keyMap:{request:{keyList:"MsgKeyList"}}}}(e)),this._configMap.set(yr,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP,".").concat(V.CMD.DELETE_GROUP_MESSAGE)}),body:{groupID:"",deleter:"",keyList:void 0,topicID:void 0},keyMap:{request:{deleter:"Deleter_Account",keyList:"Seqs"}}}}(e)),this._configMap.set(hi,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.IM_OPEN_TRANSLATE,".").concat(V.CMD.TRANSLATE_TEXT)}),body:{sourceTextList:void 0,SDKAppID:0,from:0,source:"",target:""},keyMap:{request:{sourceTextList:"SourceText",SDKAppID:"SdkAppId",from:"FromAccount"},response:{TargetText:"translatedTextList",RequestId:"requestID",CmdErrorCode:"error",ErrorCode:"code",ErrorInfo:"message"}}}}(e)),this._configMap.set(Mr,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.OPEN_IM,".").concat(V.CMD.MODIFY_GROUP_MESSAGE)}),body:{groupID:"",topicID:void 0,sequence:0,version:0,elements:void 0,cloudCustomData:void 0},keyMap:{request:{sequence:"MsgSeq",version:"MsgVersion",type:"MsgType",content:"MsgContent"}}}}(e)),this._configMap.set(lr,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP,".").concat(V.CMD.GET_READ_RECEIPT)}),body:{groupID:"",sequenceList:void 0},keyMap:{request:{sequence:"MsgSeq"}}}}(e)),this._configMap.set(pr,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.OPEN_IM,".").concat(V.CMD.SEND_C2C_READ_RECEIPT)}),body:{peerAccount:"",messageInfoList:void 0},keyMap:{request:{peerAccount:"Peer_Account",messageInfoList:"C2CMsgInfo",fromAccount:"From_Account",toAccount:"To_Account",sequence:"MsgSeq",random:"MsgRandom",time:"MsgTime",clientTime:"MsgClientTime"}}}}(e)),this._configMap.set(dr,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP,".").concat(V.CMD.SEND_READ_RECEIPT)}),body:{groupID:"",sequenceList:void 0},keyMap:{request:{sequenceList:"MsgSeqList",sequence:"MsgSeq"}}}}(e)),this._configMap.set(hr,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP,".").concat(V.CMD.GET_READ_RECEIPT_DETAIL)}),body:{groupID:"",sequence:void 0,flag:0,cursor:0,count:0},keyMap:{request:{sequence:"MsgSeq",count:"Num"},response:{ReadList:"readUserIDList",Read_Account:"userID",UnreadList:"unreadUserIDList",Unread_Account:"userID",IsFinish:"isCompleted"}}}}(e)),this._configMap.set(Oo,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.OPEN_IM_MSG_EXT,".").concat(V.CMD.MODIFY_C2C_MESSAGE_EXTENSIONS)}),body:{from:void 0,to:void 0,messageKey:void 0,operateType:void 0,extensionList:void 0}}}(e)),this._configMap.set(No,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.OPEN_IM_MSG_EXT,".").concat(V.CMD.GET_C2C_MESSAGE_EXTENSIONS)}),body:{from:void 0,to:void 0,messageKey:void 0,startSequence:void 0}}}(e)),this._configMap.set(Dr,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.OPEN_IM_MSG_EXT,".").concat(V.CMD.MODIFY_GROUP_MESSAGE_EXTENSIONS)}),body:{groupID:void 0,topicID:void 0,messageSequence:void 0,operateType:void 0,extensionList:void 0}}}(e)),this._configMap.set(Sr,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.OPEN_IM_MSG_EXT,".").concat(V.CMD.GET_GROUP_MESSAGE_EXTENSIONS)}),body:{groupID:void 0,topicID:void 0,messageSequence:void 0,startSequence:void 0}}}(e)),this._configMap.set(Lo,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.OPEN_IM,".").concat(V.CMD.GET_PEER_READ_TIME)}),body:{userIDList:void 0},keyMap:{request:{userIDList:"To_Account"},response:{ReadTime:"peerReadTimeList"}}}}(e)),this._configMap.set(bo,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.RECENT_CONTACT,".").concat(V.CMD.GET_CONVERSATION_LIST)}),body:{fromAccount:void 0,count:0},keyMap:{request:{},response:{SessionItem:"conversations",ToAccount:"groupID",To_Account:"userID",UnreadMsgCount:"unreadCount",MsgGroupReadedSeq:"messageReadSeq",C2cPeerReadTime:"c2cPeerReadTime"}}}}(e)),this._configMap.set(wo,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.RECENT_CONTACT,".").concat(V.CMD.PAGING_GET_CONVERSATION_LIST)}),body:{fromAccount:void 0,timeStamp:void 0,startIndex:void 0,pinnedTimeStamp:void 0,pinnedStartIndex:void 0,orderType:void 0,messageAssistFlag:4,assistFlag:15},keyMap:{request:{messageAssistFlag:"MsgAssistFlags",assistFlag:"AssistFlags",pinnedTimeStamp:"TopTimeStamp",pinnedStartIndex:"TopStartIndex"},response:{SessionItem:"conversations",ToAccount:"groupID",To_Account:"userID",UnreadMsgCount:"unreadCount",MsgGroupReadedSeq:"messageReadSeq",C2cPeerReadTime:"c2cPeerReadTime",LastMsgFlags:"lastMessageFlag",TopFlags:"isPinned",TopTimeStamp:"pinnedTimeStamp",TopStartIndex:"pinnedStartIndex",GroupId:"convGroupID"}}}}(e)),this._configMap.set(Uo,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.RECENT_CONTACT,".").concat(V.CMD.DELETE_CONVERSATION)}),body:{fromAccount:"",conversationList:void 0,clearHistoryMessage:void 0},keyMap:{request:{toGroupID:"ToGroupid",clearHistoryMessage:"ClearRamble",conversationList:"ContactItem"},response:{ResultItem:"resultList",ToGroupid:"groupID",ResultCode:"code",ResultInfo:"info"}}}}(e)),this._configMap.set(Po,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.RECENT_CONTACT,".").concat(V.CMD.CLEAR_HISTORY_MESSAGE)}),body:{fromAccount:"",toAccount:void 0,type:1,toGroupID:void 0},keyMap:{request:{toGroupID:"ToGroupid"}}}}(e)),this._configMap.set(Go,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.RECENT_CONTACT,".").concat(V.CMD.PIN_CONVERSATION)}),body:{fromAccount:"",operationType:1,itemList:void 0},keyMap:{request:{itemList:"RecentContactItem"}}}}(e)),this._configMap.set(xo,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.OPEN_IM,".").concat(V.CMD.DELETE_GROUP_AT_TIPS)}),body:{messageListToDelete:void 0},keyMap:{request:{messageListToDelete:"DelMsgList",messageSeq:"MsgSeq",messageRandom:"MsgRandom"}}}}(e)),this._configMap.set(Fo,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.RECENT_CONTACT,".").concat(V.CMD.MARK_CONVERSATION)}),body:{fromAccount:"",itemList:void 0},keyMap:{request:{itemList:"MarkItem",operationType:"OptType",groupID:"ToGroupId"},response:{ToGroupId:"groupID",OptType:"operationType"}}}}(e)),this._configMap.set(qo,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.RECENT_CONTACT,".").concat(V.CMD.MARK_CONVERSATION)}),body:{fromAccount:"",itemList:void 0},keyMap:{request:{itemList:"MarkItem",operationType:"OptType",groupID:"ToGroupId"},response:{ToGroupId:"groupID",OptType:"operationType"}}}}(e)),this._configMap.set(Bo,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.RECENT_CONTACT,".").concat(V.CMD.CREATE_CONVERSATION_GROUP)}),body:{fromAccount:"",itemList:void 0},keyMap:{request:{itemList:"GroupContactItem",groupID:"ToGroupId"},response:{GroupId:"convGroupID",ToGroupId:"groupID",OptType:"operationType"}}}}(e)),this._configMap.set(Vo,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.RECENT_CONTACT,".").concat(V.CMD.DELETE_CONVERSATION_GROUP)}),body:{fromAccount:"",groupName:void 0},keyMap:{request:{},response:{GroupId:"convGroupID"}}}}(e)),this._configMap.set(Ko,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.RECENT_CONTACT,".").concat(V.CMD.UPDATE_CONVERSATION_GROUP)}),body:{fromAccount:"",updateType:void 0,updateGroup:void 0},keyMap:{request:{oldName:"OldGroupName",newName:"NewGroupName",groupID:"ToGroupId",operationType:"ContactOptType",groupName:"OldGroupName",updateItem:"ContactUpdateItem"},response:{ContactOptType:"operationType",ToGroupId:"groupID",GroupId:"convGroupID"}}}}(e)),this._configMap.set(Ho,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.RECENT_CONTACT,".").concat(V.CMD.UPDATE_CONVERSATION_GROUP)}),body:{fromAccount:"",updateType:void 0,updateGroup:{groupName:void 0,updateGroupType:void 0,updateItem:void 0}},keyMap:{request:{},response:{}}}}(e)),this._configMap.set(jo,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.RECENT_CONTACT,".").concat(V.CMD.UPDATE_CONVERSATION_GROUP)}),body:{fromAccount:"",updateType:void 0,updateGroup:void 0},keyMap:{request:{},response:{}}}}(e)),this._configMap.set(zo,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.RECENT_CONTACT,".").concat(V.CMD.GET_CONVERSATION_GROUP_LIST)}),body:{fromAccount:"",startTime:void 0,startIndex:void 0},keyMap:{request:{},response:{GroupId:"convGroupID",ToGroupId:"groupID",OptType:"operationType",CustomMark:"customData",ContactGroupId:"convGroupIDList"}}}}(e)),this._configMap.set(vo,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.PROFILE,".").concat(V.CMD.PORTRAIT_GET)}),body:{fromAccount:"",userItem:[]},keyMap:{request:{toAccount:"To_Account",standardSequence:"StandardSequence",customSequence:"CustomSequence"}}}}(e)),this._configMap.set(yo,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.PROFILE,".").concat(V.CMD.PORTRAIT_SET)}),body:{fromAccount:"",profileItem:[{tag:He.NICK,value:""},{tag:He.GENDER,value:""},{tag:He.ALLOWTYPE,value:""},{tag:He.AVATAR,value:""}]},keyMap:{request:{toAccount:"To_Account",standardSequence:"StandardSequence",customSequence:"CustomSequence"}}}}(e)),this._configMap.set(Mo,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.FRIEND,".").concat(V.CMD.GET_BLACKLIST)}),body:{fromAccount:"",startIndex:0,maxLimited:30,lastSequence:0},keyMap:{response:{CurruentSequence:"currentSequence"}}}}(e)),this._configMap.set(Io,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.FRIEND,".").concat(V.CMD.ADD_BLACKLIST)}),body:{fromAccount:"",toAccount:[]}}}(e)),this._configMap.set(Co,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.FRIEND,".").concat(V.CMD.DELETE_BLACKLIST)}),body:{fromAccount:"",toAccount:[]}}}(e)),this._configMap.set(ii,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.IM_OPEN_STATUS,".").concat(V.CMD.SET_SELF_STATUS)}),body:{customStatus:""},keyMap:{}}}(e)),this._configMap.set(si,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.IM_OPEN_STATUS,".").concat(V.CMD.GET_USER_STATUS)}),body:{userIDList:void 0},keyMap:{response:{UserStatusList:"successUserList",ErrorList:"failureUserList",To_Account:"userID",Invalid_Account:"invalidUserID",Status:"statusType"}}}}(e)),this._configMap.set(ai,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.IM_OPEN_STATUS,".").concat(V.CMD.SUBSCRIBE_USER_STATUS)}),body:{userIDList:void 0},keyMap:{response:{ErrorList:"failureUserList",To_Account:"userID",Invalid_Account:"invalidUserID"}}}}(e)),this._configMap.set(ci,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.IM_OPEN_STATUS,".").concat(V.CMD.UNSUBSCRIBE_USER_STATUS)}),body:{userIDList:void 0,unsubscribeAll:void 0},keyMap:{response:{ErrorList:"failureUserList",To_Account:"userID",Invalid_Account:"invalidUserID"}}}}(e)),this._configMap.set(Wo,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP,".").concat(V.CMD.GET_JOINED_GROUPS)}),body:{memberAccount:"",limit:void 0,offset:void 0,groupType:void 0,responseFilter:{groupBaseInfoFilter:void 0,selfInfoFilter:void 0},isSupportTopic:0},keyMap:{request:{memberAccount:"Member_Account"},response:{GroupIdList:"groups",NoUnreadSeqList:"excludedUnreadSequenceList",MsgSeq:"readedSequence",LastRecallTime:"_lastRevokedTime"}}}}(e)),this._configMap.set(Yo,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP,".").concat(V.CMD.GET_GROUP_INFO)}),body:{groupIDList:void 0,responseFilter:{groupBaseInfoFilter:["Type","Name","Introduction","Notification","FaceUrl","Owner_Account","CreateTime","InfoSeq","LastInfoTime","LastMsgTime","MemberNum","MaxMemberNum","ApplyJoinOption","NextMsgSeq","ShutUpAllMember"],groupCustomFieldFilter:void 0,memberInfoFilter:void 0,memberCustomFieldFilter:void 0}},keyMap:{request:{groupIDList:"GroupIdList",groupCustomField:"AppDefinedData",memberCustomField:"AppMemberDefinedData",groupCustomFieldFilter:"AppDefinedDataFilter_Group",memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember"},response:{GroupIdList:"groups",AppDefinedData:"groupCustomField",AppMemberDefinedData:"memberCustomField",AppDefinedDataFilter_Group:"groupCustomFieldFilter",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",InfoSeq:"infoSequence",MemberList:"members",GroupInfo:"groups",ShutUpUntil:"muteUntil",ShutUpAllMember:"muteAllMembers"}}}}(e)),this._configMap.set($o,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP,".").concat(V.CMD.CREATE_GROUP)}),body:{type:void 0,name:void 0,groupID:void 0,ownerID:void 0,introduction:void 0,notification:void 0,maxMemberNum:void 0,joinOption:void 0,memberList:void 0,groupCustomField:void 0,memberCustomField:void 0,webPushFlag:1,avatar:"",isSupportTopic:void 0,inviteOption:void 0},keyMap:{request:{ownerID:"Owner_Account",userID:"Member_Account",avatar:"FaceUrl",maxMemberNum:"MaxMemberCount",joinOption:"ApplyJoinOption",groupCustomField:"AppDefinedData",memberCustomField:"AppMemberDefinedData",inviteOption:"InviteJoinOption"},response:{HugeGroupFlag:"avChatRoomFlag",OverJoinedGroupLimit_Account:"overLimitUserIDList"}}}}(e)),this._configMap.set(Jo,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP,".").concat(V.CMD.DESTROY_GROUP)}),body:{groupID:void 0}}}(e)),this._configMap.set(Xo,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP,".").concat(V.CMD.MODIFY_GROUP_INFO)}),body:{groupID:void 0,name:void 0,introduction:void 0,notification:void 0,avatar:void 0,joinOption:void 0,groupCustomField:void 0,muteAllMembers:void 0,inviteOption:void 0},keyMap:{request:{groupCustomField:"AppDefinedData",muteAllMembers:"ShutUpAllMember",joinOption:"ApplyJoinOption",avatar:"FaceUrl",inviteOption:"InviteJoinOption"},response:{AppDefinedData:"groupCustomField",ShutUpAllMember:"muteAllMembers"}}}}(e)),this._configMap.set(Zo,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP,".").concat(V.CMD.APPLY_JOIN_GROUP)}),body:{groupID:void 0,applyMessage:void 0,userDefinedField:void 0,webPushFlag:1,historyMessageFlag:void 0},keyMap:{request:{applyMessage:"ApplyMsg",historyMessageFlag:"HugeGroupHistoryMsgFlag"},response:{HugeGroupFlag:"avChatRoomFlag",AVChatRoomKey:"avChatRoomKey",RspMsgList:"messageList",ToGroupId:"to"}}}}(e)),this._configMap.set(Qo,function(e){return e.a2,e.tinyid,{head:n(n({},g(e,Ka)),{},{servcmd:"".concat(V.NAME.BIG_GROUP_NO_AUTH,".").concat(V.CMD.APPLY_JOIN_GROUP)}),body:{groupID:void 0,applyMessage:void 0,userDefinedField:void 0,webPushFlag:1},keyMap:{request:{applyMessage:"ApplyMsg"},response:{HugeGroupFlag:"avChatRoomFlag"}}}}(e)),this._configMap.set(er,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP,".").concat(V.CMD.QUIT_GROUP)}),body:{groupID:void 0}}}(e)),this._configMap.set(tr,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP,".").concat(V.CMD.SEARCH_GROUP_BY_ID)}),body:{groupIDList:void 0,responseFilter:{groupBasePublicInfoFilter:["Type","Name","Introduction","Notification","FaceUrl","CreateTime","Owner_Account","LastInfoTime","LastMsgTime","NextMsgSeq","MemberNum","MaxMemberNum","ApplyJoinOption","InviteJoinOption"]}},keyMap:{response:{}}}}(e)),this._configMap.set(nr,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP,".").concat(V.CMD.CHANGE_GROUP_OWNER)}),body:{groupID:void 0,newOwnerID:void 0},keyMap:{request:{newOwnerID:"NewOwner_Account"}}}}(e)),this._configMap.set(or,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP,".").concat(V.CMD.HANDLE_APPLY_JOIN_GROUP)}),body:{groupID:void 0,applicant:void 0,handleAction:void 0,handleMessage:void 0,authentication:void 0,messageKey:void 0,userDefinedField:void 0},keyMap:{request:{applicant:"Applicant_Account",handleAction:"HandleMsg",handleMessage:"ApprovalMsg",messageKey:"MsgKey"}}}}(e)),this._configMap.set(rr,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP,".").concat(V.CMD.HANDLE_INVITE_JOIN_GROUP)}),body:{groupID:void 0,applicant:void 0,invitee:void 0,handleAction:void 0,handleMessage:void 0,authentication:void 0,userDefinedField:void 0},keyMap:{request:{applicant:"Applicant_Account",invitee:"Invited_Account",handleAction:"HandleMsg",handleMessage:"ApprovalMsg"}}}}(e)),this._configMap.set(ir,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP,".").concat(V.CMD.HANDLE_GROUP_INVITATION)}),body:{groupID:void 0,inviter:void 0,handleAction:void 0,handleMessage:void 0,authentication:void 0,messageKey:void 0,userDefinedField:void 0},keyMap:{request:{inviter:"Inviter_Account",handleAction:"HandleMsg",handleMessage:"ApprovalMsg",messageKey:"MsgKey"}}}}(e)),this._configMap.set(gr,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP,".").concat(V.CMD.GET_GROUP_APPLICATION)}),body:{startTime:void 0,limit:void 0,handleAccount:void 0},keyMap:{request:{handleAccount:"Handle_Account"},response:{To_Account:"userID"}}}}(e)),this._configMap.set(fr,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.OPEN_IM,".").concat(V.CMD.DELETE_GROUP_SYSTEM_MESSAGE)}),body:{messageListToDelete:void 0},keyMap:{request:{messageListToDelete:"DelMsgList",messageSeq:"MsgSeq",messageRandom:"MsgRandom"}}}}(e)),this._configMap.set(_r,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.BIG_GROUP_LONG_POLLING,".").concat(V.CMD.AVCHATROOM_LONG_POLL)}),body:{USP:1,startSeq:1,startBroadcastSeq:void 0,holdTime:90,key:void 0,simplifiedMessage:void 0},keyMap:{request:{USP:"USP"},response:{ToGroupId:"groupID",RspBroadcastMsgList:"broadcastMessageList",IsSystemMsg:"isSystemMessage"}}}}(e)),this._configMap.set(mr,function(e){return e.a2,e.tinyid,{head:n(n({},g(e,Ha)),{},{servcmd:"".concat(V.NAME.BIG_GROUP_LONG_POLLING_NO_AUTH,".").concat(V.CMD.AVCHATROOM_LONG_POLL)}),body:{USP:1,startSeq:1,holdTime:90,key:void 0,simplifiedMessage:void 0},keyMap:{request:{USP:"USP"},response:{ToGroupId:"groupID",RspBroadcastMsgList:"broadcastMessageList",IsSystemMsg:"isSystemMessage"}}}}(e)),this._configMap.set(vr,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP,".").concat(V.CMD.GET_ONLINE_MEMBER_NUM)}),body:{groupID:void 0}}}(e)),this._configMap.set(Ir,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP,".").concat(V.CMD.SET_GROUP_ATTRIBUTES)}),body:{groupID:void 0,groupAttributeList:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]},keyMap:{request:{key:"key",value:"value"}}}}(e)),this._configMap.set(Cr,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP,".").concat(V.CMD.MODIFY_GROUP_ATTRIBUTES)}),body:{groupID:void 0,groupAttributeList:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]},keyMap:{request:{key:"key",value:"value"}}}}(e)),this._configMap.set(Tr,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP,".").concat(V.CMD.DELETE_GROUP_ATTRIBUTES)}),body:{groupID:void 0,groupAttributeList:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]},keyMap:{request:{key:"key"}}}}(e)),this._configMap.set(Er,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP,".").concat(V.CMD.CLEAR_GROUP_ATTRIBUTES)}),body:{groupID:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]}}}(e)),this._configMap.set(kr,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP_ATTR,".").concat(V.CMD.GET_GROUP_ATTRIBUTES)}),body:{groupID:void 0,avChatRoomKey:void 0,groupType:1},keyMap:{request:{avChatRoomKey:"Key",groupType:"GroupType"}}}}(e)),this._configMap.set(Lr,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP,".").concat(V.CMD.GET_GROUP_NOTIFY)}),body:{notifyType:1,groupID:"",beginTime:0,endTime:0,limit:20},keyMap:{request:{},response:{NextMsgTime:"nextRevokedTime",NotifyMsgList:"notifyList"}}}}(e)),this._configMap.set(Ar,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP,".").concat(V.CMD.UPDATE_GROUP_COUNTER)}),body:{groupID:void 0,counterList:void 0,avChatRoomKey:void 0,mode:void 0},keyMap:{request:{counterList:"GroupCounter"}}}}(e)),this._configMap.set(Rr,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP,".").concat(V.CMD.GET_GROUP_COUNTER)}),body:{groupID:void 0,keyList:[],avChatRoomKey:void 0},keyMap:{request:{keyList:"GroupCounterKeys"}}}}(e)),this._configMap.set(ti,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP_COMMUNITY,".").concat(V.CMD.CREATE_TOPIC)}),body:{groupID:void 0,topicName:void 0,avatar:void 0,customData:void 0,topicID:void 0,notification:void 0,introduction:void 0},keyMap:{request:{avatar:"FaceUrl"}}}}(e)),this._configMap.set(ni,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP_COMMUNITY,".").concat(V.CMD.DELETE_TOPIC)}),body:{groupID:void 0,topicIDList:void 0},keyMap:{request:{topicIDList:"TopicIdList"},response:{DestroyResultItem:"resultList"}}}}(e)),this._configMap.set(oi,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP_COMMUNITY,".").concat(V.CMD.UPDATE_TOPIC_PROFILE)}),body:{groupID:void 0,topicID:void 0,avatar:void 0,customData:void 0,notification:void 0,introduction:void 0,muteAllMembers:void 0,topicName:void 0},keyMap:{request:{avatar:"FaceUrl",muteAllMembers:"ShutUpAllMember"}}}}(e)),this._configMap.set(ri,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP_COMMUNITY,".").concat(V.CMD.GET_TOPIC_LIST)}),body:{groupID:void 0,topicIDList:void 0,MemberInfoFilter:["NoUnreadSeqList"]},keyMap:{request:{topicIDList:"TopicIdList"},response:{TopicAndSelfInfo:"topicInfoList",TopicInfo:"topic",GroupID:"groupID",ShutUpTime:"muteTime",ShutUpAllFlag:"muteAllMembers",LastMsgTime:"lastMessageTime",MsgSeq:"readedSequence",LastMsgSeq:"sequence",NoUnreadSeqList:"excludedUnreadSequenceList"}}}}(e)),this._configMap.set(Or,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP,".").concat(V.CMD.GET_GROUP_MEMBER_LIST)}),body:{groupID:void 0,limit:0,offset:void 0,next:void 0,memberRoleFilter:void 0,memberInfoFilter:["Role","NameCard","ShutUpUntil","JoinTime"],memberCustomFieldFilter:void 0},keyMap:{request:{memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember"},response:{AppMemberDefinedData:"memberCustomField",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",MemberList:"members",ShutUpUntil:"muteUntil"}}}}(e)),this._configMap.set(Nr,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP_AVCHATROOM,".").concat(V.CMD.GET_AVCHATROOM_MEMBER_LIST)}),body:{groupID:void 0,offset:void 0,filter:void 0},keyMap:{request:{offset:"Timestamp",filter:"Mark"},response:{NextTimestamp:"offset"}}}}(e)),this._configMap.set(wr,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP,".").concat(V.CMD.GET_GROUP_MEMBER_INFO)}),body:{groupID:void 0,userIDList:void 0,memberInfoFilter:void 0,memberCustomFieldFilter:void 0},keyMap:{request:{userIDList:"Member_List_Account",memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember"},response:{MemberList:"members",ShutUpUntil:"muteUntil",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",AppMemberDefinedData:"memberCustomField"}}}}(e)),this._configMap.set(br,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP,".").concat(V.CMD.ADD_GROUP_MEMBER)}),body:{groupID:void 0,silence:void 0,userIDList:void 0},keyMap:{request:{userID:"Member_Account",userIDList:"MemberList"},response:{MemberList:"members"}}}}(e)),this._configMap.set(Ur,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP,".").concat(V.CMD.DELETE_GROUP_MEMBER)}),body:{groupID:void 0,userIDList:void 0,reason:void 0},keyMap:{request:{userIDList:"MemberToDel_Account"}}}}(e)),this._configMap.set(Pr,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP,".").concat(V.CMD.BAN_AVCHATROOM_MEMBER)}),body:{groupID:void 0,userIDList:void 0,duration:void 0,reason:""},keyMap:{request:{userIDList:"Members_Account",duration:"Duration",reason:"Description"}}}}(e)),this._configMap.set(Gr,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP,".").concat(V.CMD.MODIFY_GROUP_MEMBER_INFO)}),body:{groupID:void 0,topicID:void 0,userID:void 0,messageRemindType:void 0,nameCard:void 0,role:void 0,memberCustomField:void 0,muteTime:void 0},keyMap:{request:{userID:"Member_Account",memberCustomField:"AppMemberDefinedData",muteTime:"ShutUpTime",messageRemindType:"MsgFlag"}}}}(e)),this._configMap.set(xr,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.GROUP_AVCHATROOM,".").concat(V.CMD.MARK_AVCHATROOM_MEMBER_INFO)}),body:{groupID:void 0,operationType:1,memberList:[]},keyMap:{request:{operationType:"CommandType",memberList:"MemberList",markType:"Marks",userID:"Member_Account"},response:{CommandType:"operationType",Marks:"markType",Member_Account:"userID"}}}}(e)),this._configMap.set(Vr,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.IM_OPEN_STAT,".").concat(V.CMD.TIM_WEB_REPORT_V2)}),body:{header:{},event:[],quality:[]},keyMap:{request:{SDKType:"sdk_type",SDKVersion:"sdk_version",deviceType:"device_type",platform:"platform",instanceID:"instance_id",traceID:"trace_id",SDKAppID:"sdk_app_id",userID:"user_id",tinyID:"tiny_id",extension:"extension",timestamp:"timestamp",networkType:"network_type",eventType:"event_type",code:"error_code",message:"error_message",moreMessage:"more_message",duplicate:"duplicate",costTime:"cost_time",level:"level",qualityType:"quality_type",reportIndex:"report_index",wholePeriod:"whole_period",totalCount:"total_count",rttCount:"success_count_business",successRateOfRequest:"percent_business",countLessThan1Second:"success_count_business",percentOfCountLessThan1Second:"percent_business",countLessThan3Second:"success_count_platform",percentOfCountLessThan3Second:"percent_platform",successCountOfBusiness:"success_count_business",successRateOfBusiness:"percent_business",successCountOfPlatform:"success_count_platform",successRateOfPlatform:"percent_platform",successCountOfMessageReceived:"success_count_business",successRateOfMessageReceived:"percent_business",avgRTT:"average_value",avgDelay:"average_value",avgValue:"average_value",uiPlatform:"ui_platform"}}}}(o)),this._configMap.set(Kr,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.HEARTBEAT,".").concat(V.CMD.ALIVE)}),body:{}}}(e)),this._configMap.set(Hr,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.IM_OPEN_PUSH,".").concat(V.CMD.MESSAGE_PUSH)}),body:{},keyMap:{response:{C2cMsgArray:"C2CMessageArray",GroupMsgArray:"groupMessageArray",GroupTips:"groupTips",C2cNotifyMsgArray:"C2CNotifyMessageArray",C2cMsgInfo:"C2CReadReceiptArray",ClientSeq:"clientSequence",MsgPriority:"priority",NoticeSeq:"noticeSequence",MsgContent:"content",MsgType:"type",MsgBody:"elements",ToGroupId:"to",Desc:"description",Ext:"extension",IsSyncMsg:"isSyncMessage",Flag:"needSync",NeedAck:"needAck",PendencyAdd_Account:"userID",ProfileImNick:"nick",PendencyType:"applicationType",C2CReadAllMsg:"readAllC2CMessage",IsNeedReadReceipt:"needReadReceipt",Status:"statusType"}}}}(e)),this._configMap.set(jr,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.IM_OPEN_PUSH,".").concat(V.CMD.MULTI_MESSAGE_PUSH)}),body:{},keyMap:{response:{GroupMsgArray:"groupMessageArray",GroupTips:"groupTips",ClientSeq:"clientSequence",MsgPriority:"priority",NoticeSeq:"noticeSequence",MsgContent:"content",MsgType:"type",MsgBody:"elements",ToGroupId:"to",Desc:"description",Ext:"extension",IsSyncMsg:"isSyncMessage",Flag:"needSync",NeedAck:"needAck",PendencyType:"applicationType"}}}}(e)),this._configMap.set(zr,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.OPEN_IM,".").concat(V.CMD.MESSAGE_PUSH_ACK)}),body:{sessionData:void 0},keyMap:{request:{sessionData:"SessionData"}}}}(e)),this._configMap.set(Wr,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.IM_OPEN_STATUS,".").concat(V.CMD.STATUS_FORCE_OFFLINE)}),body:{},keyMap:{response:{C2cNotifyMsgArray:"C2CNotifyMessageArray",NoticeSeq:"noticeSequence",KickoutMsgNotify:"kickoutMsgNotify",NewInstInfo:"newInstanceInfo"}}}}(e)),this._configMap.set($r,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.IM_LONG_MESSAGE,".").concat(V.CMD.DOWNLOAD_MERGER_MESSAGE)}),body:{downloadKey:""},keyMap:{response:{Data:"data",Desc:"description",Ext:"extension",Download_Flag:"downloadFlag",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID"}}}}(e)),this._configMap.set(Yr,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.IM_LONG_MESSAGE,".").concat(V.CMD.UPLOAD_MERGER_MESSAGE)}),body:{messageList:[]},keyMap:{request:{fromAccount:"From_Account",toAccount:"To_Account",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom",msgBody:"MsgBody",type:"MsgType",content:"MsgContent",data:"Data",description:"Desc",extension:"Ext",sizeType:"Type",uuid:"UUID",url:"",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",from:"From_Account",time:"MsgTimeStamp",messageRandom:"MsgRandom",messageSequence:"MsgSeq",elements:"MsgBody",clientSequence:"ClientSeq",payload:"MsgContent",messageList:"MsgList",messageNumber:"MsgNum",abstractList:"AbstractList",messageBody:"MsgBody"}}}}(e)),this._configMap.set(di,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.IM_OPEN_STATUS,".").concat(V.CMD.SET_TOKEN)}),body:{tokenID:"",pushMsg:0,sdkAppID:0,businessID:"",deviceBrand:"",deviceToken:"",isTpns:0,isWebUniapp:0},keyMap:{request:{tokenID:"TokenID",pushMsg:"PushMsg",sdkAppID:"EnterVersion",businessID:"BusiID",deviceBrand:"InstType",deviceToken:"VarToken",isTpns:"IsTpns"}}}}(e)),this._configMap.set(li,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.IM_OPEN_STATUS,".").concat(V.CMD.STAT_FOREGROUND)}),body:{isWebUniapp:0}}}(e)),this._configMap.set(ui,function(e){return{head:n(n({},e),{},{servcmd:"".concat(V.NAME.IM_OPEN_STATUS,".").concat(V.CMD.STAT_BACKGROUND)}),body:{C2CUnread:0,GroupUnread:0,isWebUniapp:0},keyMap:{request:{c2cUnreadCount:"C2cUnread",groupUnreadCount:"GrpUnread"}}}}(e))}},{key:"has",value:function(e){return this._configMap.has(e)}},{key:"get",value:function(e){return this._configMap.get(e)}},{key:"update",value:function(){this._fillConfigMap()}},{key:"getKeyMap",value:function(e){return this.has(e)?this.get(e).keyMap||{}:(Ve.w("".concat(this._n,".getKeyMap unknown protocolName:").concat(e)),{})}},{key:"getProtocolData",value:function(e){var t=e.protocolName,n=e.requestData,o=this.get(t),r=null;if(n){var i=this._simpleDeepCopy(o),s=this._updateService(n,i),a=s.body,c=Object.create(null);for(var u in a)if(Object.prototype.hasOwnProperty.call(a,u)){if(c[u]=a[u],void 0===n[u])continue;c[u]=n[u]}s.body=c,r=this._getUplinkData(s)}else r=this._getUplinkData(o);return r}},{key:"_getUplinkData",value:function(e){var t=this._requestDataCleaner(e),n=Gt(t.head),o=Sa(t.body,this._getRequestKeyMap(n));return t.body=o,t}},{key:"_updateService",value:function(e,t){var n=Gt(t.head);if(this._isFromGroupRequest(t)){var o=e.type,r=e.groupID,i=void 0===r?void 0:r,s=e.groupIDList,a=void 0===s?[]:s;at(i)&&(i=a[0]||""),kt({type:o,groupID:i})&&(t.head.servcmd="".concat(V.NAME.GROUP_COMMUNITY,".").concat(n))}return t}},{key:"_isFromGroupRequest",value:function(e){return e.head.servcmd.includes(V.NAME.GROUP)||e.head.servcmd.includes(V.NAME.GROUP_ATTR)}},{key:"_getRequestKeyMap",value:function(e){var t=this.getKeyMap(e);return n(n({},Ea.request),t.request)}},{key:"_requestDataCleaner",value:function(e){var t=Array.isArray(e)?[]:Object.create(null);for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&pt(n)&&null!==e[n]&&void 0!==e[n]&&("object"!==o(e[n])?t[n]=e[n]:t[n]=this._requestDataCleaner.bind(this)(e[n]));return t}},{key:"_simpleDeepCopy",value:function(e){for(var t,n=Object.keys(e),o={},r=0,i=n.length;r<i;r++)t=n[r],st(e[t])?o[t]=Array.from(e[t]):rt(e[t])?o[t]=this._simpleDeepCopy(e[t]):o[t]=e[t];return o}}]),e}(),za=[zr],Wa=function(){function e(t){r(this,e),this._sessionModule=t,this._n="DownlinkHandler",this._eventHandlerMap=new Map,this._eventHandlerMap.set("C2CMessageArray",this._c2cMessageArrayHandler.bind(this)),this._eventHandlerMap.set("groupMessageArray",this._groupMessageArrayHandler.bind(this)),this._eventHandlerMap.set("groupTips",this._groupTipsHandler.bind(this)),this._eventHandlerMap.set("C2CNotifyMessageArray",this._C2CNotifyMessageArrayHandler.bind(this)),this._eventHandlerMap.set("C2CReadReceiptArray",this._C2CReadReceiptArrayHandler.bind(this)),this._eventHandlerMap.set("profileModify",this._profileHandler.bind(this)),this._eventHandlerMap.set("friendListMod",this._relationChainHandler.bind(this)),this._eventHandlerMap.set("recentContactMod",this._recentContactHandler.bind(this)),this._eventHandlerMap.set("readAllC2CMessage",this._allMessageReadHandler.bind(this)),this._eventHandlerMap.set("c2cMessageModified",this._c2cMessageModifiedHandler.bind(this)),this._eventHandlerMap.set("groupMessageModified",this._groupMessageModifiedHandler.bind(this)),this._eventHandlerMap.set("userStatusList",this._userStatusListHandler.bind(this)),this._eventHandlerMap.set("messageExtensionNotify",this._messageExtensionNotifyHandler.bind(this)),this._keys=y(this._eventHandlerMap.keys())}return s(e,[{key:"_c2cMessageArrayHandler",value:function(e){var t=this._sessionModule.getModule(Un);t&&(e.dataList.forEach((function(e){if(1===e.isSyncMessage){var t=e.from;e.from=e.to,e.to=t}})),1===e.needSync&&this._sessionModule.getModule(Yn).startOnlineSync(),t.onNewC2CMessage({dataList:e.dataList,isInstantMessage:!0}))}},{key:"_c2cMessageModifiedHandler",value:function(e){var t=this._sessionModule.getModule(Un);t&&t.onC2CMessageModified(e)}},{key:"_groupMessageArrayHandler",value:function(e){var t=this._sessionModule.getModule(Pn);t&&t.onNewGroupMessage({event:e.event,dataList:e.dataList,isInstantMessage:!0})}},{key:"_groupMessageModifiedHandler",value:function(e){var t=this._sessionModule.getModule(Pn);t&&t.onGroupMessageModified(e)}},{key:"_groupTipsHandler",value:function(e){var t=this._sessionModule.getModule(Pn);if(t){var n=e.event,o=e.dataList,r=e.isInstantMessage,i=void 0===r||r,s=e.isSyncingEnded;switch(n){case 4:case 6:t.onNewGroupTips({event:n,dataList:o});break;case 5:for(var a=0;a<o.length;a++)if(st(o[a].elements.revokedInfos))t.onGroupMessageRevoked({dataList:o});else if(st(o[a].elements.groupMessageReadNotice))t.onGroupMessageReadNotice({dataList:o});else{if(!st(o[a].elements.readReceiptList)){t.onNewGroupSystemNotice({dataList:o,isInstantMessage:i,isSyncingEnded:s});break}t.onReadReceiptList({dataList:o})}break;case 12:this._sessionModule.getModule(qn).onNewGroupAtTips({dataList:o});break;default:Ve.l("".concat(this._n,"._groupTipsHandler unknown event:").concat(n," dataList:"),o)}}}},{key:"_C2CNotifyMessageArrayHandler",value:function(e){var t=this,n=e.dataList;if(st(n)){var o=this._sessionModule.getModule(Un);n.forEach((function(e){if(it(e))if(e.hasOwnProperty("kickoutMsgNotify")){var r=e.kickoutMsgNotify,i=r.kickType,s=r.newInstanceInfo,a=void 0===s?{}:s;1===i?t._sessionModule.onMultipleAccountKickedOut(a):2===i?t._sessionModule.onMultipleDeviceKickedOut(a):3===i&&t._sessionModule.onRestApiKickedOut(a)}else e.hasOwnProperty("c2cMessageRevokedNotify")?o&&o.onC2CMessageRevoked({dataList:n}):e.hasOwnProperty("c2cMessageReadReceipt")?o&&o.onC2CMessageReadReceipt({dataList:n}):e.hasOwnProperty("c2cMessageReadNotice")?o&&o.onC2CMessageReadNotice({dataList:n}):e.hasOwnProperty("muteNotificationsSync")&&t._sessionModule.getModule(qn).onC2CMessageRemindTypeSynced({dataList:n})}))}}},{key:"_C2CReadReceiptArrayHandler",value:function(e){this._sessionModule.getModule(Un).onReadReceiptList(e)}},{key:"_profileHandler",value:function(e){this._sessionModule.getModule(bn).onProfileModified({dataList:e.dataList});var t=this._sessionModule.getModule(Gn);t&&t.onFriendProfileModified({dataList:e.dataList})}},{key:"_relationChainHandler",value:function(e){this._sessionModule.getModule(bn).onRelationChainModified({dataList:e.dataList});var t=this._sessionModule.getModule(Gn);t&&t.onRelationChainModified({dataList:e.dataList})}},{key:"_recentContactHandler",value:function(e){var t=e.dataList;if(st(t)){var n=this._sessionModule.getModule(qn);n&&t.forEach((function(e){var t=e.pushType;if(1===t){var o=e.recentContactDeleteItem;n.onConversationDeleted(o.recentContactList)}else if(2===t){var r=e.recentContactTopItem;n.onConversationPinned(r.recentContactList)}else if(3===t){var i=e.recentContactTopItem;n.onConversationUnpinned(i.recentContactList)}else if(4===t){var s=e.recentContactMarkContact;n.onConversationMarkUpdated(s.recentContactMarkContactItem)}else if(5===t){var a=e.recentContactCreateContactGroup;n.onConversationGroupCreated(a.msgContactGroupContactItem)}else if(6===t){var c=e.recentContactDelContactGroup;n.onConversationGroupDeleted(c.msgGroupItem)}else if(7===t){var u=e.recentContactUpdateContactGroup,l=u.updateType,d=u.msgUpdateGroup,p=u.msgUpdateContact;if(1===l){var h=d.updateGroupType;1===h?n.onConversationGroupNameUpdated(d):2===h&&n.onConversationInGroupUpdated(d)}else 2===l&&n.onConversationAddedToOrDeletedFromGroup(p)}}))}}},{key:"_allMessageReadHandler",value:function(e){var t=e.dataList,n=this._sessionModule.getModule(qn);n&&n.onPushedAllMessageRead(t)}},{key:"_userStatusListHandler",value:function(e){this._sessionModule.getModule(bn).onUserStatusUpdated(e)}},{key:"_messageExtensionNotifyHandler",value:function(e){this._sessionModule.getModule(wn).onMessageExtensionNotify(e)}},{key:"onMessage",value:function(e){var t=this,n=e.body;if(this._filterMessageFromIMOpenPush(e)){var o=n.eventArray,r=n.isInstantMessage,i=n.isSyncingEnded,s=n.needSync;if(st(o))for(var a=null,c=null,u=0,l=0,d=o.length;l<d;l++){u=(a=o[l]).event;var p=Object.keys(a).find((function(e){return-1!==t._keys.indexOf(e)}));p?(c=14===u?{readAllC2CMessage:a[p],groupMessageReadInfoList:a.groupMessageReadNotice||[]}:16===u?{userID:a.userID,readReceiptList:a[p]}:a[p],this._eventHandlerMap.get(p)({event:u,dataList:c,isInstantMessage:r,isSyncingEnded:i,needSync:s})):Ve.l("".concat(this._n,".onMessage unknown eventItem:").concat(a))}}}},{key:"_filterMessageFromIMOpenPush",value:function(e){var t=e.head,n=e.body,o=t.servcmd,r=!1;if(at(o)||(r=o.includes(V.NAME.IM_CONFIG_MANAGER)||o.includes(V.NAME.OVERLOAD_PUSH)||o.includes(V.NAME.STAT_SERVICE)),!r)return!0;if(o.includes(V.CMD.PUSHED_CLOUD_CONTROL_CONFIG))this._sessionModule.getModule(Zn).onPushedCloudControlConfig(n);else if(o.includes(V.CMD.PUSHED_COMMERCIAL_CONFIG))this._sessionModule.getModule(no).onPushedConfig(n);else if(o.includes(V.CMD.OVERLOAD_NOTIFY))this._sessionModule.onPushedServerOverload(n);else if(o.includes(V.CMD.KICK_OTHER)){var i=Date.now();this._sessionModule.reLoginOnKickOther();var s=new Ai("kickOther"),a=this._sessionModule.getModule(On).getLastWsHelloTs(),c=i-a;s.setMessage("last wshello time:".concat(a," diff:").concat(c,"ms")).setNetworkType(this._sessionModule.getNetworkType()).end()}return!1}}]),e}(),Ya=[{cmd:V.CMD.GET_GROUP_INFO,interval:1,count:20},{cmd:V.CMD.GET_AVCHATROOM_MEMBER_LIST,interval:3,count:1},{cmd:V.CMD.GET_GROUP_APPLICATION,interval:1,count:15},{cmd:V.CMD.GET_TOPIC_LIST,interval:1,count:10},{cmd:V.CMD.SET_GROUP_ATTRIBUTES,interval:5,count:10},{cmd:V.CMD.MODIFY_GROUP_ATTRIBUTES,interval:5,count:10},{cmd:V.CMD.DELETE_GROUP_ATTRIBUTES,interval:5,count:10},{cmd:V.CMD.CLEAR_GROUP_ATTRIBUTES,interval:5,count:10},{cmd:V.CMD.GET_GROUP_ATTRIBUTES,interval:5,count:20},{cmd:V.CMD.UPDATE_GROUP_COUNTER,interval:5,count:20},{cmd:V.CMD.GET_GROUP_COUNTER,interval:5,count:20},{cmd:V.CMD.SET_ALL_MESSAGE_READ,interval:1,count:1},{cmd:V.CMD.GET_USER_STATUS,interval:5,count:20},{cmd:V.CMD.SUBSCRIBE_USER_STATUS,interval:5,count:20},{cmd:V.CMD.UNSUBSCRIBE_USER_STATUS,interval:5,count:20}],$a=function(e){c(o,e);var t=m(o);function o(e){var n;return r(this,o),(n=t.call(this,e))._n="SessionModule",n._platform=n.getPlatform(),n._protocolHandler=new ja(f(n)),n._messageDispatcher=new Wa(f(n)),n._commandFrequencyLimitMap=new Map,n._commandRequestInfoMap=new Map,n._serverOverloadInfoMap=new Map,n._init(),n.getInnerEmitterInstance().on(ns,n._onCloudConfigUpdated,f(n)),n}return s(o,[{key:"_init",value:function(){this._updateCommandFrequencyLimitMap(Ya)}},{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("cmd_frequency_limit");at(e)||(e=JSON.parse(e),this._updateCommandFrequencyLimitMap(e))}},{key:"_updateCommandFrequencyLimitMap",value:function(e){var t=this;e.forEach((function(e){t._commandFrequencyLimitMap.set(e.cmd,{interval:e.interval,count:e.count})}))}},{key:"updateProtocolConfig",value:function(){this._protocolHandler.update()}},{key:"request",value:function(e){Ve.d("".concat(this._n,".request options:"),e);var t=e.protocolName,n=e.tjgID;if(!this._protocolHandler.has(t))return Ve.w("".concat(this._n,".request unknown protocol:").concat(t)),Xi({code:gi.CANNOT_FIND_PROTOCOL});var o=this.getProtocolData(e),r=o.head.servcmd;if(this._isFrequencyOverLimit(r))return Xi({code:gi.OVER_FREQUENCY_LIMIT});if(this._isServerOverload(r))return Xi({code:gi.OPEN_SERVICE_OVERLOAD_ERROR});$t(n)||(o.head.tjgID=n);var i=this.getModule(Jn);return za.includes(t)?i.simplySend(o):i.send(o)}},{key:"getKeyMap",value:function(e){return this._protocolHandler.getKeyMap(e)}},{key:"genCommonHead",value:function(){var e=this.getModule(Bn);return{ver:"v4",platform:this._platform,websdkappid:w,websdkversion:N,a2:e.getA2Key()||void 0,tinyid:e.getTinyID()||void 0,status_instid:e.getStatusInstanceID(),sdkappid:e.getSDKAppID(),contenttype:e.getContentType(),reqtime:0,identifier:e.getA2Key()?void 0:e.getUserID(),usersig:e.getA2Key()?void 0:e.getUserSig(),sdkability:192371,tjgID:""}}},{key:"genCosSpecifiedHead",value:function(){var e=this.getModule(Bn);return{ver:"v4",platform:this._platform,websdkappid:w,websdkversion:N,sdkappid:e.getSDKAppID(),contenttype:e.getContentType(),reqtime:0,identifier:e.getUserID(),usersig:e.getUserSig(),status_instid:e.getStatusInstanceID(),sdkability:192371}}},{key:"genSSOReportHead",value:function(){var e=this.getModule(Bn);return{ver:"v4",platform:this._platform,websdkappid:w,websdkversion:N,sdkappid:e.getSDKAppID(),contenttype:"",reqtime:0,identifier:"",usersig:"",status_instid:e.getStatusInstanceID(),sdkability:192371}}},{key:"getProtocolData",value:function(e){return this._protocolHandler.getProtocolData(e)}},{key:"trans",value:function(e){var t=e.servcmd,o=e.data,r={head:n(n({},this.genCommonHead()),{},{servcmd:t}),body:o};return this.getModule(Jn).send(r)}},{key:"sendComboMessage",value:function(e){var t=e.servcmd,o=e.data,r={head:n(n({},this.genCommonHead()),{},{servcmd:t}),body:o};return this.getModule(Jn).send(r)}},{key:"onErrorCodeNotZero",value:function(e){var t=e.errorCode;if(t===gi.HELLO_ANSWER_KICKED_OUT){var n=e.kickType,o=e.newInstanceInfo,r=void 0===o?{}:o;1===n?this.onMultipleAccountKickedOut(r):2===n?this.onMultipleDeviceKickedOut(r):3===n&&this.onRestApiKickedOut(r)}t!==gi.MESSAGE_A2KEY_EXPIRED&&t!==gi.ACCOUNT_A2KEY_EXPIRED||(this._onUserSigExpired(),this.getModule(Jn).reConnect())}},{key:"onMessage",value:function(e){var t=e.body,n=t.needAck,o=void 0===n?0:n,r=t.sessionData;1===o&&this._sendACK(r),this._messageDispatcher.onMessage(e)}},{key:"onReconnected",value:function(){this._reLoginOnReconnected()}},{key:"reLoginOnKickOther",value:function(){Ve.l("".concat(this._n,".reLoginOnKickOther")),this._reLogin()}},{key:"_reLoginOnReconnected",value:function(){Ve.l("".concat(this._n,"._reLoginOnReconnected")),this._reLogin()}},{key:"_reLogin",value:function(){var e=this;if(this.isLoggedIn()){var t=0,n=this.getModule(oo);n.canIUseOfflinePush()&&(t=n.getUniAppPlatform()),this.request({protocolName:uo,requestData:{isWebUniapp:t}}).then((function(t){var n=t.data.instanceID;e.getModule(Bn).setStatusInstanceID(n),Ve.l("".concat(e._n,"._reLogin ok.")),e.getModule(qn).syncConversationList().then((function(){Ve.l("".concat(e._n,"._reLogin, sync conversation list ok.")),e.getModule(eo).start()})),e.getModule(Pn).updateLocalMainSequenceOnReconnected();var o=e.getModule(Fn);o.resetGetTopicTime(),o.getTopicListOnReconnected()}))}}},{key:"onMultipleAccountKickedOut",value:function(e){this.getModule(On).onMultipleAccountKickedOut(e)}},{key:"onMultipleDeviceKickedOut",value:function(e){this.getModule(On).onMultipleDeviceKickedOut(e)}},{key:"_onUserSigExpired",value:function(){this.getModule(On).onUserSigExpired()}},{key:"onRestApiKickedOut",value:function(e){this.getModule(On).onRestApiKickedOut(e)}},{key:"_sendACK",value:function(e){this.request({protocolName:zr,requestData:{sessionData:e}})}},{key:"_isFrequencyOverLimit",value:function(e){var t=e.split(".")[1];if(!this._commandFrequencyLimitMap.has(t))return!1;if(!this._commandRequestInfoMap.has(t))return this._commandRequestInfoMap.set(t,{startTime:Date.now(),requestCount:1}),!1;var n=this._commandFrequencyLimitMap.get(t),o=n.count,r=n.interval,i=this._commandRequestInfoMap.get(t),s=i.startTime,a=i.requestCount;if(Date.now()-s>1e3*r)return this._commandRequestInfoMap.set(t,{startTime:Date.now(),requestCount:1}),!1;a+=1,this._commandRequestInfoMap.set(t,{startTime:s,requestCount:a});var c=!1;return a>o&&(c=!0),c}},{key:"_isServerOverload",value:function(e){if(!this._serverOverloadInfoMap.has(e))return!1;var t=this._serverOverloadInfoMap.get(e),n=t.overloadTime,o=t.waitingTime,r=!1;return Date.now()-n<=1e3*o?r=!0:(this._serverOverloadInfoMap.delete(e),r=!1),r}},{key:"onPushedServerOverload",value:function(e){var t=e.overloadCommand,n=e.waitingTime;this._serverOverloadInfoMap.set(t,{overloadTime:Date.now(),waitingTime:n}),Ve.w("".concat(this._n,".onPushedServerOverload waitingTime:").concat(n,"s"))}},{key:"reset",value:function(){Ve.l("".concat(this._n,".reset")),this._updateCommandFrequencyLimitMap(Ya),this._commandRequestInfoMap.clear(),this._serverOverloadInfoMap.clear()}}]),o}(co),Ja=function(e){c(n,e);var t=m(n);function n(e){var o;return r(this,n),(o=t.call(this,e))._n="MessageLossDetectionModule",o._maybeLostSequencesMap=new Map,o._firstRoundRet=[],o}return s(n,[{key:"onMessageMaybeLost",value:function(e,t,n){this._maybeLostSequencesMap.has(e)||this._maybeLostSequencesMap.set(e,[]);for(var o=this._maybeLostSequencesMap.get(e),r=0;r<n;r++)-1===o.indexOf(t+r)&&o.push(t+r)}},{key:"detectFirstRound",value:function(e,t){var n=this._maybeLostSequencesMap.get(e);if(!$t(n)&&!$t(t)){var o=n.filter((function(e){return-1===t.indexOf(e)}));0===o.length?Ve.i("".concat(this._n,".detectFirstRound no message loss. conversationID:").concat(e)):this._firstRoundRet=this._firstRoundRet.concat(o),n.length=0}}},{key:"detectSecondRound",value:function(e,t){if(!$t(this._firstRoundRet)&&!$t(t)){var n=this._firstRoundRet.filter((function(e){return-1===t.indexOf(e)}));this._firstRoundRet.length=0;var o,r=n.length;0!==r&&(r<=5?o=e+"-"+n.join("-"):(n.sort((function(e,t){return e-t})),o=e+" start:"+n[0]+" end:"+n[r-1]+" count:"+r),new Ai("messageLoss").setMessage(o).setNetworkType(this.getNetworkType()).setLevel("warning").end(),Ve.i("".concat(this._n,".detectSecondRound message loss detected. conversationID:").concat(e," lostSequences:").concat(n)))}}},{key:"reset",value:function(){Ve.l("".concat(this._n,".reset")),this._maybeLostSequencesMap.clear(),this._firstRoundRet.length=0}}]),n}(co),Xa=function(e){c(n,e);var t=m(n);function n(e){var o;return r(this,n),(o=t.call(this,e))._n="CloudControlModule",o._cloudConfig=new Map,o._expiredTime=0,o._version=0,o._isFetching=!1,o}return s(n,[{key:"getCloudConfig",value:function(e){return at(e)?this._cloudConfig:this._cloudConfig.has(e)?this._cloudConfig.get(e):void 0}},{key:"_canFetchConfig",value:function(){return this.isLoggedIn()&&!this._isFetching&&Date.now()>=this._expiredTime}},{key:"fetchConfig",value:function(){var e=this,t=this._canFetchConfig();if(Ve.l("".concat(this._n,".fetchConfig canFetchConfig:").concat(t)),t){var n=new Ai("fetchCloudControlConfig"),o=this.getModule(Bn).getSDKAppID();this._isFetching=!0,this.request({protocolName:Jr,requestData:{SDKAppID:o,version:this._version}}).then((function(t){e._isFetching=!1,n.setMessage("version:".concat(e._version," newVersion:").concat(t.data.version," config:").concat(t.data.cloudControlConfig)).setNetworkType(e.getNetworkType()).end(),Ve.l("".concat(e._n,".fetchConfig ok")),e._parseCloudControlConfig(t.data)})).catch((function(t){e._isFetching=!1,e.probeNetwork().then((function(e){var o=v(e,2),r=o[0],i=o[1];n.setError(t,r,i).end()})),Ve.l("".concat(e._n,".fetchConfig failed. error:"),t),e._setExpiredTimeOnResponseError(12e4)}))}}},{key:"onPushedCloudControlConfig",value:function(e){Ve.l("".concat(this._n,".onPushedCloudControlConfig")),new Ai("pushedCloudControlConfig").setNetworkType(this.getNetworkType()).setMessage("newVersion:".concat(e.version," config:").concat(e.cloudControlConfig)).end(),this._parseCloudControlConfig(e)}},{key:"onCheckTimer",value:function(e){this._canFetchConfig()&&this.fetchConfig()}},{key:"_parseCloudControlConfig",value:function(e){var t=this,n="".concat(this._n,"._parseCloudControlConfig"),o=e.errorCode,r=e.errorMessage,i=e.cloudControlConfig,s=e.version,a=e.expiredTime;if(0===o){if(this._version!==s){var c=null;try{c=JSON.parse(i)}catch(u){this.isPrivateNetWork()||Ve.e("".concat(n," JSON parse error. cloudControlConfig:"),i)}c&&(this._cloudConfig.clear(),Object.keys(c).forEach((function(e){t._cloudConfig.set(e,c[e])})),this._version=s,this.emitInnerEvent(ns))}this._expiredTime=Date.now()+1e3*a}else at(o)?(Ve.l("".concat(n," failed. Invalid message format:"),e),this._setExpiredTimeOnResponseError(36e5)):(Ve.e("".concat(n," errorCode:").concat(o," errorMessage:").concat(r)),this._setExpiredTimeOnResponseError(12e4))}},{key:"_setExpiredTimeOnResponseError",value:function(e){this._expiredTime=Date.now()+e}},{key:"reset",value:function(){Ve.l("".concat(this._n,".reset")),this._cloudConfig.clear(),this._expiredTime=0,this._version=0,this._isFetching=!1}}]),n}(co),Za=function(e){c(n,e);var t=m(n);function n(e){var o;return r(this,n),(o=t.call(this,e))._n="RecoverMessageModule",o.PULL_LIMIT_COUNT=15,o}return s(n,[{key:"start",value:function(){this._recoverGroupChat(),this._recoverC2CChat()}},{key:"_recoverGroupChat",value:function(){var e,t,n=this,o=this._getLocalConversationList().filter((function(e){return e.type===S.CONV_GROUP&&e.groupProfile.type!==S.GRP_AVCHATROOM})),r=this.getModule(qn),i=0,s=0,a=0;o.forEach((function(o){var c=o.conversationID,u=o.lastMessage;t=c.replace(S.CONV_GROUP,""),e=r.getLocalLastMessage(c),u&&0!==u.lastSequence&&e?(s=u.lastSequence,i=e.sequence,a=s-i,i>0&&a>=1&&a<300?n._recoverGroupMessage({groupID:t,localLastMessageSequence:i,remoteLastMessageSequence:s}):n._getGroupNotify(t)):n._getGroupNotify(t)}))}},{key:"_recoverC2CChat",value:function(){var e,t=this,n=this._getLocalConversationList().filter((function(e){return e.type===S.CONV_C2C})),o=this.getModule(qn),r=0,i=0,s=0,a=[Promise.resolve()];n.forEach((function(n){var c=n.conversationID,u=n.lastMessage;e=o.getLocalLastMessage(c),u&&0!==u.lastTime&&e&&(i=u.lastTime,r=e.time,s=i-r,r>0&&s>=1&&s<=600&&a.push(t._recoverC2CMessage({conversationID:c,localLastMessageTime:r,remoteLastMessageTime:i})))})),Promise.all(a).then((function(){Ve.l("".concat(t._n,"._recoverC2CChat all promise fulfilled, start to sync unread messages")),t.getModule(Yn).startSyncOnReconnected()}))}},{key:"_getLocalConversationList",value:function(){return this.getModule(qn).getLocalConversationList()}},{key:"_recoverGroupMessage",value:function(e){var t=this,n="".concat(this._n,"._recoverGroupMessage");Ve.l("".concat(n," options:"),e);var o=e.groupID,r=e.localLastMessageSequence,i=e.remoteLastMessageSequence;this._getGroupRomaingMessage({groupID:o,sequence:r}).then((function(e){var r=e.data,s=r.complete,a=r.messageList;if(!at(a)){var c=a[0].sequence;Ve.l("".concat(n," pkgLastMessageSequence:").concat(c," complete:").concat(s)),c<i&&2!==s&&t._recoverGroupMessage({groupID:o,localLastMessageSequence:c,remoteLastMessageSequence:i}),new Ai("recoverMessage").setNetworkType(t.getNetworkType()).setMessage("groupID:".concat(o," complete:").concat(s," messageList length:").concat(a.length)).end();var u=t.getModule(Pn);a.length>1&&a.sort((function(e,t){return e.sequence-t.sequence}));for(var l=0;l<a.length;l++){var d=a[l];d.from!==S.CONV_SYSTEM?u.onNewGroupMessage({dataList:[d],isInstantMessage:!1,updateUnreadCount:!1}):u.onNewGroupTips({event:d.event,dataList:[d]})}t._getGroupNotify(o)}}))}},{key:"_getGroupNotify",value:function(e){this.getModule(Pn).getGroupNotify(e)}},{key:"_getGroupRomaingMessage",value:function(e){var t=e.groupID,n=e.sequence;return this.request({protocolName:ur,requestData:{groupID:t,count:this.PULL_LIMIT_COUNT,sequence:n+this.PULL_LIMIT_COUNT-1}})}},{key:"_recoverC2CMessage",value:function(e){var t=this,n="".concat(this._n,"._recoverC2CMessage");Ve.l("".concat(this._n,"._recoverC2CMessage options:"),e);var o=e.conversationID,r=e.localLastMessageTime,i=e.remoteLastMessageTime;return this._getC2CRoamingMessage({conversationID:o,time:r}).then((function(e){var r=e.data,s=r.complete,a=r.messageList;if(!at(a)){var c=a.length;new Ai("recoverMessage").setNetworkType(t.getNetworkType()).setMessage("".concat(o," complete:").concat(s," messageList length:").concat(c)).end(),t.getModule(Un).onNewC2CMessage({dataList:a,isInstantMessage:!0});var u=a[c-1].time;if(Ve.l("".concat(n," pkgLastMessageTime:").concat(u," complete:").concat(s)),u<i&&1!==s)return t._recoverC2CMessage({conversationID:o,localLastMessageTime:u,remoteLastMessageTime:i})}}))}},{key:"_getC2CRoamingMessage",value:function(e){var t=e.conversationID,n=e.time;return this.request({protocolName:So,requestData:{peerAccount:t.replace(S.CONV_C2C,""),count:this.PULL_LIMIT_COUNT+1,lastMessageTime:n,direction:1}})}},{key:"reset",value:function(){Ve.l("".concat(this._n,".reset"))}}]),n}(co),Qa=function(){function e(){r(this,e),this._n="AvgE2EDelay",this._e2eDelayArray=[]}return s(e,[{key:"addMessageDelay",value:function(e){var t=xe()-e;t>=0&&this._e2eDelayArray.push(t)}},{key:"_calcAvg",value:function(e,t){if(0===t)return 0;var n=0;return e.forEach((function(e){n+=e})),xt(n/t,1)}},{key:"_calcCountWithLimit",value:function(e){var t=e.e2eDelayArray,n=e.min,o=e.max;return t.filter((function(e){return n<=e&&e<o})).length}},{key:"_calcPercent",value:function(e,t){var n=xt(e/t*100,2);return n>100&&(n=100),n}},{key:"_checkE2EDelayException",value:function(e,t){var n=e.filter((function(e){return e>t}));if(n.length>0){var o=n.length,r=Math.min.apply(Math,y(n)),i=Math.max.apply(Math,y(n)),s=this._calcAvg(n,o),a=xt(o/e.length*100,2);a>50&&new Ai("messageE2EDelayException").setMessage("count:".concat(o," min:").concat(r," max:").concat(i," avg:").concat(s," percent:").concat(a)).setLevel("warning").end()}}},{key:"getStatResult",value:function(){var e=this._e2eDelayArray.length;if(0===e)return null;var t=y(this._e2eDelayArray),n=this._calcCountWithLimit({e2eDelayArray:t,min:0,max:1}),o=this._calcCountWithLimit({e2eDelayArray:t,min:1,max:3}),r=this._calcPercent(n,e),i=this._calcPercent(o,e),s=this._calcAvg(t,e);return this._checkE2EDelayException(t,3),t.length=0,this.reset(),{totalCount:e,countLessThan1Second:n,percentOfCountLessThan1Second:r,countLessThan3Second:o,percentOfCountLessThan3Second:i,avgDelay:s}}},{key:"reset",value:function(){this._e2eDelayArray.length=0}}]),e}(),ec=function(){function e(){r(this,e),this._n="AvgRTT",this._requestCount=0,this._rttArray=[]}return s(e,[{key:"addRequestCount",value:function(){this._requestCount+=1}},{key:"addRTT",value:function(e){this._rttArray.push(e)}},{key:"_calcTotalCount",value:function(){return this._requestCount}},{key:"_calcRTTCount",value:function(e){return e.length}},{key:"_calcSuccessRateOfRequest",value:function(e,t){if(0===t)return 0;var n=xt(e/t*100,2);return n>100&&(n=100),n}},{key:"_calcAvg",value:function(e,t){if(0===t)return 0;var n=0;return e.forEach((function(e){n+=e})),parseInt(n/t)}},{key:"_calcMax",value:function(){return Math.max.apply(Math,y(this._rttArray))}},{key:"_calcMin",value:function(){return Math.min.apply(Math,y(this._rttArray))}},{key:"getStatResult",value:function(){var e=this._calcTotalCount(),t=y(this._rttArray);if(0===e)return null;var n=this._calcRTTCount(t),o=this._calcSuccessRateOfRequest(n,e),r=this._calcAvg(t,n);return Ve.l("".concat(this._n,".getStatResult max:").concat(this._calcMax()," min:").concat(this._calcMin()," avg:").concat(r)),this.reset(),{totalCount:e,rttCount:n,successRateOfRequest:o,avgRTT:r}}},{key:"reset",value:function(){this._requestCount=0,this._rttArray.length=0}}]),e}(),tc=function(){function e(){r(this,e),this._map=new Map}return s(e,[{key:"initMap",value:function(e){var t=this;e.forEach((function(e){t._map.set(e,{totalCount:0,successCount:0,failedCountOfUserSide:0,costArray:[],fileSizeArray:[]})}))}},{key:"addTotalCount",value:function(e){return!(at(e)||!this._map.has(e)||(this._map.get(e).totalCount+=1,0))}},{key:"addSuccessCount",value:function(e){return!(at(e)||!this._map.has(e)||(this._map.get(e).successCount+=1,0))}},{key:"addFailedCountOfUserSide",value:function(e){return!(at(e)||!this._map.has(e)||(this._map.get(e).failedCountOfUserSide+=1,0))}},{key:"addCost",value:function(e,t){return!(at(e)||!this._map.has(e)||(this._map.get(e).costArray.push(t),0))}},{key:"addFileSize",value:function(e,t){return!(at(e)||!this._map.has(e)||(this._map.get(e).fileSizeArray.push(t),0))}},{key:"_calcSuccessRateOfBusiness",value:function(e){if(at(e)||!this._map.has(e))return-1;var t=this._map.get(e),n=xt(t.successCount/t.totalCount*100,2);return n>100&&(n=100),n}},{key:"_calcSuccessRateOfPlatform",value:function(e){if(at(e)||!this._map.has(e))return-1;var t=this._map.get(e),n=this._calcSuccessCountOfPlatform(e)/t.totalCount*100;return(n=xt(n,2))>100&&(n=100),n}},{key:"_calcTotalCount",value:function(e){return at(e)||!this._map.has(e)?-1:this._map.get(e).totalCount}},{key:"_calcSuccessCountOfBusiness",value:function(e){return at(e)||!this._map.has(e)?-1:this._map.get(e).successCount}},{key:"_calcSuccessCountOfPlatform",value:function(e){if(at(e)||!this._map.has(e))return-1;var t=this._map.get(e);return t.successCount+t.failedCountOfUserSide}},{key:"_calcAvg",value:function(e){return at(e)||!this._map.has(e)?-1:e===Ii?this._calcAvgSpeed(e):this._calcAvgCost(e)}},{key:"_calcAvgCost",value:function(e){var t=this._map.get(e).costArray.length;if(0===t)return 0;var n=0;return this._map.get(e).costArray.forEach((function(e){n+=e})),parseInt(n/t)}},{key:"_calcAvgSpeed",value:function(e){var t=0,n=0;return this._map.get(e).costArray.forEach((function(e){t+=e})),this._map.get(e).fileSizeArray.forEach((function(e){n+=e})),parseInt(1e3*n/t)}},{key:"getStatResult",value:function(e){var t=this._calcTotalCount(e);if(0===t)return null;var n=this._calcSuccessCountOfBusiness(e),o=this._calcSuccessRateOfBusiness(e),r=this._calcSuccessCountOfPlatform(e),i=this._calcSuccessRateOfPlatform(e),s=this._calcAvg(e);return this.reset(e),{totalCount:t,successCountOfBusiness:n,successRateOfBusiness:o,successCountOfPlatform:r,successRateOfPlatform:i,avgValue:s}}},{key:"reset",value:function(e){at(e)?this._map.clear():this._map.set(e,{totalCount:0,successCount:0,failedCountOfUserSide:0,costArray:[],fileSizeArray:[]})}}]),e}(),nc=function(){function e(){r(this,e),this._lastMap=new Map,this._currentMap=new Map}return s(e,[{key:"initMap",value:function(e){var t=this;e.forEach((function(e){t._lastMap.set(e,new Map),t._currentMap.set(e,new Map)}))}},{key:"addMessageSequence",value:function(e){var t=e.key,n=e.message;if(at(t)||!this._lastMap.has(t)||!this._currentMap.has(t))return!1;var o=n.conversationID,r=n.sequence,i=o.replace(S.CONV_GROUP,"");if(0===this._lastMap.get(t).size)this._addCurrentMap(e);else if(this._lastMap.get(t).has(i)){var s=this._lastMap.get(t).get(i),a=s.length-1;r>s[0]&&r<s[a]?(s.push(r),s.sort(),this._lastMap.get(t).set(i,s)):this._addCurrentMap(e)}else this._addCurrentMap(e);return!0}},{key:"_addCurrentMap",value:function(e){var t=e.key,n=e.message,o=n.conversationID,r=n.sequence,i=o.replace(S.CONV_GROUP,"");this._currentMap.get(t).has(i)||this._currentMap.get(t).set(i,[]),this._currentMap.get(t).get(i).push(r)}},{key:"_copyData",value:function(e){if(!at(e)){this._lastMap.set(e,new Map);var t,n=this._lastMap.get(e),o=k(this._currentMap.get(e));try{for(o.s();!(t=o.n()).done;){var r=v(t.value,2),i=r[0],s=r[1];n.set(i,s)}}catch(a){o.e(a)}finally{o.f()}n=null,this._currentMap.set(e,new Map)}}},{key:"getStatResult",value:function(e){if(at(this._currentMap.get(e))||at(this._lastMap.get(e)))return null;if(0===this._lastMap.get(e).size)return this._copyData(e),null;var t=0,n=0;if(this._lastMap.get(e).forEach((function(e,o){var r=y(e.values()),i=r.length,s=r[i-1]-r[0]+1;t+=s,n+=i})),0===t)return null;var o=xt(n/t*100,2);return o>100&&(o=100),this._copyData(e),{totalCount:t,successCountOfMessageReceived:n,successRateOfMessageReceived:o}}},{key:"reset",value:function(){this._currentMap.clear(),this._lastMap.clear()}}]),e}(),oc=function(e){c(o,e);var t=m(o);function o(e){var n;r(this,o),(n=t.call(this,e))._n="QualityStatModule",n.TAG="im-ssolog-quality-stat",n.reportIndex=0,n.wholePeriod=!1,n._qualityItems=[fi,_i,mi,vi,yi,Mi,Ii,Ci,Ti,Ei],n._messageSentItems=[mi,vi,yi,Mi,Ii],n._messageReceivedItems=[Ci,Ti,Ei],n.REPORT_INTERVAL=120,n.REPORT_SDKAPPID_BLACKLIST=[],n.REPORT_TINYID_WHITELIST=[],n._statInfoArr=[],n._avgRTT=new ec,n._avgE2EDelay=new Qa,n._rateMessageSent=new tc,n._rateMessageReceived=new nc;var i=n.getInnerEmitterInstance();return i.on(es,n._onLoginSuccess,f(n)),i.on(ns,n._onCloudConfigUpdated,f(n)),n}return s(o,[{key:"_onLoginSuccess",value:function(){var e=this;this._rateMessageSent.initMap(this._messageSentItems),this._rateMessageReceived.initMap(this._messageReceivedItems);var t=this.getModule(Vn),n=t.getItem(this.TAG,!1);!$t(n)&&ut(n.forEach)&&(Ve.l("".concat(this._n,"._onLoginSuccess get quality stat logs from local storage, count:").concat(n.length)),n.forEach((function(t){e._statInfoArr.push(t)})),t.removeItem(this.TAG,!1))}},{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("q_rpt_interval"),t=this.getCloudConfig("q_rpt_sdkappid_bl"),n=this.getCloudConfig("q_rpt_tinyid_wl");at(e)||(this.REPORT_INTERVAL=Number(e)),at(t)||(this.REPORT_SDKAPPID_BLACKLIST=t.split(",").map((function(e){return Number(e)}))),at(n)||(this.REPORT_TINYID_WHITELIST=n.split(","))}},{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&e%this.REPORT_INTERVAL==0&&(this.wholePeriod=!0,this._report())}},{key:"addRequestCount",value:function(){this._avgRTT.addRequestCount()}},{key:"addRTT",value:function(e){this._avgRTT.addRTT(e)}},{key:"addMessageDelay",value:function(e){this._avgE2EDelay.addMessageDelay(e)}},{key:"addTotalCount",value:function(e){this._rateMessageSent.addTotalCount(e)||Ve.w("".concat(this._n,".addTotalCount invalid key:"),e)}},{key:"addSuccessCount",value:function(e){this._rateMessageSent.addSuccessCount(e)||Ve.w("".concat(this._n,".addSuccessCount invalid key:"),e)}},{key:"addFailedCountOfUserSide",value:function(e){this._rateMessageSent.addFailedCountOfUserSide(e)||Ve.w("".concat(this._n,".addFailedCountOfUserSide invalid key:"),e)}},{key:"addCost",value:function(e,t){this._rateMessageSent.addCost(e,t)||Ve.w("".concat(this._n,".addCost invalid key or cost:"),e,t)}},{key:"addFileSize",value:function(e,t){this._rateMessageSent.addFileSize(e,t)||Ve.w("".concat(this._n,".addFileSize invalid key or size:"),e,t)}},{key:"addMessageSequence",value:function(e){this._rateMessageReceived.addMessageSequence(e)||Ve.w("".concat(this._n,".addMessageSequence invalid key:"),e.key)}},{key:"_getQualityItem",value:function(e){var t={},o=Si[this.getNetworkType()];at(o)&&(o=8);var r={qualityType:ki[e],timestamp:Pe(),networkType:o,extension:""};switch(e){case fi:t=this._avgRTT.getStatResult();break;case _i:t=this._avgE2EDelay.getStatResult();break;case mi:case vi:case yi:case Mi:case Ii:t=this._rateMessageSent.getStatResult(e);break;case Ci:case Ti:case Ei:t=this._rateMessageReceived.getStatResult(e)}return null===t?null:n(n({},r),t)}},{key:"_report",value:function(e){var t=this,n=[],o=null;at(e)?this._qualityItems.forEach((function(e){null!==(o=t._getQualityItem(e))&&(o.reportIndex=t.reportIndex,o.wholePeriod=t.wholePeriod,n.push(o))})):null!==(o=this._getQualityItem(e))&&(o.reportIndex=this.reportIndex,o.wholePeriod=this.wholePeriod,n.push(o)),Ve.d("".concat(this._n,"._report"),n),this._statInfoArr.length>0&&(n=n.concat(this._statInfoArr),this._statInfoArr=[]);var r=this.getModule(Bn),i=r.getSDKAppID(),s=r.getTinyID();Ft(this.REPORT_SDKAPPID_BLACKLIST,i)&&!qt(this.REPORT_TINYID_WHITELIST,s)&&(n=[]),n.length>0&&this._doReport(n)}},{key:"_doReport",value:function(e){var t=this,o={header:ra(this),quality:e};this.request({protocolName:Vr,requestData:n({},o)}).then((function(){t.reportIndex++,t.wholePeriod=!1})).catch((function(n){Ve.w("".concat(t._n,"._doReport, online:").concat(t.getNetworkType()," error:"),n),t._statInfoArr=t._statInfoArr.concat(e),t._flushAtOnce()}))}},{key:"_flushAtOnce",value:function(){var e=this.getModule(Vn),t=e.getItem(this.TAG,!1),n=this._statInfoArr,o="".concat(this._n,"._flushAtOnce");if($t(t))Ve.l("".concat(o," count:").concat(n.length)),e.setItem(this.TAG,n,!0,!1);else{var r=n.concat(t);r.length>10&&(r=r.slice(0,10)),Ve.l("".concat(o," count:").concat(r.length)),e.setItem(this.TAG,r,!0,!1)}this._statInfoArr=[]}},{key:"reset",value:function(){Ve.l("".concat(this._n,".reset")),this._report(),this.reportIndex=0,this.wholePeriod=!1,this.REPORT_SDKAPPID_BLACKLIST=[],this.REPORT_TINYID_WHITELIST=[],this._avgRTT.reset(),this._avgE2EDelay.reset(),this._rateMessageSent.reset(),this._rateMessageReceived.reset()}}]),o}(co),rc=function(e){c(n,e);var t=m(n);function n(e){var o;return r(this,n),(o=t.call(this,e))._n="WorkerTimerModule",o._isWorkerEnabled=!0,o._workerTimer=null,o._timerID=-1,o._init(),o.getInnerEmitterInstance().on(ns,o._onCloudConfigUpdated,f(o)),o}return s(n,[{key:"isWorkerEnabled",value:function(){return this._isWorkerEnabled&&Le}},{key:"startWorkerTimer",value:function(){Ve.l("".concat(this._n,".startWorkerTimer")),this._workerTimer&&this._workerTimer.postMessage("start")}},{key:"stopWorkerTimer",value:function(){Ve.l("".concat(this._n,".stopWorkerTimer")),this._workerTimer&&this._workerTimer.postMessage("stop")}},{key:"_init",value:function(){if(Le){var e=URL.createObjectURL(new Blob(['let interval = -1;onmessage = function(event) {  if (event.data === "start") {    if (interval > 0) {      clearInterval(interval);    }    interval = setInterval(() => {      postMessage("");    }, 1000);    postMessage(interval);  } else if (event.data === "stop") {    clearInterval(interval);    interval = -1;  }};'],{type:"application/javascript; charset=utf-8"}));this._workerTimer=new Worker(e);var t=this;this._workerTimer.onmessage=function(e){e.data?(t._timerID=e.data,Ve.l("".concat(t._n,"._init seed:").concat(t._timerID))):t._m.onCheckTimer()}}}},{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("enable_worker");Ve.l("".concat(this._n,"._onCloudConfigUpdated enableWorker:").concat(e)),at(e)||"1"===e?!this._isWorkerEnabled&&Le&&(this._isWorkerEnabled=!0,this.startWorkerTimer(),this._m.onWorkerTimerEnabled()):this._isWorkerEnabled&&Le&&(this._isWorkerEnabled=!1,this.stopWorkerTimer(),this._m.onWorkerTimerDisabled())}},{key:"terminate",value:function(){Ve.l("".concat(this._n,".terminate")),this._workerTimer&&(this._workerTimer.terminate(),this._workerTimer=null,this._timerID=-1)}},{key:"getTimerID",value:function(){return this._timerID}},{key:"reset",value:function(){Ve.l("".concat(this._n,".reset"))}}]),n}(co),ic=function(){function e(){r(this,e),this._n="PurchasedFeatureHandler",this._purchasedFeatureMap=new Map}return s(e,[{key:"isValidPurchaseBits",value:function(e){return e&&"string"==typeof e&&e.length>=1&&e.length<=64&&/[01]{1,64}/.test(e)}},{key:"parsePurchaseBits",value:function(e){if(this.isValidPurchaseBits(e)){this._purchasedFeatureMap.clear();for(var t=null,n=e.length-1,o=0;n>=0;n--,o++)t=o<32?new A(0,Math.pow(2,o)).toString():new A(Math.pow(2,o-32),0).toString(),"1"===e[n]?this._purchasedFeatureMap.set(t,!0):this._purchasedFeatureMap.set(t,!1)}else Ve.w("".concat(this._n,".parsePurchaseBits invalid purchasebits:").concat(e))}},{key:"hasPurchasedFeature",value:function(e){return!!this._purchasedFeatureMap.get(e)}},{key:"isFeatureEnabled",value:function(e){for(var t=parseInt(e).toString(2),n=void 0,o=!0,r=t.length-1,i=0;r>=0;r--,i++)if("1"===t.charAt(r)&&(n=i<32?new A(0,Math.pow(2,i)).toString():new A(Math.pow(2,i-32),0).toString(),!this._purchasedFeatureMap.get(n))){o=!1;break}return Ve.l("".concat(this._n,".isFeatureEnabled decimalNumber:").concat(e," binaryString:").concat(t," ret:").concat(o)),Ji({enabled:o})}},{key:"clear",value:function(){this._purchasedFeatureMap.clear()}}]),e}(),sc=function(){function e(t){r(this,e),this._m=t,this._n="CommercialConfigModule",this._expiredTime=0,this._isFetching=!1,this._purchasedFeatureHandler=new ic}return s(e,[{key:"_canFetch",value:function(){return this._getModule(Bn).isLoggedIn()?!this._isFetching&&Date.now()>=this._expiredTime:(this._expiredTime=Date.now()+2e3,!1)}},{key:"onCheckTimer",value:function(e){this._canFetch()&&this.fetchConfig()}},{key:"fetchConfig",value:function(){var e=this,t=this._canFetch(),n="".concat(this._n,".fetchConfig");if(Ve.l("".concat(n," canFetch:").concat(t)),t){var o=this._getModule(Hn),r=new Ai("fetchCommercialConfig");r.setNetworkType(o.getNetworkType());var i=this._getModule(Bn).getSDKAppID(),s=this._getModule($n);this._isFetching=!0,s.request({protocolName:Zr,requestData:{SDKAppID:i}}).then((function(t){r.setMessage("purchaseBits:".concat(t.data.purchaseBits)).end(),Ve.l("".concat(n," ok.")),e._parseConfig(t.data),e._isFetching=!1})).catch((function(t){o.probe().then((function(e){var n=v(e,2),o=n[0],i=n[1];r.setError(t,o,i).end()})),e._isFetching=!1}))}}},{key:"onPushedConfig",value:function(e){var t="".concat(this._n,".onPushedConfig data:").concat(JSON.stringify(e));Ve.l("".concat(t)),new Ai("pushedCommercialConfig").setNetworkType(this._getModule(Hn).getNetworkType()).setMessage("purchaseBits:".concat(e.purchaseBits)).end(),this._parseConfig(e)}},{key:"_parseConfig",value:function(e){var t="".concat(this._n,"._parseConfig"),n=e.errorCode,o=e.errorMessage,r=e.purchaseBits,i=e.expiredTime;0===n?(this._purchasedFeatureHandler.parsePurchaseBits(r),this._expiredTime=Date.now()+1e3*i):at(n)?(Ve.l("".concat(t," failed. Invalid message format:"),e),this._setExpiredTimeOnResponseError(36e5)):(Ve.e("".concat(t," errorCode:").concat(n," errorMessage:").concat(o)),this._setExpiredTimeOnResponseError(12e4))}},{key:"_setExpiredTimeOnResponseError",value:function(e){this._expiredTime=Date.now()+e}},{key:"canIUse",value:function(e){return this._purchasedFeatureHandler.hasPurchasedFeature(e)}},{key:"isFeatureEnabled",value:function(e){return this._purchasedFeatureHandler.isFeatureEnabled(e)}},{key:"_getModule",value:function(e){return this._m.getModule(e)}},{key:"reset",value:function(){Ve.l("".concat(this._n,".reset")),this._expiredTime=0,this._isFetching=!1,this._purchasedFeatureHandler.clear()}}]),e}(),ac=function(e){c(n,e);var t=m(n);function n(e){var o;return r(this,n),(o=t.call(this,e))._m=e,o._n="OfflinePushModule",o._offlinePushPlugin=void 0,o._androidPushConfig={huaweiPushBussinessId:"",xiaomiPushBussinessId:"",xiaomiPushAppId:"",xiaomiPushAppKey:"",meizuPushBussinessId:"",meizuPushAppId:"",meizuPushAppKey:"",vivoPushBussinessId:"",fcmPushBussinessId:"",oppoPushBussinessId:"",oppoPushAppKey:"",oppoPushAppSecret:"",honorPushBussinessId:""},o._deviceToken="",o._businessID=0,o._iosBusinessID=0,o._c2cUnreadCount=0,o._groupUnreadCount=0,o._isWebUniapp=0,o}return s(n,[{key:"registerPlugin",value:function(e){if(oe){this._offlinePushPlugin=e["tim-offline-push-plugin"];var t=e.offlinePushConfig||{},n=t.huaweiBusinessID,o=t.xiaomiBusinessID,r=t.xiaomiAppID,i=t.xiaomiAppKey,s=t.meizuBusinessID,a=t.meizuAppID,c=t.meizuAppKey,u=t.vivoBusinessID,l=t.oppoBusinessID,d=t.oppoAppKey,p=t.oppoAppSecret,h=t.honorBusinessID,g=t.iosBusinessID;this._androidPushConfig.huaweiPushBussinessId=n,this._androidPushConfig.xiaomiPushBussinessId=o,this._androidPushConfig.xiaomiPushAppId=r,this._androidPushConfig.xiaomiPushAppKey=i,this._androidPushConfig.meizuPushBussinessId=s,this._androidPushConfig.meizuPushAppId=a,this._androidPushConfig.meizuPushAppKey=c,this._androidPushConfig.vivoPushBussinessId=u,this._androidPushConfig.oppoPushBussinessId=l,this._androidPushConfig.oppoPushAppKey=d,this._androidPushConfig.oppoPushAppSecret=p,this._androidPushConfig.honorPushBussinessId=h,new Ai("registerPlugin").setMessage("tim-offline-push-plugin").setMoreMessage("isExist:".concat(!at(this._offlinePushPlugin))).end(!0),Ve.l("".concat(this._n,".").concat("registerPlugin"," ok. offlinePushConfig:").concat(JSON.stringify(e.offlinePushConfig))),this._iosBusinessID=g,this._setAppShowListener()}else this.outputWarning("OfflinePushInUniapp")}},{key:"init",value:function(){this._isWebUniapp=this.getUniAppPlatform(),this._getDeviceToken()}},{key:"_getDeviceToken",value:function(){var e=this,t="".concat(this._n,".").concat("_getDeviceToken");if(ut(this._offlinePushPlugin.getDeviceToken)){var n="androidPushConfig:".concat(JSON.stringify(this._androidPushConfig),", iosBusinessID:").concat(this._iosBusinessID);Ve.l("".concat(t," start. ").concat(n)),new Ai("_getDeviceToken").setMessage("".concat(n)).end(!0),this._offlinePushPlugin.getDeviceToken(this._androidPushConfig,(function(o){var r=new Ai("getDeviceTokenRes"),i=o.code,s=o.msg;if(0===i){var a=o.data,c=a.deviceToken,u=a.deviceBrand,l=a.deviceType,d=a.bussinessId;e._deviceToken=c,e._businessID=d||e._iosBusinessID,n="deviceToken:".concat(c,", deviceBrand:").concat(u||l,", businessID:").concat(e._businessID),Ve.l("".concat(t," ok. ").concat(n)),r.setMessage(n).end(!0),e._setToken()}else r.setMessage("code:".concat(i,", msg:").concat(s)).end(!0),Ve.e("".concat(t," failed. error:"),o)}))}else Ve.e("".concat(t," getDeviceToken is not a function"))}},{key:"canIUseOfflinePush",value:function(){return oe&&!at(this._offlinePushPlugin)}},{key:"_setAppShowListener",value:function(){var e=this,t="".concat(this._n,".").concat("_setAppShowListener");at(this._offlinePushPlugin)?Ve.e("".concat(t," offlinePushPlugin is undefined")):ut(this._offlinePushPlugin.setAppShowListener)?(new Ai("_setAppShowListener").end(!0),Ve.l("".concat(t," start")),this._offlinePushPlugin.setAppShowListener((function(n){var o=(n||{}).appShow;new Ai("setAppShowListenerRes").setMessage("appShow:".concat(o)).end(!0),Ve.l("".concat(t," ok. appShow:").concat(o)),e._m.isReady()&&(0===o?(e._getConvUnreadCount(),e._onBackground()):1===o&&e._onForeground())}))):Ve.e("".concat(t," setAppShowListener is not a function"))}},{key:"getDeviceBrand",value:function(){if(!at(this._offlinePushPlugin)&&ut(this._offlinePushPlugin.getDeviceType)){var e=(this._offlinePushPlugin.getDeviceType()||{}).deviceType;return Ve.l("".concat(this._n,".getDeviceBrand ok. deviceType:").concat(e)),e}}},{key:"_setToken",value:function(){var e,t=this,n="".concat(this._n,"._setToken"),o=this.getModule(Bn),r=1,i="",s="";$t(this._deviceToken)&&(r=0);var a=this.getUniAppPlatform(),c=this.getDeviceBrand();a===O.IOS||a===O.IPAD||a===O.MAC?s=this._deviceToken:a===O.ANDROID&&(i=this._deviceToken);var u=new Ai("offlinePushSetToken");return e="deviceToken:".concat(s||i,", businessID:").concat(this._businessID,", ")+"deviceBrand:".concat(c,", isWebUniapp:").concat(this._isWebUniapp,", pushMsg:").concat(r,", platform:").concat(a),u.setMessage("".concat(e)),Ve.l("".concat(n," ").concat(e)),this.request({protocolName:di,requestData:{tokenID:i,pushMsg:r,sdkAppID:o.getSDKAppID(),businessID:parseInt(this._businessID),deviceBrand:c,deviceToken:s,isWebUniapp:this._isWebUniapp}}).then((function(e){return u.end(),Ve.l("".concat(n," ok")),e})).catch((function(e){return t.probeNetwork().then((function(t){var n=v(t,2),o=n[0],r=n[1];u.setError(e,o,r).end()})),Ve.e("".concat(n," failed. error:"),e),Xi(e)}))}},{key:"_getConvUnreadCount",value:function(){var e=this;this._c2cUnreadCount=0,this._groupUnreadCount=0,this.getModule(qn).getLocalConversationList().forEach((function(t){t.type===S.CONV_C2C&&(e._c2cUnreadCount+=t.unreadCount),t.type===S.CONV_GROUP&&(e._groupUnreadCount+=t.unreadCount)}))}},{key:"_onBackground",value:function(){var e=this,t="".concat(this._n,".").concat("_onBackground"),n=new Ai("_onBackground");this.request({protocolName:ui,requestData:{c2cUnreadCount:this._c2cUnreadCount,groupUnreadCount:this._groupUnreadCount,isWebUniapp:this._isWebUniapp}}).then((function(o){return n.setMessage("c2cUnreadCount: ".concat(e._c2cUnreadCount,", groupUnreadCount: ").concat(e._groupUnreadCount)).end(),Ve.l("".concat(t," ok")),o})).catch((function(o){e.probeNetwork().then((function(e){var t=v(e,2),r=t[0],i=t[1];n.setError(o,r,i).end()})),Ve.e("".concat(t," failed. error:"),o)}))}},{key:"_onForeground",value:function(){var e=this,t="".concat(this._n,".").concat("_onForeground"),n=new Ai("_onForeground");this.request({protocolName:li,requestData:{isWebUniapp:this._isWebUniapp}}).then((function(e){return n.end(),Ve.l("".concat(t," ok")),e})).catch((function(o){e.probeNetwork().then((function(e){var t=v(e,2),r=t[0],i=t[1];n.setError(o,r,i).end()})),Ve.e("".concat(t," failed. error:"),o)}))}},{key:"getUniAppPlatform",value:function(){var e=uni.getSystemInfoSync().platform,t=this.getDeviceBrand();return"ios"===e?O.IOS:"android"===e?O.ANDROID:1002===t?O.IPAD:1001===t?O.MAC:void 0}},{key:"reset",value:function(){this._deviceToken="",this._businessID=0,this._c2cUnreadCount=0,this._groupUnreadCount=0,this._isWebUniapp=0,Ve.l("".concat(this._n,".reset"))}}]),n}(co),cc=function(e){c(n,e);var t=m(n);function n(e){var o;return r(this,n),(o=t.call(this,e))._n="ProfanityFilterModule",o._plugin=null,o._filterConfigMap=new Map,o._startIndex=0,o._version=0,o._canIUseLexicon=!1,o._isFetching=!1,o._expiredTime=0,o}return s(n,[{key:"init",value:function(){var e=this.getModule(Wn).getPlugin("tim-profanity-filter-plugin");e?(this._plugin=new e({logger:Ve,isArray:st,isMap:Qe,isDevMode:this.isDevMode()}),this._getLexicon()):this.outputWarning("ProfanityPluginNotFound")}},{key:"onCheckTimer",value:function(){this._plugin&&this._canIUseLexicon&&this.isLoggedIn()&&!this._isFetching&&Date.now()>=this._expiredTime&&this._getLexicon()}},{key:"filterMessage",value:function(e,t){var n=!0;if(!this._plugin||!this._canIUseLexicon)return n;if(t&&t.messageControlInfo&&!0===t.messageControlInfo.excludedFromContentModeration)return n;var o=e.type,r=e.conversationType;if(o!==S.MSG_TEXT&&o!==S.MSG_CUSTOM)return n;var i,s="".concat(this._n,".filterMessage");if(Ve.l("".concat(s)),o===S.MSG_TEXT){if(r===S.CONV_C2C?i=H:r===S.CONV_GROUP&&(i=z),!this._isConfigOn(i))return n;var a=this._plugin.filter(e.payload.text),c=a.type,u=a.modifiedText;1===c?n=!1:2===c&&(e.payload.text=u)}else if(o===S.MSG_CUSTOM){if(r===S.CONV_C2C?i=j:r===S.CONV_GROUP&&(i=W),!this._isConfigOn(i))return n;var l=this._plugin.filter(e.payload.data),d=this._plugin.filter(e.payload.description),p=this._plugin.filter(e.payload.extension);1===l.type||1===d.type||1===p.type?n=!1:(2===l.type&&(e.payload.data=l.modifiedText),2===d.type&&(e.payload.description=d.modifiedText),2===p.type&&(e.payload.extension=p.modifiedText))}return Ve.l("".concat(s," done. isAllowedToSend:").concat(n)),n}},{key:"filterText",value:function(e,t){var n="".concat(this._n,".filterText"),o={isAllowedToSend:!0,modifiedText:e};if(!this._plugin||!this._canIUseLexicon)return o;if(!this._isConfigOn(t))return o;Ve.l("".concat(n));var r=this._plugin.filter(e),i=r.type,s=r.modifiedText;return 1===i?o.isAllowedToSend=!1:2===i&&(o.modifiedText=s),Ve.l("".concat(n," done. ret:"),o),o}},{key:"_getLexicon",value:function(){var e=this,t=new Ai("profanityFilter"),n="".concat(this._n,"._getLexicon");this._isFetching=!0,this.request({protocolName:pi,requestData:{startIndex:this._startIndex,version:this._version}}).then((function(o){var r=o.data,i=r.errorInfo,s=r.filterConfig,a=r.lexicon,c=r.strToken,u=r.completeFlag,l=r.nextStartIndex,d=r.version,p=r.expiredTime,h=i.errorCode,g=i.errorMessage;return 0!==h?(e._isFetching=!1,Ve.w("".concat(n," failed. error:"),i),void t.setCode(h).setMessage(g).end()):(e._onFilterConfig(s),e._getToken(c),1===u?(Ve.l("".concat(n," done. version:").concat(d," expiredTime:").concat(p)),e._version=d,e._canIUseLexicon=!0,e._isFetching=!1,e._expiredTime=Date.now()+1e3*p,void e._plugin.onLexiconCompleted(a)):(e._startIndex=l,e._plugin.onLexiconSliced(a),void e._getLexicon()))})).catch((function(o){e.probeNetwork().then((function(e){var n=v(e,2),r=n[0],i=n[1];t.setError(o,r,i).end()})),e._isFetching=!1,Ve.l("".concat(n," failed. error:"),o)}))}},{key:"_onFilterConfig",value:function(e){var t=this;$t(e)||(this._filterConfigMap.clear(),Object.keys(e).forEach((function(n){t._filterConfigMap.set(n,e[n])})),Ve.l("".concat(this._n,"._onFilterConfig. keys:").concat(Array.from(this._filterConfigMap.keys())," values:").concat(Array.from(this._filterConfigMap.values()))))}},{key:"_isConfigOn",value:function(e){return 1===this._filterConfigMap.get(e)}},{key:"_getToken",value:function(e){if(ot(e)){var t=e.length,n="";if(t%2==0)for(var o=0;o<=t-1;o+=2)n+=e[o+1],n+=e[o];else{for(var r=0;r<t-1;r+=2)n+=e[r+1],n+=e[r];n+=e[t-1]}this._plugin.onToken(n)}}},{key:"reset",value:function(){Ve.l("".concat(this._n,".reset")),this._plugin&&(this._plugin.reset(),this._plugin=null),this._filterConfigMap.clear(),this._startIndex=0,this._version=0,this._canIUseLexicon=!1,this._isFetching=!1,this._expiredTime=0}}]),n}(co),uc=function(){function e(t){r(this,e),this._m=t,this._n="TransCmdModule",this._TRTCCommandList=["tui_room_svr.*"],this._m.getInnerEmitterInstance().on(ns,this._onCloudConfigUpdated,this)}return s(e,[{key:"_onCloudConfigUpdated",value:function(){var e=this,t=this._m.getModule(Zn).getCloudConfig("rtc_cmd");at(t)||(t=JSON.parse(t)).forEach((function(t){e._TRTCCommandList.includes(t)||e._TRTCCommandList.push(t)}))}},{key:"sendTRTCCustomData",value:function(e){var t=e.serviceCommand,n=e.data,o="".concat(V.NAME.TUIROOM_SVR,".*");return at(t)||(o=t),this._TRTCCommandList.includes(o)?this._trans({servcmd:o,data:n}):Xi({code:gi.INVALID_TRTC_CMD})}},{key:"_trans",value:function(e){Ve.d("".concat(this._n,"._trans. options:").concat(JSON.stringify(e)));var t=e.servcmd,n=e.data;return this._m.getModule($n).trans({servcmd:t,data:ot(n)?JSON.parse(n):n})}},{key:"getCommandList",value:function(){return this._TRTCCommandList}},{key:"reset",value:function(){Ve.l("".concat(this._n,".reset"))}}]),e}(),lc=function(){function e(t){r(this,e),this._m=t,this._n="ErrorMessageModule",this.TIM_ERROR_ASSISTANCE="tim_error_assistance",this.STORAGE_EXPIRES_TIME=6048e5,this._map=new Map,this._init()}return s(e,[{key:"_init",value:function(){var e=this._getStorageModule().getItem(this.TIM_ERROR_ASSISTANCE,!1);if(e){var t;try{t=JSON.parse(e)}catch(n){this._getStorageModule().removeItem(this.TIM_ERROR_ASSISTANCE,!1),Ve.w("".concat(this._n,"._init error:"),n)}t&&(this._needToUpdate(t)?this._fetch():this._fillMap(t.message))}else this._fetch()}},{key:"_needToUpdate",value:function(e){var t=e.localSavedTime,n=e.localSavedVersion,o=t&&(new Date).getTime()-t>=this.STORAGE_EXPIRES_TIME,r=!n||"2.27.5"!==n;return Ve.l("".concat(this._n,"._needToUpdate isTimeout:").concat(o," isDifferentVersion:").concat(r)),o||r}},{key:"_fetch",value:function(){if(!this._m.getModule(Bn).isPrivateNetWork()){var e="https://web.sdk.qcloud.com/im/download/error-message/0.0.1/tim-error-message.txt",t="application/x-www-form-urlencoded;charset=UTF-8",n="".concat(this._n,"._fetch ok in"),o=this;if(ie)ae.request({url:e,method:"GET",timeout:3e3,header:{"content-type":t},dataType:"text",success:function(e){o._fillAndSave(e.data),Ve.l("".concat(n," mini program"))},fail:function(){}});else{var r=new XMLHttpRequest,i=setTimeout((function(){r.abort()}),3e3);r.onreadystatechange=function(){4===r.readyState&&(clearTimeout(i),200!==r.status&&304!==r.status||(Ve.l("".concat(n," browser")),o._fillAndSave(r.responseText)))},r.open("GET",e,!0),r.setRequestHeader("Content-type",t),r.send()}}}},{key:"_fillAndSave",value:function(e){this._fillMap(e),this._getStorageModule().setItem(this.TIM_ERROR_ASSISTANCE,JSON.stringify({message:e,localSavedTime:(new Date).getTime(),localSavedVersion:"2.27.5"}),!0,!1)}},{key:"_getStorageModule",value:function(){return this._m.getModule(Vn)}},{key:"_fillMap",value:function(e){this._map.clear();for(var t,n,o,r=e.split(";\n"),i=r.length,s=new RegExp(/'/g),a=0;a<i;a++)if(t=r[a].indexOf(":"),n=r[a].slice(0,t),o=r[a].slice(t+1,r[a].length),!n.startsWith("//")){if(at(o))continue;this._map.set(n,o.replace(s,""))}}},{key:"get",value:function(e){var t=e.isIntl,n=e.key,o=e.replacement1,r=e.replacement2,i="".concat(n,t?"_en":"_cn");!this._map.has(i)&&this._map.has(n)&&(i=n);var s="";return this._map.has(i)?(s=this._map.get(i),at(o)||(s=s.replace("$replacement1",o)),at(r)||(s=s.replace("$replacement2",r)),s):s}},{key:"reset",value:function(){Ve.l("".concat(this._n,".reset"))}}]),e}(),dc=function(){function e(t){r(this,e);var n=new Ai("sdkConstruct");this._n="ModuleManager",this._isReady=!1,this._reason=gi.USER_NOT_LOGGED_IN,this._startLoginTs=0,this._moduleMap=new Map,this._innerEmitter=null,this._outerEmitter=null,this._checkCount=0,this._checkTimer=-1,this._moduleMap.set(Bn,new Qs(this,t)),this._moduleMap.set(no,new sc(this)),this._moduleMap.set(Zn,new Xa(this)),this._moduleMap.set(Qn,new rc(this)),this._moduleMap.set(to,new oc(this)),this._moduleMap.set(Jn,new Va(this)),this._moduleMap.set($n,new $a(this)),this._moduleMap.set(On,new ea(this)),this._moduleMap.set(Nn,new ya(this)),this._moduleMap.set(wn,new Ma(this)),this._moduleMap.set(so,new Ia(this)),this._moduleMap.set(bn,new Zs(this)),this._moduleMap.set(Un,new Zi(this)),this._moduleMap.set(qn,new Ms(this)),this._moduleMap.set(Pn,new qs(this)),this._moduleMap.set(xn,new Vs(this)),this._moduleMap.set(Fn,new zs(this)),this._moduleMap.set(Vn,new na(this)),this._moduleMap.set(ao,new lc(this)),this._moduleMap.set(Kn,new ia(this)),this._moduleMap.set(Hn,new ua(this)),this._moduleMap.set(jn,new da(this)),this._moduleMap.set(zn,new ha(this)),this._moduleMap.set(Wn,new Ca(this)),this._moduleMap.set(Yn,new Ta(this)),this._moduleMap.set(Xn,new Ja(this)),this._moduleMap.set(eo,new Za(this)),this._moduleMap.set(oo,new ac(this)),this._moduleMap.set(ro,new cc(this)),this._moduleMap.set(io,new uc(this)),this._eventThrottleMap=new Map;var o=t.instanceID,i=t.oversea,s=t.SDKAppID,a="instanceID:".concat(o," SDKAppID:").concat(s," host:").concat(wt()," oversea:").concat(i," inBrowser:").concat(se," inMiniApp:").concat(ie)+" workerAvailable:".concat(Le," UserAgent:").concat(ce);Ai.bindEventStatModule(this._moduleMap.get(Kn)),n.setMessage("".concat(a," ").concat(function(){var e="";if(ie)try{var t=ae.getSystemInfoSync(),n=t.model,o=t.version,r=t.system,i=t.platform,s=t.SDKVersion;e="model:".concat(n," version:").concat(o," system:").concat(r," platform:").concat(i," SDKVersion:").concat(s)}catch(a){e=""}return e}())).end(),Ve.i("SDK ".concat(a)),Wi.prototype._getErrorMessage=this.getErrorMessage.bind(this),this._readyList=void 0,this._ssoLogForReady=null,this._initReadyList()}return s(e,[{key:"_startTimer",value:function(){var e=this._moduleMap.get(Qn),t=e.isWorkerEnabled();Ve.l("".concat(this._n,".startTimer isWorkerEnabled:").concat(t," seed:").concat(this._checkTimer)),t?e.startWorkerTimer():this._startMainThreadTimer()}},{key:"_startMainThreadTimer",value:function(){this._checkTimer<0&&(this._checkTimer=setInterval(this.onCheckTimer.bind(this),1e3)),Ve.l("".concat(this._n,"._startMainThreadTimer seed:").concat(this._checkTimer))}},{key:"stopTimer",value:function(){var e=this._moduleMap.get(Qn),t=e.isWorkerEnabled();Ve.l("".concat(this._n,".stopTimer isWorkerEnabled:").concat(t," seed:").concat(this._checkTimer)),t?e.stopWorkerTimer():this._stopMainThreadTimer()}},{key:"_stopMainThreadTimer",value:function(){Ve.l("".concat(this._n,"._stopMainThreadTimer")),this._checkTimer>0&&(clearInterval(this._checkTimer),this._checkTimer=-1,this._checkCount=0)}},{key:"_stopMainThreadSocket",value:function(){Ve.l("".concat(this._n,"._stopMainThreadSocket"));var e=this._moduleMap.get(Jn);e.setIsWorkerEnabled(!0),e.reConnect()}},{key:"_startMainThreadSocket",value:function(){Ve.l("".concat(this._n,"._startMainThreadSocket"));var e=this._moduleMap.get(Jn);e.setIsWorkerEnabled(!1),e.reConnect()}},{key:"onWorkerTimerEnabled",value:function(){Ve.l("".concat(this._n,".onWorkerTimerEnabled, disable main thread timer and socket")),this._stopMainThreadTimer(),this._stopMainThreadSocket()}},{key:"onWorkerTimerDisabled",value:function(){Ve.l("".concat(this._n,".onWorkerTimerDisabled, enable main thread timer and socket")),this._startMainThreadTimer(),this._startMainThreadSocket()}},{key:"onCheckTimer",value:function(){this._checkCount+=1;var e,t=k(this._moduleMap);try{for(t.s();!(e=t.n()).done;){var n=v(e.value,2)[1];n.onCheckTimer&&n.onCheckTimer(this._checkCount)}}catch(o){t.e(o)}finally{t.f()}}},{key:"_initReadyList",value:function(){var e=this;this._readyList=[this._moduleMap.get(On),this._moduleMap.get(qn)],this._readyList.forEach((function(t){t.ready((function(){return e._onModuleReady()}))}))}},{key:"_onModuleReady",value:function(){var e=!0;if(this._readyList.forEach((function(t){t.isReady()||(e=!1)})),e&&!this._isReady){this._isReady=!0,this._outerEmitter.emit(D.SDK_READY);var t=Date.now()-this._startLoginTs;Ve.w("SDK is ready. cost ".concat(t," ms")),this._startLoginTs=Date.now();var n=this._moduleMap.get(Hn).getNetworkType(),o=this._ssoLogForReady.getStartTs()+Ue;this._ssoLogForReady.setNetworkType(n).setMessage(t).start(o).end()}}},{key:"login",value:function(){0===this._startLoginTs&&(Ge(),this._startLoginTs=Date.now(),this._startTimer(),this._moduleMap.get(Hn).start(),this._ssoLogForReady=new Ai("sdkReady"),this._reason=gi.LOGGING_IN)}},{key:"onLoginFailed",value:function(){this._startLoginTs=0}},{key:"getOuterEmitterInstance",value:function(){return null===this._outerEmitter&&(this._outerEmitter=new la,$i(this._outerEmitter),this._outerEmitter._emit=this._outerEmitter.emit,this._outerEmitter.emit=function(e,t){var n=this;if(e===D.CONVERSATION_LIST_UPDATED||e===D.FRIEND_LIST_UPDATED||e===D.GROUP_LIST_UPDATED||e===D.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED)if(this._eventThrottleMap.has(e)){var o=Date.now(),r=this._eventThrottleMap.get(e);o-r.last<=1e3?(r.timeoutID&&clearTimeout(r.timeoutID),r.timeoutID=setTimeout((function(){r.last=Date.now(),n._outerEmitter._emit.apply(n._outerEmitter,[e,{name:e,data:n._getEventData(e)}])}),1e3)):(r.last=o,this._outerEmitter._emit.apply(this._outerEmitter,[e,{name:e,data:this._getEventData(e)}]))}else this._eventThrottleMap.set(e,{last:Date.now(),timeoutID:-1}),this._outerEmitter._emit.apply(this._outerEmitter,[e,{name:e,data:this._getEventData(e)}]);else this._outerEmitter._emit.apply(this._outerEmitter,[e,{name:e,data:arguments[1]}])}.bind(this)),this._outerEmitter}},{key:"_getEventData",value:function(e){return e===D.CONVERSATION_LIST_UPDATED?this._moduleMap.get(qn).getLocalConversationList():e===D.FRIEND_LIST_UPDATED?this._moduleMap.get(Gn).getLocalFriendList(!1):e===D.GROUP_LIST_UPDATED?this._moduleMap.get(Pn).getLocalGroupList():e===D.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED?this._moduleMap.get(qn).getTotalUnreadMessageCount():void 0}},{key:"getInnerEmitterInstance",value:function(){return null===this._innerEmitter&&(this._innerEmitter=new la,this._innerEmitter._emit=this._innerEmitter.emit,this._innerEmitter.emit=function(e,t){var n;n=it(arguments[1])&&arguments[1].data?[e,{name:arguments[0],data:arguments[1].data}]:[e,{name:arguments[0],data:arguments[1]}],this._innerEmitter._emit.apply(this._innerEmitter,n)}.bind(this)),this._innerEmitter}},{key:"hasModule",value:function(e){return this._moduleMap.has(e)}},{key:"getModule",value:function(e){return this._moduleMap.get(e)}},{key:"isReady",value:function(){return this._isReady}},{key:"isIntl",value:function(){return this.getModule(Bn).isIntl()}},{key:"getNotReadyReason",value:function(){return this._reason}},{key:"setNotReadyReason",value:function(e){this._reason=e}},{key:"getErrorMessage",value:function(e,t,n){return this._moduleMap.get(ao).get({key:e,replacement1:t,replacement2:n,isIntl:this.isIntl()})}},{key:"outputWarning",value:function(e,t,n){var o=this.getErrorMessage(e,t,n);o&&Ve.w(o)}},{key:"onError",value:function(e){var t="code:".concat(e.code," message:").concat(e.message);Ve.w("Oops! ".concat(t)),new Ai("error").setMessage(t).setNetworkType(this.getModule(Hn).getNetworkType()).setLevel("error").end(),this.getOuterEmitterInstance().emit(D.ERROR,e)}},{key:"restartTimer",value:function(){Ve.l("".concat(this._n,".restartTimer")),this.stopTimer(),this._startTimer(),this.getModule(Pn).restartPolling()}},{key:"getTimerID",value:function(){var e=this._moduleMap.get(Qn);return e.isWorkerEnabled()?e.getTimerID():this._checkTimer}},{key:"getPollingTimerID",value:function(e){return this._moduleMap.get(Pn).getPollingTimerID(e)}},{key:"reset",value:function(){Ve.l("".concat(this._n,".reset")),Ge();var e,t=k(this._moduleMap);try{for(t.s();!(e=t.n()).done;){var n=v(e.value,2)[1];n.reset&&n.reset()}}catch(s){t.e(s)}finally{t.f()}this._startLoginTs=0,this._initReadyList(),this._isReady=!1,this.stopTimer(),this._outerEmitter.emit(D.SDK_NOT_READY);var o,r=k(this._eventThrottleMap);try{for(r.s();!(o=r.n()).done;){var i=v(o.value,2)[1];i.timeoutID&&clearTimeout(i.timeoutID)}}catch(s){r.e(s)}finally{r.f()}this._eventThrottleMap.clear()}}]),e}(),pc=function(){function e(t){r(this,e),this._funcMap=new Map,this._m=t}return s(e,[{key:"defense",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if("string"!=typeof e)return null;if(0===e.length)return null;if("function"!=typeof t)return null;if(this._funcMap.has(e)&&this._funcMap.get(e).has(t))return this._funcMap.get(e).get(t);this._funcMap.has(e)||this._funcMap.set(e,new Map);var o=null;return this._funcMap.get(e).has(t)?o=this._funcMap.get(e).get(t):(o=this._pack(e,t,n),this._funcMap.get(e).set(t,o)),o}},{key:"defenseOnce",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return"function"!=typeof t?null:this._pack(e,t,n)}},{key:"find",value:function(e,t){return"string"!=typeof e||0===e.length||"function"!=typeof t?null:this._funcMap.has(e)&&this._funcMap.get(e).has(t)?this._funcMap.get(e).get(t):(this._m.outputWarning("ListenerFnNotFound",e),null)}},{key:"delete",value:function(e,t){return"function"==typeof t&&!!this._funcMap.has(e)&&!!this._funcMap.get(e).has(t)&&(this._funcMap.get(e).delete(t),0===this._funcMap.get(e).size&&this._funcMap.delete(e),!0)}},{key:"_pack",value:function(e,t,n){var o=this;return function(){try{t.apply(n,Array.from(arguments))}catch(a){var r=Object.values(D).indexOf(e),i="CallbackError";if(-1!==r){var s=Object.keys(D)[r];o._m.outputWarning(i,s,a)}new Ai(i).setMessage("eventName:".concat(e)).setMoreMessage(a.message).end()}}}}]),e}(),hc=function(){function e(t){r(this,e);var n={SDKAppID:t.SDKAppID,unlimitedAVChatRoom:t.unlimitedAVChatRoom||!1,scene:t.scene||"",oversea:t.oversea||!1,instanceID:Nt(),devMode:t.devMode||!1,proxyServer:t.proxyServer||void 0,fileUploadProxy:t.fileUploadProxy||void 0,fileDownloadProxy:t.fileDownloadProxy||t.fileUploadProxy||void 0};this._m=new dc(n),this._safetyCallbackFactory=new pc(this._m)}return s(e,[{key:"onError",value:function(e){this._m.onError(e)}},{key:"login",value:function(e){return this._m.login(),this._getModule(On).login(e)}},{key:"logout",value:function(){var e=this;return this._getModule(On).logout().then((function(t){return e._m.reset(),t}))}},{key:"isReady",value:function(){return this._m.isReady()}},{key:"isIntl",value:function(){return this._m.isIntl()}},{key:"getNotReadyReason",value:function(){return this._m.getNotReadyReason()}},{key:"getErrorMessage",value:function(e,t,n){return this._m.getErrorMessage(e,t,n)}},{key:"_getModule",value:function(e){return this._m.getModule(e)}},{key:"destroy",value:function(){var e=this;return this.logout().finally((function(){e._m.stopTimer(),e._getModule(Qn).terminate(),e._getModule(Jn).dealloc();var t=e._m.getOuterEmitterInstance(),n=e._getModule(Bn);t.emit(D.SDK_DESTROY,{SDKAppID:n.getSDKAppID()})}))}},{key:"on",value:function(e,t,n){Ve.d("on","eventName:".concat(e)),this._m.getOuterEmitterInstance().on(e,this._safetyCallbackFactory.defense(e,t,n),n)}},{key:"once",value:function(e,t,n){Ve.d("once","eventName:".concat(e)),this._m.getOuterEmitterInstance().once(e,this._safetyCallbackFactory.defenseOnce(e,t,n),n||this)}},{key:"off",value:function(e,t,n,o){Ve.d("off","eventName:".concat(e));var r=this._safetyCallbackFactory.find(e,t);null!==r&&(this._m.getOuterEmitterInstance().off(e,r,n,o),this._safetyCallbackFactory.delete(e,t))}},{key:"registerPlugin",value:function(e){at(e["tim-offline-push-plugin"])?this._getModule(Wn).registerPlugin(e):this._getModule(oo).registerPlugin(e)}},{key:"setLogLevel",value:function(e){if(e<=0){var n=this.getErrorMessage("TIM_ASCII_ART");n&&t("log","at node_modules/tim-wx-sdk/tim-wx.js:1",n);var o=this.getErrorMessage("API_REFER");o&&(jt()?t("log","at node_modules/tim-wx-sdk/tim-wx.js:1","%c ".concat("IM SDK API ->"," %c"),"background:#ff9d00; padding:1px; border-radius:3px; color: #fff","background:transparent",o):t("log","at node_modules/tim-wx-sdk/tim-wx.js:1","IM SDK API ->",o));var r=this.getErrorMessage("DOCS_GUIDE");r&&t("log","at node_modules/tim-wx-sdk/tim-wx.js:1",r)}Ve.setLevel(e)}},{key:"createTextMessage",value:function(e){return this._getModule(Nn).createTextMessage(e)}},{key:"createTextAtMessage",value:function(e){return this._getModule(Nn).createTextMessage(e)}},{key:"createImageMessage",value:function(e){return this._getModule(Nn).createImageMessage(e)}},{key:"createAudioMessage",value:function(e){return this._getModule(Nn).createAudioMessage(e)}},{key:"createVideoMessage",value:function(e){return this._getModule(Nn).createVideoMessage(e)}},{key:"createCustomMessage",value:function(e){return this._getModule(Nn).createCustomMessage(e)}},{key:"createFaceMessage",value:function(e){return this._getModule(Nn).createFaceMessage(e)}},{key:"createFileMessage",value:function(e){return this._getModule(Nn).createFileMessage(e)}},{key:"createLocationMessage",value:function(e){return this._getModule(Nn).createLocationMessage(e)}},{key:"createMergerMessage",value:function(e){return this._getModule(Nn).createMergerMessage(e)}},{key:"downloadMergerMessage",value:function(e){return e.type!==S.MSG_MERGER?Xi({code:gi.MESSAGE_MERGER_TYPE_INVALID}):$t(e.payload.downloadKey)?Xi({code:gi.MESSAGE_MERGER_KEY_INVALID}):this._getModule(Nn).downloadMergerMessage(e).catch((function(e){return Xi({code:gi.MESSAGE_MERGER_DOWNLOAD_FAIL})}))}},{key:"createForwardMessage",value:function(e){return this._getModule(Nn).createForwardMessage(e)}},{key:"sendMessage",value:function(e,t){return e instanceof ji?this._getModule(Nn).sendMessageInstance(e,t):Xi({code:gi.MESSAGE_SEND_NEED_MESSAGE_INSTANCE})}},{key:"callExperimentalAPI",value:function(e,t){return"sendComboMessage"===e?this._getModule(so).sendMessage(t):"handleGroupInvitation"===e?this._getModule(Pn).handleGroupInvitation(t):"isCommercialAbilityEnabled"===e?this._getModule(no).isFeatureEnabled(t):"isIntl"===e?this.isIntl():"sendTRTCCustomData"===e?this._getModule(io).sendTRTCCustomData(t):"getTimerID"===e?this._m.getTimerID():"getPollingTimerID"===e?this._m.getPollingTimerID(t):Xi({code:gi.INVALID_OPERATION})}},{key:"revokeMessage",value:function(e){return this._getModule(Nn).revokeMessage(e)}},{key:"resendMessage",value:function(e){return this._getModule(Nn).resendMessage(e)}},{key:"deleteMessage",value:function(e){return this._getModule(Nn).deleteMessage(e)}},{key:"translateText",value:function(e){return this._getModule(Nn).translateText(e)}},{key:"setMessageExtensions",value:function(e,t){return this._getModule(wn).setMessageExtensions(e,t)}},{key:"getMessageExtensions",value:function(e){return this._getModule(wn).getMessageExtensions(e)}},{key:"deleteMessageExtensions",value:function(e,t){return this._getModule(wn).deleteMessageExtensions(e,t)}},{key:"modifyMessage",value:function(e){return this._getModule(Nn).modifyRemoteMessage(e)}},{key:"getMessageList",value:function(e){return this._getModule(qn).getMessageList(e)}},{key:"getMessageListHopping",value:function(e){return this._getModule(qn).getMessageListHopping(e)}},{key:"sendMessageReadReceipt",value:function(e){return this._getModule(qn).sendReadReceipt(e)}},{key:"getMessageReadReceiptList",value:function(e){return this._getModule(qn).getReadReceiptList(e)}},{key:"getGroupMessageReadMemberList",value:function(e){return this._getModule(Pn).getReadReceiptDetail(e)}},{key:"findMessage",value:function(e){return this._getModule(qn).findMessage(e)}},{key:"setMessageRead",value:function(e){return this._getModule(qn).setMessageRead(e)}},{key:"getConversationList",value:function(e){return this._getModule(qn).getConversationList(e)}},{key:"getConversationProfile",value:function(e){return this._getModule(qn).getConversationProfile(e)}},{key:"deleteConversation",value:function(e){return this._getModule(qn).deleteConversation(e)}},{key:"clearHistoryMessage",value:function(e){return this._getModule(qn).clearHistoryMessage(e)}},{key:"pinConversation",value:function(e){return this._getModule(qn).pinConversation(e)}},{key:"setAllMessageRead",value:function(e){return this._getModule(qn).setAllMessageRead(e)}},{key:"setMessageRemindType",value:function(e){return this._getModule(qn).setMessageRemindType(e)}},{key:"getTotalUnreadMessageCount",value:function(){return this._getModule(qn).getTotalUnreadMessageCount()}},{key:"setConversationCustomData",value:function(e){return this._getModule(qn).setConversationCustomData(e)}},{key:"markConversation",value:function(e){return this._getModule(qn).markConversation(e)}},{key:"getConversationGroupList",value:function(){return this._getModule(qn).getConversationGroupList()}},{key:"createConversationGroup",value:function(e){return this._getModule(qn).createConversationGroup(e)}},{key:"deleteConversationGroup",value:function(e){return this._getModule(qn).deleteConversationGroup(e)}},{key:"renameConversationGroup",value:function(e){return this._getModule(qn).renameConversationGroup(e)}},{key:"addConversationsToGroup",value:function(e){return this._getModule(qn).addConversationsToGroup(e)}},{key:"deleteConversationsFromGroup",value:function(e){return this._getModule(qn).deleteConversationsFromGroup(e)}},{key:"getMyProfile",value:function(){return this._getModule(bn).getMyProfile()}},{key:"getUserProfile",value:function(e){return this._getModule(bn).getUserProfile(e)}},{key:"updateMyProfile",value:function(e){return this._getModule(bn).updateMyProfile(e)}},{key:"getBlacklist",value:function(){return this._getModule(bn).getLocalBlacklist()}},{key:"addToBlacklist",value:function(e){return this._getModule(bn).addBlacklist(e)}},{key:"removeFromBlacklist",value:function(e){return this._getModule(bn).deleteBlacklist(e)}},{key:"setSelfStatus",value:function(e){return this._getModule(bn).setSelfStatus(e)}},{key:"getUserStatus",value:function(e){return this._getModule(bn).getUserStatus(e)}},{key:"subscribeUserStatus",value:function(e){return this._getModule(bn).subscribeUserStatus(e)}},{key:"unsubscribeUserStatus",value:function(e){return this._getModule(bn).unsubscribeUserStatus(e)}},{key:"getFriendList",value:function(){var e=this._getModule(Gn);return e?e.getLocalFriendList():Xi({code:gi.CANNOT_FIND_MODULE})}},{key:"addFriend",value:function(e){var t=this._getModule(Gn);return t?t.addFriend(e):Xi({code:gi.CANNOT_FIND_MODULE})}},{key:"deleteFriend",value:function(e){var t=this._getModule(Gn);return t?t.deleteFriend(e):Xi({code:gi.CANNOT_FIND_MODULE})}},{key:"checkFriend",value:function(e){var t=this._getModule(Gn);return t?t.checkFriend(e):Xi({code:gi.CANNOT_FIND_MODULE})}},{key:"getFriendProfile",value:function(e){var t=this._getModule(Gn);return t?t.getFriendProfile(e):Xi({code:gi.CANNOT_FIND_MODULE})}},{key:"updateFriend",value:function(e){var t=this._getModule(Gn);return t?t.updateFriend(e):Xi({code:gi.CANNOT_FIND_MODULE})}},{key:"getFriendApplicationList",value:function(){var e=this._getModule(Gn);return e?e.getLocalFriendApplicationList():Xi({code:gi.CANNOT_FIND_MODULE})}},{key:"acceptFriendApplication",value:function(e){var t=this._getModule(Gn);return t?t.acceptFriendApplication(e):Xi({code:gi.CANNOT_FIND_MODULE})}},{key:"refuseFriendApplication",value:function(e){var t=this._getModule(Gn);return t?t.refuseFriendApplication(e):Xi({code:gi.CANNOT_FIND_MODULE})}},{key:"deleteFriendApplication",value:function(e){var t=this._getModule(Gn);return t?t.deleteFriendApplication(e):Xi({code:gi.CANNOT_FIND_MODULE})}},{key:"setFriendApplicationRead",value:function(){var e=this._getModule(Gn);return e?e.setFriendApplicationRead():Xi({code:gi.CANNOT_FIND_MODULE})}},{key:"getFriendGroupList",value:function(){var e=this._getModule(Gn);return e?e.getLocalFriendGroupList():Xi({code:gi.CANNOT_FIND_MODULE})}},{key:"createFriendGroup",value:function(e){var t=this._getModule(Gn);return t?t.createFriendGroup(e):Xi({code:gi.CANNOT_FIND_MODULE})}},{key:"deleteFriendGroup",value:function(e){var t=this._getModule(Gn);return t?t.deleteFriendGroup(e):Xi({code:gi.CANNOT_FIND_MODULE})}},{key:"addToFriendGroup",value:function(e){var t=this._getModule(Gn);return t?t.addToFriendGroup(e):Xi({code:gi.CANNOT_FIND_MODULE})}},{key:"removeFromFriendGroup",value:function(e){var t=this._getModule(Gn);return t?t.removeFromFriendGroup(e):Xi({code:gi.CANNOT_FIND_MODULE})}},{key:"renameFriendGroup",value:function(e){var t=this._getModule(Gn);return t?t.renameFriendGroup(e):Xi({code:gi.CANNOT_FIND_MODULE})}},{key:"getGroupList",value:function(e){return this._getModule(Pn).getGroupList(e)}},{key:"getGroupProfile",value:function(e){return this._getModule(Pn).getGroupProfile(e)}},{key:"createGroup",value:function(e){return this._getModule(Pn).createGroup(e)}},{key:"dismissGroup",value:function(e){return this._getModule(Pn).dismissGroup(e)}},{key:"updateGroupProfile",value:function(e){return this._getModule(Pn).updateGroupProfile(e)}},{key:"joinGroup",value:function(e){return this._getModule(Pn).joinGroup(e)}},{key:"quitGroup",value:function(e){return this._getModule(Pn).quitGroup(e)}},{key:"searchGroupByID",value:function(e){return this._getModule(Pn).searchGroupByID(e)}},{key:"getGroupOnlineMemberCount",value:function(e){return this._getModule(Pn).getGroupOnlineMemberCount(e)}},{key:"changeGroupOwner",value:function(e){return this._getModule(Pn).changeGroupOwner(e)}},{key:"getGroupApplicationList",value:function(){return this._getModule(Pn).getGroupApplicationList()}},{key:"handleGroupApplication",value:function(e){return this._getModule(Pn).handleGroupApplication(e)}},{key:"initGroupAttributes",value:function(e){return this._getModule(Pn).initGroupAttributes(e)}},{key:"setGroupAttributes",value:function(e){return this._getModule(Pn).setGroupAttributes(e)}},{key:"deleteGroupAttributes",value:function(e){return this._getModule(Pn).deleteGroupAttributes(e)}},{key:"getGroupAttributes",value:function(e){return this._getModule(Pn).getGroupAttributes(e)}},{key:"setGroupCounters",value:function(e){return this._getModule(Pn).setGroupCounters(e)}},{key:"increaseGroupCounter",value:function(e){return this._getModule(Pn).increaseGroupCounter(e)}},{key:"decreaseGroupCounter",value:function(e){return this._getModule(Pn).decreaseGroupCounter(e)}},{key:"getGroupCounters",value:function(e){return this._getModule(Pn).getGroupCounters(e)}},{key:"getGroupMemberList",value:function(e){return this._getModule(xn).getGroupMemberList(e)}},{key:"getGroupMemberProfile",value:function(e){return this._getModule(xn).getGroupMemberProfile(e)}},{key:"addGroupMember",value:function(e){return this._getModule(xn).addGroupMember(e)}},{key:"deleteGroupMember",value:function(e){return this._getModule(xn).deleteGroupMember(e)}},{key:"setGroupMemberMuteTime",value:function(e){return this._getModule(xn).setGroupMemberMuteTime(e)}},{key:"setGroupMemberRole",value:function(e){return this._getModule(xn).setGroupMemberRole(e)}},{key:"setGroupMemberNameCard",value:function(e){return this._getModule(xn).setGroupMemberNameCard(e)}},{key:"setGroupMemberCustomField",value:function(e){return this._getModule(xn).setGroupMemberCustomField(e)}},{key:"markGroupMemberList",value:function(e){return this._getModule(xn).markGroupMemberList(e)}},{key:"getJoinedCommunityList",value:function(){return this._getModule(Fn).getJoinedCommunityList()}},{key:"createTopicInCommunity",value:function(e){return this._getModule(Fn).createTopicInCommunity(e)}},{key:"deleteTopicFromCommunity",value:function(e){return this._getModule(Fn).deleteTopicFromCommunity(e)}},{key:"updateTopicProfile",value:function(e){return this._getModule(Fn).updateTopicProfile(e)}},{key:"getTopicList",value:function(e){return this._getModule(Fn).getTopicList(e)}}]),e}(),gc={login:1,logout:1,destroy:1,on:1,off:1,ready:1,setLogLevel:1,joinGroup:1,quitGroup:1,registerPlugin:1,getGroupOnlineMemberCount:1};function fc(e,t){if(e.isReady()||1===gc[t])return!0;var n=e.getNotReadyReason(),o={code:n,message:"".concat(e.getErrorMessage(n)," | ").concat(t," | ").concat(e.getErrorMessage(gi.SDK_IS_NOT_READY))};return e.onError(o),o}var _c={},mc={create:function(e){var t=0,o=e.SDKAppID;if(nt(o))t=o;else if(t=parseInt(o),isNaN(o))return Ve.e("".concat("TIM.create"," failed. Failed to parse the SDKAppID, please check the arguments")),null;if(t&&_c[t])return _c[t];Ve.l("".concat("TIM.create"));var r=new hc(n(n({},e),{},{SDKAppID:t}));r.on(D.SDK_DESTROY,(function(e){_c[e.data.SDKAppID]=null,delete _c[e.data.SDKAppID]}));var i,s,a=(i=r,s=Object.create(null),Object.keys(Rn).forEach((function(e){if(i[e]){var t=new L;s[e]=function(){var n=Array.from(arguments);return t.use((function(t,n){var o=fc(i,e);return!0===o?n():Xi(o)})).use((function(t,n){if(!0===Jt(t,An[e],e))return n()})).use((function(t,n){return i[e].apply(i,t)})),t.run(n)}}})),s);return _c[t]=a,An.hookGetAPITips(r.getErrorMessage.bind(r)),Ve.l("".concat("TIM.create"," ok")),a}};return mc.TYPES=S,mc.EVENT=D,mc.VERSION="2.27.5",Ve.l("TIM.VERSION:".concat(mc.VERSION)),mc}();const os=ns;var rs={};!function(e,n){var o;o=function(){function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function n(t){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?e(Object(o),!0).forEach((function(e){a(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function s(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var c="undefined"!=typeof wx&&"function"==typeof wx.getSystemInfoSync&&Boolean(wx.getSystemInfoSync().fontSizeSetting),u="undefined"!=typeof qq&&"function"==typeof qq.getSystemInfoSync&&Boolean(qq.getSystemInfoSync().fontSizeSetting),l="undefined"!=typeof tt&&"function"==typeof tt.getSystemInfoSync&&Boolean(tt.getSystemInfoSync().fontSizeSetting),d="undefined"!=typeof swan&&"function"==typeof swan.getSystemInfoSync&&Boolean(swan.getSystemInfoSync().fontSizeSetting),p="undefined"!=typeof my&&"function"==typeof my.getSystemInfoSync&&Boolean(my.getSystemInfoSync().fontSizeSetting),h="undefined"!=typeof uni&&"undefined"==typeof window&&!0,g=h&&"ios"===uni.getDeviceInfo().platform.toLocaleLowerCase(),f=(h&&uni.getDeviceInfo().platform.toLocaleLowerCase(),c||u||l||d||p||h),_=u?qq:l?tt:d?swan:p?my:c?wx:h?uni:{},m=function(e){if("object"!==o(e)||null===e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;for(var n=t;null!==Object.getPrototypeOf(n);)n=Object.getPrototypeOf(n);return t===n};function v(e){if(null==e)return!0;if("boolean"==typeof e)return!1;if("number"==typeof e)return 0===e;if("string"==typeof e)return 0===e.length;if("function"==typeof e)return 0===e.length;if(Array.isArray(e))return 0===e.length;if(e instanceof Error)return""===e.message;if(m(e)){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}return!1}var y=function(){function e(){r(this,e)}return s(e,[{key:"request",value:function(e,t){var n=this,o=e.downloadUrl||"",r=(e.method||"PUT").toUpperCase(),i=e.url;if(e.qs){var s=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"&",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"=";return v(e)?"":m(e)?Object.keys(e).map((function(o){var r=encodeURIComponent(o)+n;return Array.isArray(e[o])?e[o].map((function(e){return r+encodeURIComponent(e)})).join(t):r+encodeURIComponent(e[o])})).filter(Boolean).join(t):void 0}(e.qs);s&&(i+="".concat(-1===i.indexOf("?")?"?":"&").concat(s))}var a=new XMLHttpRequest;a.open(r,i,!0),a.responseType=e.dataType||"text";var c=e.headers||{};if(!v(c))for(var u in c)c.hasOwnProperty(u)&&"content-length"!==u.toLowerCase()&&"user-agent"!==u.toLowerCase()&&"origin"!==u.toLowerCase()&&"host"!==u.toLowerCase()&&a.setRequestHeader(u,c[u]);return a.onload=function(){if(200===a.status)t(null,n._xhrRes(a,n._xhrBody(a,o)));else{var e={code:a.status,message:JSON.stringify(a.responseText)};t(e,n._xhrRes(a,n._xhrBody(a)))}},a.onerror=function(e){var o=n._xhrBody(a),r={code:a.status,message:JSON.stringify(a.responseText)};o||a.statusText||0!==a.status||(e.message="CORS blocked or network error"),t(r,n._xhrRes(a,o)),r=null},e.onProgress&&a.upload&&(a.upload.onprogress=function(t){var n=t.total,o=t.loaded,r=Math.floor(100*o/n);e.onProgress({total:n,loaded:o,percent:(r>=100?100:r)/100})}),a.send(e.resources),a}},{key:"_xhrRes",value:function(e,t){var n={};return e.getAllResponseHeaders().trim().split("\n").forEach((function(e){if(e){var t=e.indexOf(":"),o=e.substr(0,t).trim().toLowerCase(),r=e.substr(t+1).trim();n[o]=r}})),{statusCode:e.status,statusMessage:e.statusText,headers:n,data:t}}},{key:"_xhrBody",value:function(e,t){return 200===e.status&&t?{location:t}:{response:e.responseText}}}]),e}(),M=["unknown","image","video","audio","log"],I=["name"],C=function(){function e(){r(this,e)}return s(e,[{key:"request",value:function(e,t){var o=this,r=e.resources,i=void 0===r?"":r,s=e.headers,a=void 0===s?{}:s,c=e.url,u=e.downloadUrl,l=void 0===u?"":u,d=c,h=null,f=l.match(/^(https?:\/\/[^/]+\/)([^/]*\/?)(.*)$/),m=decodeURIComponent(f[3]),v=m.indexOf("?")>-1?m.split("?")[0]:m,y={key:e.fileKey?e.fileKey:v,success_action_status:200,"Content-Type":""},C={};if(g){var T=c.split("?sign=");if(T.length>1){var E=T[1];d="".concat(T[0],"?sign=").concat(encodeURIComponent("".concat(E))),C.sign=decodeURIComponent(E),C.signature=decodeURIComponent(E)}}var k={url:d,header:a,name:"file",filePath:i,formData:n(n({},y),C),timeout:e.timeout||3e5};if(p){var D=k;D.name,k=n(n({},function(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(D,I)),{},{fileName:"file",fileType:M[e.fileType]})}return(h=_.uploadFile(n(n({},k),{},{success:function(e){o._handleResponse({response:e,downloadUrl:l,callback:t})},fail:function(e){o._handleResponse({response:e,downloadUrl:l,callback:t})}}))).onProgressUpdate&&h.onProgressUpdate((function(t){e.onProgress&&e.onProgress({total:t.totalBytesExpectedToSend,loaded:t.totalBytesSent,percent:Math.floor(t.progress)/100})})),h}},{key:"_handleResponse",value:function(e){var t=e.downloadUrl,o=e.response,r=e.callback,i=o.header,s={};if(i)for(var a in i)i.hasOwnProperty(a)&&(s[a.toLowerCase()]=i[a]);var c=+o.statusCode;200===c?r(null,{statusCode:c,headers:s,data:n(n({},o.data),{},{location:t})}):r({code:c,message:JSON.stringify(o.data)},{statusCode:c,headers:s,data:void 0})}}]),e}();return function(){function e(){r(this,e),t("log","at node_modules/tim-upload-plugin/index.js:1","TIMUploadPlugin.VERSION: ".concat("1.3.0")),this.retry=1,this.tryCount=0,this.systemClockOffset=0,this.httpRequest=f?new C:new y}return s(e,[{key:"uploadFile",value:function(e,t){var n=this;return this.httpRequest.request(e,(function(o,r){o&&n.tryCount<n.retry&&n.allowRetry(o)?(n.tryCount++,n.uploadFile(e,t)):(n.tryCount=0,t(o,r))}))}},{key:"allowRetry",value:function(e){var t=!1,n=!1;if(e){var o=e.headers&&(e.headers.date||e.headers.Date)||e.error&&e.error.ServerTime;try{var r=e.error&&e.error.Code,i=e.error&&e.error.Message;("RequestTimeTooSkewed"===r||"AccessDenied"===r&&"Request has expired"===i)&&(n=!0)}catch(c){}if(n&&o){var s=Date.now(),a=Date.parse(o);Math.abs(s+this.systemClockOffset-a)>=3e4&&(this.systemClockOffset=a-s,t=!0)}else 5===Math.floor(e.statusCode/100)&&(t=!0)}return t}}]),e}()},e.exports=o()}({get exports(){return rs},set exports(e){rs=e}});const is=rs;var ss={};!function(e,n){e.exports=function(){var e=function(t,n){return(e=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(t,n)},n=function(){return(n=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function o(e,t,n,o){return new(n=n||Promise)((function(r,i){function s(e){try{c(o.next(e))}catch(t){i(t)}}function a(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))}function r(e,t){var n,o,r,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},s={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){var c=[s,a];if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,o&&(r=2&c[0]?o.return:c[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,c[1])).done)return r;switch(o=0,(c=r?[2&c[0],r.value]:c)[0]){case 0:case 1:r=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,o=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!((r=0<(r=i.trys).length&&r[r.length-1])||6!==c[0]&&2!==c[0])){i=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3]))i.label=c[1];else if(6===c[0]&&i.label<r[1])i.label=r[1],r=c;else{if(!(r&&i.label<r[2])){r[2]&&i.ops.pop(),i.trys.pop();continue}i.label=r[2],i.ops.push(c)}}c=t.call(e,i)}catch(u){c=[6,u],o=0}finally{n=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}function i(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var o=Array(e),r=0;for(t=0;t<n;t++)for(var i=arguments[t],s=0,a=i.length;s<a;s++,r++)o[r]=i[s];return o}Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(null==e)throw new TypeError("Cannot convert first argument to object");for(var t=Object(e),n=1;n<arguments.length;n++)if(null!=(o=arguments[n]))for(var o=Object(o),r=Object.keys(Object(o)),i=0,s=r.length;i<s;i++){var a=r[i],c=Object.getOwnPropertyDescriptor(o,a);null!=c&&c.enumerable&&(t[a]=o[a])}return t}});var s,a=["aegis.qq.com","tamaegis.com","/aegis-sdk","rumt-","/flog.core.min.js","pingfore.qq.com","pingfore.tencent.com","zhiyan.tencent-cloud.net","h.trace.qq.com","btrace.qq.com","beacon.qq.com","dmplog.qq.com","qq.com/report","svibeacon.onezapp.com","cube.weixinbridge.com","doubleclick.net","pcmgrmonitor.3g.qq.com","report.qqweb.qq.com","tpstelemetry.tencent.com","insight.cloud.tencent.com","facebook.com","facebook.net","google","yahoo.com","twitter.com","ga-audiences","report.idqqimg.com","arms-retcode.aliyuncs.com","px.effirst.com","sentry","hot-update.json","u.c.b.r.o.w.s.e.r","report.url.cn","sockjs-node","m3u8"],c=["ext1","ext2","ext3","level","trace","tag","seq","code"],u=["static","fetch"],l=(p.prototype.indexOf=function(e,t){for(var n=0;n<e.length;n++)if(e[n].callback===t)return n;return-1},p.prototype.on=function(e,t,n){var o;if(void 0===n&&(n=0),this)return(o=this.eventsList[e])||(this.eventsList[e]=[],o=this.eventsList[e]),-1===this.indexOf(o,t)&&o.push({name:e,type:n||0,callback:t}),this},p.prototype.one=function(e,t){this.on(e,t,1)},p.prototype.remove=function(e,t){if(this){var n=this.eventsList[e];if(n){if(t)return n.length&&(t=this.indexOf(n,t),n.splice(t,1)),this;try{delete this.eventsList[e]}catch(o){}}return null}},p.prototype.clear=function(){this.eventsList={}},p),d=function(e){if(!e||0===e.length)return"{}";e=Array.isArray(e)?e:[e];var t=Object.keys(e[0]),n={},o=(t.forEach((function(t){n[t]=e.map((function(e){return e[t]}))})),n.count=e.length,n);if("string"==typeof o)return o;try{return JSON.stringify(o,b())||"undefined"}catch(r){return"error happen when aegis stringify: \n "+r.message+" \n "+r.stack}};function p(){var e=this;this.emit=function(t,n){if(e){var o;if(null!=(r=e.eventsList[t])&&r.length)for(var r=r.slice(),i=0;i<r.length;i++){o=r[i];try{var s=o.callback.apply(e,[n]);if(1===o.type&&e.remove(t,o.callback),!1===s)break}catch(a){throw a}}return e}},this.eventsList={}}function h(e){return"string"==typeof e&&/^\//.test(e)?"https:"===(null===location||void 0===location?void 0:location.protocol):/^https/.test(e)}function g(e,t,n){try{var o="function"==typeof t?t(e,null==n?void 0:n.url)||"":e;return P(o).slice(0,102400)}catch(r){return""}}function f(e,t){return"string"!=typeof e||!e||t&&-1<e.indexOf(t)||G.test(e)||a.some((function(t){return-1<e.indexOf(t)}))}function _(e,t){var n,o=[],r=e.config;return e.lifeCycle.on("destroy",(function(){o.length=0})),function(i,s){Array.isArray(i)?o=o.concat(i):o.push(i),t&&o.length>=t||e.sendNow&&0<o.length?(o=x(o),s(o.splice(0,o.length)),n&&clearTimeout(n)):(n&&clearTimeout(n),n=setTimeout((function(){n=null,0<(o=x(o)).length&&s(o.splice(0,o.length))}),r.delay))}}function m(e,t){return Array.isArray(e)?t(e.map((function(e){return t=n(n({},e),{msg:"string"==typeof e.msg?e.msg:[].concat(e.msg).map(U).join(" ")}),c.forEach((function(e){t[e]||delete t[e]})),t;var t}))):t([n(n({},e),{msg:"string"==typeof e.msg?e.msg:U(e.msg)})])}function v(e,t){return function(o,r){var i,s,a,u=Array.isArray(o),l=u?o:[o],d=(e.lifeCycle.emit("beforeRequest",o),e.config.beforeRequest);(l="function"==typeof d?l.map((function(e){try{var n=d({logs:e,logType:t});return(null==n?void 0:n.logType)===t&&null!=n&&n.logs?n.logs:!1!==n&&e}catch(o){return e}})).filter((function(e){return!1!==e})):l).length&&(i=l,o=c,!Array.isArray(i)||i.length<=1||(s=[],a=[],!(a="string"==typeof o?[o]:o))||a.length<=0||(a.forEach((function(e){i.forEach((function(t){null!=t&&t[e]&&s.push(e)}))})),0<s.length&&(i=i.map((function(e){var t={};return s.forEach((function(e){t[e]=""})),n(n({},t),e)})))),l=i,r(u?l:l[0]))}}function y(e){return function(n,o){e.lifeCycle.emit("modifyRequest",n);var r=e.config.modifyRequest;if("function"==typeof r)try{var i=r(n);"object"==typeof i&&"url"in i&&(n=i)}catch(s){t("error","at node_modules/aegis-weex-sdk/lib/aegis.min.js:10",s)}o(n)}}function M(e){return function(t,n){null!=(o=e.lifeCycle)&&o.emit("afterRequest",t);var o=(e.config||{}).afterRequest;"function"==typeof o&&!1===o(t)||n(t)}}function I(e){if(e&&e.reduce&&e.length)return 1===e.length?function(t,n){e[0](t,n||j)}:e.reduce((function(e,t){return function(n,o){return void 0===o&&(o=j),e(n,(function(e){return null==t?void 0:t(e,o)}))}}));throw new TypeError("createPipeline need at least one function param")}function C(e,t){Object.getOwnPropertyNames(e).forEach((function(n){"function"==typeof e[n]&&"constructor"!==n&&(t?t[n]="sendPipeline"===n?function(){return function(){}}:function(){}:e[n]=function(){})}))}function T(e){var n,i=this,s=(c=e.config).uin,a=c.id,c=c.offlineLogLimit;s&&a&&(n=new E({limit:void 0===c?2e4:c}),e.lifeCycle.on("beforeWrite",(function(t){n.save2Offline(t=void 0===t?[]:t,e.config)})),e.getOfflineLog=function(){var e=n.getLogs({uin:s,id:a});return n.clearLogs(),e},e.uploadOfflineLogs=function(n){return o(i,void 0,void 0,(function(){return r(this,(function(i){return n=Array.isArray(n)?n:[n],[2,function(e,n){return o(this,void 0,void 0,(function(){var o,i,s,a,c,u,l;return r(this,(function(r){return o=e.config,i=e.bean,s=o.offlineUrl,a=o.id,c=o.uin,u=(i||{}).aid,l=void 0===u?"":u,(c||l)&&a?(e.send({url:s+"/offlineAuto",type:S.OFFLINE,log:S.OFFLINE},(function(o){var r=(null==o?void 0:o.data).secretKey;if(r)try{e.send({url:s+"/offlineLog",data:{logs:n,secretKey:r,id:a,uin:c,aid:l},contentType:"application/json",method:"post",type:S.OFFLINE,log:S.OFFLINE})}catch(i){t("error","at node_modules/aegis-weex-sdk/lib/aegis.min.js:10",i)}}),(function(e){t("error","at node_modules/aegis-weex-sdk/lib/aegis.min.js:10",e)})),[2]):[2]}))}))}(e,n)]}))}))})}function E(e){var t=this;e=void 0===(e=(void 0===e?{}:e).limit)?2e4:e,this.offlineBuffer=[],this.clearLogs=function(){t.offlineBuffer=[]},this.save2Offline=function(e,n){e=(e=Array.isArray(e)?e:[e]).map((function(e){return"string"==typeof e&&(e={msg:e}),Object.assign({id:n.id,uin:n.uin,time:+Date.now(),version:n.version},e)})),t.offlineBuffer=t.offlineBuffer.concat(e).slice(0,t.limitSize)},this.getLogs=function(e,n){var o=t.offlineBuffer.filter((function(t){return t.id===e.id&&t.uin===e.uin}));return null!=n&&n(o),o},this.limitSize=e}function k(e,t){return void 0===t&&(t={}),new Promise((function(o,r){Y||r(new Error("no available fetch found!"));try{Y(n(n({},t),{url:e,type:"text"}),(function(e){return o($(e))}))}catch(i){r(i)}}))}(z=s=s||{})[z.number=-1]="number",z.string="";var D,S,L,A,R,O=["application/xhtml+xml","application/xml","application/pdf","application/pkcs12","application/javascript","application/x-javascript","application/ecmascript","application/vnd.mspowerpoint","application/vnd.apple.mpegurl","application/ogg","text/css","text/javascript","image","audio","video","video/mp2t"],N=/\.(json|js|css|jpg|jpeg|png|svg|apng|webp|gif|bmp|mp4|mp3|ts|mpeg|wav|webm|ogg|flv|m3u8|ttf|woff2|otf|eot|woff|html|htm|shtml|shtm|)$/gi,w=["ret","retcode","code","errcode"],b=function(){var e=new WeakSet;return function(t,n){if(n instanceof Error)return"Error.message: "+n.message+" \n  Error.stack: "+n.stack;if("object"==typeof n&&null!==n){if(e.has(n))return"[Circular "+(t||"root")+"]";e.add(n)}return n}},U=function(e){if("string"==typeof e)return e;try{return e instanceof Error?(JSON.stringify(e,b(),4)||"undefined").replace(/"/gim,""):JSON.stringify(e,b(),4)||"undefined"}catch(t){return"error happen when aegis stringify: \n "+t.message+" \n "+t.stack}},P=function(e,t){void 0===t&&(t=3);var n,o,r,i="";return Array.isArray(e)?(i+="[",n=e.length,e.forEach((function(e,o){var r,s;i=(i+="object"==typeof e&&1<t?P(e,t-1):(s="",s+="undefined"==(r=typeof e)||"symbol"==r||"function"==r?"null":"string"==r||"object"==r?'"'+e+'"':e))+(o===n-1?"":",")})),i+="]"):e instanceof Object?(i="{",o=Object.keys(e),r=o.length,o.forEach((function(n,s){var a,c,u;"object"==typeof e[n]&&1<t?i+='"'+n+'":'+P(e[n],t-1):i+=(u="","string"==(c=typeof(a=e[n]))||"object"==c?u+='"'+n+'":"'+a+'"':"function"==typeof a?u+='"'+n+'":"function '+a.name+'"':"symbol"==typeof a?u+='"'+n+'":"symbol"':"number"!=typeof a&&"boolean"!=c||(u+='"'+n+'": '+a),u),i+=s===r-1||s<r-1&&void 0===e[o[s+1]]?"":","})),i+="}"):i+=e,i},G=/data:(image|text|application|font)\/.*;base64/,x=((z=D=D||{}).INFO_ALL="-1",z.API_RESPONSE="1",z.INFO="2",z.ERROR="4",z.PROMISE_ERROR="8",z.AJAX_ERROR="16",z.SCRIPT_ERROR="32",z.IMAGE_ERROR="64",z.CSS_ERROR="128",z.CONSOLE_ERROR="256",z.MEDIA_ERROR="512",z.RET_ERROR="1024",z.REPORT="2048",z.PV="4096",z.EVENT="8192",z.PAGE_NOT_FOUND_ERROR="16384",z.WEBSOCKET_ERROR="32768",z.BRIDGE_ERROR="65536",z.LAZY_LOAD_ERROR="131072",(z=S=S||{}).LOG="log",z.SPEED="speed",z.PERFORMANCE="performance",z.OFFLINE="offline",z.WHITE_LIST="whiteList",z.VITALS="vitals",z.PV="pv",z.CUSTOM_PV="customPV",z.EVENT="event",z.CUSTOM="custom",z.SDK_ERROR="sdkError",z.SET_DATA="setData",z.LOAD_PACKAGE="loadPackage",(z=L=L||{}).production="production",z.development="development",z.gray="gray",z.pre="pre",z.daily="daily",z.local="local",z.test="test",z.others="others",function(e){return e.filter((function(t,n){return"static"!==t.type||!e.find((function(e,o){return t.url===e.url&&200===t.status&&n<o}))}))}),F=function(e){e.level===D.INFO_ALL&&(e.level=D.INFO)},q={},B={},V=function(e){return q[e]||(q[e]=setTimeout((function(){B[e]={},q[e]=null}),6e4)),q[e]},K=function(e){return(Array.isArray(e)?e:[e]).map((function(e){return Object.getOwnPropertyNames(e).reduce((function(t,n){return"ctx"!==n&&(t[n]=e[n]),t}),{level:D.INFO,msg:""})}))},H=function(e){return function(t){return e.sendPipeline([function(t,n){return n({url:e.config.url||"",data:d(K(t)),method:"post",contentType:"application/json",type:S.LOG,log:t,requestConfig:{timeout:5e3},success:function(){var o=e.config.onReport;"function"==typeof o&&t.forEach((function(e){o(e)})),"function"==typeof n&&n([])}})}],S.LOG)(t)}},j=function(){},z=(Object.defineProperty(ie.prototype,"__version__",{get:function(){return t("warn","at node_modules/aegis-weex-sdk/lib/aegis.min.js:10","__version__ has discard, please use version"),"1.37.2"},enumerable:!1,configurable:!0}),Object.defineProperty(ie.prototype,"LogType",{get:function(){return t("warn","at node_modules/aegis-weex-sdk/lib/aegis.min.js:10","LogType has discard, please use logType"),D},enumerable:!1,configurable:!0}),ie.prototype.init=function(e){this.setConfig(e);for(var t=0;t<ie.installedPlugins.length;t++)try{ie.installedPlugins[t].patch(this)}catch(n){this.sendSDKError(n)}this.lifeCycle.emit("onInited")},ie.prototype.setConfig=function(e){Object.assign(this.config,e);var t=(e=this.config).id,n=e.uin,o=e.version,r=e.ext1,i=e.ext2,s=e.ext3,a=e.aid,c=void 0===(u=e.env)?"production":u,u=e.pageUrl;return e=this.bean.id!==t||this.bean.uin!==n||this.bean.aid!==a,this.bean.id=t||"",this.bean.uin=n||"",this.bean.version=o||"1.37.2",this.bean.aid=a||"",this.bean.env=function(){switch(c){case L.production:case L.development:case L.gray:case L.pre:case L.daily:case L.local:case L.test:case L.others:return 1;default:return}}()?c:L.others,u&&this.extendBean("from",encodeURIComponent(u.slice(0,2048))),r&&this.extendBean("ext1",encodeURIComponent(r)),i&&this.extendBean("ext2",encodeURIComponent(i)),s&&this.extendBean("ext3",encodeURIComponent(s)),e&&this.lifeCycle.emit("onConfigChange",this.config),this.config},ie.use=function(e){-1===ie.installedPlugins.indexOf(e)&&e.aegisPlugin&&ie.installedPlugins.push(e)},ie.unuse=function(e){-1!==(e=ie.installedPlugins.indexOf(e))&&ie.installedPlugins.splice(e,1)},ie.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var o={level:D.INFO,msg:e};1===e.length&&e[0].msg&&Object.assign(o,n({},e[0]),{level:D.INFO}),this.normalLogPipeline(o)},ie.prototype.infoAll=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var o={level:D.INFO_ALL,msg:e};1===e.length&&e[0].msg&&Object.assign(o,n({},e[0]),{level:D.INFO_ALL}),this.normalLogPipeline(o)},ie.prototype.report=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var o={level:D.REPORT,msg:e};1===e.length&&e[0].msg&&Object.assign(o,n({},e[0])),this.normalLogPipeline(o)},ie.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var o={level:D.ERROR,msg:e};1===e.length&&e[0].msg&&Object.assign(o,n({},e[0]),{level:D.ERROR}),this.normalLogPipeline(o)},ie.prototype.speedLogPipeline=function(e){throw new Error('You need to override "speedLogPipeline" method')},ie.prototype.reportPv=function(e){var n,o=this;e&&(t("warn","at node_modules/aegis-weex-sdk/lib/aegis.min.js:10","reportPv is deprecated, please use reportEvent"),n=""+Object.getOwnPropertyNames(this.bean).filter((function(e){return"id"!==e})).map((function(e){return e+"="+o.bean[e]})).join("&"),this.sendPipeline([function(t,r){r({url:o.config.url+"/"+e+"?"+n,addBean:!1,type:S.CUSTOM_PV})}],S.CUSTOM_PV)(null))},ie.prototype.reportEvent=function(e){e&&((e="string"==typeof e?{name:e,ext1:this.config.ext1||"",ext2:this.config.ext2||"",ext3:this.config.ext3||""}:e).name?("string"!=typeof e.name&&(t("warn","at node_modules/aegis-weex-sdk/lib/aegis.min.js:10","reportEvent params name must be string"),e.name=String(e.name)),this.eventPipeline(e)):t("warn","at node_modules/aegis-weex-sdk/lib/aegis.min.js:10","reportEvent params error"))},ie.prototype.reportTime=function(e,n){if("object"==typeof e)return this.reportT(e);"string"==typeof e?"number"==typeof n?n<0||6e4<n?t("warn","at node_modules/aegis-weex-sdk/lib/aegis.min.js:10","reportTime: duration must between 0 and 60000"):this.submitCustomTime(e,n):t("warn","at node_modules/aegis-weex-sdk/lib/aegis.min.js:10","reportTime: second param must be number"):t("warn","at node_modules/aegis-weex-sdk/lib/aegis.min.js:10","reportTime: first param must be a string")},ie.prototype.reportT=function(e){var n=e.name,o=e.duration,r=void 0===(r=e.ext1)?"":r,i=void 0===(i=e.ext2)?"":i,s=void 0===(s=e.ext3)?"":s;if(e=e.from,"string"==typeof n&&"number"==typeof o&&"string"==typeof r&&"string"==typeof i&&"string"==typeof s){if(!(o<0||6e4<o))return this.submitCustomTime(n,o,r,i,s,void 0===e?"":e);t("warn","at node_modules/aegis-weex-sdk/lib/aegis.min.js:10","reportTime: duration must between 0 and 60000")}else t("warn","at node_modules/aegis-weex-sdk/lib/aegis.min.js:10","reportTime: params error")},ie.prototype.time=function(e){"string"==typeof e?this.timeMap[e]?t("warn","at node_modules/aegis-weex-sdk/lib/aegis.min.js:10","Timer "+e+" already exists"):this.timeMap[e]=Date.now():t("warn","at node_modules/aegis-weex-sdk/lib/aegis.min.js:10","time: first param must be a string")},ie.prototype.timeEnd=function(e){"string"==typeof e?this.timeMap[e]?(this.submitCustomTime(e,Date.now()-this.timeMap[e]),delete this.timeMap[e]):t("warn","at node_modules/aegis-weex-sdk/lib/aegis.min.js:10","Timer "+e+" does not exist"):t("warn","at node_modules/aegis-weex-sdk/lib/aegis.min.js:10","timeEnd: first param must be a string")},ie.prototype.submitCustomTime=function(e,t,n,o,r,i){this.customTimePipeline({name:e,duration:t,ext1:n||this.config.ext1,ext2:o||this.config.ext2,ext3:r||this.config.ext3,from:i||void 0})},ie.prototype.extendBean=function(e,t){this.bean[e]=t},ie.prototype.sendPipeline=function(e,n){var o,r=this;return I(i([function(e,n){if("number"!=typeof o.config.random&&(t("warn","at node_modules/aegis-weex-sdk/lib/aegis.min.js:10","random must in [0, 1], default is 1."),o.config.random=1),!o.isHidden||!o.isGetSample)if(o.isGetSample)o.isHidden||n(e);else{if(o.isGetSample=!0,Math.random()<o.config.random)return o.isHidden=!1,n(e);o.isHidden=!0}},v(o=this,n)],e,[y(this),function(e,t){r.request(e,(function(){for(var n,o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];r.failRequestCount=0,t({isErr:!1,result:o,logType:null==e?void 0:e.type,logs:null==e?void 0:e.log}),null!=(n=null==e?void 0:e.success)&&n.call.apply(n,i([e],o))}),(function(){for(var n,o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];60<=++r.failRequestCount&&r.destroy(),-1<(""+o[0]).indexOf("403 forbidden")&&r.destroy(),t({isErr:!0,result:o,logType:null==e?void 0:e.type,logs:null==e?void 0:e.log}),null!=(n=null==e?void 0:e.fail)&&n.call.apply(n,i([e],o))}))},M(this)]))},ie.prototype.send=function(e,t,n){var o=this;return I([y(this),function(e,r){o.request(e,(function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];r({isErr:!1,result:n,logType:e.type,logs:e.log}),null!=t&&t.apply(void 0,n)}),(function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];r({isErr:!0,result:t,logType:e.type,logs:e.log}),null!=n&&n.apply(void 0,t)}))},M(this)])(e)},ie.prototype.ready=function(e,t,n){throw new Error('You need to override "ready" method')},ie.prototype.request=function(e,t,n){throw new Error('You need to override "request" method')},ie.prototype.sendSDKError=function(e){var t=this;this.sendPipeline([function(e,n){n({url:t.config.url+"?id=1085&msg[0]="+encodeURIComponent(U(e))+"&level[0]=2&from="+t.config.id+"&count=1&version="+t.config.id+"(1.37.2)",addBean:!1,method:"get",type:S.SDK_ERROR,log:e})}],S.SDK_ERROR)(e)},ie.prototype.destroy=function(e){void 0===e&&(e=!1);var t,n,o=ie.instances.indexOf(this);-1!==o&&ie.instances.splice(o,1);for(var r=ie.installedPlugins.length-1;0<=r;r--)try{ie.installedPlugins[r].unpatch(this)}catch(s){this.sendSDKError(s)}if(this.lifeCycle.emit("destroy"),this.lifeCycle.clear(),e)t=this,n=Object.getOwnPropertyDescriptors(t),Object.keys(n).forEach((function(e){n[e].writable&&(t[e]=null)})),Object.setPrototypeOf(this,null);else{for(var i=this;i.constructor!==Object&&C(i,this),i=Object.getPrototypeOf(i););0===ie.instances.length&&(C(o=Object.getPrototypeOf(this).constructor),C(ie))}},ie.version="1.37.2",ie.instances=[],ie.logType=D,ie.environment=L,ie.installedPlugins=[],ie),W=new(re.prototype.patch=function(e){this.canUse(e)&&this.exist(e)&&(this.instances.push(e),this.triggerInit(e),this.triggerOnNewAegis(e))},re.prototype.unpatch=function(e){var t=this.instances.indexOf(e);-1!==t&&(this.instances.splice(t,1),0===this.instances.length)&&this.uninstall(e)},re.prototype.countInstance=function(){return this.instances.length},re.prototype.uninstall=function(e){var t;null!=(t=null==(t=this.option)?void 0:t.destroy)&&t.apply(this,[e])},re.prototype.walk=function(e){var t=this;this.instances.forEach((function(n){var o=t.canUse(n);o&&e(n,o)}))},re.prototype.canUse=function(e){return!(!(e=this.getConfig(e))||"object"!=typeof e)||!!e},re.prototype.getConfig=function(e){return null==(e=e.config)?void 0:e[this.name]},re.prototype.exist=function(e){return-1===this.instances.indexOf(e)},re.prototype.triggerInit=function(e){var t;this.inited||(this.inited=!0,null==(t=null==(t=this.option)?void 0:t.init))||t.call(this.option,this.getConfig(e))},re.prototype.triggerOnNewAegis=function(e){var t;null!=(t=null==(t=this.option)?void 0:t.onNewAegis)&&t.call(this.option,e,this.getConfig(e))},te=re)({name:"offlineLog",onNewAegis:function(e){T(e),e.lifeCycle.on("onConfigChange",(function(t){T(e)}))}}),Y=null==(Q="undefined"!=typeof weex&&(null===weex||void 0===weex?void 0:weex.requireModule("stream")))?void 0:Q.fetch,$=function(e){var t=e.ok,n=e.status,o=e.statusText,r=e.data,i=e.headers;return{ok:t,status:n,statusText:o,body:r,headers:i,clone:function(){return $(e)},text:function(){return new Promise((function(e){return e(r)}))},json:function(){return new Promise((function(e,t){try{e(JSON.parse(r))}catch(n){t(new Error("response body is not JSON"))}}))}}},J=[],X={},Z=weex,Q=(e(R=ne,Q=A=z),R.prototype=null===Q?Object.create(Q):(oe.prototype=Q.prototype,new oe),ne.prototype.getPlatform=function(){var e=((null==(e=null==(e=null==(e=this.weex)?void 0:e.config)?void 0:e.env)?void 0:e.osName)||"").toLowerCase();return"android"===e?1:"ios"===e?2:100},ne.prototype.initOfflineLog=function(){ne.use(W)},Object.defineProperty(ne.prototype,"getBean",{get:function(){var e=this;return Object.getOwnPropertyNames(this.bean).map((function(t){return t+"="+e.bean[t]})).join("&")},enumerable:!1,configurable:!0}),ne.prototype.reportSpeed=function(e){var t,o,r,i,s;this.send({url:""+this.config.speedUrl,method:"post",data:(t=e,o=this.bean,i={fetch:[],static:[],bridge:[]},s={},Array.isArray(t)?t.forEach((function(e){var t;null!=(t=i[e.type])&&t.push(e)})):null!=(r=i[t.type])&&r.push(t),s.payload=JSON.stringify(n({duration:i},o)),s),contentType:"application/json",type:S.SPEED,log:e})},ne.prototype.retcode=function(e){var n=this;"object"==typeof e?e.url?400<=Object.keys(X).length||(X[e.url]||(X[e.url]=0),X[e.url]+=1,3<X[e.url])||(e=Object.assign({},{url:"",isHttps:!0,method:"GET",type:"fetch",duration:0,ret:0,status:200},e),J.push(e),1===J.length&&setTimeout((function(){n.reportSpeed(J),J=[]}),1e3)):t("error","at node_modules/aegis-weex-sdk/lib/aegis.min.js:10","param url can not be empty!"):t("error","at node_modules/aegis-weex-sdk/lib/aegis.min.js:10","retcode params should be an object")},ne.prototype.uploadLogs=function(e,t){this.lifeCycle.emit("uploadLogs",e=void 0===e?{}:e,t=void 0===t?{}:t)},ne.prototype.getOfflineLog=function(){},ne.prototype.uploadOfflineLogs=function(e){},ne.prototype.getCurrentPageUrl=function(e){return e=e.pageUrl||(null==(e=null==(e=this.weex)?void 0:e.config)?void 0:e.bundleUrl)||"-",encodeURIComponent(e.slice(0,2048))},ne.sessionID="session-"+Date.now(),z=ne,new te({name:"aid",onNewAegis:function(e){var t,n=this;this.aid&&!0!==this.aid?(e.bean.aid=this.aid,e.config.aid=this.aid):t=setTimeout((function(){n.getAid((function(t){n.aid=t,e.bean.aid=n.aid,e.config.aid=n.aid})),clearTimeout(t)}),0)},getAid:function(e){return o(this,void 0,void 0,(function(){var t;return r(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,localStorage.getItem("AEGIS_ID")];case 1:return(t=n.sent())||(t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),localStorage.setItem("AEGIS_ID",t)),null!=e&&e(t||""),[3,3];case 2:return n.sent(),null!=e&&e(""),[3,3];case 3:return[2]}}))}))}})),ee=new te({name:"onError",listening:!1,init:function(){this.startListen()},startListen:function(){var e=this;if(!this.listening){this.listening=!0;try{var t,n=Vue;void 0!==n&&n&&(t=n.config.errorHandler,n.config.errorHandler=function(n){n&&e.publishErrorLog({msg:n,level:D.ERROR}),"function"==typeof t&&t(n)})}catch(o){this.publishErrorLog({msg:o,level:D.ERROR})}}},publishErrorLog:function(e){this.$walk((function(t){t.normalLogPipeline(e)}))}}),te=new te({name:"reportApiSpeed",override:!1,fetch:null,weexFetch:null,onNewAegis:function(e){var t,n;this.override||(this.override=!0,this.fetch=e.fetch,this.weexFetch=e.weexFetch,t=(n=this.overrideFetch(e.config)).fetch,n=n.weexFetch,e.fetch=t,e.weexFetch=n)},publishSpeed:function(e){this.$walk((function(t){t.speedLogPipeline(e)}))},publishNormalLog:function(e){this.$walk((function(t){t.normalLogPipeline(e)}))},overrideFetch:function(e){var t,n,o,r,i=this;if("function"==typeof this.fetch)return t=this.fetch,n=this.weexFetch,o=function(t,n,o,r){var a,c,l,d;f(o,e.hostUrl)||(a={url:o,isHttps:h(o),method:(null==r?void 0:r.method)||"get",duration:n,nextHopProtocol:"",type:"fetch",status:t.status},"function"==typeof(null==(d=e.api)?void 0:d.resourceTypeHandler)&&(c=null==(d=e.api)?void 0:d.resourceTypeHandler(t.url)),-1===u.indexOf(c)&&(d=t.headers&&t.headers.get("content-type")||"",c=t.ok&&(void 0===(l=d)&&(l=""),d=(void 0===o?"":o).split("?")[0],N.test(d)||O.some((function(e){return-1!==String(l).indexOf(e)})))?"static":"fetch"),"fetch"===c?t.clone().text().then((function(s){var c=(u=function(e,t,n){var o,r;try{if("function"==typeof(null==t?void 0:t.retCodeHandler))return{code:void 0===(i=(r=t.retCodeHandler(e,null==n?void 0:n.url,null==n?void 0:n.ctx,null==n?void 0:n.payload)||{}).code)?"unknown":i,isErr:r.isErr};if(!(e="string"==typeof e?JSON.parse(e):e))return{code:"unknown",isErr:!1};"function"==typeof(null==(o=null==t?void 0:t.ret)?void 0:o.join)&&(w=[].concat(t.ret.map((function(e){return e.toLowerCase()}))));var i,s=Object.getOwnPropertyNames(e).filter((function(e){return-1!==w.indexOf(e.toLowerCase())}));return s.length?{code:""+(i="未知"!==(i=e[s[0]])&&""!==i?i:"unknown"),isErr:0!==i&&"0"!==i&&"unknown"!==i}:{code:"unknown",isErr:!1}}catch(a){return{code:"unknown",isErr:!1}}}(s,e.api,{url:t.url,ctx:t,payload:null==r?void 0:r.body})||{}).code,u=u.isErr,l=(d=null==(d=e.api)?void 0:d.apiDetail)?g(null==r?void 0:r.body,null==(l=e.api)?void 0:l.reqParamHandler,{url:o}):"",d=(s=d?g(s,null==(d=e.api)?void 0:d.resBodyHandler,{url:o}):"","req url: "+o+" \n                              \nres status: "+(t.status||0)+"\n                              \nres duration: "+n+"ms \n                              \nreq method: "+((null==r?void 0:r.method)||"get")+" \n                              \nreq param: "+l+" \n                              \nres retcode: "+c+"\n                              \nres data: "+s);i.publishNormalLog({msg:d,level:D.API_RESPONSE}),a.payload=null==r?void 0:r.body,a.ret=c,a.isErr=+u,u&&i.publishNormalLog({msg:d,level:D.RET_ERROR})})):Object.assign(a,{type:"static",urlQuery:(d=t.url,c=!0,"string"==typeof d?d.split("?")[c?1:0]||"":d),domainLookup:s.number,connectTime:s.number}),i.publishSpeed(a))},r=function(t,n,o,r){var s;throw f(o,e.hostUrl)||(s={url:o,isHttps:h(o),method:(null==r?void 0:r.method)||"get",duration:n,nextHopProtocol:"",type:"fetch",status:0},i.publishSpeed(s),s=null!=(s=e.api)&&s.apiDetail?g(null==r?void 0:r.body,null==(s=e.api)?void 0:s.reqParamHandler,{url:o}):"",o="AJAX_ERROR: "+t+"\n              \nreq url: "+o+"\n              \nres status: 0\n              \nres duration: "+n+"ms\n              \nreq method: "+((null==r?void 0:r.method)||"get")+"\n              \nreq param: "+s,i.publishNormalLog({msg:o,level:D.AJAX_ERROR})),t},{fetch:function(e,n){var i=Date.now();return t(e,n).then((function(t){var r=Date.now()-i,s=t;try{o(s,r,e,n)}catch(a){}return t})).catch((function(t){var o=Date.now()-i;try{r(t,o,e,n)}catch(s){}throw t}))},weexFetch:function(e,t,i){var s=e.url,a=Date.now();try{n(e,(function(n){var r=Date.now()-a,i=$(n);try{o(i,r,s,e)}catch(c){}"function"==typeof t&&t(n)}),i)}catch(c){i=Date.now()-a;try{r(c,i,s,e)}catch(u){}throw c}}}}});function ne(e){var o,r=A.call(this,e)||this;r.weex=Z,r.originRequest=k,r.fetch=k,r.weexFetch=Y,r.speedLogPipeline=I([(o=r.config,function(e,t){var n,r,i,s="number"==typeof o.repeat?o.repeat:60;!o.speedSample||s<=0?t(e):(n=(null==o?void 0:o.id)||"0",r=B[n]||{},Array.isArray(e)?(i=e.filter((function(e){var t=!r[e.url]||r[e.url]<s;return t?(r[e.url]=1+~~r[e.url],B[n]=r):q[n]||V(n),t}))).length&&t(i):!r[e.url]||r[e.url]<s?(r[e.url]=1+~~r[e.url],B[n]=r,t(e)):q[n]||V(n))}),_(r),function(e,t){r.lifeCycle.emit("beforeReportSpeed",e);var n=r.config.beforeReportSpeed;if((e="function"==typeof n?e.filter((function(e){return!1!==n(e)})):e).length)return t(e)},function(e,t){t(e.map((function(e){return void 0!==e.payload&&delete e.payload,e})))},function(e){r.reportSpeed(e)}]),r.request=function(e,t,o){var i,s,a,c;e&&"string"==typeof e.url&&""!==e.url&&r.bean.id&&(i=e.url,!1!==e.addBean&&(i=i+(-1===i.indexOf("?")?"?":"&")+r.getBean),("get"===(e.method||"get").toLocaleLowerCase()?r.originRequest((s=i,a=e.data,"string"!=typeof s?"":"object"==typeof a&&a?(c=Object.getOwnPropertyNames(a).map((function(e){var t=a[e];return e+"="+("string"==typeof t?encodeURIComponent(t):encodeURIComponent(JSON.stringify(t)))})).join("&").replace(/eval/gi,"evaI"),s+(-1===s.indexOf("?")?"?":"&")+c):s),n({method:"GET",headers:{}},e.requestConfig)):("string"==typeof e.data?e.data=e.data.replace(/eval/gi,"evaI"):e.data=JSON.stringify(e.data),r.originRequest(i,n({method:"POST",body:e.data,headers:e.contentType?{"Content-Type":e.contentType}:{}},e.requestConfig)))).then((function(n){var i,s;String(n.status).match(/^20\d+/g)?null!=t&&t(n):null!=o&&o(n),null!=(s=(i=r.config).reqCallback)&&s.call(i,n,e)})).catch((function(e){null!=o&&o(e)})))};try{e.offlineLog&&r.initOfflineLog(),r.init(e),r.extendBean("sessionId",ne.sessionID),r.extendBean("platform",r.getPlatform()),r.extendBean("from",r.getCurrentPageUrl(e)),r.extendBean("referer",encodeURIComponent(e.referrer||""))}catch(i){t("warn","at node_modules/aegis-weex-sdk/lib/aegis.min.js:10",i),t("log","at node_modules/aegis-weex-sdk/lib/aegis.min.js:10","%cThe above error occurred in the process of initializing Aegis, which will affect your normal use of Aegis.\nIt is recommended that you contact aegis-helper for feedback and thank you for your support.","color: red"),r.sendSDKError(i)}return r}function oe(){this.constructor=R}function re(e){this.aegisPlugin=!0,this.name="",this.instances=[],this.inited=!1,e.$walk=this.walk.bind(this),e.$getConfig=this.getConfig.bind(this),this.option=e,this.name=e.name}function ie(e){var t,n,o,r,i,s,a,c,u,d,p,h,g,f,v=this;this.isGetSample=!1,this.isHidden=!1,this.config={version:0,delay:1e3,onError:!0,repeat:60,random:1,aid:!0,device:!0,pagePerformance:!0,webVitals:!0,speedSample:!0,onClose:!0,reportLoadPackageSpeed:!0,hostUrl:"https://aegis.qq.com",env:"production",url:"",offlineUrl:"",whiteListUrl:"",pvUrl:"",speedUrl:"",customTimeUrl:"",performanceUrl:"",webVitalsUrl:"",eventUrl:"",setDataReportUrl:"",reportImmediately:!0},this.isWhiteList=!1,this.lifeCycle=new l,this.bean={},this.normalLogPipeline=I([_(this,5),m,function(e,n){var o=t.config;n(e=e.map((function(e){var t,n=o.maxLength||102400;try{if(!e.msg||e.msg.length<=n)return e;e.msg=null==(t=e.msg)?void 0:t.substring(0,n)}catch(r){e.msg=U(e.msg).substring(0,o.maxLength)}return e})))},(f=(t=this).config,function(e,t){var n="number"==typeof f.repeat?f.repeat:60;if(n<=0)return t(e);var o=(null==f?void 0:f.id)+"_error",r=B[o]||{};t(e.filter((function(e){if(e.level===D.ERROR||e.level===D.PROMISE_ERROR||e.level===D.AJAX_ERROR||e.level===D.SCRIPT_ERROR||e.level===D.IMAGE_ERROR||e.level===D.CSS_ERROR||e.level===D.MEDIA_ERROR||e.level===D.RET_ERROR||e.level===D.BRIDGE_ERROR||e.level===D.PAGE_NOT_FOUND_ERROR||e.level===D.WEBSOCKET_ERROR||e.level===D.LAZY_LOAD_ERROR){if(e=e.msg.slice(0,200),r[e]>n)return q[o]||V(o),!1;r[e]=1+~~r[e],B[o]=r}return!0})))}),(h=this.lifeCycle.emit,g=this.config,function(e,t){var n,o=g.logCreated;return"function"==typeof o?(n=e.filter((function(e){return!1!==o(e)})),h("beforeWrite",n),t(n)):(h("beforeWrite",e),t(e))}),(p=this,setTimeout((function(){var e=void 0===(t=(n=p.config).pvUrl)?"":t,t=n.spa,n=-1<["web-sdk","mp-sdk"].indexOf("weex-sdk");e&&(n&&!t||!n)&&p.sendPipeline([function(t,n){n({url:e,type:S.PV})}],S.PV)(null)}),100),function(e,t){t(e)}),(u=c=a=!1,d=[],(i=this).lifeCycle.on("onConfigChange",(function(){s&&clearTimeout(s),s=setTimeout((function(){var e,t;!u&&i.config&&(u=!0,e=i.config.whiteListUrl,(t=void 0===e?"":e)&&i.sendPipeline([function(e,n){n({url:t,type:S.WHITE_LIST,success:function(e){c=!0;try{var t=e.data||JSON.parse(e),n=t.retcode,o=t.result,r=void 0===o?{}:o,s=(0===n&&(a=r.is_in_white_list,i.isWhiteList=a,0<=r.rate)&&r.rate<=1&&(i.config.random=r.rate,i.isGetSample=!1),i.isWhiteList&&d.length?H(i)(d.splice(0),(function(){})):!i.isWhiteList&&d.length&&(d.length=0),i.config.onWhitelist);"function"==typeof s&&s(a)}catch(u){}},fail:function(){c=!0}})}],S.WHITE_LIST)(null),u=!1)}),i.config.uin?50:500)})),i.lifeCycle.on("destroy",(function(){d.length=0})),function(e,t){var n;a||null!=(n=null==(n=i.config)?void 0:n.api)&&n.reportRequest?t(e.concat(d.splice(0)).map((function(e){return F(e),e}))):(n=e.filter((function(e){return e.level!==D.INFO&&e.level!==D.API_RESPONSE?(F(e),!0):(c||(d.push(e),200<=d.length&&(d.length=200)),!1)}))).length&&t(n)}),function(e,t){try{var n=JSON.parse(JSON.stringify(e)),o=(v.lifeCycle.emit("beforeReport",n),v.config.beforeReport);(e="function"==typeof o?e.filter((function(e){return!1!==o(e)})):e).length&&t(e)}catch(r){}},H(this)]),this.eventPipeline=I([_(this,10),(r=this,function(e){r.sendPipeline([function(e,t){var n=e.map((function(e){return{name:e.name,ext1:e.ext1||r.config.ext1||"",ext2:e.ext2||r.config.ext2||"",ext3:e.ext3||r.config.ext3||""}}));t({url:r.config.eventUrl+"?payload="+encodeURIComponent(JSON.stringify(n)),type:S.EVENT,log:e})}],S.EVENT)(e)})]),this.timeMap={},this.failRequestCount=0,this.customTimePipeline=I([_(this,10),(o=this,function(e){return o.sendPipeline([function(e,t){t({url:o.config.customTimeUrl+"?payload="+encodeURIComponent(JSON.stringify({custom:e})),type:S.CUSTOM,log:e})}],S.CUSTOM)(e)})]),this.config=(n=this.config,void 0===(e=e.hostUrl)&&(e="https://aegis.qq.com"),n.url=n.url||e+"/collect",n.offlineUrl=n.offlineUrl||e+"/offline",n.whiteListUrl=n.whiteListUrl||e+"/collect/whitelist",n.pvUrl=n.pvUrl||e+"/collect/pv",n.eventUrl=n.eventUrl||e+"/collect/events",n.speedUrl=n.speedUrl||e+"/speed",n.customTimeUrl=n.customTimeUrl||e+"/speed/custom",n.performanceUrl=n.performanceUrl||e+"/speed/performance",n.webVitalsUrl=n.webVitalsUrl||e+"/speed/webvitals",n.setDataReportUrl=n.SetDataReportUrl||e+"/speed/miniProgramData",n),ie.instances.push(this)}return z.use(ee),z.use(te),z.use(Q),z}()}({get exports(){return ss},set exports(e){ss=e}});const as=new ss({id:"iHWefAYqmGKHeAqvDB",reportApiSpeed:!0});uni.$aegis=as;const cs={userID:"test01",SDKAppID:1600002539,secretKey:"e05fb6e437025f12385953543c200b3ec90502e6286fdf69eb40a12d0269bdec"},us=function(e){const{SDKAppID:t,secretKey:n,userID:o}=e;return{SDKAppID:t,userSig:new es(t,n,604800).genTestUserSig(o)}}(cs).userSig;uni.$chat_SDKAppID=cs.SDKAppID,uni.$chat_userID=cs.userID,uni.$chat_userSig=us,uni.$TUIKit=os.create({SDKAppID:uni.$chat_SDKAppID}),uni.$TIM=os,uni.$TUIKit.registerPlugin({"tim-upload-plugin":is});const ls={onLaunch:function(){this.bindTIMEvent(),this.login()},methods:{login(){uni.$TUIKit.login({userID:cs.userID,userSig:us}).then((e=>{uni.showLoading({title:"初始化..."})}))},bindTIMEvent(){uni.$TUIKit.on(uni.$TIM.EVENT.SDK_READY,this.handleSDKReady),uni.$TUIKit.on(uni.$TIM.EVENT.SDK_NOT_READY,this.handleSDKNotReady),uni.$TUIKit.on(uni.$TIM.EVENT.KICKED_OUT,this.handleKickedOut)},handleSDKReady(e){uni.$chat_isSDKReady=!0,uni.hideLoading()},handleSDKNotReady(e){uni.showToast({title:"SDK 未完成初始化"})},handleKickedOut(e){uni.clearStorageSync(),uni.showToast({title:`${this.kickedOutReason(e.data.type)}被踢出。`,icon:"none"})},kickedOutReason(e){switch(e){case uni.$TIM.TYPES.KICKED_OUT_MULT_ACCOUNT:return"多实例登录";case uni.$TIM.TYPES.KICKED_OUT_MULT_DEVICE:return"多设备登录";case uni.$TIM.TYPES.KICKED_OUT_USERSIG_EXPIRED:return"userSig 过期";case uni.$TIM.TYPES.KICKED_OUT_REST_API:return"REST API kick 接口踢出";default:return""}}}};const{app:ds,Vuex:ps,Pinia:hs}={app:e.createVueApp(ls)};uni.Vuex=ps,uni.Pinia=hs,ds.provide("__globalStyles",__uniConfig.styles),ds._component.mpType="app",ds._component.render=()=>{},ds.mount("#app")}(Vue);
